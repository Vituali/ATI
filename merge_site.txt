

// --- admin.html ---

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel de Administração - ATI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
    <!-- CSS principal que importa todos os outros (themes, components, layout) -->
    <link rel="stylesheet" href="assets/css/main.css">
    <!-- CSS específico para a página de admin -->
    <link rel="stylesheet" href="assets/css/admin.css">
</head>
<body class="dark-mode">
    <!-- Popup para notificações, reutilizado do ui.js -->
    <div id="popup" class="popup"></div>

    <!-- O contêiner .content é definido em layout.css -->
    <div class="content">
        <!-- Loader de carregamento inicial -->
        <div class="card-loader" id="adminLoader" style="display: flex;">
            <div class="loader"></div>
        </div>
        
        <!-- Conteúdo principal, fica visível após o carregamento -->
        <div id="mainContent" style="display: none;">
            
            <!-- Card de Gerenciamento de Usuários -->
            <div class="card">
                <h2>Gerenciamento de Usuários</h2>
                <p>Controle as permissões e o status dos usuários do sistema.</p>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Usuário (Login)</th>
                            <th>Nome Completo</th>
                            <th>Permissão</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="userListBody">
                        <!-- Linhas da tabela serão inseridas aqui via JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Card da Ferramenta de Verificação -->
            <div class="card checker-section">
                <h2>Verificação de Usuários Órfãos</h2>
                <p>Encontre contas na Autenticação sem dados correspondentes no Banco de Dados.</p>

                <div id="checkerStep1">
                    <button id="loadValidUsersBtn" class="button">Passo 1: Carregar Usuários Válidos</button>
                </div>

                <div id="checkerStep2" class="hidden">
                    <h3>Passo 2: Cole a lista do Painel de Autenticação</h3>
                    <div class="instructions">
                        <ol>
                            <li>No <a href="https://console.firebase.google.com/" target="_blank">Painel do Firebase</a>, vá para <strong>Authentication > Users</strong>.</li>
                            <li>Selecione e copie toda a lista de usuários (Ctrl+A, Ctrl+C).</li>
                            <li>Cole o conteúdo no campo abaixo (Ctrl+V).</li>
                        </ol>
                    </div>
                    <textarea id="authPasteArea" placeholder="Cole os dados copiados do painel de autenticação aqui..."></textarea>
                    <button id="compareBtn" class="button">Passo 3: Encontrar Contas Órfãs</button>
                </div>

                <div id="checkerResults" class="results hidden">
                    <h3>Resultado da Comparação:</h3>
                    <p>As seguintes contas são órfãs e podem ser excluídas no Firebase.</p>
                    <ul id="orphanList" class="user-list">
                        <!-- Contas órfãs serão listadas aqui -->
                    </ul>
                </div>
            </div>

            <!-- Botão para voltar à aplicação principal -->
            <a href="index.html" id="backToAppBtn">Voltar para a aplicação</a>
        </div>
    </div>
    
    <!-- Script principal da página de administração -->
    <script type="module" src="assets/js/admin.js"></script>
</body>
</html>


// --- assets\css\admin.css ---

/* ==========================================================================
   ADMIN.CSS - Estilos para o Painel de Administração
   ========================================================================== */

/* --- Layout Geral da Página de Admin --- */
/* Ajusta o contêiner principal para empilhar os cards verticalmente */
.content {
    flex-direction: column; /* Empilha os cards */
    align-items: center;    /* Centraliza os cards horizontalmente */
    gap: 20px; /* Espaço entre os cards */
}

/* Garante que o conteúdo principal não fique muito largo em telas grandes */
#mainContent {
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 100%;
    max-width: 900px; /* Limita a largura máxima */
}

/* --- Estilização dos Cards --- */
.card h2 {
    font-family: var(--font-primary);
    color: var(--heading-color);
    margin-bottom: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border-color);
}

.card p {
    margin-bottom: 20px;
    font-size: 14px;
    color: var(--text-primary);
    opacity: 0.8;
}

/* --- Tabela de Gerenciamento --- */
.admin-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

.admin-table th,
.admin-table td {
    border: 1px solid var(--border-color);
    padding: 12px;
    text-align: left;
    vertical-align: middle;
}

.admin-table th {
    background-color: rgba(0, 0, 0, 0.1);
    font-family: var(--font-primary);
    font-size: 14px;
}

.admin-table select {
    background-color: var(--input-bg);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    border-radius: 5px;
    padding: 8px;
    width: 100%;
    font-size: 14px;
}

.admin-table select:focus {
    outline: none;
    border-color: var(--icon-color);
}

.admin-table button {
    margin: 0;
    width: 100%;
    padding: 8px 12px;
}

/* --- Ferramenta de Verificação de Órfãos --- */
.checker-section textarea {
    background-color: var(--input-bg);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    border-radius: 5px;
    width: 100%;
    min-height: 150px;
    margin-top: 10px;
    padding: 10px;
    font-family: monospace;
}

.checker-section .instructions {
    margin-bottom: 15px;
}

.checker-section .instructions ol {
    line-height: 1.8;
    padding-left: 20px;
    font-size: 14px;
}

.checker-section .user-list {
    list-style: none;
    padding: 10px;
    margin-top: 10px;
    background-color: rgba(0,0,0,0.1);
    border-radius: 5px;
    max-height: 200px;
    overflow-y: auto;
}

.checker-section .orphan {
    color: var(--error-color, #F43F5E);
    font-weight: bold;
}

.checker-section .valid {
    color: var(--success-color, #22C55E);
}

/* --- Botão de Voltar --- */
#backToAppBtn {
    display: block;
    width: 100%;
    max-width: 900px;
    text-align: center;
    margin: 10px auto 0;
    padding: 12px 20px;
    background: var(--button-bg);
    color: var(--button-text);
    border-radius: 5px;
    text-decoration: none;
    font-family: var(--font-primary);
    transition: background 0.3s, transform 0.2s;
}

#backToAppBtn:hover {
    background: var(--button-hover-bg);
    transform: scale(1.02);
}

.hidden {
    display: none;
}


// --- assets\css\components.css ---

/* ==========================================================================
   COMPONENTS.CSS - Estilos para todos os elementos de UI reutilizáveis
   ========================================================================== */

/* --- Cards e Contêineres de Conteúdo --- */
.card,
.upload-card {
    position: relative;
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 20px;
    margin: 15px 0;
    max-width: 1200px;
    width: 100%;
    min-height: 200px;
    box-sizing: border-box;
}

.upload-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    width: 100%;
}

/* --- Botões da Barra Lateral --- */
.sidebar-button,
.toggle-sidebar,
.dark-mode-toggle {
    background: transparent;
    color: var(--icon-color);
    border: none;
    padding: 10px;
    cursor: pointer;
    font-size: 24px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    transition: color 0.3s, background 0.2s, transform 0.2s;
}

.sidebar-footer {
    margin-top: auto;
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.bottom-toggle {
    background: transparent;
    color: var(--icon-color);
    border: none;
    padding: 10px;
    cursor: pointer;
    font-size: 24px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    transition: color 0.3s, background 0.2s, transform 0.2s;
    width: 100%;
    border-radius: 5px;
}

.bottom-toggle .text {
    display: none;
    font-family: var(--font-primary);
    font-size: 16px;
    white-space: nowrap;
}

.bottom-toggle .text {
    display: none; /* Esconde o texto por padrão */
    white-space: nowrap;
}

.sidebar.expanded .bottom-toggle .text {
    display: inline-block;
}

.bottom-toggle:hover {
    background: rgba(0, 0, 0, 0.1);
    transform: scale(1.05);
}

.sidebar-button {
    font-family: var(--font-primary);
    font-size: 16px;
    border-radius: 5px;
}

.dark-mode-toggle {
    width: 100%;
}

.sidebar-button .icon {
    font-size: 20px;
}

.sidebar-button .text {
    display: none;
    white-space: nowrap;
}

.sidebar.expanded .sidebar-button .text {
    display: inline-block;
}

.sidebar-button:hover,
.toggle-sidebar:hover,
.dark-mode-toggle:hover {
    background: rgba(0, 0, 0, 0.1);
    transform: scale(1.05);
}

.sidebar-button.active {
    background: var(--icon-color); /* Cor customizável via JS */
    color: var(--button-text);
}

.sidebar-button.active .text {
    text-shadow: 0 0 5px rgba(0, 0, 0, 0.7);
}

/* --- Botões Principais --- */
.button,
.copy-btn,
.file-label {
    background: var(--button-bg);
    color: var(--button-text);
    border: none;
    padding: 8px 16px;
    border-radius: 5px;
    cursor: pointer;
    font-family: var(--font-primary);
    font-size: 14px;
    margin: 5px;
    text-align: center;
    flex: 1 1 10px;
    max-width: 150px;
    transition: background 0.3s, transform 0.2s;
}

.button:hover,
.copy-btn:hover,
.file-label:hover {
    background: var(--button-hover-bg);
    transform: scale(1.05);
}

/* Botão especial de voltar */
.button.back {
    background: #6B7280;
}
.button.back:hover {
    background: #4B5563;
}
.dark-mode .button.back {
    background: #4B5563;
}
.dark-mode .button.back:hover {
    background: #374151;
}

/* --- Elementos de Formulário --- */
input,
select,
textarea {
    width: 100%;
    padding: 8px;
    margin: 5px 0;
    border: 1px solid var(--border-color);
    background: var(--input-bg);
    color: var(--text-primary);
    border-radius: 5px;
    font-size: 14px;
    box-sizing: border-box;
    font-family: var(--font-secondary);
}

textarea {
    resize: vertical;
    min-height: 80px;
}

input:focus,
select:focus,
textarea:focus {
    outline: none;
    border-color: var(--icon-color); /* Destaca com a cor do ícone ao focar */
}

input[type="color"] {
    width: 40px;
    height: 40px;
    padding: 2px;
    vertical-align: middle;
    cursor: pointer;
}

.error {
    color: var(--error-color);
    font-size: 12px;
    margin-top: 5px;
    display: block;
}

.grupo {
    margin-bottom: 15px;
}

.grupo label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

.grupo p {
    margin: 5px 0;
}

/* --- Upload de Arquivo --- */
.file-upload-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}
.file-input {
    display: none;
}
.file-name {
    text-align: center;
}

/* --- Popups --- */
.popup {
    position: fixed;
    top: 20px;
    right: 20px;
    background: var(--button-bg);
    color: var(--button-text);
    padding: 10px 20px;
    border-radius: 5px;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 3000;
}
.popup.show {
    opacity: 1;
}

.customization-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--card-bg);
    padding: 20px;
    border-radius: 10px;
    z-index: 1000;
    max-width: 400px;
    width: 90%;
    border: 1px solid var(--border-color);
}
.customization-group {
    margin-bottom: 15px;
}
.customization-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}
.theme-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.customization-buttons {
    display: flex;
    gap: 10px;
    justify-content: space-between;
}

/* --- Switch Toggle --- */
.switch {
    position: relative;
    display: inline-block;
    width: 50px; /* Tamanho explícito para garantir consistência */
    height: 24px;
    margin-left: 10px;
    flex-shrink: 0; /* Impede que o switch encolha */
}
.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}
.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--switch-bg);
    transition: background 0.3s;
    border-radius: 24px;
}
.slider:before {
    position: absolute;
    content: "";
    height: 18px; /* Tamanho explícito da bolinha */
    width: 18px;
    left: 3px;   /* Posição inicial da bolinha */
    bottom: 3px;
    background: white;
    transition: transform 0.3s;
    border-radius: 50%;
}
input:checked + .slider {
    background: var(--switch-bg-checked);
}
input:checked + .slider:before {
    transform: translateX(26px); /* Distância que a bolinha se move */
}

/* --- Checkbox Customizado --- */
.checkbox-group {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    margin: 10px 0;
}
.checkbox-label {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
}
.checkbox-custom {
    width: 18px;
    height: 18px;
    border: 2px solid var(--border-color);
    border-radius: 4px;
    display: inline-block;
    position: relative;
    transition: background 0.3s, border-color 0.3s;
}
.checkbox-label input {
    display: none;
}
.checkbox-label input:checked + .checkbox-custom {
    background: var(--button-bg);
    border: var(--button-bg);
}
.checkbox-custom::after {
    content: '✔';
    color: var(--button-text);
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    font-size: 12px;
    transition: transform 0.2s;
}
.checkbox-label input:checked + .checkbox-custom::after {
    transform: translate(-50%, -50%) scale(1);
}

/* --- Contêineres de Elementos --- */
.controls,
.copy-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    margin-top: 10px;
}
.inline-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: space-between;
}
.inline-group > div {
    flex: 1;
    min-width: 150px;
}
.title-container {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-bottom: 10px;
}
.title-container input {
    flex: 1;
}

/* --- Output e Mensagens --- */
.output {
    margin-top: 20px;
    padding: 10px;
    border: 1px solid var(--border-color);
    background: var(--input-bg);
    border-radius: 5px;
    white-space: pre-wrap;
    width: 100%;
}
#renewalMessage,
#migrationMessage {
    margin-top: 10px;
    font-weight: bold;
}
#saudacaoDespedidaText {
    text-align: center;
    margin-top: 10px;
    font-size: 0.9em;
}

.customization-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.popup-column {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.popup-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: normal;
}

.customization-buttons {
    margin-top: 10px;
}

.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    backdrop-filter: blur(5px);
}

.modal-content {
    max-width: 400px;
    text-align: center;
}

.modal-buttons {
    display: flex;
    justify-content: space-around;
    margin-top: 20px;
}

/* --- Estilo dos Tooltips --- */
[data-tooltip] {
    position: relative;
}

/* Regra geral para tooltips (acima do elemento) */
[data-tooltip]::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: calc(100% + 5px);
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--icon-color);
    color: #ffffff;
    padding: 6px 12px;
    border-radius: 5px;
    font-size: 12px;
    font-family: var(--font-secondary);
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
    z-index: 101;
}

#atendenteToggleBtn[data-tooltip]::after,
#darkModeToggleBtn[data-tooltip]::after {
    bottom: auto;
    top: 50%;
    left: calc(100% + 10px);
    transform: translateY(-50%);
}

[data-tooltip]:hover::after {
    opacity: 1;
}

/* --- Estilo do Indicador de Carregamento --- */
.card-loader {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(42, 42, 42, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10;
    border-radius: 10px;
}

.light-mode .card-loader {
    background: rgba(255, 255, 255, 0.7);
}

.loader {
    width: 40px;
    height: 40px;
    border: 4px solid #555;
    border-top-color: var(--icon-color, #FFF);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* --- Estilos para o Seletor Customizado (Drag and Drop) --- */
.custom-select {
    position: relative;
    width: 100%;
}

.select-selected {
    background-color: var(--input-bg);
    color: var(--text-primary);
    padding: 12px 16px;
    font-size: 16px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    cursor: pointer;
    user-select: none;
    transition: all 0.2s;
}

.select-selected:hover {
    border-color: var(--icon-color);
}

.select-items {
    position: absolute;
    background-color: var(--input-bg);
    top: 100%;
    left: 0;
    right: 0;
    z-index: 99;
    border: 1px solid var(--border-color);
    border-top: none;
    border-radius: 0 0 5px 5px;
    max-height: 500px;
    overflow-y: auto;
}

.select-hide {
    display: none;
}

.select-items div, .select-items .optgroup-label {
    padding: 4px 16px;
    font-size: 13px;
    cursor: pointer;
    border-bottom: 1px solid var(--border-color);
    transition: background-color 0.2s;
}

.select-items .optgroup-label {
    font-weight: bold;
    color: var(--icon-color);
    cursor: default;
    background-color: rgba(0,0,0,0.1);
}

.select-items div:not(.optgroup-label) {
    padding-left: 25px;
    cursor: grab;
}

.select-items div:hover:not(.optgroup-label) {
    background-color: rgba(0,0,0,0.2);
}

.sortable-ghost {
    opacity: 0.4;
    background-color: var(--icon-color) !important;
}

/* --- Estilos para o Formulário do Modal --- */
.modal-form-group {
    text-align: left;
    margin-bottom: 15px;
}

.modal-form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    font-size: 14px;
}

.modal-form-group input {
    width: 100%;
}

.category-group {
    border-bottom: 2px solid var(--border-color);
}

.optgroup-label {
    cursor: move !important;
}

.option-item {
    padding-left: 25px;
    cursor: grab;
}

.option-item:hover {
    background-color: rgba(0,0,0,0.2);
}

/* --- Estilos para Autenticação --- */
.auth-toggle-link {
    margin-top: 20px;
    font-size: 14px;
}
.auth-toggle-link a {
    color: var(--icon-color);
    text-decoration: underline;
    cursor: pointer;
}

.user-menu {
    position: absolute;
    bottom: 110px;
    left: 15px;
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    z-index: 101;
    width: 180px;
    padding: 5px;
    transition: opacity 0.2s, transform 0.2s;
}

.user-menu a {
    display: block;
    padding: 10px 15px;
    color: var(--text-primary);
    text-decoration: none;
    font-family: var(--font-secondary);
    font-size: 14px;
    border-radius: 5px;
}

.user-menu a:hover {
    background-color: var(--button-bg);
    color: var(--button-text, #FFF);
}

.popup.success {
    background: var(--success-color);
    color: #FFFFFF;
    box-shadow: 0 0 15px 1px var(--success-color);
}

.popup.error {
    background: var(--error-color);
    color: #FFFFFF;
    box-shadow: 0 0 15px 1px var(--error-color);
}
/* ======================================= */
/* ESTILOS PARA O EDITOR DE MODELOS DE O.S. */
/* ======================================= */

.os-editor-layout {
    display: grid;
    grid-template-columns: 1fr 2fr; /* Coluna da lista com 1/3 e formulário com 2/3 */
    gap: 20px;
}

.os-list {
    max-height: 400px;
    overflow-y: auto;
}

.os-category-header {
    font-weight: bold;
    color: var(--heading-color);
    margin-top: 15px;
    margin-bottom: 8px;
    padding-bottom: 5px;
    border-bottom: 1px solid var(--border-color);
    font-size: 1.1em;
}
.os-category-header:first-child {
    margin-top: 0;
}

.os-list-item {
    padding: 10px;
    cursor: pointer;
    border-radius: 4px;
    transition: background-color 0.2s;
}

.os-list-item:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

.os-list-item.active {
    background-color: var(--button-bg);
    color: var(--button-text);
    font-weight: bold;
}
/*=============================================================================*/
/* == TEXTO COPIADOS = */
@font-face {
    font-family: Orbitron;
    font-style: normal;
    font-weight: 400;
    src: url(https://fonts.gstatic.com/s/orbitron/v31/yMJRMIlzdpvBhQQL_Qq7dy0.woff2) format('woff2')            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
.password-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
}
.password-grid .card hr {
    margin: 10px 0;
    border-color: rgba(128, 128, 128, 0.2);
}
.copiable {
    cursor: pointer;
    background-color: rgba(255, 255, 255, 0.08);
    padding: 2px 6px;
    border-radius: 4px;
    transition: background-color 0.2s;
    display: inline-block; /* Garante que o fundo se aplique corretamente */
}

.copiable:hover {
    background-color: rgba(255, 255, 255, 0.2);
}

.copiable:active {
    transform: translateY(1px); /* Efeito de clique */
}

// --- assets\css\layout.css ---

/* ==========================================================================
   LAYOUT.CSS - Estrutura principal, sidebar, grid
   ========================================================================== */

/* Contêiner principal */
.chatbox {
    display: flex;
    min-height: 100vh;
}

/* Barra lateral */
.sidebar {
    width: 60px;
    background: var(--sidebar-bg);
    border-right: 1px solid var(--border-color);
    padding: 20px 10px;
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    gap: 10px;
    transition: width 0.3s ease, background 0.3s;
    overflow: visible;
    z-index: 100;
}

.sidebar.expanded {
    width: 200px;
}

/* Conteúdo principal */
.content {
    margin-left: 80px;
    padding: 20px;
    flex: 1;
    transition: margin-left 0.3s ease;
    display: flex;
    justify-content: center;
}

.sidebar.expanded ~ .content {
    margin-left: 220px;
}

/* Grid de duas colunas */
.dual-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    width: 100%;
    align-items: start;
}

@media (max-width: 800px) {
    .dual-grid {
        grid-template-columns: 1fr;
    }
    .content {
        margin-left: 80px;
        padding: 10px;
    }
    .sidebar.expanded ~ .content {
        margin-left: 220px;
    }
}

// --- assets\css\main.css ---

/* ==========================================================================
   MAIN.CSS - Ponto de entrada principal
   ========================================================================== */

/* 1. Importa os módulos de estilo */
@import url('themes.css');
@import url('layout.css');
@import url('components.css');

/* 2. Regras Globais e Resets */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: var(--font-secondary);
    background: var(--bg-gradient);
    color: var(--text-primary);
    transition: background-color 0.3s, color 0.3s;
    min-height: 100vh;
}

h1, h2, h3, h4 {
    font-family: var(--font-primary);
    color: var(--heading-color);
    text-align: center;
    margin-bottom: 1rem;
}

// --- assets\css\themes.css ---

/* ==========================================================================
   THEMES.CSS - Variáveis de cores, fontes e temas
   ========================================================================== */

:root {
    /* Fontes */
    --font-primary: 'Orbitron', sans-serif;
    --text-primary: #1A3C5A;
    --font-secondary: Arial, sans-serif;
    --bg-gradient: linear-gradient(135deg, #E5F0F8 0%, #D1E0F0 100%);
    --card-bg: linear-gradient(135deg, #FFFFFF 0%, #F5F7FA 100%);
    --sidebar-bg: linear-gradient(180deg, #E5F0F8 0%, #D1E0F0 100%);
    --input-bg: #FFFFFF;
    --switch-bg: linear-gradient(180deg, #CCCCCC 0%, #AAAAAA 100%);
    --switch-bg-checked: linear-gradient(180deg, #FF416C 0%, #FF4B2B 100%);
}

.dark-mode {
    /* Cores do Tema Escuro */
    --bg-gradient: linear-gradient(135deg, #2A2A2A 0%, #1A1A1A 100%);
    --card-bg: linear-gradient(135deg, #2A2A2A 0%, #1A1A1A 100%);
    --sidebar-bg: linear-gradient(180deg, #2A2A2A 0%, #1A1A1A 100%);
    --text-primary: #D1D5DB;
    --input-bg: #2A2A2A;
    --switch-bg: linear-gradient(180deg, #555555 0%, #333333 100%); /* Gradiente cinza-escuro para 'desligado' */
    --switch-bg-checked: linear-gradient(180deg, #FF0000 0%, #B30000 100%); /* Gradiente vermelho-escuro para 'ligado' */
}

/* Efeito Neon (controlado pela classe .no-neon no body) */
.card, .upload-card, .customization-popup, .popup {
    box-shadow: 0 0 15px 1px var(--shadow-color), 0 4px 8px rgba(0,0,0,0.2);
}
.button, .copy-btn, .file-label {
    box-shadow: 0 0 10px 0px var(--shadow-color), 0 2px 4px rgba(0,0,0,0.2);
}
input:focus, select:focus, textarea:focus {
    box-shadow: 0 0 10px 2px var(--shadow-color);
}
.sidebar-button.active {
    box-shadow: 0 0 15px 2px var(--shadow-color);
}

/* Desativa o neon */
.no-neon .card,
.no-neon .upload-card,
.no-neon .customization-popup,
.no-neon .popup,
.no-neon .button,
.no-neon .copy-btn,
.no-neon .file-label,
.no-neon input:focus,
.no-neon select:focus,
.no-neon textarea:focus,
.no-neon .sidebar-button.active {
    box-shadow: none;
}

// --- assets\extension\extensao-ati.zip ---

PK
     @u[              Extens�o ATI/up +�Extensão ATI/PK    �D[@�,p�  -   $ Extens�o ATI/background.jsup  
�}$Extensão ATI/background.js���n�@��y�Q�Ը�VA*QH��
��R'��Y�w����R�aġO�c�N\��q��k��7��Ɠ	�1�r)l�~v���1Γ%��!�
mΐ��r�0�y)>,L�f� [W��w�C�����)��6�h�y���%� L�=�N�0̸�y�k�a�| ���q�ҫ@r3�̼Y�!x	4�,�����*��n�j�x���f��g/Γn@�=�Mf�b�B�e4���pk�U%��pw��Α�ߒsxI�4�����e{C��,x�i��F㎾�(�]�\��mx	�]Kt�D�8��wmGa��Q�"sWPh�P�Q�6������X�R��A0�!ؘ�p��!`�ԏ�|J_�St�K��o*�@-�X�^�R�B�9������nIe
��ktZ�
�t��2���U���?�q}Lv�4u�f��pi\���5v�W><����׻�)�Ώ!�@Ү��4���7_�--�A�:[����~ z�흽�f���B�����>���.Jml����;��0Y3�j�]5���u��{Ǟ�� ���8���昶&��d��Ik�,'�-����G��WqGe���6�gȩe�����{8sB%c����DO�_�/���=G��m+b�B�-ƥ�%
��5�!����� ��zJ�Ţ�?Ag���c�I��HA@{Q�r�,V�]�����f*5���l���PK     E[��)ZS  [   ) Extens�o ATI/bridge-injected.jsup% s�=<Extensão ATI/bridge-injected.jsm��N�@��M�1ikp��HM6¡1��X۱)YvI;�i<��s� 0��7������R�i�W��aB��Y�:�V��Ȥ����CN�c��b$R�(��x�3j��.�J5��\1ƚA�u\G"�%�+�R�U*A��rG�H��[,��� �[X�����(P��ԉ�V�!��:������*!������r��gr���a��
�����R$Ll�Df2����c��@-�]GsT��>��0� |3P��Ц�i��G8���忏�Y�F�b]�Kk��d�����ф��`��x�8��x����VtO�{p��ҫSo\�<\�t:A�PK    E[t.r�  �   ) Extens�o ATI/bridge-listener.jsup% S�+�Extensão ATI/bridge-listener.js}SKn�0��A�@��m� #���r��(V��
d�餩�E��U�ዕ�$[N�̆������W��ǲPV�Q�{�J�HJ9w���cQ��h~���8��!��~H�q�~�נ�.���&y�LcP��\G�U��{wET��|Q�%�j-ta�9�,�u��^!1���}�{ȼ@�����^�a�
�/��������&�w �'x��d�,͸4�KP��� $�Bc[�s!�|&����@��r���fst.�Ek٣n�=0R<4�D�u�#x�u&8?��ęfD���O6�1\�h��1��w�lL��� V�0m8q&�����u���1�[�G�o{4	�	�&~p���M�v=v�����n	+��)�r?� 6{�������$
��֦�z���i)ۋf�����;�#Ie��3[V-�O���mx=�.Ωf>�&�hL!�+��\�Q6C���,��Y`޳$����&�8�Ns���P��{d{��B�!��V���9�3�vY�m�g���J���_PK    ]}[�&��  e   ! Extens�o ATI/content.jsup U_�Extensão ATI/content.js�T�r�0��+g���pi&̸iJ-�iw!mRG
��6dr��wp�� ?��v7�Гdy���ݷ{t�h�ڳ;����f��q������h|���?�e)��"{�>����Yzٍ"qk��-�Wt}���)2.�r�6I,~+��Cp�%��A77�a�oa�	l,^�~b|DQx��"��_��L��|1��%�S�L
]"4�k�t{��6�d	�s_���?sš
�%g1�j�`��/ �5'p^����/AT�:|���;�Q��po=,��1��9��	͙Yn�I��3>R��:��^���E���)�Q�M��/J��\K��~��kn��
��lʷ/���6�4�I4�i�V�����q��6�ۉWiDߡ���(�TW�L8�)A[�PZy�s������6}R�s���K�#�F~��E�"������L&��Y����t�*��Ԓ��/��]� $T����EK���m���+�7�����v�����A���q�V܆�ƪ>h�de` v��i���NgF�<ڭ�Ux�Pw\|��$�式s5~��OY]6B��Qf���L�Ȋ������.,w�����a�	�<YXNKx+X�X|�w{�#j|�.��yF���p�4^~�$ͦl���V{d�(��i#�i@S�����Vr-�֨%?�iKU��m�]�o1� Z��n�PK    E[F�q�F     ) Extens�o ATI/firebase-config.jsup% x�a�Extensão ATI/firebase-config.jseTۊG}�*b�#�%�8��a�@l�k��c*��xڙ��E�EO���@`��	�c������A=U��\��C���%�J������@"����oo��V��u�����kU��-V�������Xx��"˕�(#�� �W'V
RbZ"�UX���P��7X�ؠ��	�SW<�SR�!ǵ�Y�-��*��"F�N@�3��D�|;���nރ��@��f&D威�ƴ�=��Fp�n0״=���t�w�W/ַ?o�/o&Y���\����h����هW�N��s6�R
ɽFX���/�ߞ�Y��֯ӫZ"����~���ܜ��{���R��6Z���8��+�����NU��:��@���L���_�B2���?�Q��A失��+ڭ�E�����QU�t&����d�>G+��3�Ԋ��&�n���b'C+���l����V٤f8CZbF�� C��g �R�� U������В�HrN�#իH'�M&WƢ9%2�t/*4M�i	?]x�fC�+�	��F�i��t�7�J�.�%�
�b68�����}�.�V���+�/�wv"��x�E���F�1N�<dqv_���������+�����z{*����Lk�Fa+/n�(%o�ꯃꌖh���a������ ��)�s8�?��R֙9m�~� �˟z��a�C�_=h�Y~)еMҥ)�,���0V�#�j�hT��9�h����c��q�~�����V�t�V1!�C�Z��ߊj�/3�}�/�E��Bd�! /�XS%���P�����'�`� ��\/R��ى���T�5�ʶ�<a���PK    ,[�8d�  �"   # Extens�o ATI/injected.cssup �n�Extensão ATI/injected.css�Z]n�8~�;pH�ʕ�(V,�!M] @۴I�J�mndQ���iчŞd� {�\l�#ʲH�r�JE+����p~>��	x��x�lw��:�x�����������s�����k`���30��j�����s5���_��)&I~J
q���@#];���`W��4�w#0��җ�)LG�K���N"��cv1�W��HI�9���K�  ���86cb4���x6q�"�FN�#�w��9̦�1�A�(]
�x��m����;=��
h��[q���.�8 Y��HH��/+�^�# F��,'lDJpBQVb�d�n�Θ&�#_�r��	��4����c`����< K+����r��.��M�o?w�9���(2��O¾��d�|�!E��[�ρ_���zuރ��Ae2�
99�l� �7ӌ,��cn�=����߷3L�LKU��ݣ`ЉY:1�p<8<t ]:i����hp؅��&��oK���A7vmb!z��K�P�1�ܔ�pA	�.�X�8�3�",�X�`+W�K��s�칮�����%t�n�k��P��\� 9�f���2��.�Z���a[U�t �ű��8*r'��gK_xΫ#��"wa(\M}��=�/4~�,3JB(��r�#��MI��u&Ӝ��|�$͸�^���_Y=��m�z�4�����Tş^�=�uuz�"Q�}�s�ch_�,#N4~u�.��������˓�\�/ߝ_^�\����ޝ�d���P�|u��ޜD0�-�Z����y>��=����@���(�0�1�7�	�S�Q�����L��[�-~��y6����'}�z;�TD)K26pY���O3}�	�8��2���y"]���f2C<�:�Р��	!e�TI��:o����
�mZ`a�|���Ű�x�ig}5�p����&V\y͘��ֺk�2��s-�6d]���
c<M,�-���0#���q��B�!�9˨�.F��o-v���+��l!û�OJ9����l�.��f0����
`�sQh�UMJf�^s�.�����淮a��eh�h@Kn��T��P+ �UԄ����r!p�rV�)��io��$�"I�6I^����nDZ��똀�RӠ:�ܾl����W�$Aem���Qb7�?M#W�I����߶|�R#8�T�22�PV�x�8���nv��"&�!@��R���d�?9�~w*���[��B�^�`�%->q�݌�ww~(�<�]���˫�7g���<�X p����6ۣH���&�2��o>l�)�}U.D>/џ��d��~ax`�3�ΰ^������a��nBѕ�#�MFw��En����d�"Pn����\�e�����4�5L����|mp�h�u`�i1�� z�Pb^��4�꽻j*����K���U�>vy�Z�{��r��"&9��%�ۑk|=�VM�y�ޚ�<��Vղ��Y@�;� �@6�Ix���F�[�5��jv��1-FP	���{�~�Ca�-+c�5y�dZ�U�pğ�D���ʐʌMqc�4¬��b:Ey�k��ՠ��-��,�h���ǐǔdw�4F�h\q)��v�Ԃ̈�}S�G0��b���w[U��4nNV���W3�v�P����!�X�J9:3Ix�qF����tc�9��t�sEՔ�tَ�۵i��
��ۀ�ؖ	�5��~Q��r��q���5n&����	�BIT8V���xq8�,�~5�h6� q��c���3�e���o�J%���Op6��xh�6p��7�6��I�b��G��F[	%��F<r��ӼV-�\���b�v�>�BX������wLDo�$���0�� �[^����J(~����Jc��g&���ne��N�M��֢+��Sge��
5*���"2�f�^�bՄ��a,3r��Ʉf_[U���1T�A��WR�?���j�&�!��g{-Q���\����:��*"��W�Q׉,��U���7G���ި�\'��PK    m[���W  �*    Extens�o ATI/logic.jsup p�Extensão ATI/logic.js�]s���]�b��&`S����Z2�2�T��e�%�����ɳ�$+
��Ч��2�L���W������8����&1ɻ�ݽ��:�X��k�r������`��)��d��{p���Z{���O���5��bFY�Bƈ�'<��,�j?��q*6��k 	O�$��_�n
�'�J�܅�C�Op�{*?��g�7��B�q���ӌ��6���@}_/�,� b΍:�[n"e#3Dr쬟�E@5/�rp�<�dQE>��/	J�|c�D�C�����}�-��[wwJ2�Ez5�rj"/e*F�gZ��^Z�<[6s��#c۰���1�9!�%�<�,I��%�x� ����ې&oý��M��Y�ͨ�9=��s��gkk�b{�(���Yqb���m���>f�J�ir���F"�C�xie�v���ԟԌo��:u
օ����l��̟���*)l/�R�Ѣ�A�ܼ^B�<��Y)��CkIJ�B�AH(��rw���Da
%"�8<Id��zc��Y8a�,��\Tj�n�\|���O#������n��Śg��+��-�/�QOj_�p~_F;��S�j[૸��g�C�W�B��Cʢ����J����}#�W���h*�W�Xslr�e۝�U��_t�2ҏD����#Y&�}������tt�؛�3�6<�r�0�1����L�����/�Z�6uA�$ q!�"�#ʯ3� ^�BK1����mD\)4��R��֪���LXz�?ŋ@�a�Uru�L��U?����z�����j���[�!G)��(9L�>X�����	j!��<ѱ;�;��P�P�.x�3<Bi89�Sb�ξ�Uzr��%�J^��d4�Rӎ��X�.� �}���w���G��[�1�\�u��Y����B�̒�e�j"d^-�i~�@(��+�A�,�1o��[9��C��lOD��Mhf=9a�}��x��Cش/m8�3���9ˌ������b�����@����ED��R#<>y��]aB%�?��	��&p]Q c_g�H�<!��Wǜ���>;�̍K��s���X8��KhC���6B}'m�9�!ɯq�Em���*O%+z�Y���E��,82�>��;6ťÏ����&�	�n�?��2�2������۫O�#������B����I�۴`ު�h97}�,�܂�VkǺi,/����]���k�Md��f���* 0ȂbY�|LϽ'-\M�f�c���#'�?@w��;�2t�VTjxOtt�"���C9"O���	��l��-��VSƐÒ�
m��!�{,E�I���R��(xpB��i�{	��u8������������3����ӵ�6�ݽ㣽]l���ۺ���k��������g��������g�۷
 �����un�^��0��)e�?�;���Bǐ�.�)���-�əc�1�e���P��Ty�8��N�X��?RR���҃	(3H�L�,j((���Y#!%zp�p)C��c�ա�:�������2I�U� UγB��)՝��0h#BөB�/C�R�Ujx�j��a=vv*�N�+߿Q��Y�w�<�t�"z��z�b��sX0WBY��F���E����Е���]���	p�_� �uN���8w�!��(n 
�|e~��
QC�q�ǖ�6���	�w�����kS]��D8��݃�{'ώ�}h��*�����JJ�)��:��""@u�{2W,�C�#_�,/�ݑ_�uR��l���X�Z7b�NH5}2Co�vd	+a	�]��H�����!�V��⨵�m�~�xW�7MoS���db�*L�:S�o�����"�u��R�N�?m��4S�"� h5Jy�/�ZKy�{��R��	�pĴc���vN��!x"�y��i��z�8�θX%��lNh����t4�����1������۝}Kwg�ٰ3�����)M���!f�7�P$�Ӗ?�w ������!o颒������T���PP��#"��î�ep���E`&D���;$N�6����K���n�Kݹ��0Hj!���boE5�UMz`�Vc���H������=��'{��I�˱R>�BL
�%Oz�R� �|R,;M]9I��S2��~u)�s5��0Ô_@��}�f���B=)-���d�e�4oV�l9EQr�N*�W2=�e�!gqc5t�m�u��iú=�0}�$�,�̳D�E����^�c!�����B##��ؙ�>P�.
��.U�B�$w"��n�y��������L��L��M���Ͽ�G��:07����0�$G�+pA�H{K�����R�
�Qm�	l��v[����O�{Em����R�	dT�>��<�=F"Qi��ѡ�0�Șfѐ'z�*�Qh��-�h<V].��b�ӯ舝Y	����x2œ���bǭ]�ޱS>|�-���=�U}�3���9����r&B6�M��\i�2E�ځ&�~m�b\˾Y�h�ң![��*҉Ӻw��{� l��"*�6?wWWSAPgi�͆y_�l�����T���泫b6M��3lF�ãbU�E�ن{�����a�[?�2�&�u�yu�6������������ڊ@�J)��X��)E��s�������U^��M=���ո��i���j��o��\r��G�Z�їg�y-fN1⺡m���%���Y���9���0�R͋MIqk@�EHm�F��f�';ke=D ��;������W��#�)~k�!	J�mH�68���re�P�$,��\�2_�˱����t��ծ���mV����\�o�F��|@�͟#��ߦ$��m��IE�d��ԩ����n2v\���PO|��	�6��u���2xbh��l|�UA�!F vx���{���2�`ͨtA$�XI���o��=�moc�������2�N�Q��!�����	?�-�ppqf�p��T�~2H��X���W{s�^����3�(x�\�����^�����7)�_Pv�OsH�t�L�����'}������٢���l&�SaV��5���>�>��7&�W����(�Dn_f1ᱮP��ѓ�At3�����ç�|xa|ـg��ٵ(GN�f<d�M���3g��_5��]!�[�J��lgI9K5�J����9��Y3�E����~�'�Ф����
��7ֱ�������0����¹���ר���3!?b�daF��>n��Z\�g��6�+
�z4Z�-2�œ�/��<_��m����د��	gi�L���o�G�=Al�(�����3)�5�<mY��pi�D�����$ẞ�߬J2T|��/�?�D��.I�9e�r��R��ǰo���"dP�&���(_]�F��:��=G��ʡ��~�2z8���4�PK    S}[/��|�  '   $ Extens�o ATI/manifest.jsonup  n�rExtensão ATI/manifest.json�T�n�0��Gǖ���-�Pti�:H�"N�Y>GU���~�y��X��,��Ӵh5�����xO'B�J����
�#Sʩx7%�yq�QL�E�@9�Ņ�RS��7N6��W���Z�F�,U��_��@h�ƍ��3�(P0ĕ�X��<C���g#@T`=q8#�|�rVhr!�cίlb���B�r�AyZ��[�ʩJX�Œ��g�5zH]0�F;�ǻ&��p�����r�8Es���C2�#9~U�@�1Y���:�>P];�Z�s�s�T������'Z�"N��)u�YS�zpt��
����h�t-���w�wU�z�h�Л_�e,"��=>�\96�6?�-h�O/�x����6V�� �-򸤌kU�H%'V%
`	��%����w�OZ�a|�d�b�g-&�X��g����X�C��Ι{�����z��T�d�(�1�:���Ȼ�`9����[uL8�9ea;��MFj�VӞ�+�c���F������vu�迖�:����C�Fa[]����&������*1���r�2�:��ļヺdjIg8ɉ�@�6Z�ï6ϓ��u����V���n���J7��N���6b�����]VE'�-��:���J���b���X*���7�[~��>FL�7��`H��Zc��R��3�1��Lmy��\m�K�o�&���Q��fm�h_��@���Gr'���OPK    E[8��D1       Extens�o ATI/popup.cssup (^��Extensão ATI/popup.css�W͎�6��;�(�,V�^��=Eh�"��S�HfC�*Iywcl/=�9�
��'��uHI�$��M���kr�~��7��V����=�O�y�(�����4��x�L_����q�ea�`�d�5�`�l,^ٰ��O��,����S��y���NQ��Y6�͓��*IИm�O����p�d�9�&��n���2Vpq��?`�~z��~dKU�x�W��3j���0Lz���7��ݿ����wߊ�/{.6~	˜�L��1K��ZU2@PmҞ�mz�zۗ<��̧���2c���K��\��-�İ<�� D�7/�`2B�w�cWM'��� \wvLy����\()3�<f�/��-�#�V����R0�?x�xj+kU��s
�(���w�`��#]��Ǹ���{`c��Xi�Y*.-Ꝅ/@*��0{K1
�3�=��G��ݸ8�f����^2��6�~�[�(�L��N 3P��#������0���/���n�u�HNq�P�r�pV���J���7�A��JQ�.�c#A&[�_EK�����-�
u&�eDnXeՁ�H� �R^�l�}+]�89���X���y�je����)�;����Rή�\,�X�`��D�u����Һ%)�����)��	�j%sXS7�օ���P��92)i�/	MFf��'ހ�S��� ������ŀL���-�a^����X���H�mK�[��R��av����].�ƾ���%�t���E%64W[M�h1"�d���v�E�#9��,���0Ϊҍ��mCa�EWn��u�%n�V��(F�ip�=���}��7o߾�������;	`���j*��ja�uwr��i�)��o?�ԗ���Წ�	t����UC�O�F��ʵK�sP���}E���
A�� ��S���Ze��!�v�r���|o*g�g���g�;�b�1׬�a��&A�\�,OX��OñV5���Ѥ���\X8�<�L����r�LȀ�z��v^�?�=ꂇ|V���Uc�),C��D^Y1QGi�)��>\�qi�KӴ껵�����{O�(6r����A1Gv�?�g��;�W����9+�FN�6��*>4]���IM�;znm��BQw����!F��ܘ���>m4�Ȱ��{/�{��%�(a2Aq��H����`r���r��¼��~�.u�d�w�]E6���u]������i� �Y��)��s��讝�T�FMW��t8�{|����HT�:%�ѩ��x�
*G��o����;>�/�>I~�L��C<�����a����u�斬�uu�s���PK    E[uq�%   �   ! Extens�o ATI/popup.htmlup ^C�Extensão ATI/popup.htmlmQ�j�0��+����@qeC�zj�G9�XY2�&i��Z�}��\��;�H\=�>T��'���2�+]S���:�ȡTeD�$a�e�
�V=�wl�Ȑ�rU�@
kiZPV�N�#|4�枎�sD��N	�A+Cc\���I��kf��(�9�fY�q�h4���˙����r�FW���?���"�.��d��尹R��0����9�O}>v-b!SU�}�Lu}����NZ�h�]�0��sV
>��qŰ1~�PK    E[a�*�	  r"    Extens�o ATI/popup.jsup œ�KExtensão ATI/popup.js�Y�n���)#��Pk|teE	l�i]$1�8��55Cˌ��X�W�.�A�]tu�'Ћ��Iq$�hQ�F3�����ɴ��\'4�.p�+�rV���w�2�xOҌe��d��<����W*�Q����Ne�4�trVj�dL�5~*Y���K�,N����CF��z�}$��+B*��P
�b�L�{?[^fq$�P �0m�]I������Vy�.Xe�mr�*h���)�TtAw���p-�6~$j�r�ͭ�|^�m�!F��w����fSY,w�6�.�[~�E�v�7�a�?����>�"�+�e4����M �#�'�q.}��z�"N��n>��o�vWT�;��M���}} �a7XBv���Y���h6�+çϣ���)��?��dNJfR��L���lJgs,U�D)��
.��ө`o���D���fV������xL��J�>�hR?X��q"(Qz)X�q: 3�r��h�p���d��>X\+b߷�/c������ժ��x�4�)�9%����TN�$+�<�_s��&�9��`�X���4�����]�%�������)O)�+EN'T�M��W	�M�������ڛ �{���dk#��TPeUR��\�8���#_L�[9u�CY��vy��Z������ۦ|��q�	Y{�u��',�QM�@��%���'#o�t�ہ����8?L�ѹ��I�*�����Ц���`��q�f3�1g*"���&'$�Y���<�^�����5\���5��Ϋ�z�̌\3�p�gZ�?Fί?�F"� ͍U;�`M�9c��S�@u������� GW�ݒ�$��F~���j��h	���n޽�2���;y������hq��$�N�J�l�����\W���q@j(� ��)n$���o��y��1�3>l8��_n���g�*T�a�n*����OSb���q�d�
asZ]R��C��9=!a��-$��y�,mip7f���Ǡ�wX�̷Z�*�'��C��>2�×��/�+��Ef0�h�+�1%�!�G�����Vʴm���@ғ.�
>�9�z��g�n�&%Z��y���wc/O�$q������v���4���i�9F����m@Ax����*��0���@	�8z'!�~+*��`͔)%��z�*ީQ�`{�Iڴ�n���y�H�`Ԃ��I��Y]��}��B/�)�.�{��� �~
�"���f��>C؉�ۋ��,���ޓ�`'i`��1�̬�t�]�l/T���������o�^��S":H�� aJ��(�$��!�~�x���lQ�*g_�L!c�a,�l�d.�Ń#�����E�X�$dY����Pd'n��Dƌ��T�^rР�3	%����48�ɉZPW:F��nn�LZ�c��6H�1���X��6���Ɠ�ݻ�4�T�l{���.N7@$���@N�P��%���,��~��,2V��������A�.�	F6a�;��gX��t�y�N</ս�`��8>�d�v���S5�3���Ur"��g���͝T����U7!�tz�D	Z��$U�E���S�c�ڋ��kA�:]�H�$����>�Mt�w�gg2���,���"��L�1�žP�*X3���Wrء}����s=~���X�8��e&e��:"���3�0�}UG�o*^��+־F��y���e;l9Ų��b��`w���7���K�K��#���C���gu�0H�H�CC!~M�EM�I��Pi�2~s)�+��������ذ͠�[wP_\�����Ҝ�#@!��es^Ծj�V���gG�����{�`�T�$���bV�{���~��� �:d��]�:qr��)�E��5l��W�A��S~��������!x�Q0�9���S#��y"z9g h��Ń�c|�UPXY����mR��W�/ ��w��Y���+���6��o ��쎌q!�	��I�h8���ㄦ�<1[��M�u�^��|��km;�^km}]��A���Uo�A�ZwBE����&6�v_�e��]�۹67\L�w��)2�b�{�P�ʲ6���3�;n��P�B[+;Z�]&\��xC&�,���(rQ0�^Z "�Y7ǔZ�J�5�%��7�3��������|�7,�
*vw-3�K<`�j��r���������`�'���N� �֖O6��+���Q��4�0�1D/��r��{C�(ǀcJ��ڐ�G!�؈%�:U��c�����o7�K�9�')��K���*��pf��q�X��PK    �z[��T �  B+    Extens�o ATI/ui.jsup ����Extensão ATI/ui.js��n����_1�!���d���V�,���Jޠ��#r$1�8�t����E?`чE����U?�s����%��bixΙs��{{$���쒷��d��9:>띐�h<>��x���ry(������_.z�a��dx2�_�ƤK̄�$4f�2
��<�X�5��O��R����%����8�;��uMc��[V��|���v���${������1�����b<2�`DNG���wq�v�{1�5KC7�yH���Y��B�p�,T�M��dʦ |����ff~���A/IX���eÀ�J��H,F��
�&1K�8�($;�
�����v"y��fc冂D�+�g�5Rģ��L��mH��{^9����4Q=_D4q�k)d�I����(M�rG��t0�O�nY�mdf�ME���"��Z>L���%���j��Β{4x�����$;؝q���Pg*)��BªN�c�|�c��Jq��MS?��(Z��䍺+@��_|&J�83? �,��8.��y|�LL��>F?S9V�9��B¿hu?	
O��%s�Z�]0
&&����R|�<� �'�:���?|��c餖4��4fC�޶���&ۊ��UH]���ی���H� ������kxO���6��t��2��LFO@o�p�C��+�R�� *9~�����	�.�̅o���i����K]fY�uw$���n�yvEG�S���s�3б��i��N�d�^*��lR?�kJ��x�D�XXgTfB�#��*>�1��l�aSvC�":/�/�,�B�J�|n����ai�z==xv��z�7=��PU;�(���_@��4��Utm��C��
�-I�p?N����U���<���ܨ�Z"A��B��%��\B��s��qs����ɨ݈�+P@��C���b�2�
�v�#��c�9Ų`ٝ�Q,،�A���\T��V���v���"�M�6�*�(����~����)+|o����L�}aU���L��hBwe��y�f�l/%�,!��){�G�@��B�O���Ħ�4M�F��e-�q⋺�lP�>#5�
�L�9�C�$���`��bіyٴ[\%�e��´�+W~�	I���b�lw���ە��M�ؠuZ�6�;M�a`��Y햬>�7��۶ڿ��TVLp��%f(�A*ǅ':��

���S��w�:9�-�>��}�]�n�2u|n0�����'��"����H�M�LWF&�;����pv������߇r>>>����'d�#0���Pj����C�<�i�CX�:��aX[��g<�g���漲�[�ǅO�/���%�^�xQ�c
�������B�*F�R�<��e��
n�
�L���yü�R�O�y�tH��I�%����}���gS��y��Ѓ~8��d��
��'�W���o�3�>|~�����XuH��l6<�~|\�O�w�C�?��8�n���O'oYJ�L�w��U�\;�%���4��,-늈ْC���,cw�
�S�$��!�W�TT�����(n�G�a�ư�\PŦŵ�IL�I�	���>�(�J�I�۱�Ը+X�������~����iG ?TS�r{���7��<EXhb� ���r]P���J�J'�U���i�fŐM��R��,��5gE�rx{�Y&Y��&`d�M6T�{�~yl5�z�� �CmW��1�@��I�8c�"]J�k',D��2E�Ț`w
�k�$E�c�+�n�/�f�=!�y(�Pɋ*��G
�n��ڍ�;��E���P����t��@Sw�e��JQ%.�_�<��N%�3��"���ˊ���U����k�ɸv�>�%�o��E��(Mb.�w�"�y
_.���D��u��&Xl�e�,jC�ۮ2׶H���B�k�H�9�u�|������ɀyխ��ŷ괚ݝm�
�Zn�tˁtI��60	K���mw���3By���k<��V2��!����1�Jy�1���d��Ւ����g���m*��� ���*!ME>���
Ԑ�x�����Px�4�'��c�[�6}Z��̟a���"����<ɳ���1����lfK����{A3�|ߦ�
�8x]-�����}����+D�����D�v���r� �eh��������l�_��V(6�.�(4�Ġ�h�OB!H(JD�p��?��C�od�#q��Gr�m4M��JWo�<[�Z��xu���d4O��d8~{��eA�������*gF-��"C�����>�)�UR�w��W�X}v�{�>�����-u<�8' �����	U���b)�:C��^�F�!D�e�P?dq����hB���h0<M*�vW�U]S).{�a�c8����ɐ*>�"�P���At.�Ù8dH���7�qӜ�~G�m�K�U���𤍼�|[�:��a?4�hd�Π�5y6���H���c^�U}N?F�>A(�`�o�pO�����mE/��3I�(/��Ԉ�[UY�Z���9ִ˭2�Oۮ�A�r�
Z��tA?����W�K,�����ѳ4�HW�5��.��f��~��ZHj/7����ߊ��\)+?��z�|����$�FO,�ڴ�}vM�!���̋/:�)�0�}��L?V]%��,Xh���9�����ǣ�FM3���:�l���o�I��] 	%��_s�M���g�|�;=�ʅ���fB-��LB5�V1�y4�,�m$���Y֓_D����&�pRV����}X�
���-I��u�t���[��Ou�<8E�v���Ӫw��+����yKe�bi�s�n�/L�'����PN^c�> ^)�S@/@��/A���1�$��-�4F%
������B3�._$(��* �'1�"��~�l�p(^�7to��D��M}��3\�I�D%p�2S�ew6�V��Aہl?�|U|nr�<���×��������.��S��&����Yȁ7��z�q!;���n�W��q�����2�--���E����ї����H��N�.~�oZ���
d�~v~����E�&��#�ߠ�?�%e���x����3�[<���N��=}ٶݾl����B�*��-�Jr�2:7�Z�p���ו8�L�n��n7Tv��H^�9�(��WW���+h�X��0�&g7��Rݒ���`���v9�S��6�(փgPȧl��-��/�k^��ؗ-y�l��}�V��i����<��¯�v�T�/sg�R�%�OV��"El?��+1������T�)P��c K������5%/��PQ��j(�7�R��7�PK    [ɞ� �  �+    Extens�o ATI/v2.jsup �'�Extensão ATI/v2.js��r۸��@ԌI�Z����[�(��jǱ��Ig�f�	IL(B@'�W�δ�:}��2{�ә��&}��B? 	P�,�98�����no����Gm���e��st�;랢��/{�{G]t�}�E���翗���ѳ�������8MI�ґ��^���'A2>��>A��%S�^�"�$�p���	P�##��`oc�3D�%�LS,G��-,S�v������o���?%i�<t:��(�����Y$�!>�ϨH��F.��9�-��c�(�C�rX�s�@`����N�n7����Y8z1�x׻m{��S�1��	�D8"�8%���M/����Ӑ�	�&~����T�"F@:�'׭b��#L$_.�(A>�C��� /�� ���3<! u�p�����)�|����<� �7���b@�O�$��I�*��q�Lͅ��s�n]nJu�YuR�w����M���S���x^���]��q"\�F'}A��טK��$���xM�X|KpL�F�9�*a?���IJ"@�{pV�o�_��I��}zZ�ϰ�#�q���F^a��f8GX`)[ɶf�0'��d���7��'�B���jm��f�,��h�1�@�ƺ�]e����s<AQX�bm�m>q��l����S�[?���(K&~�i��C^�f�m(�+0bv��!I�5��[%�S��JUojʮ	z��!��n��Ո�ۿ>�m!�����B.0�����7�x��tR���u:��������f�b>�e�qh���F��zl1gهQR��&W�Wo��B�F�4u�lh�m >kנ@�*b3D ,h����*%}}ۻ_������nWP�8��mT��Pd0��XDS���2��Xa,*B����Ә���V���0�ܰ�MSߛ����ĕpH�1���Tf'�?��~�~Z��8 �Z=���H"H��|��RP�D�y������e�0Ia�Pl��.Ɉ�� l���'���eиq#��*��M2� ֝ҏ&�靠 �%k����K���=��HY̥-,ڮ��I�M�F��#�/��,a�$��<&�/6T�JA�@4�6��i�k�q��K�p�Q_���}B͊�����H(���2(%2k���k��2�M�����$��ycLSȣ\����5N ��h||-͌|D��K�i.�-��A>��?A��YЄf�qc63GAj�^��y
�d�m������MB�º,2��Q�6���<�﷗/NeI�U�m�ܬx��]�������
����6���>��@dH��nK0�q�[�{���O����k��n�wP�i�sY?��ym+��(+���zE�]��2V�ȣ���$7��r��K��5��T�")i��o*8��VWy���5�踮�Y�p�� J�p�}����9����K�6	h�ðm��bö�����"��=�{/R���Z�m
�,���DÖ�faN�:#�8��L�`隢)fX�`��4lm�@�$������E����N]X�� �{�,3Kjf釫���up�d �e��NF K��!=d� ʥP��IV�
twu�����'���}v,s���� �!��d�l�#E$�`G�2���q�D��D*^Ƃ�Zu��Vմk��,r�V���ξ,��5�p����Z'����pZ���M��q�\�l�]|g���z?�z,��g�9*���C4U�~��$�����:��e�C���+�z1��z��nf뙙�"�۲��{�,&C�yد�͈�f�I����WI�����u�wm��_��Lk�Ti�N(d$Ρ��B8�n! W�Xe�>���{+��o�Ǜ��n}Ey�rKa��$̂j06�1�W�B����J�5If�W���Ǐ��D:��t���h�"�u��֬���Ǐ�A�]���1ކ<��t����f�,Z(�j�K�����Y^5�k���懜�=/�IV�.=�S���*(�qs�M*��kW�SՐ�i�x֨�v:����ǌNWT���p�l��V�j�q*Ƃ��m��j�۫sVU��2V�h��W^��C�*�`��6i���:����蠟�%yӵ�],��d�h����gw�U���
��8�Z�L^�]����*��U�a�}z�2u�	�?:8�ق�d"����]'��\�Q��$�rrΟ���n�E�^)�<�Ʉ𽚼���RXa��H*V�%#�'���G�C^���`�Uv�SW��f�u��TH�m��+CS��_*���1���(�l��m/� �L�!�B!���~���]�Ж,�LZ��5��@�H��ngM����l�	�Gt�89�R�8��`L����9^�7D�p�q�i	GX��Lq����8�%��Gy٢�k�a�v������� 8T8p��F	�u�sW@�GO|o1���j�45H���C��z���$>�Ɠj@�2�=p�M����Q�c������h9�,L?n���p���j]9���\a�O*N}�aɤ�M��`6���f�u�/F�j�n�/�%�$�${�Gc�Xn���[v1�<�Iu��Ft[U��HF��)B>A�z�&I&gs�z�`�l��T�X��E�,&[���BDDa`�*IL���;�w�}e`�nn�KO+A��I2�,'�eZ����^V��EB�
�`�	�%�`ϨS`p�D�.9��d��ժ�v���ܣ)3ڗ��+t'�*�[�RO���&��m�AJ���s�{#��s��"�����PLKc\�|ΕT^�9zI��r!���&�d��U/0��uƆ)��Π����t����huD�N$��}~1����>X��M:K&	�Yc5��i���i8g�� pf�^CՀ��AߑX�z�A<'��b5�=����H��柙S4ȩ]�М�z���W۬�ݪs^�ݽj�(��1T��W�|���3SFd�=���L$N� +ax+��9�N��_�D�4�LY���M�?9tj�j5j
r/qj�[�F�pMi.�}:����aW~��;�����_u������^����-����`���TG+/�_�BU1�Ų�k��|�m���eT&���
�q�Bw����~$qq�9�mjEQ0���+�HfHY�Kyu�%!��.g@�/PK    Cu[��Q�u  �U  $ Extens�o ATI/jquery.min.jsup  �g�AExtensão ATI/jquery.min.js�;�w�8���s���h���(i��V�0-,쁁�v�$���Jcp�`+m�u��߽�?޼�p�m�����~Kv;����ɦs�h��`��:t�:oWR����"^���a�:�
:�^Ȥ3��N�˵���?��8�:�T����u�k5ÑTr����S7��ė�%��7+�;�8XG�q����U��t��rĳ�R*=�0Mw��jVv�i�az��7%o:ϓ$N(��ȯ�0�i��܄* ��P/�I�q"�:Q��m]�K	�F�C%�-ȵ�����E��Pr�Çk?��RL<���f�+��%����9���� E��+|�G���S�wf~"�a`�f �Vц¼ �SĻZ���ـxys+q��P��ꊯ%|-���"W2���� |[�r�$b��䐢��m� �^^ʤb��8��v�Cjݡ��-ߴ��Q�(�
(� a�۲�"�Ă���r�C�&3|(`��/o��������Y�Ds��p��*�N�`�H_��DԔ��$\���(�-o�@m��	M:����$^�����f��o�0�8� m��ÆH?��*8]�Q@c6X�	�;pn��e|-��m���F�ƲG����2��6k�&a!o��b�[�o�?ZcW���ˋ7��B>��i
2@7gr0W ��6]5�ϐ`���Ei����|�-�O[\Y���kxw���<(����p����YVH\�0�8�����l.�Z���_���wІ��LN�TR��4[�f�~W���;kE]�AC�<�g`]]Pz�(w�u�i����v�܀:�ظ%��7�]y2��D����sm���hε?���iwV��ɕ4�5�)㲲��Lym�0&Qo��g�6*%v��8-�U�J83cIEJ�5��%�.�2�zhS+��a�en,n?�2F#E�0I�}�W:���.H0�Z��`K�J�w�Huo���Y\�����_[v�U:ד=j�������'B9�:��/�y��C��~jK�ɲ})���<�p�EG	O�����y�r��[��z�GmN\����t�c�VO�`���M���j.����:���H�5�ŉ��@���z=����e��gYF}��bH|�7i�ώӓ�1��b����xm-W"�D{�|�dLͧO��9���s| W��]���&HC(�Ł.�D����|D��j@���s�,��=�5�Dw�q�(��F�n@�^�a��������6��A��h������b�`�2^o�3I��gGW����=8��u��_C�wcC4=*�Wu���Ƣ�U�����.�̉�ߎ������DoԥZ�T�Ϳ�ׅ��&��apPk0��T�m|��>_���>B��"b)���D�=��#�jC�}�l|�r`^�UlϤsm'�C��}�;�Y��Y''�3+�ݑq��?�&⃱K���le�s8��(D����m�!H�ee"�ݐ�@��M �^�c���x�.��i���v�Br�����af6`��?�H�?ZKW���"�V��Ö�w����#�ǥwV��&:��n��]��4���ô�ڟ��� B��#7-�S����y}�Z<��� 2JW���ŕ!W�%���EY&�.�
���q)�>�Ѕ��(Ɣ\��P\,�z:��r�wPNB�g�|-`D�A��U� �.�q��~W�'�1 f]ؓI0� ����E�V�S���eC�9�J]2�P�$>I��^�Yq����`�	���C�I�դ�黢hZ��a��x�^a�F�TKvp�Y^Ƒ�-s5����%>�,�̽6Ƌ��f]i�w�wlr�yQ��FF;g�iu�˫緫��Z��M��הt��7�BMJ�Lz�G<����d�+����(��}]٬\
2�No�S=�&ө�N���R�?�R��� ��e��ݏ����x>�e�Yp@8�"�xf�u�&�6 �o��Rk�pA�;iS�i��
�z�����Dt�:����t����^
���\��t؟ގ���_�^��?���ۿ@���������*�[5��1�1G����q�r�{d:%= i�'���g�Z �e1��� h���.����<��D��R2��W�Ü���m�8#���^�x�o0d���Ny ��E,%?G���*�9h����dG3�6����qm7�� �C��7��-����,^�t�f����v'5o@�&3��8J�@�e�a�_F0`�TY�.�UA��-בW���t��bm��4s͠# \�K,�|�����/�����;�L��J���`؟�`=�WvebR���E����A���+���ZhK�><P�ٔ�vL	�LI�cfY�t��+A�j��R��q�l��2X��e��̇, ����u[`��j9ߴ�C�?`�
@'O{߼�~�
�vw��)�~n�2�l'p� ���ݫ3���S�'�=}�����k��/����k��ɡ���..޻;�w������@���W�w�q��J�xg�ZgJ/�_?X�ΰʕ��>z�|o�a��Ab�6�@2
|�TV����h �l_��%	a5��5�3�;V� J� 5�ޭv�6��[Q&�fW:�첪U�,�@�66��i�c1�8ȩ������Z�#Cz�����Z�X1��}��4���v�Ot�z������_��	��6D�G���-�U�]�{#�[�+�����<~��IYY�2�N�ck��$^��΀��enk�ӧ�a����_�����#Ge��<z8�*ǛzA�Vދ��}��jraM�T�<�Q�J�l���%�s& ��%����@p���ݗ��C�G�902��R�w>!hj����og��-��/�� ߉��E9K��kǷh+`Ye�#�����l��w�~�S������>X9�R.�W�iM	}��JY���jˬ�W��OV�%&k��� �K��?e�h���k�z o����c(֓�g`0][�#�k�y���U A0kL�� ����K�F��E� ���q�[�9Ϋ*��p�G(����WA���6E���¿�����f��<�8;��`^R��!�������e�A��1���и�|$,�o��,[� �\�,>��*�a�
��HLjOS�=�1	���T�x+܃t��sXD,h$��d)�M��~�E�	���O����5�N��N���D4����c[T�=&���_��6tf�W��tB��<T�ݛ;,��;Nql�$��Ha{�0������\+��G�b~Z�βS�zj�g�fC��K�>�3_���� ْ�d�.¹���2�|�j��E��/'��j[�}P.v��*�y\��E1��UT�J~�S�fB�8��BWLtk��F�8{��۳b<'1������O�EA(��~Z�K�}8��]���9���һ��W�ȿ�������4��w�3L�jYVo�څ�=��mpmr�i��V�Oꗫ~Q9ݸ:������Fߜe����P$M��}&'J$����4Q �T�����ߒ�?��8m���V�Xa�P/6��~��ݔ���po���c�k�"�'�^�W+㧢k*�G/,��;2Ͳdp#/����m(�v,ӝF���8ih��������1iH9�ق�A��z�Z�z�D�`x��� d:BqP�͚�eK�n��Gw/�\�U��VZ�*��L�W���,����T�1��#��C�����tv�,M_�ispe�v�腟�C�~�:��HL���=;8�n����<��L��DK!��o�;v|��k�Va9Π�&~���oS��8�iY����3c5�t'�v���I��d�~��˴vt��.��l$������I�أ�V����������"��@�8�E;$33y�#B{����"J�~��x��֒֏xRY�q{3P��}u��|jS���Q�rqW����`����1�8	Vr�w��= ��y�Y$r.<蔎�A����ɑ��Ħ�Ր>f����+�w�Ҡx�8l#��槄�s5)y����ۨ�^��F2[� �Y|��6t��=���̠�aˠ�O����uі�U�-�g���LEB{[,5�ַT�������;���î��@��\�T������br�Z�Ѿ��}Y@��U�ʴX5���|�x�l@G �r��R��Ta�Uq�b.��eq><���{�!E����*=��#l_۩�T�j6��PD3w7�'FgRc6��o�	���w��uc:!6�Q3��eR<��^���8��A�� ���ώB�#ܸ�-J<"|UĐ�g��S+��/2����Ns�8ݢ���!`Y������2���f��qȶ"&�+DUCS�Ӓ��=��h]��L�W����}Grvd�예٬�v�g!:4t�w��~i���6����K�L���<R�;�llO������B��8��݉-��M#ۻ_}����v$�U"g�
�-��LS�vH=)pg�B�D�0�E�4���{s���v�k��<�ip��p)��M�1�fu����ƛ�JG�,���~�-J
Jq�Ma��{fsպ���������\���<�I�]�"�>rk�ߥr��n4�=��n�+�������5�����/Oۻ�x��tZ���W6'�:���yxa��>��}@'C�ǻw�(�-혌0y�����#OP�]��l~�c�W�}|��h�a�_LY�W��?�m~��]:��;��+1=b㜶\)�k�!�?{�G�1Fz��	@����<������AP|1�؎��������qv&��im����yS(���p�\�c����R4��]�l�3u�Q���~��P�Wő�f�❙m"�a�A�Ap2Uk���#<n��\x��G�ms����C{�`O)Atۤ ����'����i�]�c)�8��3Z������y�~�ebmY�kk0���G��8��Ml)1ñ,I0P��R�l��h��u�1d�;�Àdt�v�Go��4F3��Xw����3ts)��������N�}U��ť�f�����X�
ԫU��֙�>k ��#�悞.%����=�'F6w,I�ѫ.���ֵ0���d�o������ʻ�6��W19Y>tؔEg��d/�g;;'��!$cL4 ʖE�g��Uh�����꫺�*��g���l،�~���>	@��oͭ�G�iל��^��1ܒ�F����ʍ�<�� �Ո���R�M,z˒ޕ�{q���Y�՞���\nHd���]9�@�jOk�m9q���Q9��F^�sL�J����'̕X�	�'��\���dr.nv�RS�]� ������l?� �R��dR�I���O&[����nF�)=�'̌ �T�N�|����؞�d2��9SnR�X��������$�q�G��>b������;�f�<@��{��wk!�dZ��n�.p^H@����N�`�vw��� ˒�eZ1ɹ;�o��r8��V�t��}�%bh�I���k!��Ӹ�8�i��؜����*R�e��~W��� �
�ǽɭ���I��J��_��I 	�HOc�Tzu,��'=3�	K�?%q� �9ݒ�X��<Z}UZ%���i2VI{N�l&3�f��K�{$��`i@�AatH�
�7��(��	�"m�?�ۼdF�K��F�[�kF���,�
�
�>lLx"R�`�qv�����k#@1�=���6�l&Hr�nmd��x���V�a��0�.��p�� �w�����U7*Vx�sn���Z�A��X��K:Rb#��X�*.��jZ�Hi���3�'��⛖)�q/��:y>� �JQK�<���o&�@y26��nP�M�%�`�k�ۊ�m��v��INH#}���l'6߅��\Hk���S!��2��?ߴ��em��9���jjۉ����x��D=5Pd��@��H%�]$��x5�L����?�c����M�HM�����'�X����j�l��v���ͰN}^"��mg����xh�@#���k�+:'�EN!��tϬ�T���$:˴��Գh���M�w�	_!/�Va����[p,�t�-�E6U���9��H\<���oo��Q2#\�d	;�j�E4��!�Y��Њ��!hMƇ��b:-��0"reIP��7E|��HH��W�פ�r���Գ�yq���2��,t�KD�,��L{S���La��EB�K��knn&t����_��D����rY���7:�V��<��S��+��n�6�Z��@܀�Tl���[�p��,�5��#v
)���A��P.0I���͕N�����@}��{'�^��B;01z��>Z�ko�{��g�+�D��=��G:���̤��%��iG��#�mU)��7{�oK���p��)H_�/��TS�ծ�&���.��C.��ro9aĞ�R���FB"=[y���ɠb�u�F��W5jQ⥩l�Ǽ���G��sFҁ��L,t˃N����ѥ�}-L�M �^�.	 �I���Z���4�v�9l`�2u�&5W����8�r4{���1�̗�P.�J�cϼ�i��bm��0�p��[j;�ź�SԈ�2��i�cV��� �ˋ�K�)r���g}�Ho�B����;�A�g���+y-�|E �hW���6Wt��QB߻ƽkNx�E���s��!���9����8(l�E�L9�.2��ֲ: }x�9��8�%ck��F���0�#8'R|�#v\D��V�����ና��$�R�䕸I�A	�U�T~���~�+��A��>�
���v�(+��uy�/ �H9���A�!�6�k�d4�H���סt��:jt�X�{3T8lX�L� ��-1k�AQi�􂍴���6Df�,�\6`�~�� �ħ��F��s�uֱ�b�6��Ep��'��D�������քu���mh)�*��bao�j���r��á��8Y����M�pk.j�Z�.�5���V�ڳ-�l��]�`CڜX7�R��z��:k��(����&�O�%�y�"���z��N�7)��r2�Q��Bgj-��Y�<��})���A��Z�~P5aŒ�T�8�%VK��]eﻻ�Ģޘ�j�)����_���@��Z����5"9J{~8][U퓓�-G�¦c���^-�6��#	&�tI$1����n\5R��O�1`K O	Yǧc�B"U4�s�{���3���I�إHx|<UZ��ёhn8N���E��p��W��s8R� V�.&����3��Ŗ��G���&��Q��Lg �/A΂�C��-��*6�o%�!�>B�yc�0
�c��h�7���-4W0F�D�����%�X��$s?%��b�{���ZwXm:�2�#��˽��niG749b8�7�?�3T �1Ή؝��R�B��J�.�����̗�����:?���{�#�R���	=Q��(�9���ω��v���3	;��j�#�����1�楹��%�@��xD�DL��>��&���4��W`����d⑕|5�dEg U*pQ�Al�:l�+a��^vЖ�F~"�#���VQв��Z��G'~��1FҲ�����r�Q��EA��JO��Z���2���[N�	9U;!Ǧ�䖵�r.�v�p{�o�?��@6�ql
�����A��(�D���V���dV�Uϲ��l���]���Vx�za���&�ք�q���K d'�k8R|~Kz�-i.P@7	o�z*M��j��6��M�X�:��t�#��ʧ��B_W���B���m����|jҤ�	S��"�^�N�1m˧:�@y����(�PqO��q�\ʧ~0Lk�u�c��T�ô.
)3��ZYT�j�+e}5��4���[�80��pT���%39��6�vWD�t�Cf!72�t�;�Ե9�ٻ.�U<��^������!��^��W���Ū�����~�Kj;�@�nc�y��/��꒭���Zu��U���G�^o���y�������'�fM�|p`q���qI*�Tn���q��U��M����59��n�"�!������u�iJe��-I1�v�_q,��x,��gƾ�ꩥ�����8ID���z���Iԕ���@�żt��S�6*f���R�YZ����e�eR32�3�p��^��,��n,���?��i�鐷g42-�A6,��E�0o"Ӯ��ΕU~,W�޿�u=�/V�_~���.����è,S��[�����4�J��K�ʜ�I�����j(t��X��ּ�պ_h�& �E��D8�袔�]f�Eث�W�gras�+�cegy�D8�(q�׍�/�e��~Y�_��~�u���V���d�3zE�*�Z�����`��`�1��`��m4��VNI��nZ,ul|fp$��|��R+��< ^�Ƚ��_��0D�Ҩ�|'(�r�����ML,]��@C���"F9���5�>�تe��h��sV����ۭw��ǶP�KhGw��p���_�^k��Z�.�����w��M���QD��L��s��9B��v�N�2[$}r�W!��#wD��y��ձ�u��QXݼO����G�FBg	l+*���d��������8I�s8H�k�;�鼓(z��qi7qc��̪���s���F�~�"�AK���9�1gY</�4X/��qL�-�uabf.��e��E	
x�\K��ټ��_��7���]��9J4i�Ga���>\zn�I�)[v~[��}�n*���Y��k|���J����8�Q���Z3	�yV�������7�4)h��Z�cm�!��םr$�X����H����O�>�Z/�����ྼ	ZU/PVx1l�uDy�}?�B��hl�E��6�\�L�n��w+45��r�%�v�f�8��&VR�q�1�)QW,փ%����iSQz�{����~��Ae&�%��C�hl��Gө��{Wl���������I�A�CP2a��G���ϖ�6�k�=�fcA{�����W� b�#x�eZ���ʞ��Y��X�n�%\��M�5���~@�t�.x���z�h��L	�_�歗
e�����mC�J�?+`�^��U��Mi�2�
���XޱC/��Ȱ��8�fs����pc��j���E0{+R�Zy���9cj�N�K�4�P�r����2q�'e��gO�m�p�g'(Tj�4!:�yqͦ{�|�*�p��
N;��suV�.�ړ�(m��i�{����G�-ng=IQa�{29G��)-$]���F�Q�<&kQ7���4#��#QK]ve`"vXM��CoVn?>�� -\s8�¹�2����N&�٬��w�I'�D"(�S���h����,|�7�2V{������j=��#z��7o����PFó��Ap��ü�_Ӫ[�قe�[%����&�$�1�����$�x7�
�c=?��v�{��7�k��*���*��o&!�{5��*=����H!K�c}�����{k�Ӌ��
	� �]�w��=;���X���r���;���:F�6��!���������r�5gh�Gs��v��쏇�P�<��n!���(� 7�����<�6�Z��|�
�+�V�\����E��]�>����W��<N�.Y��'��,N̞�E�o��MX�@��c��x�;˸�v�%�I�A�E�[-�z�zy\}O�#���3Ks�ޙ�V�]��h2�%�A�t���|$�s�N�p��>�e¤�|�C�QM�|�k��8�x�5�����]銠I�@edk��m���>�ٚ�wt)�`?�������<������3����R(�,2(�6[˭�R�LZ�2j�2�Y�'yXL�j�p���y�v29�������/U:e5�F�n`t�A2̎k�F$�����P �"^k���U=���ۮ	����^��I�g�Z]�v�i��=\}�f�x�ʄ6� �#|&��VI�]�-	=��?��{�_�x'D�\��[����.>�̙��P�D�B�*�}����zk�2�KLw��|��"� _}1K���-�a�|��9����.~��V��)d�tg=�N^�)$Uc?�yr�%�9��T����-}
K9z�����ר�U�J�pfD7��^Q��8��؆:�	�v���q5_v�������Ͳ��g���< 	��Vnx$�ܶv�R�2!f��|!+̬�̨�L��wο�RQ�f�{�sA7�3�zD����j��q���]dt�S�]$���t		]h���?��T0����(i���`��&�L&����� �J��u�ȋ赱_�s��q�q��?e_$H�q���D[�ۦ��m��4*�)����C���>4% ;��=��$p}��g(��#��ƺnݏ�~�K����s��Xij�"����m��'����%��5N��\��`�Ss��̂��v4�5�PI~�UUO��W��S�P�6��7��)=C|��r� 8u�8�����'�->�}�,�)��6j��8�CPĿ����v�y�a �"��e���@H�=yG�϶��%XH;���H�*�|d�������p�?��K�o��8���Ki�[Uɾ��`�ַ�g���4�/l��%�cbÅn�wJiy�)�B['��p��0�䨉}���e9�+���3� |ׯm��I���۹�jW�uqH?�1���z<��
���gCG���U��h�y�!>`B���>�W`r��d��M�5�Ws��s��,CF���S⦖���zN���
�@�qh����N��U�L�yz�/��>{���Iq0k������R���_"�@��?œB����v�6�m��w�nuvf>�tn��.����ͦ�p8b�uM���u0�P�yʤ20e�m%�}V������7�O1����N�\�l?�X�+h���䂰jYDE?���b�.���u�Sy��_��ގwFP4@;O����Gq�}�o&Oľ7 dG3~�Ay�G��7Jq��(>U^�����Y�]}=����_�(�}�%#<A��h>3���r<�l2��Vw��?\��*�V35��=3B"���`��Te��1b�u���.��t<��i���R}���3�J$����=��yV�l��<�ah�L��'�a�`��ޯZ���i��'�H����<�"n>Y����mP_w��>
�u��J�@�v/�t�U:=��������v�6��n{�R���G.d����~"�f���B��'�Ǭ(�#BD��"�˥7��cu����D��9R�����r�[��]j.zFCY��k�_ڤ�z?��~�2�=⚈�*�^�+H����ҹ���`����4�K}�O?�CH�iGz�/�θ+�X���}2�Suľ��&5>���B��-��q� ETD�}3�P�3�
졥
�!d�@�4�
g`�n���^l�3��ʲ�kn�PW&�_ޮ��m#I���psD���V�d{��c��	�� r$!� [���~��<0�^'uw��������x��z�v0�#�
$��D۾�����6�`)YI&��љ�_�Go%u��LY/�
�z����I3��BO�����;;ԅ�SZ������gZ5v��s��Ȗԛ&K:2y�7�v��A0�\!1�}�?c��3��5Q�cx�Q�W�{�+���"�M�;�G��Й=��>#����~)jɯs�V��[��E�bu>*t����zb'u2��3�]Y��1��̻�.��Ř�ԇ3;�e� �zg ^���*�m�L�ө�oL���٣�͵�����#6���������.z����J~y�?��.:��e[���1�bS�(XQ���`�w�H�%����6�ճd�(���}vu}�òi�z���l�s�8\�œ��k�׏��'�t�7۲�6:|�a��,5`I�'
0�SH��!�lz(�x�������LT�Һ�]!�rܽ]�v�~*�q���4:G�F�o�\��� X!?�k}����z��>[�ҠMjx��ڌ�'C�C�$�d �JJ�͡�o�C.�
��d�R�~T�]�
�`M�U���]{�<����iTô�����X�qS��4�D8?.���o��>�Gt �(fb}����}*y���%3|�a�t�ۡb�v���r=�w:�����`�?V &�$0�H��BO�A?²�B&w��U��E��`�S8�q}v�X�-�����'l�R�h��� �%��z3�J��-¯@���A��s�'R)��I��	��FU��nSE�U'����A�����#�����፧=(�ψ 5ŔNDy(�O	;-��
.�8�{Tw��j3Vy��QR)B���`)�f���΅R�C�4_��#ſ4j��˷#K���s���F��qyu���}�P�r�-OQq���Q�yRײ\��}W_���r+Ņo���Ěc�p������sf�<������7���ݫ*���M���4��U�mN�ŭLiJ1��U�^1�DA=�;�m�7���+����+��؏f���<�d���p���	��G9�`r�Vz�󇈡�f�*�JtH���ݞ��� �%��H}��ʃ��>)�k�1#���U���
C;`$�x5�>�%���D?ҖW�����ޯ��ݪl������l&*�zt�Rş���5��^}6��/������Ap����]�|+aI><��PP>��������$[#=)�F,�B��$��N��e�lJNH����H�-��*//�Ȁ]s�a�����k9�QN�pI����s�(�5ۃ������Ύ��l�ӄǴ�á����_��_�d� '�j����n�嫷�ŉ�"��8�+��[������]w��9����	��lpbvʨ�=�;�����$JK�V�e�5�Uj����nw�G�8���I�B*f��Y�w4D4o��
��٬�:;"dN����M�]%�uM��ؘ.��y[C������t1��rXL�f�E�$�D�7�J�a��d��Jֽ/0�w��h,�j2��>KX�d���<y�"Mh���~CL���n�k��t�F���|i� ��_pies��5~�G���������;4��t1�m�oN��1w(ڀ�5��K��3�ˡ�.��[���b������:��a~`H�z�J�r@���N��X� �Q_[S w%*�W�:-�x�Y�%�I;kG6^��]�� a6~=$����N�ㆃ�hv�_���U���e� ԏ�1���M]KV2��C�Y��nꍖ�a���;p�6]K�\s\߁V���<�+UQ@%��Uvu%+�NU)��"
mM�V��4g�8�@`w�6Ƴ��v�F�W���b̨�Nr�~]mu��D?':Ϟpv:��onn�&C��B�C�RԎ�ҵN�&�+���Q�ʶ����Y�tT`��Z�rn���V�9v�nF�X)wT*��$&w��Dh��_RƑ48��Vh�33�<���>�+f�8��HR�����嶇|��0$_�I��7�5.x�[��{z�� �]��n�wo#�r�Z�ɤ?nT��.�o���+ƫ#H=9 ��&T{��c��hN�ug�\%a�|�OQ	�!��2?�3?���SEi�����H��`�mx��If�Ko�ŗ��VQ�vq��u�&[r#J.�J��*�O3�����M�� F�QM�n#��0)����"�&��uB�	��Ge[ ��˲�"R-M�~Ӟ�D��"���|g4��2G�?`��ה��]�P��d?!Q���rk�I�~{�Sq
|̓���Y�\���Q[�[�u2�;/�7���Т�����@ʥz���!���OoV�_�F@<h�qxz�P^��E�����3��
bjh�B<!<
���v�N %(�ttut(C�įL&jj9]�}�p���3K��J"���e���}v+�펺tе%�^G�7=�9>&�T1��'��Z�R{��j|lZmʷ�]&�|u-�Mt�)ү��W�k�Ÿ��;�ﴑ�R���LAL�Dɋ��F�ti����Y"�0��C��<Y����"۰��Q��(���n�Y�|(�[����,^�.�ċ��@�̠&5L��/�%�v�Έ�Jet��"�9���8��|���R�� Rgc�Ļ���
"��$�2[�!'�-�f��Qt� ��T�*����P�����Eg9sS���㮰�����%��1��.)�Ogr��&Cn���Z���$�q�D������6�U[ɚ����Wl��^d�f4eݘ	�L�woB���ͤ� ��E���6���QvT$�5�q,L�)[�v���tQ����3�̘<�=_r$t,�XS�妈|1��U�+����_���,�,o��0�8i�E�10k���3TX)��%�#��Сs{��q���4��pJ��j��;�A�w3Q����j��g���xC�0ʮ�=�x,zt7n�I��}�3%^�N��C;�&P2䋭��@��
��d�݌�~�����������:���s��VYc����B7�8zȪ3�=_��K6K��B|SnD�y�^h�W�t�1;9b��&�[W�VoU�A8lf\ O'����	����B_B����:N��XzX��&�h-�@�qx
zM����Х��߹۝��eK��A<�Qe~�L��U�;�s�>+30o�ǘL��4��!�a��#�\�J嵞:>�����El�;f���.\eS	Y���Ա#7���%�vv���1���[�f�d��0�|�$���$۔�8�M�*�g����0����,�{;C $��n�6
���d7�y��l5��u���TVoC�����ᆚ�9�c��]G�5�3����>*����B��s���jH�C��Wݑ��ւq��){�cS�H��~���^E��Q�#���[s@��ه�� E�Ҽy"��s�gc����s{^]�n�l!�┦��W٤Y�'���Ӛ?��t��*�/�Ïx`�G��L��߀��u>nL��#��Z������uO�ayF�x�=ru��%w/�GN�ҍ���7�;7�nM�x�=�j3pơ)�&I��t�I�a�W�kb+Y+�?Y�����kI�P�����P�vcOˍ=�ܻ�b�`�ѿ5.
���-��TIA�=���Pܰv��#��y� �����)�  �-�עh?"bO�l�^C����Ff��Fo4��gJwH2`7�i(#���g���h:�Fˋ�f(n�H#F����<�GK�)�xጝ��a6b�sF�������P	U�n��#;8zO��N"m��u�ex+;}�|��H��)�G<+Q*�K=��ˢ��CS��ڋ���Xv�Q<ڧC��3n�g�l�T{�x7e[K�����3壅̏�L�H�L����tv��>�/���ۙ$v��H"����wңڕ�d`}��--�L�E..�D_!h�ǘR�YRY�MZed!�:L��ɠڦ�G��4�M��^v&}/�B~pv�������sҒC�g2qǰ�ވ1(cO�4�U'yZvc4f���)v����
a�Q��
s&�0UF����Qh�@cYd�y3���n����~�Y~E	�i����e�e�F�q���	{e��;c���Y��O2���ʀX��W?'组����6zOa�@�gG�V������V�W��?��{����ږHw]#���^� ��l4U�v�plB �]�;��7���5i��H�PP�ipL���)��$v�;Q�ܝ͆��߀r�x���g�Zݚ���b���uC���
k�O��*Ȓ��_����lʰ�&���v�V
�&d��n��o@�t.��8�GV�i/-���l���К�T�U����XMԁ�?�6�<��M��h�:ynXv����.G|{qC��)'��$d���{��2���P�p0��G+6u�DXܓ�v����a���?��WtZ�����\*Ww����S��7�ݮԢ�aK4�%�vfG�H��(�t�^�oY_��v�a����db�R����������9Mʚ;�H'Oҕ�]<������ ��ӵnO���	T�@Y���7�L�/����՚&^Y	CF�曰�
�Ie���Y)Q�O�����E)�
xw��ܔ]��78j�<�o��52���O#<bm��/;�� &|�.�(��E	q��`T��k�f�D�Gn���ܛW�s�:��A�������s83-�C��U�p��î�ߨ���y���;����b0�Á����t2�v;'	�YL�l���4V7m\X>݊1��uR"�2ƳFJ� OZ����;�a�xE���Im�b]�r�	�e6��>̵�Nj�G�a��H�]�ݎ�!����`���3ܳ������G��N��$�2t)ʢQ����:�R�3�N�Q��(^��;q��d��t��b����$s�u�&���>��{jq�Q4j�[����ꝃ@���%a�7hlE<�ܘ��ތc!�u��k�K'5^�����:&v4��Z9�_U��O�I@/��kj�9c��{�gG�
�d�~����7�{;��Ѯj']0�Ts�W5I���d،�]�ʯe�<d=�J�{�n'~��^ bv,�4]6�������F�vm��tG�^ �[e�#.��3Qr�!{v���l����4��c�5��Yk�2�3/�u��v�=���R��р<|
9��n�����(�����G����re����h_��� t]�Γgol~�{ShÍ��Y���iy�R�S�d�L&��y(߻i^�C6 ���Q{75nǙ@�g�N���̊O[�FoL��x/
?��؋2�S`v/$��@�+,ԶaR?�E��� 4B���/�J�<O�����/��(�s>�˳$�S�IJF�i,��Z��8�;������mT�o��b��"{N��1}y����w��8�������D��ɘ
ݻ�X,�o��ͬ�B>��]��TK�7����s�`LS�/y(���69�~�5�pn��/��Cc��v�dC	���^���gڠrD<N�9ʝ'��@Āw\�.^��z�<4{R辱av�q�Џkf���C�57|��p�OBm
��i÷�n��V��[�:�قnbJ����Uq,go�c�������_J����KwR�wI*Ы�:�J��o2�|H�ͦ�t���GOv�a�)�\!��2��at �Z�q��Ĉ9��Z�*>��5y]��1���qz���r���&>�������o��8n�m�_������⢬6���"?X��=��N�1;bӧ��u��R�)e)�e^��kF{�5�i۔�2�n;?^p�>�c��k}�/ע&Z���J?I0�X�����>����P�- ��lw+`[$�e}�7���q�)���;3:I`F�6hSU>S[���O"�ػ�����tj��Ap��-6!Ä}��)����q�h��a��oy� �\qm��l�:�fT���|�~����|�
� 6L��Aaʥ���ϙ���yv \���w��J�τj=�� 7�*|j��@^`+3m��ja����"�9�3��{��֦�-_q�)�3�����b��j�t��zM�L���kI��H@���l΄;k�#�!�t_^K���'(���O�D���޶л6�k��;�C4������5��i4uRU�_�[^��*8�+_���U���G4��d&*�3�������:O�wpQ��#L���G"�Iv�����!^�`U�D���T*�}<�t��Ƙ'H�=<ש�<���U����J>m"��Z���j����;�fb��+��G�it"�&�����o�:�����u���"�4��A�6}Lg*��Ϸ�����D�?�|����.�K�1M�F�逺�%o��!�t][=8?V�hV�� :q�m�Y3➛|x0��r��TG�?U�?a!�Y��9��8e��x��綍k���h.������p�n<��I��Y"B2j
P��dW��~�;���n�s�,�������<��<�d����23�8C��'�M�f���f�����4 %�s8j�dk� m��.�~�{�����M�a�M>��t�y��y���	��/SH?/���o�h���]�������t;f^�&?�ug�*�SN�w�E�6�g��Q�6��e�!V��7����VcQy����ʮ�|n$��H�Z;��=ʆα8$
:z�{�1#�p-�ꣲڔ�స��=����~..�6����>Ѐ�|X�|�a��V�c�ݭ�.�C�O�3O&��~��`��#RZ��R����bZ���5�!j�}�ehɭ2�V@$;uA;U��<J+v���]�}^���7�C�AQ(p�ˡ��?�&.��/�����2nv����M��OM}g�zה�{���QM���[��S��}��Z�o�ܖ��s}��5W�A����GeT�'z�?n���[���%^�\�wt�/�B�����Qn6/}=���^�pEm]6���nF�u��=��A�c��tlxְ�̗c�;�½q�<g�>��7N�G|)5�� �\�-:�t��'fך5����x�,��w޶�2� |�k"a���	m]9V���<�����Z	"U�j���v!�|�������T5�D9 i���vɀ<�2��a_�`�^�ѝ���]є �mg$2�v��@�|`�[lp�������(�E�\5�I�����p*�O�eҚ�p�f��u��^��Bpk�u����1�z?�`�2��!��3�W-�:$�%�H���>�|��L�,�u� ]F�oGJx�V:�]r�f��z�Q	v�uC-$x} g\��3������u�1OP�t��0���i՗��3��aT~f��iKx�1��\��, ����8�B�(�UfI��w��9����i6����.`���6�L�+�4�>�IP�7�0�d�5C���nE^r�[;0���kZm��֮�@�������K�j�(^'����:�b�$�)��{�N:;���+9$�QvQ�E�?E�7���N)'��+l�6�g3��:��QD��cF`�O�"�\ej��l~T�`����1��9��p��P��$lc��gm���f���]�,?u/p�=;�2��OJ#?M�z����+N�����h�^?AڈP�-�j-�f��r��P��뻢0g�N��9��4�J�/H�ylS\ۘ4S�MVYҭ�Ѭ�À/<�=��j�L�%c��I�����W���,j�=k+֚sm���ҙ����L!��Ŀ!|ǵߗ�Ż��%���G�t�c~Xr��H��Fm�
0��I�f�|�,I�j�F8��:�㟜艿j׷���xܻ�i-���ܨ�8a�-���'FՕsN�CBK�6CaF�a%ٽ����2#��Y44�`�o/�(�'�w�T��E�Q�R���ǀஇ����-D��� >h(]��[H`3��QH�j;TrT�t�O��]�II�T8���@������p
�6���>v�=ˍ�/�P�\�Q�{�Y�1����~��O�������_$g�����ލ�[���Ԭ��@ω%��j��!f�l�N���{ ��c��17�̣�����{�?KN�OOY�Hi���o��Vf~� ��XA��I�Nb��m�h��|�ȵ./�a���i�%M�� 'Й����\��99�3k�l�֬l�7�,o&��)�;�czb䗟�G��ʥ��Uf%�<�:+�|��7�V������q,��G樻�u�(:��5�ti���In=�cV<������o�G� 	�"����e%~,�+-�)�R������8@�
M�r��\������@]�m�0a�O6"1;����߄6Jڽ���v�?�}3i���+�" ȸ�����7��,oC�r��?t�f+�it2lV�S�wt�uy@�Fڅ�m;K?��4��x�>#R��ϟAn�Ev.�ٛ/� L�r㙺�#�j7��
й*��_ek�/3��%�.�y��YS��{���Ό��k"TF-���bљ┘�<�������:�~����O�*VI�n%#i�e��e0�Ԋ���Y4=P���t�D޸���4n�Rmּf�r���2*dC썹e1��@O�ѐ��E�r$�������J��r+a 㯚��&+œ��_�~�!�kZ�e��ژ!��;JuWʞ�P&_���ߣ������[��@�Z�2.ԭ��m,/3?9��ܨ�m|ty�^K6t��߶=6���G����Ȧ��+�]M��NY��t�Q�4&�5�Yn� wm��Q�{{b����H�+RD�ݩ�eE\	���ZB�N]���%��,/|R����|���ӷ��*��xf��/	Ѭ}˥X���,�,]~F����ƒ��Vن+u��Hk�אַX]�U�$1�:������(�;G����X�{㼟\�d%�'t荹��`�̃�O*�O[��9���@�;���8������S�R"I#e������JR�Z��R�$�� �E��q��(����W��#&��{�J#M�1� l0<�ծ�_e�t;�lo�|h`1ǻl(�b���o�iq�M�}����ʖ��o�����J��o�y�O�������>�G|1��^\\d�4nΞ��vs���5��������^���"�{,����p��KhI9�#DHP�p1��A�Æ�͸�p_1�$�]��v�@����z�(g��ahQ���)��OYXr��-,y�:Pv�ѹZ'����~�,��^җ�$�m���Ruo}10(P2���U����`Z�c�V��~/3�\�k@�L��M��?n��C��'���$��Eo��v�b�¼�v�ޑ��,I+On;g�^�N|G��$mXX�o�Bz7H����?_t8��ޞ©FFZ�HD�v�9��2�\�����A�� 䣹��\4�M�f�7�I|)T����UP��a-�����J�<�k�k�"�VSn]w��/ʐ���z�6�v@����1=h:O���,Q�;�<tR �⡣������v�f��J �}����^�l�,9H����3��#�#V��z �b �(=�u�Q+��[cA��G�ci--���!��;�eUn�E�.�n�\��
�!����FsQ���J�ʓ�DT�»G��$�����+��5�|%���Y������AsJ�Ap{�GpA'Ss+o���u�?Q�Dv6�����q7��zɰ�������_��]�\O�����ˎ,��k*Qc����V}BQ:_Y�c�Γd>2�T���mQ&�j����}R�;�R�*���Am%�D/s�Y�'���y��`�k����2�]�pWi��i~��L������V��8��;l_�a��A!��qG�M�Rڑ,h$Ѱ"�͋'�� �Y�0��ֶ.|�|4����\�K��bƲe:	�e����G� ��,j��~(�X9����ұ+$X�0HV�Р�ݘ&~�"�p��n�rC��r�5u�nKO����.R\ǁ��頀j��ȗIu�Cg��Z���g�� /JDLy%o6��g!����R�B�bR������s3���{�H/�@���b���8�[��5�r)NϞ7D�Vag�_�����x����Vw��-��8�A��f�F}���lffl��ǳ�7|5��#x]�[v�5ʛf(��6���O����
{C*����b�{}(ő�>Vq(�F�;�.��(�DV;6�����;��/r��^Vy2�GwWRjq~�o^h=*�*~��	��E:���x��~��>���A�Z�:�%�f�;
�g��8<h�7�㙣�s��w�Q��E��s4�w�i-�J �`��^͞y��c�Kz)M<�l����:�zP�y=�!.����h����6� �ȶ��6�z�V-�țt�=2�����me���d�so�I�hҸ��tf���+�r����
�p�4h2��&��H�y��8a;)�>���ƎZKt<�����:&�u.۽��k���!%��<�U��vdvpS���uU-��Ld�F_�O��Y7<���֋�lVI��T�:N�:��8A�4�����̈��>��M��p��t����vC�����J�_�F�&�Z5-)/�%q¿���wϴnoaX���J�J���|������A�]\�	WV�D�>�������W�0��&�R6�(p�ж�ɢH����뤟�i!�W<�)�
��g� lu)�?/?�u�X��,��D��1����X����hբ��O�
r��L�V�����\�o�e>�!�%��#�� �b��(:-�M�¡����$�Ŧ�\���9h��Oz42����<7���Ӕ������'��	<O,�q�g�������)\�i�s��O���y�s���d�����/��G��������*6�*���g¼Rߙ�
����m�r�ο���7�#k#K��9wB(�%��R��k�$���'M#�b���@��֙"�0��I6`9����^�S��o�"{O�!$�ABA�O��߃�1�Q41t�I�J���7�li�B�R���浒^!PD��<�^k
�d�}m;@���:�,ki�t�*�.A^�?�=���qNϟqRe��|p����x��z�0�\��,�Ӣ���U
�CN�������W��#�E|欯+1��vQ9�g��{�^	~�c�T8�4s��楟��L[��r$m���0K�O5IZ��4�}t���]?�#� 9<�w���;޾�Tc���y~h�QkX¼
�[/�J� V�~���Ӟ���B�1�G�HF`����Y۱쉧X��/�jw�AF6Xbtn��W��|Ӝ]u[#��9��0���<����evW���y�ljko�Y��Z��-dӪ8IR�<˙w|B������Y�T|Kt��wu��C3��n,Ǚ/^ךSy���-�ό53��էUD�Ef��e��J��V6��_��������2n��-�|�A��p�D0�ƶyPVb�?�S���#�v~�cXP�s<G�HG�u}K�x���3Q[MŚ- ��,'�BJy��E=9O�2�#/�'��.5E����S1K�.��ˆR��ǣ�%%��n�n��В�"�Td3�G�E����{Ay����=��s�v�̖[khho�/�~	�U� ��i��j�.k�%��M����Q!�h(#wf�TD�C�y���v���^\e���^�u�ށ�ąd���I��_%,�����-�|Օ�@�����g@�:�����$ZF��OZ}��8�&1���� �Z(����"	Hx:��m����~D�M�u?o��W�>�'6�ه�M� w�2V���2v�����HSQ]M�4uC�耕UD��f���@Rb:�>��Bhv O��`���7�T�P�D�����.��*�oo3� �
<��ܞơ�BsO�,�����"
��t����ӕZg;�Y�Ut�=-Ի������*H~k���.�<#���Q�S�c�z����I?I5���k�6����:��e����)����3��i%x/eY�}�V�dy0Y�Z�]G�ԟ$>|�,�_�` � ��*���Y������˪:��MLQ.kQ2I�S%��X�mҪ����hnb��+3���ʵ��� @ �q�I�\|�+��~�Jo���v���5�:���&����I]S�yNa��T,O��X��C B�rU5ˠ6�e��0��Ͳ�D�ṵ̋�Ym3��?)�􂼆m�b�g��d�]�fe��>9���АB{<��J��/ؽ�-��+$�)�y�ܹ'�Yc����j0�^8'"�Y�o�G͈�]��# Q���Ɇ�F�dY��@=�n��O3Q��n�sl
�z u��aI0���d�m��Fȶ�mks��u�im��a�k�RC�����ɼ��C�>�V}DC��aMr�v��䘃�]�V�A����M]�4XiEx��=��`�feβ�I�[��ή�wr�mw�]�Z���({3�]�]If������*	m?�����u?h�o��u��f�.t�v%��UN��azG��jj�G ӫHi�M TH��}���e�����R��Oi�	�n�hT��l���D9T��J&NR=o�jv�R������g��DY4(���|U%Z,qY�l44Ơ(��}W4q.о��e�������%O��ˠn0��h�-AJ0� ��8J���ۢ1��0��^��{������uk��!HkvqU��b
aF� ��u,�,M��c�B'��ܐ�H�~��V�
s`�^��ni	@���v�f*���#Fw���A��*k+EBq���;j�*q�� }�����d�;��{#��i�OC�9�h5�(��2�`��=�b������C�^�_�r1^%o���ǫ�3�W"?�'�$]>z�W'���qub��յz.��O�^�{����ڿ��7go���7 o��?u��E663:1��#y5��0�k�|_���W&����2�e�$0t�sy4!C�@/v�$���D*�mh[q} M�vˬ*��g��)�j�e��[�.C�ȷ��~c�G�	�E�BYڡ��\��?q̍�"�#�-v�Q�d�g߈����`���a�7q��0�K�6�Wڵ-�ml�_�P.�(���$��q�'q'�9�8�9)�-8�6))"�}z��Wt<5�F������g���Z6�o�6g����Ĭ@�?���
)U�6å�	�&�p��''SVUAU��E��ڍ�AEWV3z�CB��)�����ٷ����~8�U�
a�,�y��s�_��q۬RS
�6�Z
�"o~����I���i��V�߹�a���9}���ѿ�+������o����V�"�kS�/��9��C5�`j�vO�&�NK\\ܟ��ݝ�μ=WU�Cnq��,�������D�k�]����'�R�5���8����]��t�=+��6uf@���)���`ꮾ�2/>\����Iu��.O��W=�Nm���M�,V�rd���c�[a�I�Tˤ�~�����h�v��*F)K[X�ң6����D)�f�NF�SOtެ�9c���vVmOYȱZ9�xZ�\G���		uIm��%J�4y��H$��[>"���j�e&i�b1� E���7�#mn;oqo���!�u�����u���/�Ń��pR�Ij�;��_�����|�Bp5�DT�w�x��Zw����������m��1����${�B��_3j����w*���@�L��G�<����%��s����J�Y�|�1��g�� h��#�! 7$�RӁ�S4��j��+���xM�V��)8w���O2�ܦ]�YG�"�E�3L�%�aM�(~*o	�����|�nu��0%��� r�I&Ƴ��N�3 w�ę�?1AX5s��Ko�7�����!e�@��,f��Q�{�`���P�Ye����Y�����qO��΁Atq�]�]��m!ojE�Jh��)�E�������4eE��R-ѦV�M}�� `0vm\7|�Rc�����o�g�#��H�h�Jw���l��R�
�������<&�~!�|ߣS�����$�Ħ)v��R�uc���ֈ?Z�!>��b#F��ɴ�`���
"�a�¸x�T�~��fU8k"tWۙ�+i���'��K��@jq''�[�!J\G�4T�DD�2��4���	�ZN;��C�O-Y�Bw�2+7��Q2�c���NKU����k�-m����&"���?�h�I���Y�K�,��.�8>�8]*�t2lo�q�����9WR�J�.��+�M]�{4����В�>��_-[-�ۤ�S���	+$��D=Fb����+���������<�q6�K��޿��p�4��)u�p��~>⒎j��1�,����G�`�6�i��y�S��WN�>O�l���"qM8�;�3��"?dE�lɟ)�b��6h!�	RLo5DRL��ɞ���}~�T�jlN�!��K�#7��bQ-��A�LC"�4�}5���|sU@��s��4�t�ʛ�������)����t��{������I�\&/o���<��~�1f���u�b$��]��)X�g��A�]}=��_��C9@������!�0S~CxFv&jO�5UB�&[�s�1�KZXzkl-��&R�@�7 ]0M�}�睪I��c��2��V�� ꂨIM�"�Ɓ�s0۳-�`�3%3;
�:K��%愫T&
:���H�>����*5�����JA(����5�	��#��� �*xN��;���f�f�������K��sH��D�?W9c�I�}7YM�6�td>�����z���b�S�ڑN��ٶ�o�}��+������m�@Z�Zx��gy�֘V�;�*KV�4)�8��[�5bO���.=���l�ҋ�
h?���
�N�ʠ;5c)js>F�r�����&6B��an���Mkʜ���l+�m5���,����Df�w���n��l��9�jw�!�$��T�9�j�����!,G��@ק���Q3�LD9�[�:&]��Gu�[������6�
��o��4@�`��x�S{"�e ��*���z#�Tykj���F-UsiÔU�a�l�Y�N��+7@�U	�Si�p��de��$�X��+�7��abZ���̒����3n%�+�^|G�=m���X��|���ݷ\G���u��)���E�[�K}������R���)ھ&31ÝO����He�t0���� ���h�^;~I��t`ˡ�l��d��]B9
0��MSbg��9[��^H+�/I�
�����Ni�W�Ы'��C)F�%�����l�q�ܳ0`d���p������̾J=�O��*�.h,~m��IG�'�}jŸOC�������A�=?>`�-���p���k�5@;���n�Ys��9�_8	�L�Y'����I2,����d=d|�Q[���jC<�'h���Z�� �E֑jU����z9#*BO|_��*o�Wk�o��hr��xթ@����Jx�[狡��+u�9�?����m��/�5�=<T���
Nz���Sqt]/�����!�"�R�g.��%M�G����E�11��+q��I�\.�ĳ�b���GJ	��}���h��o���ad�l������r�YO�:�����qD��>{���x~oe��5K`�Z7����-�)�TϾl
�[��WX���bůfo%�35�|�+m?#�}r��=�>+I��{�����U�B�q�2ǒ$�%s��S+�tԥ�O��]�,Ao3��k��z^����2�
aW�r䮴ؽ����j����s=\�✀�g0&�JϢp|a�4ǲ6�HSб���S�g��ժ�tAD]sNW�%�kbw�R����G�ZA�]c����(�#Uc�`�jo�M�h<�~�S��8]�X�8��a>��$��^N�e�x]Vy��C�H*�0�A4�NG��o���F���5=ZǦ���mߏ�(�ig�{�	�����I�K��K�ר }�J�I�R�<V�s�P S��HKA�����tU�/	�V��.�X����Ҙ�QK�+z�$�Tz1��L�?wO%���Ň�x���=2&�L��/��
�[��:���u~L�ʛ�zL�+���b������q�)�?��J�6�ٵ	t=����D	��o3�>�k=j��dx��b���
���YWq����,`�t&�"�i{{����G��0�[t�K"̃6@�I:f7��즣��?H�s�,�0��Y�$�k/o��Z��\���0`m���%��dc������?<u�O�ik��{&�SdB��NCϨ��!(��=�s5A2����#��p��<��W�㾩�1~#:�������@��T�t��^[)ɸ�'i+E��b��2�����Y�3h���O�?�ʈ�=-��IV�-RO��3�F'0���+���]��U��a"��b�D��n�YI��_x�Y΃�:B�:D5XE������7<q��R��� �u���$�����z	ؼ���Y�!̎�!X��݄�cP}�8~c��$Є��c��T�0�e���7W���D0篥�FX�1��2�Y�c+��t��ǮՒ��qn$����.��&mE�u����5�/�c�6 ����y��$<7ut�m-.�;6-Ql�x*[_ �a�ZXf/8�5nm���I����E�Q垉��֒��nCF�@t��6+l{�;����z����G������	ܓ�vH�R�Ö�_~~��Q1�ʽ&h��%�!s.#�MZ���`=�|��q3�3tQ�b"bXȋ�g�Y�j���8?b�+?��b<� ��	�F��:��7B��Pm���t���g\�`�_�
s����3]���Z��]�����b2\x< �S��9|s}�0��b�CȊ؍�\�"�bp���Ul����8�:\!R_yO��( 7�����?	�&^Nq�l5�F2k�k7�G�oگ��(��-�7�4���ojz�d7��!�ĩ��/ߝ#,�z��,�<����?��� ��p��H��rH7���$�S�,�C[>X�F��t�B8�)b� I²���I���N�e_���F<iG0h��)9��8�w��*kB��� '����K���7��@ߥw!?y�O`\��F�et0���L��]Z���""��1)(����z�6�RI��Ʋf��?�Uq��ŏ!!X��~�#b%�/�Qq6��|����-ٮ��a�$(��Hw� PBH��z���O��]��x��d.�ѺP��Z*��hƦR��<,zA�7��l'{w�߫�'oz���K�6x�H����a�GٖFޜ���xK#o�x��x��Y�D'&	���u��zNq����o�&�j[��6���"L;�Z�x-L+Q�����x������}��3���@OV� ��L®�^�b`tOb���� `�D�a��Ǽ �A��%�VP#�pjr�gL3=��+�ة�7y�oYtW"��An�'�F bK�����h��%9:��݇���:{Ap`��1)��g�g��K�or�%�G�94�Ɂ;��ɸ�چ��b���&6�洓R�p*�y&���EY+ho�F<��h�;����޹�'��&����w�r��
H��؄w�z>�:{R��Ϣ���၊\8���/��<of�����#:��f��|�"���^i��\�7T~�R��Ḃ�`[�x˾���(����諯�$�	R�%�W5�:�ϵ����z�)�_���%��CXXu��R�x=
����2z&TFO��_E�gao�*���+��b�&�����j��TY�b=W�K�{�{�c��ޟ���~���*^�r���F����F��T5�:�itu��+Ę%!�01ό�Ee�*����͇��o_��p�b4���$�O8�ֺ���=�Y�j�	-��)�oL��Î�r�Iw��<�1�P�o�G�t��?����~$n�
��dR,�%Q�7�j�+4a 竒���r0H�-t��.����k��[`Œy^Os4[��+��l��x"�B�*�
�+1���{.�����ި7��C�����dpL�B��p=Se�o���/t8y��k{�k�E��QTlA~�y�M
������0�]��8b�&��t@��=�%���yEE7O<x��~YW�U9�s��DBB:��"p[��P'�
��AtrR�s�����PK    �x[�� `�  �    Extens�o ATI/sgp.jsup 맻�Extensão ATI/sgp.js�Xˎ�F�7���!eHl�/,��i�eO<-��v�a�ȒTv���*���h5���F�*��˭�C|��.$���ǹ�tz
z��4��-Uz���9�C(cДS#D��"��P��(JE�d1�K���nW�wN:'(����hr���ś�����;���ί�W����R8��L

2Ec�"{-�O)`ފp�<�aE� ��o[H�$L_�
:'�ڠ
����z
gp�9��������{�>�z�ӗoF��؇�=zT<�����h�u�4Q=#�bb� ���?�V�hrq�b�uN��"�^.dvN�!<O��~��gD���T	Q�Ǵ0뽋�MICH�D�4��1f&b�R[2���	��ه1�h��Xls�҇I��O�J��ؠ��nfԟRǙYB\V2���H�U[|����j-F�N(�Ec��]��"�Ԏ��H���U�#3�'����^fJ/�ޅ���+jR%@�/�Jɘi�+�%_�
��P�5��L��w��eԦ��^�qy�Ф�M�a�����iN��,�x�=$�^):�;Ʉ���������pIĂz=��Y:�q��	&m���������	��,'���Ӏ˅���x��� ����=�\i>�)"�-a#�\��yp�|�iٶ����[��j�0��[��(���1YؙAMӋ��d��l�`2��0����m��;vN����Í�����\���vx.�ʐ%��?a���W�"�O��*j��O��S�����)d`�r$e�h?�7"�y*B�x�#���"y��~�Fsd�r��$Q�5]۲$_3 Ȋ-/UP��0GTˤ�oj2t��վ����,�Ta�[hY�8w;-\��x6IҘ�$����r��������m��qQ�^��^��Q=�A]K5�m�d�\�B����¢�%L#�uB����o��A��v�UC��h��0/��6[*���'!�ڙ����l�P9�L�1���=����a��9[㬜��T�A\�P�P~���F���kMnK�Dp&h3A&�v4:7v�d.C§h/Y�`A�%�%��U�CA���^�@[�5y�!D�#�3�C-a��Gj��O�m#'�mOgeupf��=HG���_����3x�r���y�6����}V���F�`�WWt(��?ֈ��J'��G��[6ɑ�Q��C���v=xF�Y�T��v.�\�me�j3����<��<)��L|������ؘ�n��8_"�eMY��|���ޖM$�Ԇ�v�8[�m.#�+{�_ʾM#�~T�K��+�Q`5��C�nCs��U�rI�Y�+m�h��,�Z��C�c���f85tF&��d=�K3����p=��xݞ�%<�9���p�}���VhC����K5�/K|>��s2�����}鹻�A�~֟�I�)_����qd>�Da�_[,�u��C�#-�f�GM��0�:#(��n�l!����ꤙ%	�"<jX�'�� �L����$b�E?��=]�9��z>Ӎ���.z��$\�����@>��q� �f��U�{}﬚�m�j*-I�"w��,�h�x�gL�e�������ﺤ��+f.�)���i����v�F�6l���	_ɞ�"��ט2�>$�c�!�l`��Ha=�%�|���ԫ�[��Z%a��C�KTK1��S�0�g��?��TM�k���I&w/�N@^�rMU߁��p�X!~)�;l̏�����4v�E�?zHjd��5���?I��,5F��� ��џ�a��I01[�gF�F����}:��ɔT۵)yfHHd��+��g\�e��>L$i}9�2�wد�x�&�}��dEz��5���/�S��Q��N����H\�3y'Cu�����i1�-���^�z��������ф��E�ē�yF��_Uѫ��)��	`�Z�N��̭E�b�)�^�G��hI�ϗvfcX-�QS�����so����~mW�+�S�J�mê�juX�݁=��<�K��PK 
     @u[             ;              Extens�o ATI/
         ˷zd�������	F�F�up +�Extensão ATI/PK     �D[@�,p�  -   H           B   Extens�o ATI/background.js
         G_ Ѣ��d3��ģF�F�up  
�}$Extensão ATI/background.jsPK      E[��)ZS  [   M           j  Extens�o ATI/bridge-injected.js
         �HҢ������^AG�F�up% s�=<Extensão ATI/bridge-injected.jsPK     E[t.r�  �   M           #  Extens�o ATI/bridge-listener.js
         @ȕҢ�� =��v�G�F�up% S�+�Extensão ATI/bridge-listener.jsPK     ]}[�&��  e   E           �  Extens�o ATI/content.js
         ��$�����$���YPH�F�up U_�Extensão ATI/content.jsPK     E[F�q�F     M           �
  Extens�o ATI/firebase-config.js
         kEԢ�n�<��LI�F�up% x�a�Extensão ATI/firebase-config.jsPK     ,[�8d�  �"   G           e  Extens�o ATI/injected.css
         �������������0����up �n�Extensão ATI/injected.cssPK     m[���W  �*   C           �  Extens�o ATI/logic.js
         ��ܾ��x������I�F�up p�Extensão ATI/logic.jsPK     S}[/��|�  '   H           1$  Extens�o ATI/manifest.json
         �d�����d�����#J�F�up  n�rExtensão ATI/manifest.jsonPK     E[8��D1     D           J'  Extens�o ATI/popup.css
         �;	֢��!z\����J�F�up (^��Extensão ATI/popup.cssPK     E[uq�%   �   E           �,  Extens�o ATI/popup.html
         S;�֢� t�)���\K�F�up ^C�Extensão ATI/popup.htmlPK     E[a�*�	  r"   C           %.  Extens�o ATI/popup.js
         �}�֢�� �����K�F�up œ�KExtensão ATI/popup.jsPK     �z[��T �  B+   @           �7  Extens�o ATI/ui.js
         ȴ>���ȴ>����3M�F�up ����Extensão ATI/ui.jsPK     [ɞ� �  �+   @           �D  Extens�o ATI/v2.js
         :<<���:<<��������up �'�Extensão ATI/v2.jsPK     Cu[��Q�u  �U  H           �Q  Extens�o ATI/jquery.min.js
         ���g��k�����~،_��up  �g�AExtensão ATI/jquery.min.jsPK     �x[�� `�  �   A           z�  Extens�o ATI/sgp.js
         ���������������up 맻�Extensão ATI/sgp.jsPK      �  ��    

// --- assets\images\favicon.ico ---

RIFF�  WEBPVP8 v  pZ �*>1�C�!�� ��p�H�ğ���������>�R���/�{U���+������ǿӏ\~������o����|� y����O�/��������!��w�_���}����{���������������������?���[�O�I�������������=��}@=W���;�����}>d����J~3����g}��O��_�#���Q�k�@ ~_������o&��x�@?��:��I���]@�?տ�w�����}���/�����>�����/�o�����������?�_\?�^����6.�4ZAdZʂAi�qF�H,�YPH-8N(��[��$��� ��.�4Z��A�A㹔ᇢ[)����A ���f���~�b�D�M��TՎyG9PG����?y���˚�_��Iu�r�>Tx�t�(�͍�*�R���x�'�6�a�	w�����(@Z+DU'�z�>s3)�s�>�ǿ/�>p������pPj�Ad.�!a�/^j}��%�����iņWU6�b_�I�ד*��3(⣫�SVyG;|]WO!�$�w%��8�`�w"��2Ϸ�J�G��ҽ�>W��	A ���~񍭰;�^�ZʂAi�qF�H,�YPH-8N(�i�k*	��� �:g��+�D�i+_����#��\����h��,7+0U(%���1�;E&������]�D��(  ���0  �2�Wg�R4����Q��ߊ�zg�&N2��m�c;<N��ơ���u-��9hwsrR�eD��~栰�}��Ƴ�
�*��<��b�̩�!wmW@�d��e�'���s�-Z����ҍ�5�t��Qζ�9�J!��h$[�h�/��1����z���
���-��
�[9�b��CI��q�]2��w�
̤�7G�b�p�ͦ�҆�h�3M���W��I7��V#��ҿ\��v�3<Y)�X f	P�L���R�5�~\�r+@g��ds<���>�� ��C�0n��T�Z<��O��.XQ��Y����y9�iR>L�_"�p�=��/0y���%�o��8�r }��Z�9��?a�v����K�x��ǿ�~�:��xR������׺��T8����9��y��16X��������DY��.����o(ǂ�ר�_�^D�b'�$�t	���'cX�N|�!Z�V�H��������+�H׫AɋfFS��Zӝ���)r��q ���9��#�9A��ȼ=lT�z뽜L^ԃe@M۲)j�i
hմzug���W�u*�Z�P��*8
a�^ Pw�
��E�E�2vNU.�0ђ�IM�P�a��k�
�H�����Q*@!GT��5U�|֔h�uǑ�d�ѡ�%��z�syY�9ɯ�r�����X�~}!-,p9��Z�UL|���b��+�2�)<X�\��{B���`�<fZ"���e\F	V~"ˢ�,H�Jǫ�Jg"���(�<�A��Rd����M�W��k>�V�{bӫ�#64}�_�F����O�e�T��ATϠ~N	�g([�N�C�ym�ޜ}m���e�i^����IV�W�P�z���ޓ7�3% d�R�������N�7 �(�l]���(�sh�>}I�^��L�Qu�	C,�D,�)�|��\G�Be��Te/����X��}	w��N�|������V6�*0I�}����mù�~�;���h`0��<��6���&3�G�y�a�\-�P�J���>���W������"����L$��FwM��G�� Ϸ ��~�#r�p��B���� �[9;K�d�	��U/2O�&0�!Z8�o�0�@,�m�p7&�q�P:���A1|�Ҽ�ln?,R�_ܵ έH��d]�ֱ_�&��&��z�v���,�!�������b�K8km��y�� x"�83��J���OK�|	U--��auc��UӨo@֩����!ñ�c�WSie��V0����10Q�V�ȋOe��c�[��)븀D��>Jy_Z-�]Rp�r�z?�	�^���CP�����-6{\�b�J���@�]�4�#�+���\M�y�{��vA%!�������o��м�c�Ԃ4�=}6�z���HF�oy�%8 �ID�,����v9.k|p�z&zOA��*����H��,$���A����dO�	$.y�%w��mY�!!�$h۫i�cY���L1��Ls�p��AQ���*f/��,B��'��t:�GQ�yD���,�C�aq=��d�U��6�"�K��d�q����t"��W��Lk��e <��S��kR�)[�k�)�d�(h#�!�����Ϩ�;��mg�aM����T`����Zw�P��Q�)�]Q�����2�7��eZU4,�~�i$=Z��e�,Rכ�� _4F��%��'���~�n��y����?З���	����冦�*7�7*Y>;�7� ��E����	L�o�\�@��-�"��
Ծ �n?t����#��0��+�?����ʘv��r�5��{�����.���`��D�O��@G����KY���j�]W�Qp�m PQ&+�U-�T�k�cڙ;�P� ��(s�r���}~���l��X�a�I�����Ue�r�r��]fS�=y�+Ig`%�b&����6��y��T�0 d0"�,p'""砨4�ÑBm�,�`��
��}���S�fX�~V��U1ҭʟ������d`�baՅ�=1�
[Ż�q�����#e �)��d`�*Q�E�~���ߟ�sK�2D(%(,��[H��2�W��0��@^d�p� *#=^e�bS��f�V�K{�s�}�=��͔���ƮS�(��B(mM�(�_X	 ���{ \]��U��VcB�)��oNТv�&������L��:����ƌ̌\�&��k�p��'�p!�YW�����*���������ښN2��&l�|N
�F,���s�~��c�����P��:�W�_	7Z#e�5�NR�a�;���dn�V��8�izH����E����a�1a��uBN�n��V����Yukv̠��r�� ��a��H���n]iz<�nb:o�ah6V�u�ґ�驔8K���؎3@&��.��|s	ضÃ��Y�bV��!V�MLϜIA����_�yR	� ���%�5&��Nf�L���Xt�`��ҙ�C"Q%a��>��ܘ�A�+���=@�gvMDL�:���y]�2=�a{z �^js�o~2��X=a!R�M(�=�I���vkr�4�ϴ���z����6p��%��*�2�k�t����m Ά��Ġ_V�}���Hf�� �,&�_�O�m�=q%���zW��H�d\�;�}L�m�ґ���M91�(�W1\ ����w��nB�e-Ї2rz�cw,D"�mO�Z�7�*~�Ѝ�2��1kF�N6x�@��-|?w#�����G��i�ǖ�6�QU���2K{T	$����R!��Ϭ`�����ڛ
��|=�2J�*�1���	���+���74�Q�B���اk�teJ�?Q�/�ڦ
l�lk~۳��nH[ 5�+C�/1O���1a���e�S�6*����Gs��-��,���|��;w�$��\N-�i�����&�f<m�2����̸_.(z6��2�s�q���5�o1��=�}C��h����@ ��L�%�^��W�#�,'��
_��jY�m�*�+�����wph�� ѧ4Ǯ&��H=�>z�J�Y3�^�=>���@�����߾�y?-���OeYxEك�$�)�����]&ؽD�K;��KD���c[.t�� �U��AX�{Ki:�#���r�s:��,�O�Z^�aFb3%������w�,���9���h���[=� ���0�'���045L�D0    Lɉ?�Y]2T�&�='�w嶠�y�5��~�w��Jl��{,�Ի���ͳI�}�N/�����LN��g�j�̎���U����������E#~S��z1N%�΅�+�����>݊��n�Cr�V�.n�~	7�\�ĉ�g����e�F?�Z�XL��>Gߺ:���ov�_s��3�ԺB���uC��<<@�N�`�i 
M�v�N�:Q��z8�ꩇ����n_;�ЪQ�2���d�/�D?�B��,@��yF�
`gs_(�Y�"�tE�`�=�ʝ�Jz��H� ��\��bO�97a2"��Ö�q��)��b�Lx/��a���:�ZQPh�|g���Q�co�L��0)`ˑ��8nJ*.��ʹG�b�h�qjǾ�b���]��GױNgxڇd��v�Vý	�p�X��o<AAzJ0䟸9����+A<7�����+�,��wi���[s�+���pk���v]o���U�Ɉ�%?������i|��3��1xxG�Μ����Y�O"��K�@:�h[_=��p^���~��:!���������ڐEԶQ��g���|5�C�ת*����y^�v:A��쳏�i��dCa,M���L�����&縉x��%��m鈄[u$��4��Z���'�ߊn�2}ڶޫ��^��4��`g�8/���ac����Æழm������qqwT�!"%�ݳgT��mB�g�B$��=��C�M-���Z[ �0򀢯����1��5=S��p�(��y�iΖٳ��Œ~o���9]�_�`�[�ֻm3Fy�
V��b�z�������t+j���@�JWE��/����k��'A\'�BP�F�IT��c�.R���*�������A�V@�9~�+�òAA�'�r�L�G����Pˣ�\k"b4
�d
�~�J�l��xg�o+�q_T�w�ȟĮ��G��%�AZ#Gq��5�׬7�S�L�QvC��2��M@��) 뀔6��`p�����)RL����C�24�)w�����lf�	�L�6S  

// --- assets\js\admin.js ---

import { initializeFirebase, checkAuthState, loadAtendentes, updateUserRole, updateUserStatus } from './firebase.js';
import { showPopup } from './ui.js';

document.addEventListener('DOMContentLoaded', () => {
    
    // --- SELETORES GERAIS ---
    const userListBody = document.getElementById('userListBody');
    const loader = document.getElementById('adminLoader');
    const mainContent = document.getElementById('mainContent');
    let loadedAtendentes = {}; // Armazena os atendentes carregados para reutilização

    initializeFirebase();

    // --- LÓGICA DE GERENCIAMENTO DE USUÁRIOS ---
    const populateUserTable = (allAtendentes, currentAdminUid) => {
        userListBody.innerHTML = '';
        Object.entries(allAtendentes).forEach(([username, data]) => {
            const row = document.createElement('tr');
            
            row.innerHTML = `
                <td>${username}</td>
                <td>${data.nomeCompleto || 'N/A'}</td>
                <td>
                    <select data-username="${username}" ${data.uid === currentAdminUid ? 'disabled' : ''}>
                        <option value="usuario" ${data.role === 'usuario' ? 'selected' : ''}>Usuário</option>
                        <option value="admin" ${data.role === 'admin' ? 'selected' : ''}>Admin</option>
                    </select>
                </td>
                <td>
                    <button class="${data.status === 'inativo' ? 'button' : 'button back'}" data-username="${username}" data-current-status="${data.status || 'ativo'}" ${data.uid === currentAdminUid ? 'disabled' : ''}>
                        ${data.status === 'inativo' ? 'Ativar' : 'Desativar'}
                    </button>
                </td>
            `;
            
            if (data.status === 'inativo') {
                row.style.opacity = '0.5';
            }
            userListBody.appendChild(row);
        });
    };

    // --- FLUXO PRINCIPAL E EVENTOS DE GERENCIAMENTO ---
    loader.style.display = 'flex';
    mainContent.style.display = 'none';

    checkAuthState(async (user) => {
        if (user) {
            loadedAtendentes = await loadAtendentes(); // Carrega e armazena os atendentes
            const adminKey = Object.keys(loadedAtendentes).find(key => loadedAtendentes[key].uid === user.uid);
            
            if (adminKey && loadedAtendentes[adminKey].role === 'admin') {
                populateUserTable(loadedAtendentes, user.uid);
                loader.style.display = 'none';
                mainContent.style.display = 'block';
            } else {
                alert("Acesso negado. Você não tem permissão para ver esta página.");
                window.location.href = 'index.html';
            }
        } else {
            alert("Você precisa estar logado para acessar esta página.");
            window.location.href = 'index.html';
        }
    });

    userListBody.addEventListener('click', async (e) => {
        if (e.target.tagName === 'BUTTON' && e.target.dataset.username) {
            const button = e.target;
            const username = button.dataset.username;
            const newStatus = button.dataset.currentStatus === 'ativo' ? 'inativo' : 'ativo';
            try {
                await updateUserStatus(username, newStatus);
                showPopup(`Usuário ${username} foi ${newStatus === 'ativo' ? 'ativado' : 'desativado'}.`, 'success');
                // Recarrega os dados para atualizar a UI de forma consistente
                loadedAtendentes = await loadAtendentes();
                const currentUser = auth.currentUser;
                populateUserTable(loadedAtendentes, currentUser.uid);
            } catch (error) {
                showPopup(`Erro ao atualizar status: ${error.message}`, 'error');
            }
        }
    });

    userListBody.addEventListener('change', async (e) => {
        if (e.target.tagName === 'SELECT') {
            const username = e.target.dataset.username;
            const newRole = e.target.value;
            try {
                await updateUserRole(username, newRole);
                showPopup(`Permissão de ${username} atualizada para ${newRole}.`, 'success');
            } catch (error) {
                showPopup(`Erro ao atualizar permissão: ${error.message}`, 'error');
            }
        }
    });


    // --- LÓGICA PARA O VERIFICADOR DE USUÁRIOS ÓRFÃOS ---
    const checkerStep1 = document.getElementById('checkerStep1');
    const checkerStep2 = document.getElementById('checkerStep2');
    const checkerResults = document.getElementById('checkerResults');
    const loadValidUsersBtn = document.getElementById('loadValidUsersBtn');
    const compareBtn = document.getElementById('compareBtn');
    const pasteArea = document.getElementById('authPasteArea');
    const orphanList = document.getElementById('orphanList');
    let validUIDs = new Set();

    loadValidUsersBtn.addEventListener('click', () => {
        // Reutiliza a lista de atendentes já carregada
        Object.values(loadedAtendentes).forEach(data => {
            if (data.uid) validUIDs.add(data.uid);
        });
        
        alert(`${validUIDs.size} usuários válidos encontrados no banco de dados.`);
        checkerStep1.classList.add('hidden');
        checkerStep2.classList.remove('hidden');
    });

    compareBtn.addEventListener('click', () => {
        const pastedText = pasteArea.value;
        if (!pastedText.trim()) return alert("Por favor, cole os dados do painel de autenticação.");

        const lineRegex = /([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})\s+([a-zA-Z0-9]{28})/g;
        let match;
        const orphans = [];

        while ((match = lineRegex.exec(pastedText)) !== null) {
            const email = match[1];
            const uid = match[2];
            if (!validUIDs.has(uid)) {
                orphans.push({ email, uid });
            }
        }

        orphanList.innerHTML = '';
        if (orphans.length > 0) {
            orphans.forEach(orphan => {
                const li = document.createElement('li');
                li.innerHTML = `<span class="orphan">[ÓRFÃ]</span> Email: ${orphan.email} | UID: ${orphan.uid}`;
                orphanList.appendChild(li);
});
        } else {
            orphanList.innerHTML = '<li><span class="valid">[OK] Nenhuma conta órfã encontrada!</span></li>';
        }
        checkerResults.classList.remove('hidden');
    });
});

// --- assets\js\app.js ---

import { initializeUI, showSection, updateGreeting, showPopup } from './ui.js';
import {
    initializeFirebase,
    loadDataForAttendant,
    loadAtendentes,
    loginUser,
    loginWithUsername,
    logoutUser,
    checkAuthState,
    createUserAccount,
    updateUserPassword,
    updateUserFullName
} from './firebase.js';
import { initializeTheme } from './theme.js';
import { initializeChat } from './chat.js';
import { osEditorModule, initializeOsEditor } from './os-editor.js';
import { initializeConversor } from './conversor.js';

document.addEventListener('DOMContentLoaded', async () => {
    // --- 1. INICIALIZAÇÃO E SELETORES ---
    initializeUI();
    initializeTheme();
    initializeOsEditor();
    initializeConversor();
    initializeFirebase();
    const chatModule = initializeChat();

    let currentUsername = null;

    // Seletores da interface
    const authOverlay = document.getElementById('auth-overlay');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const mainContent = document.querySelector('.chatbox');
    const sidebar = document.querySelector('.sidebar');
    const atendenteToggleBtn = document.getElementById('atendenteToggleBtn');
    const chatLoader = document.getElementById('chatLoader');
    const profileModal = document.getElementById('profileModal');
    const updateFullNameForm = document.getElementById('update-fullname-form');
    const updatePasswordForm = document.getElementById('update-password-form');
    const modalLogoutBtn = document.getElementById('modalLogoutBtn');
    const modalCloseProfileBtn = document.getElementById('modalCloseProfileBtn');
    const adminLinkContainer = document.getElementById('admin-link-container');
    const newFullNameInput = document.getElementById('newFullName');
    const profileUsernameSpan = document.getElementById('profileUsername');

    // --- 2. DEFINIÇÃO DAS FUNÇÕES PRINCIPAIS ---

    const startApp = async (user, allAtendentes) => {
        const attendantKey = Object.keys(allAtendentes).find(key => allAtendentes[key].uid === user.uid);
        
        if (!attendantKey) {
            showPopup("Não foi possível carregar os dados do seu perfil. Por favor, faça o login novamente.", 'error');
            await logoutUser();
            return;
        }

        currentUsername = attendantKey;
        authOverlay.style.display = 'none';
        mainContent.style.display = 'flex';
        sidebar.style.display = 'flex';
        
        const attendantData = allAtendentes[attendantKey];
        if (attendantData.status === 'inativo') {
            showPopup("Sua conta foi desativada.", 'error');
            await logoutUser();
            return;
        }

        if (atendenteToggleBtn) {
            const atendenteTextSpan = atendenteToggleBtn.querySelector('.text');
            if (atendenteTextSpan) atendenteTextSpan.textContent = attendantKey.charAt(0).toUpperCase() + attendantKey.slice(1);
        }
        localStorage.setItem("atendenteAtual", attendantKey);
        
        if (newFullNameInput) newFullNameInput.value = attendantData.nomeCompleto;
        if (profileUsernameSpan) profileUsernameSpan.textContent = attendantKey;
        if (adminLinkContainer) adminLinkContainer.style.display = attendantData.role === 'admin' ? 'block' : 'none';

        chatLoader.style.display = 'flex';
        try {
            // 1. Carrega TODOS os dados (respostas e O.S.)
            const data = await loadDataForAttendant(attendantKey);

            // 2. REMOVA A LINHA QUE CRIA a constante 'chatResponses'
            // const chatResponses = data.filter(item => item.category === 'quick_reply'); // <-- APAGUE ESTA LINHA

            // 3. Passe a lista COMPLETA 'data' para ambos os módulos
            chatModule.setResponses(data); // <-- ALTERE DE VOLTA PARA 'data'
            osEditorModule.setTemplates(data, attendantKey);

        } catch (error) {
            console.error("Erro ao carregar dados do chat:", error);
            showPopup("Não foi possível carregar suas respostas.", "error");
        } finally {
            chatLoader.style.display = 'none';
        }

        updateGreeting(attendantKey);
        setInterval(() => updateGreeting(currentUsername), 60000);
    };

    const showLoginScreen = () => {
        mainContent.style.display = 'none';
        sidebar.style.display = 'none';
        authOverlay.style.display = 'flex';
        currentUsername = null;
    };

    // --- 3. FLUXO DE EXECUÇÃO PRINCIPAL ---
    try {
        checkAuthState(async (user) => {
            if (user) {
                const allAtendentes = await loadAtendentes();
                await startApp(user, allAtendentes);
            } else {
                showLoginScreen();
            }
        });
    } catch (error) {
        console.error("Erro fatal na inicialização:", error);
        showPopup("Não foi possível iniciar a aplicação.", "error");
        showLoginScreen();
    }

    // --- 4. EVENT LISTENERS DA INTERFACE ---
    if (atendenteToggleBtn) atendenteToggleBtn.addEventListener('click', () => { profileModal.style.display = 'flex'; });
    if (modalCloseProfileBtn) modalCloseProfileBtn.addEventListener('click', () => { profileModal.style.display = 'none'; });
    if (modalLogoutBtn) modalLogoutBtn.addEventListener('click', async () => { try { await logoutUser(); profileModal.style.display = 'none'; } catch (error) { showPopup("Erro ao fazer logout: " + error.message, 'error'); } });

    if (updateFullNameForm) {
        updateFullNameForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const newFullName = newFullNameInput.value;
            if (!newFullName.trim()) return showPopup("O nome não pode estar em branco.", 'error');
            if (!currentUsername) return showPopup("Erro: Usuário não identificado.", 'error');
            try {
                await updateUserFullName(currentUsername, newFullName);
                showPopup("Nome alterado com sucesso!", 'success');
                profileModal.style.display = 'none';
            } catch (error) {
                showPopup("Erro ao alterar o nome: " + error.message, 'error');
            }
        });
    }

    if (updatePasswordForm) {
        updatePasswordForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const newPassword = document.getElementById('newPassword').value;
            if (newPassword.length < 6) return showPopup("A nova senha deve ter pelo menos 6 caracteres.", 'error');
            try {
                await updateUserPassword(newPassword);
                showPopup("Senha alterada com sucesso!", 'success');
                document.getElementById('newPassword').value = '';
                profileModal.style.display = 'none';
            } catch (error) {
                showPopup("Erro ao alterar senha: " + error.message, 'error');
            }
        });
    }

    if(loginForm) {
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const identifier = document.getElementById('loginIdentifier').value;
            const password = document.getElementById('loginPassword').value;
            try {
                if (identifier.includes('@')) {
                    await loginUser(identifier, password);
                } else {
                    await loginWithUsername(identifier, password);
                }
            } catch (error) {
                let friendlyMessage = "Ocorreu um erro.";
                if (error.code === 'auth/invalid-login-credentials') {
                    friendlyMessage = "Usuário, e-mail ou senha incorretos.";
                }
                showPopup(friendlyMessage, 'error');
            }
        });
    }
    if (registerForm) {
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const userDetails = {
                username: document.getElementById('registerUsername').value,
                fullName: document.getElementById('registerFullName').value,
                email: document.getElementById('registerEmail').value,
                password: document.getElementById('registerPassword').value,
            };
            if (!userDetails.username || !userDetails.fullName) return showPopup("Todos os campos são obrigatórios.", 'error');
            
            try {
                // CORREÇÃO DO FLUXO PÓS-REGISTRO
                const { userCredential, sanitizedUsername, newAtendenteData } = await createUserAccount(userDetails);
                
                // Em vez de esperar o listener, iniciamos o app manualmente com os dados que acabamos de criar.
                // Isso evita a "tela presa" e a "condição de corrida".
                const allAtendentes = await loadAtendentes();
                allAtendentes[sanitizedUsername] = newAtendenteData;
                await startApp(userCredential.user, allAtendentes);
                
            } catch (error) {
                let friendlyMessage = "Ocorreu um erro desconhecido.";
                if (error.code === 'auth/email-already-in-use') friendlyMessage = "Este e-mail já está cadastrado.";
                else if (error.code === 'auth/weak-password') friendlyMessage = "A senha é muito fraca.";
                else if (error.message.includes('Este nome de usuário já pode estar em uso')) friendlyMessage = "Este nome de usuário já está em uso.";
                
                showPopup("Erro no registro: " + friendlyMessage, 'error');
            }
        });
    }

    document.querySelectorAll('.sidebar-button[data-section]').forEach(button => {
        button.addEventListener('click', () => {
            showSection(button.dataset.section, currentUsername); 
        });
    });
    const showRegisterBtn = document.getElementById('show-register');
    if (showRegisterBtn) showRegisterBtn.addEventListener('click', (e) => { e.preventDefault(); loginForm.style.display = 'none'; registerForm.style.display = 'block'; });
    const showLoginBtn = document.getElementById('show-login');
    if (showLoginBtn) showLoginBtn.addEventListener('click', (e) => { e.preventDefault(); registerForm.style.display = 'none'; loginForm.style.display = 'block'; });

    document.addEventListener('click', (e) => {
        if (profileModal && atendenteToggleBtn && !atendenteToggleBtn.contains(e.target) && !profileModal.contains(e.target)) {
            profileModal.style.display = 'none';
        }
    });
        document.addEventListener('click', (e) => {
        // Verifica se o elemento clicado (ou um parente próximo) tem a classe 'copiable'
        const copiableElement = e.target.closest('.copiable');
        if (copiableElement) {
            navigator.clipboard.writeText(copiableElement.textContent).then(() => {
                showPopup(`'${copiableElement.textContent}' copiado!`, 'success');
            }).catch(err => {
                console.error('Erro ao copiar:', err);
                showPopup('Não foi possível copiar.', 'error');
            });
        }
    });
});


// --- assets\js\bridge.js ---

// bridge.js

console.log("ATI Extensão [Ponte]: Script da ponte carregado no site-painel.");

// A cada 2 segundos, esta função verifica se o usuário fez login no site
setInterval(() => {
    // Lê o 'atendenteAtual' que o app.js do site salvou no localStorage
    const attendantKey = localStorage.getItem('atendenteAtual');

    if (attendantKey) {
        // Verifica no armazenamento da extensão se o valor já é o mesmo
        chrome.storage.local.get('atendenteAtual', (data) => {
            if (data.atendenteAtual !== attendantKey) {
                // Se for diferente (ou não existir), salva o novo valor
                chrome.storage.local.set({ atendenteAtual: attendantKey }, () => {
                    console.log(`[Ponte] Atendente '${attendantKey}' foi salvo para a extensão.`);
                });
            }
        });
    }
}, 2000);

// --- assets\js\chat.js ---

import { showPopup, adjustTextareaHeight, replacePlaceholders } from './ui.js';
import { saveDataForAttendant } from './firebase.js';

export function initializeChat() {
    // 'respostas' agora guardará a lista COMPLETA (quick replies + modelos de o.s.)
    let respostas = [];
    let currentSelection = { value: "", text: "Selecione uma resposta" };
    let sortableInstances = [];

    const elements = {
        selectDisplay: document.getElementById('select-display'),
        selectItems: document.getElementById('select-items'),
        response: document.getElementById('resposta'),
        title: document.getElementById('titulo'),
        titleContainer: document.getElementById('titleContainer'),
        copyBtn: document.getElementById('copyBtn'),
        editTitleBtn: document.getElementById('editTitleBtn'),
        saveEditBtn: document.getElementById('saveEditBtn'),
        deleteBtn: document.getElementById('deleteBtn'),
        addBtn: document.getElementById('addBtn'),
        saveTitleBtn: document.getElementById('saveTitleBtn'),
    };

    const getCurrentAttendant = () => localStorage.getItem('atendenteAtual');

    const updateResponseSelector = () => {
        elements.selectItems.innerHTML = '';

        // ## CORREÇÃO DE EXIBIÇÃO ##
        // Filtra a lista completa para pegar apenas os quick_replies para mostrar no chat
        const quickReplies = respostas.filter(r => r.category === 'quick_reply');

        if (quickReplies.length === 0) {
            elements.selectDisplay.textContent = 'Nenhuma resposta encontrada';
            return;
        }

        // Agrupa por categoria apenas os quick_replies
        const groupedByCategory = quickReplies.reduce((acc, template) => {
            const category = template.subCategory || 'Geral';
            if (!acc[category]) {
                acc[category] = [];
            }
            acc[category].push(template);
            return acc;
        }, {});

        sortableInstances.forEach(sortable => sortable.destroy());
        sortableInstances = [];

        for (const categoryName in groupedByCategory) {
            const categoryGroup = document.createElement("div");
            categoryGroup.className = 'category-group';
            const optgroup = document.createElement("div");
            optgroup.className = 'optgroup-label';
            optgroup.textContent = categoryName.charAt(0).toUpperCase() + categoryName.slice(1);
            categoryGroup.appendChild(optgroup);
            const optionsContainer = document.createElement("div");
            optionsContainer.className = 'options-container';
            optionsContainer.dataset.categoryName = categoryName;

            groupedByCategory[categoryName].forEach(template => {
                const opt = document.createElement("div");
                opt.className = 'option-item';
                opt.textContent = template.title;
                // IMPORTANTE: o data-value continua sendo o índice do item na lista COMPLETA ('respostas')
                opt.dataset.value = respostas.indexOf(template);
                opt.addEventListener('click', () => {
                    currentSelection = { value: opt.dataset.value, text: opt.textContent };
                    elements.selectDisplay.textContent = opt.textContent;
                    elements.selectItems.classList.add('select-hide');
                    displaySelectedResponse();
                });
                optionsContainer.appendChild(opt);
            });
            categoryGroup.appendChild(optionsContainer);
            elements.selectItems.appendChild(categoryGroup);
        }

        // Inicializa o Sortable para os itens dentro de cada categoria
        elements.selectItems.querySelectorAll('.options-container').forEach(container => {
            const sortable = Sortable.create(container, {
                group: 'shared-options',
                animation: 150,
                ghostClass: 'sortable-ghost',
                onEnd: (evt) => {
                    const itemEl = evt.item;
                    const originalIndex = parseInt(itemEl.dataset.value, 10);
                    const newCategoryName = evt.to.dataset.categoryName;
                    if (respostas[originalIndex] && newCategoryName) {
                        respostas[originalIndex].subCategory = newCategoryName;
                    }
                    saveOrderAndCategories();
                },
            });
            sortableInstances.push(sortable);
        });

        // Inicializa o Sortable para reordenar as categorias inteiras
        Sortable.create(elements.selectItems, {
            handle: '.optgroup-label',
            animation: 150,
            ghostClass: 'sortable-ghost',
            onEnd: () => saveOrderAndCategories(),
        });
    };

    // ## CORREÇÃO DE SALVAMENTO ##
    const saveOrderAndCategories = () => {
        const attendant = getCurrentAttendant();
        if (!attendant) return;

        // 1. Pega a nova ordem dos quick_replies a partir dos elementos visíveis no DOM
        const newOrderedQuickReplies = [];
        elements.selectItems.querySelectorAll('.option-item').forEach(item => {
            const originalIndex = parseInt(item.dataset.value, 10);
            if (respostas[originalIndex]) {
                newOrderedQuickReplies.push(respostas[originalIndex]);
            }
        });

        // 2. Pega todos os modelos de O.S. que não estão visíveis, para não perdê-los
        const osTemplates = respostas.filter(r => r.category !== 'quick_reply');

        // 3. Junta as duas listas: os quick_replies reordenados + os modelos de O.S. intactos
        const fullDataToSave = [...newOrderedQuickReplies, ...osTemplates];

        // 4. Atualiza o estado local e salva a lista COMPLETA no Firebase
        respostas = fullDataToSave;
        saveDataForAttendant(attendant, respostas).then(() => {
            updateResponseSelector();
            showPopup("Ordem e categoria salvas!", 'success');
        }).catch(error => {
            showPopup("Erro ao salvar as alterações.", 'error');
            console.error("Erro no Firebase:", error);
        });
    };

    const displaySelectedResponse = () => {
        const selectedIndex = currentSelection.value;
        if (selectedIndex === "") {
            elements.response.value = "Selecione uma opção para ver a mensagem.";
        } else {
            const template = respostas[parseInt(selectedIndex)];
            elements.response.value = template ? template.text : "Resposta não encontrada.";
        }
        adjustTextareaHeight(elements.response);
        elements.titleContainer.style.display = 'none';
    };

    const saveChanges = () => {
        const attendant = getCurrentAttendant();
        const selectedIndex = currentSelection.value;
        if (!attendant || selectedIndex === "") return showPopup("Selecione uma resposta para salvar.");
        respostas[parseInt(selectedIndex)].text = elements.response.value.trim();
        saveDataForAttendant(attendant, respostas);
        showPopup("Resposta salva com sucesso!", 'success');
    };

    const deleteResponse = () => {
        const attendant = getCurrentAttendant();
        const selectedIndex = currentSelection.value;
        if (!attendant || selectedIndex === "") return showPopup("Selecione uma resposta para apagar.");
        const modal = document.getElementById('confirmationModal');
        document.getElementById('modalTitle').textContent = 'Apagar Resposta';
        document.getElementById('modalMessage').textContent = 'Tem certeza que deseja apagar esta resposta permanentemente?';
        const confirmBtn = document.getElementById('modalConfirmBtn');
        const cancelBtn = document.getElementById('modalCancelBtn');
        modal.style.display = 'flex';
        const onConfirm = () => {
            respostas.splice(parseInt(selectedIndex), 1);
            saveDataForAttendant(attendant, respostas).then(() => {
                currentSelection = { value: "", text: "Selecione uma resposta" };
                updateResponseSelector();
                displaySelectedResponse();
                showPopup("Resposta apagada com sucesso!");
            });
            modal.style.display = 'none';
        };
        const onCancel = () => {
            confirmBtn.removeEventListener('click', onConfirm);
            cancelBtn.removeEventListener('click', onCancel);
            modal.style.display = 'none';
        };
        confirmBtn.addEventListener('click', onConfirm, { once: true });
        cancelBtn.addEventListener('click', onCancel, { once: true });
    };

    const addNewResponse = () => {
        const attendant = getCurrentAttendant();
        if (!attendant) return showPopup("Selecione um atendente primeiro.");
        const modal = document.getElementById('addResponseModal');
        const titleInput = document.getElementById('newResponseTitle');
        const categoryInput = document.getElementById('newResponseCategory');
        const saveBtn = document.getElementById('modalSaveNewBtn');
        const cancelBtn = document.getElementById('modalCancelNewBtn');
        titleInput.value = '';
        categoryInput.value = '';
        modal.style.display = 'flex';
        titleInput.focus();
        const onSave = () => {
            const title = titleInput.value.trim();
            if (!title) return showPopup("O título não pode estar em branco.");
            let categoryName = categoryInput.value.trim() || 'Geral';
            const newTemplate = {
                title: title,
                text: "Nova resposta. Edite aqui e clique em Salvar.",
                category: "quick_reply",
                subCategory: categoryName,
                keywords: []
            };
            respostas.push(newTemplate);
            saveDataForAttendant(attendant, respostas).then(() => {
                currentSelection = { value: (respostas.length - 1).toString(), text: title };
                updateResponseSelector();
                displaySelectedResponse();
                showPopup("Nova resposta adicionada!");
                modal.style.display = 'none';
            });
        };
        const onCancel = () => {
            saveBtn.removeEventListener('click', onSave);
            cancelBtn.removeEventListener('click', onCancel);
            modal.style.display = 'none';
        };
        saveBtn.addEventListener('click', onSave, { once: true });
        cancelBtn.addEventListener('click', onCancel, { once: true });
    };

    const editTitle = () => {
        const selectedIndex = currentSelection.value;
        if (selectedIndex === "") return showPopup("Selecione uma resposta para editar o título.");
        const template = respostas[parseInt(selectedIndex)];
        if (template) {
            elements.title.value = template.title;
            elements.titleContainer.style.display = 'flex';
            elements.title.focus();
        }
    };

    const saveNewTitle = () => {
        const attendant = getCurrentAttendant();
        const selectedIndex = currentSelection.value;
        if (selectedIndex === "" || !attendant) return;
        const newTitle = elements.title.value.trim();
        if (!newTitle) return showPopup("O título não pode estar em branco.");
        respostas[parseInt(selectedIndex)].title = newTitle;
        saveDataForAttendant(attendant, respostas).then(() => {
            currentSelection.text = newTitle;
            updateResponseSelector();
            displaySelectedResponse();
            showPopup("Título alterado com sucesso!");
        });
    };

    // --- Event Listeners ---
    elements.selectDisplay.addEventListener('click', () => elements.selectItems.classList.toggle('select-hide'));
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.custom-select')) elements.selectItems.classList.add('select-hide');
    });
    elements.response.addEventListener('input', () => adjustTextareaHeight(elements.response));
    elements.copyBtn.addEventListener('click', () => {
        const rawText = elements.response.value;
        const processedText = replacePlaceholders(rawText);
        navigator.clipboard.writeText(processedText).then(() => showPopup('Texto copiado!'));
    });
    elements.saveEditBtn.addEventListener('click', saveChanges);
    elements.addBtn.addEventListener('click', addNewResponse);
    elements.deleteBtn.addEventListener('click', deleteResponse);
    elements.editTitleBtn.addEventListener('click', editTitle);
    elements.saveTitleBtn.addEventListener('click', saveNewTitle);

    // --- API PÚBLICA DO MÓDULO ---
    return {
        setResponses: (data) => {
            respostas = Array.isArray(data) ? data : [];
            currentSelection = { value: "", text: "Selecione uma resposta" };
            updateResponseSelector();
            displaySelectedResponse();
        }
    };
}

// --- assets\js\conversor.js ---

import { showPopup, replacePlaceholders } from './ui.js';

// Define o worker do PDF.js para o módulo
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

// --- Funções Auxiliares do Módulo ---

function formatAddress(fullAddress) {
    if (!fullAddress || typeof fullAddress !== 'string') return 'N/A';
    // Exemplo de entrada: "RUA YEDA,781, TIJUCA, 25975-560, TERESOPOLIS/RJ."
    const parts = fullAddress.split(','); // ["RUA YEDA", "781", " TIJUCA", ...]
    if (parts.length < 3) return fullAddress; // Retorna o original se o formato for inesperado

    // 1. Pega as 3 primeiras partes: "RUA YEDA,781, TIJUCA"
    let address = parts.slice(0, 3).join(',');
    // 2. Substitui a primeira vírgula por um espaço: "RUA YEDA 781, TIJUCA"
    address = address.replace(',', ' ');
    return address.trim();
}

function formatPhone(phone) {
    const cleaned = phone.replace(/\D/g, '');
    const isValid = /^[1-9]{2}(9?\d{8})$/.test(cleaned);
    let formatted = cleaned;
    if (isValid) {
        if (cleaned.length === 10) { // Fixo
            formatted = `${cleaned.slice(0, 2)} ${cleaned.slice(2, 6)}-${cleaned.slice(6)}`;
        } else if (cleaned.length === 11) { // Celular
            formatted = `${cleaned.slice(0, 2)} ${cleaned.slice(2, 7)}-${cleaned.slice(7)}`;
        }
    }
    return { formatted, isValid };
}

function formatDate(dateStr) {
    if (!dateStr) return '';
    const [year, month, day] = dateStr.split('-');
    return `${day}/${month}`;
}

// --- Função Principal de Inicialização ---

export function initializeConversor() {
    let pdfData = {};
    let osTextData = { withdrawal: '', installation: '', os: '' };

    const elements = {
        uploadSection: document.getElementById('uploadSection'),
        dataSection: document.getElementById('dataSection'),
        withdrawalSection: document.getElementById('withdrawalSection'),
        copyButtons: document.getElementById('copyButtons'),
        contratoSpan: document.getElementById('contratoSpan'),
        contrato: document.getElementById('contrato'),
        nome: document.getElementById('nome'),
        oldAddress: document.getElementById('oldAddress'),
        newAddress: document.getElementById('newAddress'),
        fileName: document.getElementById('fileName'),
        phoneError: document.getElementById('phoneError'),
        renewalMessage: document.getElementById('renewalMessage'),
        migrationMessage: document.getElementById('migrationMessage'),
        output: document.getElementById('output'),
        pdfUpload: document.getElementById('pdfUpload'),
        phone: document.getElementById('phone'),
        equipmentType: document.getElementById('equipmentType'),
        withdrawalDate: document.getElementById('withdrawalDate'),
        withdrawalPeriod: document.getElementById('withdrawalPeriod'),
        installationDate: document.getElementById('installationDate'),
        installationPeriod: document.getElementById('installationPeriod'),
        taxValue: document.getElementById('taxValue'),
        signature: document.getElementById('signature'),
        selfWithdrawal: document.getElementById('selfWithdrawal'),
        renewal: document.getElementById('renewal'),
        migration: document.getElementById('migration'),
        carrierSection: document.getElementById('carrierSection'), // ADICIONAR
        oldCarrier: document.getElementById('oldCarrier'), 
        loadPdfBtn: document.getElementById('loadPdfBtn'),
        generateOsBtn: document.getElementById('generateOsBtn'),
        backToUploadBtn: document.getElementById('backToUploadBtn'),
        copyWithdrawalBtn: document.getElementById('copyWithdrawalBtn'),
        copyInstallationBtn: document.getElementById('copyInstallationBtn'),
        copyOsBtn: document.getElementById('copyOsBtn'),
    };

    const setMinDates = () => {
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        const minDate = tomorrow.toISOString().split('T')[0];
        elements.withdrawalDate.min = minDate;
        elements.installationDate.min = minDate;
    };

    const updateInstallationMinDate = () => {
        if (!elements.selfWithdrawal.checked && elements.withdrawalDate.value) {
            elements.installationDate.min = elements.withdrawalDate.value;
        } else {
            setMinDates();
        }
    };

    const updateTaxLogic = () => {
        const isExempt = elements.renewal.checked || elements.migration.checked;
        elements.taxValue.disabled = isExempt;
        elements.renewalMessage.style.display = elements.renewal.checked ? 'block' : 'none';
        elements.migrationMessage.style.display = elements.migration.checked ? 'block' : 'none';
        elements.carrierSection.style.display = elements.migration.checked ? 'block' : 'none';
        elements.taxValue.value = isExempt ? 'isento' : '100';
    };
    
    const handleCheckboxExclusion = (event) => {
        const { id, checked } = event.target;
        if (id === 'renewal') {
            elements.migration.disabled = checked;
        } else if (id === 'migration') {
            elements.renewal.disabled = checked;
        }
    };

    const resetForm = () => {
        pdfData = {};
        osTextData = { withdrawal: '', installation: '', os: '' };
        elements.dataSection.style.display = 'none';
        elements.uploadSection.style.display = 'block';
        elements.pdfUpload.value = '';
        elements.fileName.textContent = 'Nenhum arquivo selecionado';
        elements.output.textContent = '';
        elements.phone.value = '';
        elements.phoneError.textContent = '';
        elements.copyButtons.style.display = 'none';
        elements.renewal.checked = false;
        elements.carrierSection.style.display = 'none';
        elements.oldCarrier.value = 'none';
        elements.migration.checked = false;
        elements.selfWithdrawal.checked = false;
        elements.migration.disabled = false;
        elements.renewal.disabled = false;
        updateTaxLogic();
    };

    async function handlePdfLoad() {
        const file = elements.pdfUpload.files[0];
        if (!file) return showPopup('Por favor, selecione um arquivo PDF.');
        
        try {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            const text = (await (await pdf.getPage(1)).getTextContent()).items.map(item => item.str).join(' ');

            // --- LÓGICA DE EXTRAÇÃO CORRIGIDA USANDO SUA REGEX ORIGINAL E FUNCIONAL ---

            // Esta é a expressão regular correta do seu código original, que busca duas linhas de endereço.
            const oldAddressRegex = /2 - Sobre o\(s\) antigo\(s\) endereco\(s\) de cobrança e instalação\s+([\s\S]*? \/ RJ\.)\s+([\s\S]*? \/ RJ\.)/;
            const newAddressRegex = /3 - Sobre o\(s\) novo\(s\) endereco\(s\) de cobrança e instalação\s+([\s\S]*? \/ RJ\.)\s+([\s\S]*? \/ RJ\.)/;

            pdfData.contrato = text.match(/Aditivo do Contrato (\d+)/)?.[1] || 'N/A';
            pdfData.nomeCompleto = text.match(/CONTRATADA e ([\s\S]*?),/)?.[1].trim() || 'N/A';
            pdfData.primeiroNome = pdfData.nomeCompleto.split(' ')[0].toUpperCase();
            
            // Acessamos o grupo [2], que é o segundo endereço capturado, exatamente como no seu código.
            const rawOldAddress = oldAddressRegex.exec(text)?.[2].trim().toUpperCase();
            const rawNewAddress = newAddressRegex.exec(text)?.[2].trim().toUpperCase();

            pdfData.oldAddress = formatAddress(rawOldAddress) || 'Endereço antigo não encontrado';
            pdfData.newAddress = formatAddress(rawNewAddress) || 'Endereço novo não encontrado';

            // Preenche a UI com os dados
            elements.contratoSpan.textContent = pdfData.contrato;
            elements.contrato.textContent = pdfData.contrato;
            elements.nome.textContent = pdfData.nomeCompleto;
            elements.oldAddress.textContent = pdfData.oldAddress;
            elements.newAddress.textContent = pdfData.newAddress;

            elements.uploadSection.style.display = 'none';
            elements.dataSection.style.display = 'block';

        } catch (error) {
            console.error('Erro ao processar PDF:', error);
            showPopup('Erro ao ler o arquivo PDF.');
            resetForm();
        }
    }

    function handleGenerateOS() {
        const technician = localStorage.getItem('atendenteAtual')?.toUpperCase();
        if (!technician) return showPopup('Selecione um atendente antes de gerar a OS.');

        const { formatted: phone, isValid } = formatPhone(elements.phone.value);
        if (!isValid) {
            elements.phoneError.textContent = 'Telefone inválido. Ex: (21) 98765-4321';
            return;
        }
        elements.phoneError.textContent = '';
        
        const isSelfWithdrawal = elements.selfWithdrawal.checked;
        const withdrawalDay = formatDate(elements.withdrawalDate.value);
        const installationDay = formatDate(elements.installationDate.value);
        
        if (!isSelfWithdrawal && !withdrawalDay) return showPopup('Data de Retirada é obrigatória.');
        if (!installationDay) return showPopup('Data de Instalação é obrigatória.');
        if (!isSelfWithdrawal && elements.installationDate.value && elements.withdrawalDate.value && new Date(elements.installationDate.value) < new Date(elements.withdrawalDate.value)) {
            return showPopup('Instalação não pode ser antes da Retirada.');
        }

        const withdrawalPeriod = elements.withdrawalPeriod.value.toUpperCase();
        const installationPeriod = elements.installationPeriod.value.toUpperCase();
        
        const signature = elements.signature.value === 'digital' ? 'ASSINATURA DIGITAL PENDENTE' : 'TITULAR NO LOCAL PARA ASSINATURA';
        
        let scheduleLines = '';
        if (!isSelfWithdrawal) {
            osTextData.withdrawal = `${withdrawalDay} - ${pdfData.contrato} - ${pdfData.primeiroNome} - ${pdfData.oldAddress} - MUD ENDEREÇO - ${withdrawalPeriod} - ${technician}`;
            scheduleLines += osTextData.withdrawal + '\n';
        } else {
            osTextData.withdrawal = '';
        }
        
        osTextData.installation = `${installationDay} - ${pdfData.contrato} - ${pdfData.primeiroNome} - ${pdfData.newAddress} - MUD ENDEREÇO - ${installationPeriod} - ${technician}`;
        scheduleLines += osTextData.installation;
        
        // ✅ LINHA CORRIGIDA / READICIONADA ABAIXO
        const withdrawalText = isSelfWithdrawal ? 'CLIENTE FAZ A RETIRADA POR CONTA PRÓPRIA' : `RETIRAR EM ${pdfData.oldAddress} DIA ${withdrawalDay} ${withdrawalPeriod}`;
        
        const taxValue = elements.taxValue.value;
        let taxText;
        if (elements.renewal.checked) {
            taxText = 'ISENTO DA TAXA POR RENOVAÇÃO.';
        } else if (elements.migration.checked) {
            taxText = 'ISENTO DA TAXA POR MIGRAÇÃO.';
        } else if (taxValue === 'isento') {
            taxText = 'ISENTO DA TAXA.';
        } else {
            taxText = `TAXA DE R$${taxValue}.`;
        }

        // --- INÍCIO DA NOVA LÓGICA DO PORTADOR ---
        let carrierText = '';
        if (elements.migration.checked) {
            const selectedCarrier = elements.oldCarrier.value;
            if (selectedCarrier !== 'none') {
                carrierText = `** ANTIGO PORTADOR ${selectedCarrier.toUpperCase()} **\n`;
            }
        }
        // --- FIM DA NOVA LÓGICA ---

        // Adiciona a variável 'carrierText' no início da O.S.
        osTextData.os = `${carrierText}${phone} ${pdfData.primeiroNome} | ** ${elements.equipmentType.value.toUpperCase()} **\n${withdrawalText}.\nINSTALAR EM ${pdfData.newAddress} DIA ${installationDay} ${installationPeriod}.\n${taxText}\n${signature}.`;
        
        const fullOutput = `${scheduleLines}\n\n${osTextData.os}`;
        elements.output.textContent = replacePlaceholders(fullOutput);
        elements.output.style.height = 'auto';
        elements.output.style.height = (elements.output.scrollHeight) + 'px';
        elements.copyButtons.style.display = 'flex';
    }

    // --- Configuração Inicial e Event Listeners ---
    setMinDates();

    elements.loadPdfBtn.addEventListener('click', handlePdfLoad);
    elements.generateOsBtn.addEventListener('click', handleGenerateOS);
    elements.backToUploadBtn.addEventListener('click', resetForm);
    elements.copyWithdrawalBtn.addEventListener('click', () => {
        if(osTextData.withdrawal) navigator.clipboard.writeText(osTextData.withdrawal).then(() => showPopup('Agendamento de Retirada copiado!'));
        else showPopup('Não há agendamento de retirada para copiar.');
    });
    elements.copyInstallationBtn.addEventListener('click', () => {
        navigator.clipboard.writeText(osTextData.installation).then(() => showPopup('Agendamento de Instalação copiado!'));
    });
    elements.copyOsBtn.addEventListener('click', () => {
        navigator.clipboard.writeText(replacePlaceholders(osTextData.os)).then(() => showPopup('Texto da O.S. copiado!'));
    });
    elements.pdfUpload.addEventListener('change', () => {
        elements.fileName.textContent = elements.pdfUpload.files[0]?.name || 'Nenhum arquivo selecionado';
    });
    elements.phone.addEventListener('blur', () => {
        const { formatted, isValid } = formatPhone(elements.phone.value);
        elements.phone.value = formatted;
        elements.phoneError.textContent = isValid ? '' : 'Telefone inválido.';
    });
    elements.selfWithdrawal.addEventListener('change', () => {
        elements.withdrawalSection.style.display = elements.selfWithdrawal.checked ? 'none' : 'block';
        updateInstallationMinDate();
    });
    elements.withdrawalDate.addEventListener('change', updateInstallationMinDate);
    elements.renewal.addEventListener('change', updateTaxLogic);
    elements.migration.addEventListener('change', updateTaxLogic);
    elements.renewal.addEventListener('change', handleCheckboxExclusion);
    elements.migration.addEventListener('change', handleCheckboxExclusion);
}

// --- assets\js\firebase.js ---

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getDatabase, ref, set, get, remove } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
import { 
    getAuth, 
    createUserWithEmailAndPassword, 
    signInWithEmailAndPassword, 
    signOut, 
    onAuthStateChanged,
    updateProfile,
    updatePassword 
} from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyB5wO0x-7NFmh6waMKzWzRew4ezfYOmYBI",
    authDomain: "site-ati-75d83.firebaseapp.com",
    databaseURL: "https://site-ati-75d83-default-rtdb.firebaseio.com/",
    projectId: "site-ati-75d83",
    storageBucket: "site-ati-75d83.appspot.com",
    messagingSenderId: "467986581951",
    appId: "1:467986581951:web:046a778a0c9b6967d5790a",
    measurementId: "G-22D5RNGGK6"
};

export let db;
let auth;

export function initializeFirebase() {
    try {
        const app = initializeApp(firebaseConfig);
        db = getDatabase(app);
        auth = getAuth(app);
    } catch (error) {
        console.error("❌ Erro ao inicializar Firebase:", error);
    }
}

function capitalizeFullName(name) {
    if (!name || typeof name !== 'string') return '';
    return name.split(' ').map(word => 
        word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
    ).join(' ');
}

export const loginUser = (email, password) => signInWithEmailAndPassword(auth, email, password);
export const logoutUser = () => signOut(auth);
export const checkAuthState = (callback) => onAuthStateChanged(auth, callback);
export const updateUserPassword = (newPassword) => {
    if (!auth.currentUser) throw new Error("Usuário não autenticado.");
    return updatePassword(auth.currentUser, newPassword);
};

export async function loginWithUsername(username, password) {
    const sanitizedUsername = username.trim().toLowerCase();
    const userRef = ref(db, `atendentes/${sanitizedUsername}`);
    const snapshot = await get(userRef);

    if (!snapshot.exists() || !snapshot.val().email) {
        const error = new Error("Credenciais inválidas.");
        error.code = 'auth/invalid-login-credentials';
        throw error;
    }

    const email = snapshot.val().email;
    return signInWithEmailAndPassword(auth, email, password);
}

export async function createUserAccount(details) {
    const { email, password, username, fullName } = details;
    const sanitizedUsername = username.trim().toLowerCase().replace(/\s+/g, "_");
    if (/[.$#[\]/]/.test(sanitizedUsername)) {
        throw new Error('Nome de usuário inválido.');
    }

    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;
    const formattedFullName = capitalizeFullName(fullName);

    await updateProfile(user, { displayName: formattedFullName });

    const newAtendenteData = {
        nomeCompleto: formattedFullName,
        role: "usuario",
        status: "ativo",
        uid: user.uid,
        email: email
    };

    try {
        const atendenteRef = ref(db, `atendentes/${sanitizedUsername}`);
        await set(atendenteRef, newAtendenteData);
        // Retorna tudo que o app.js precisa para iniciar o app imediatamente
        return { userCredential, sanitizedUsername, newAtendenteData };
    } catch (error) {
        await user.delete();
        console.error("Erro ao gravar no banco de dados, usuário de autenticação foi revertido:", error);
        throw new Error('Este nome de usuário já pode estar em uso ou ocorreu um erro de permissão.');
    }
}

export async function loadAtendentes() {
    const dbRef = ref(db, 'atendentes');
    const snapshot = await get(dbRef);
    return snapshot.exists() ? snapshot.val() : {};
}

export async function loadDataForAttendant(attendant) {
    if (!attendant || !auth.currentUser) return [];
    const dbRef = ref(db, `respostas/${attendant}`);
    const snapshot = await get(dbRef);
    // Lógica simplificada: Apenas lê. Se não existir, retorna vazio.
    return snapshot.exists() ? snapshot.val() : [];
}

export async function saveDataForAttendant(attendant, data) {
    if (!attendant || !auth.currentUser) {
        console.error("Tentativa de salvar dados sem um atendente definido.");
        return;
    }
    const dbRef = ref(db, `respostas/${attendant}`);
    await set(dbRef, data);
}

export async function updateUserFullName(username, newFullName) {
    if (!auth.currentUser) throw new Error("Usuário não autenticado.");
    const formattedName = capitalizeFullName(newFullName);
    const dbRef = ref(db, `atendentes/${username}/nomeCompleto`);
    await set(dbRef, formattedName);
    await updateProfile(auth.currentUser, { displayName: formattedName });
}

async function updateUserData(username, field, value) {
    if (!auth.currentUser) throw new Error("Ação não permitida.");
    const userFieldRef = ref(db, `atendentes/${username}/${field}`);
    return set(userFieldRef, value);
}

export const updateUserRole = (username, newRole) => updateUserData(username, 'role', newRole);
export const updateUserStatus = (username, newStatus) => updateUserData(username, 'status', newStatus);


// --- assets\js\os-editor.js ---

// assets/js/os-editor.js

import { showPopup } from './ui.js';
import { saveDataForAttendant, db } from './firebase.js'; // Precisaremos do 'db' para buscar o modelo mestre
import { ref, get } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

// Variável para guardar todos os templates do usuário (O.S. e Quick Replies)
let allUserTemplates = []; 
let currentUsername = '';

const elements = {
    list: document.getElementById('os-list'),
    form: document.getElementById('os-form'),
    formTitle: document.getElementById('os-form-title'),
    editIndex: document.getElementById('os-edit-index'),
    title: document.getElementById('os-title'),
    text: document.getElementById('os-text'),
    category: document.getElementById('os-category'),
    keywords: document.getElementById('os-keywords'),
    saveBtn: document.getElementById('os-save-btn'),
    newBtn: document.getElementById('os-new-btn'),
    deleteBtn: document.getElementById('os-delete-btn'),
    resetBtn: document.getElementById('os-reset-btn'),
};

function getOsTemplates() {
    return allUserTemplates.filter(t => t.category !== 'quick_reply');
}

function renderList() {
    const osTemplates = getOsTemplates();
    elements.list.innerHTML = '';
    if (osTemplates.length === 0) {
        elements.list.innerHTML = '<p>Nenhum modelo de O.S. encontrado.</p>';
        return;
    }

    // 1. Agrupa os templates por categoria usando reduce
    const groupedByCategory = osTemplates.reduce((acc, template) => {
        const category = template.category || 'Geral'; // Usa 'Geral' se não houver categoria
        if (!acc[category]) {
            acc[category] = [];
        }
        acc[category].push(template);
        return acc;
    }, {});

    // 2. Itera sobre as categorias agrupadas para criar a lista
    for (const category in groupedByCategory) {
        // Cria o título da categoria (ex: <h3>Financeiro</h3>)
        const categoryHeader = document.createElement('div');
        categoryHeader.className = 'os-category-header';
        categoryHeader.textContent = category;
        elements.list.appendChild(categoryHeader);

        // Itera sobre os templates dentro de cada categoria
        groupedByCategory[category].forEach(template => {
            const originalIndex = allUserTemplates.indexOf(template);
            const item = document.createElement('div');
            item.className = 'os-list-item';
            item.textContent = template.title;
            item.dataset.index = originalIndex;
            
            item.addEventListener('click', () => {
                document.querySelectorAll('.os-list-item.active').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                fillFormForEdit(originalIndex);
            });

            elements.list.appendChild(item);
        });
    }
}

function fillFormForEdit(index) {
    const template = allUserTemplates[index];
    if (!template) return;

    elements.formTitle.textContent = `Editando: ${template.title}`;
    elements.editIndex.value = index;
    elements.title.value = template.title;
    elements.text.value = template.text;
    elements.category.value = template.category;
    elements.keywords.value = (template.keywords || []).join(', ');
    elements.deleteBtn.style.display = 'inline-block';
}

function resetForm() {
    elements.form.reset();
    elements.formTitle.textContent = 'Crie um Novo Modelo';
    elements.editIndex.value = '';
    elements.deleteBtn.style.display = 'none';
    document.querySelectorAll('.os-list-item.active').forEach(i => i.classList.remove('active'));
}

async function saveAllTemplates() {
    if (!currentUsername) return;
    await saveDataForAttendant(currentUsername, allUserTemplates);
    renderList(); // Re-renderiza a lista para refletir as mudanças
}

async function handleFormSubmit(e) {
    e.preventDefault();
    const data = {
        title: elements.title.value.trim(),
        text: elements.text.value.trim(),
        category: elements.category.value,
        keywords: elements.keywords.value.split(',').map(k => k.trim()).filter(Boolean),
    };

    if (!data.title) {
        showPopup('O título é obrigatório.', 'error');
        return;
    }

    const editIndex = elements.editIndex.value;

    if (editIndex !== '') { // Editando um existente
        const template = allUserTemplates[parseInt(editIndex)];
        Object.assign(template, data);
    } else { // Criando um novo
        // Garante que não é confundido com uma resposta rápida
        if (data.category === 'quick_reply') data.category = 'Geral'; 
        allUserTemplates.push(data);
    }

    await saveAllTemplates();
    showPopup('Modelo salvo com sucesso!', 'success');
    resetForm();
}

async function handleDelete() {
    const editIndex = elements.editIndex.value;
    if (editIndex === '') return;

    if (confirm('Tem certeza que deseja apagar este modelo?')) {
        allUserTemplates.splice(parseInt(editIndex), 1);
        await saveAllTemplates();
        showPopup('Modelo apagado.', 'info');
        resetForm();
    }
}

async function resetToDefaults() {
    if (!confirm('Isso substituirá TODOS os seus modelos de O.S. pelos modelos padrão. Deseja continuar?')) {
        return;
    }

    try {
        const masterRef = ref(db, 'os_templates_master');
        const snapshot = await get(masterRef);
        if (snapshot.exists()) {
            const masterTemplates = snapshot.val();
            // Remove todos os modelos de O.S. antigos
            const quickReplies = allUserTemplates.filter(t => t.category === 'quick_reply');
            // Cria a nova lista com as respostas rápidas + os modelos mestre
            allUserTemplates = [...quickReplies, ...masterTemplates];
            await saveAllTemplates();
            showPopup('Modelos de O.S. resetados para o padrão!', 'success');
        } else {
            showPopup('Nenhum modelo padrão encontrado no banco de dados.', 'error');
        }
    } catch (error) {
        showPopup('Erro ao buscar modelos padrão.', 'error');
        console.error("Erro ao resetar:", error);
    }
}


export function initializeOsEditor() {
    elements.form.addEventListener('submit', handleFormSubmit);
    elements.newBtn.addEventListener('click', resetForm);
    elements.deleteBtn.addEventListener('click', handleDelete);
    elements.resetBtn.addEventListener('click', resetToDefaults);
}

// API pública para o app.js
export const osEditorModule = {
    setTemplates: (templates, username) => {
        allUserTemplates = templates;
        currentUsername = username;
        renderList();
        resetForm();
    }
};

// --- assets\js\theme.js ---

import { showPopup } from './ui.js';

// Funções auxiliares de cor
function lightenColor(hex, percent) {
    hex = hex.replace("#", "");
    const r = parseInt(hex.substring(0, 2), 16);
    const g = parseInt(hex.substring(2, 4), 16);
    const b = parseInt(hex.substring(4, 6), 16);
    const increase = percent / 100;
    return `#${Math.min(255, Math.round(r + (255 - r) * increase)).toString(16).padStart(2, "0")}${Math.min(255, Math.round(g + (255 - g) * increase)).toString(16).padStart(2, "0")}${Math.min(255, Math.round(b + (255 - b) * increase)).toString(16).padStart(2, "0")}`;
}
function hexToRgba(hex, alpha) {
    hex = hex.replace("#", "");
    const r = parseInt(hex.substring(0, 2), 16);
    const g = parseInt(hex.substring(2, 4), 16);
    const b = parseInt(hex.substring(4, 6), 16);
    return `rgba(${r}, ${g}, ${b}, ${alpha})`;
}
function getLuminance(hex) {
    if (!hex || hex.length < 4) return 0; // Proteção contra cores inválidas
    hex = hex.replace("#", "");
    const r = parseInt(hex.substring(0, 2), 16) / 255;
    const g = parseInt(hex.substring(2, 4), 16) / 255;
    const b = parseInt(hex.substring(4, 6), 16) / 255;
    const a = [r, g, b].map(v => v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4));
    return 0.2126 * a[0] + 0.7152 * a[1] + 0.0722 * a[2];
}

// --- Função Principal de Inicialização do Tema ---
export function initializeTheme() {
    const elements = {
        popup: document.getElementById('customizationPopup'),
        openBtn: document.getElementById('darkModeToggleBtn'),
        saveBtn: document.getElementById('saveCustomizationBtn'),
        closeBtn: document.getElementById('closeCustomizationBtn'),
        themeToggle: document.getElementById('themeToggle'),
        neonBorders: document.getElementById('neonBorders'),
        iconColor: document.getElementById('iconColor'),
        borderColor: document.getElementById('borderColor'),
        textColor: document.getElementById('textColor'),
        styleTag: document.getElementById('custom-styles') || document.createElement('style')
    };
    if (!document.getElementById('custom-styles')) {
        elements.styleTag.id = 'custom-styles';
        document.head.appendChild(elements.styleTag);
    }

    let originalSettings = {};

    const applyCustomizations = (settings) => {
        document.body.classList.toggle('dark-mode', settings.isDarkMode);
        document.body.classList.toggle('no-neon', !settings.neonBorders);

        const contrastColorForIcons = getLuminance(settings.iconColor) > 0.5 ? '#000000' : '#FFFFFF';
        const contrastColorForButtons = getLuminance(settings.borderColor) > 0.5 ? '#111111' : '#FFFFFF';
        
        elements.styleTag.textContent = `
            :root {
                --icon-color: ${settings.iconColor};
                --border-color: ${settings.borderColor};
                --button-bg: ${settings.borderColor};
                --heading-color: ${settings.textColor};
                --button-text: ${contrastColorForButtons};
                --button-hover-bg: ${lightenColor(settings.borderColor, 20)};
                --shadow-color: ${hexToRgba(settings.borderColor, 0.5)};
            }
            .sidebar-button.active {
                background-color: ${settings.iconColor} !important;
                color: ${contrastColorForIcons} !important;
            }
        `;
    };

    const loadSettings = () => {
        const isDarkMode = localStorage.getItem('darkMode') === 'true';
        const defaultColors = {
            iconColor: isDarkMode ? '#0AEEF5' : '#D12E66',
            borderColor: isDarkMode ? '#0AEEF5' : '#D12E66',
            textColor: isDarkMode ? '#E5E5E5' : '#1A3C5A',
        };
        return {
            isDarkMode: isDarkMode,
            neonBorders: localStorage.getItem('neonBorders') !== 'false',
            iconColor: localStorage.getItem('iconColor') || defaultColors.iconColor,
            borderColor: localStorage.getItem('borderColor') || defaultColors.borderColor,
            textColor: localStorage.getItem('textColor') || defaultColors.textColor,
        };
    };

    const saveSettings = (settings) => {
        localStorage.setItem('darkMode', settings.isDarkMode);
        localStorage.setItem('neonBorders', settings.neonBorders);
        localStorage.setItem('iconColor', settings.iconColor);
        localStorage.setItem('borderColor', settings.borderColor);
        localStorage.setItem('textColor', settings.textColor);
    };

    const updatePopupUI = (settings) => {
        elements.themeToggle.checked = settings.isDarkMode;
        elements.neonBorders.checked = settings.neonBorders;
        elements.iconColor.value = settings.iconColor;
        elements.borderColor.value = settings.borderColor;
        elements.textColor.value = settings.textColor;
    };

    elements.openBtn.addEventListener('click', () => {
        originalSettings = loadSettings();
        updatePopupUI(originalSettings);
        elements.popup.style.display = 'block';
    });

    elements.closeBtn.addEventListener('click', () => {
        elements.popup.style.display = 'none';
        applyCustomizations(originalSettings);
    });

    elements.saveBtn.addEventListener('click', () => {
        const newSettings = {
            isDarkMode: elements.themeToggle.checked,
            neonBorders: elements.neonBorders.checked,
            iconColor: elements.iconColor.value,
            borderColor: elements.borderColor.value,
            textColor: elements.textColor.value,
        };
        saveSettings(newSettings);
        applyCustomizations(newSettings);
        elements.popup.style.display = 'none';
        showPopup('Personalização salva!');
    });
    
    ['input', 'change'].forEach(eventType => {
        elements.popup.addEventListener(eventType, () => {
            const previewSettings = {
                isDarkMode: elements.themeToggle.checked,
                neonBorders: elements.neonBorders.checked,
                iconColor: elements.iconColor.value,
                borderColor: elements.borderColor.value,
                textColor: elements.textColor.value,
            };
            applyCustomizations(previewSettings);
        });
    });

    const initialSettings = loadSettings();
    applyCustomizations(initialSettings);
}

// --- assets\js\ui.js ---

// --- Funções de UI reutilizáveis ---

export function showPopup(message, type = 'info', duration = 3000) {
    const popup = document.getElementById('popup');
    if (!popup) return;

    popup.classList.remove('success', 'error', 'info');
    popup.classList.add(type);
    popup.textContent = message;
    popup.classList.add('show');
    
    setTimeout(() => {
        popup.classList.remove('show');
    }, duration);
}
export function showSection(sectionId, username) {
    // Esconde todas as seções de conteúdo
    document.querySelectorAll('.content > div[id$="Section"]').forEach(section => {
        section.style.display = 'none';
    });

    // Mostra apenas a seção desejada
    const activeSection = document.getElementById(`${sectionId}Section`);
    if (activeSection) {
        activeSection.style.display = 'block';
    }

    // Gerencia a classe 'active' nos botões da sidebar
    document.querySelectorAll('.sidebar-button[data-section]').forEach(button => {
        // Remove a classe 'active' de todos os botões
        button.classList.remove('active');
        // Adiciona a classe 'active' apenas ao botão correspondente
        if (button.dataset.section === sectionId) {
            button.classList.add('active');
        }
    });

    updateGreeting(username);
}

export function initializeUI() {
    const sidebar = document.getElementById('sidebar');
    const toggleSidebarBtn = document.getElementById('toggleSidebarBtn');
    if (sidebar && toggleSidebarBtn) {
        toggleSidebarBtn.addEventListener('click', () => {
            sidebar.classList.toggle('expanded');
        });
    }
}

export function updateGreeting(username) {
    const hora = new Date().getHours();
    let saudacaoText = hora >= 5 && hora < 12 ? "Bom dia" :
                         hora >= 12 && hora < 18 ? "Boa tarde" : "Boa noite";
    if (username) {
        const capitalizedUsername = username.charAt(0).toUpperCase() + username.slice(1);
        saudacaoText += `, ${capitalizedUsername}`;
    }                         
    document.getElementById('saudacaoChat').textContent = saudacaoText;
}

export function replacePlaceholders(text) {
    const hora = new Date().getHours();
    const saudacao = hora >= 5 && hora < 12 ? "Bom dia" :
                     hora >= 12 && hora < 18 ? "Boa tarde" : "Boa noite";
    const despedida = hora >= 5 && hora < 12 ? "Tenha uma excelente manhã" :
                      hora >= 12 && hora < 18 ? "Tenha uma excelente tarde" : "Tenha uma excelente noite";
    
    // Verifica se o texto é uma string antes de substituir
    if (typeof text !== 'string') return '';

    return text.replace(/\[SAUDACAO\]/gi, saudacao).replace(/\[DESPEDIDA\]/gi, despedida);
}

export function adjustTextareaHeight(textarea) {
    if (textarea) {
        textarea.style.height = 'auto';
        textarea.style.height = `${textarea.scrollHeight}px`;
    }
}

// --- config_yml ---

# _config.yml - Configuração Jekyll para ATI

# Site settings
title: "ATI - Auxiliar de Atendimentos"
description: "Sistema automatizado para atendimentos com chat humanizado e conversor de aditivos contratuais"
author: "Equipe ATI"
email: "contato@ati.com"
baseurl: "" # Subpasta do site, ex: /meu-projeto
url: "https://vituali.github.io" # URL base do site

# Build settings
markdown: kramdown
highlighter: rouge
theme: minima
encoding: utf-8

# Plugins
plugins:
  - jekyll-feed
  - jekyll-sitemap
  - jekyll-seo-tag

# SEO settings
logo: "/assets/images/favicon.ico"
social:
  name: "ATI"
  links:
    - "https://github.com/vituali/ATI"

# Collections (se precisar no futuro)
collections:
  docs:
    output: true
    permalink: /:collection/:name/

# Defaults
defaults:
  - scope:
      path: ""
      type: "pages"
    values:
      layout: "default"
  - scope:
      path: ""
      type: "docs"
    values:
      layout: "doc"

# Exclusões do build
exclude:
  - README.md
  - Gemfile
  - Gemfile.lock
  - node_modules/
  - package.json
  - package-lock.json
  - yarn.lock
  - .git/
  - .gitignore
  - .sass-cache/
  - .jekyll-cache/
  - .jekyll-metadata
  - vendor/
  - docs/desenvolvimento/
  - "*.tmp"
  - "*.bak"

# Inclusões específicas
include:
  - _pages
  - assets/

# Sass/SCSS settings
sass:
  sass_dir: assets/css
  style: compressed # Para produção use 'compressed'

# Markdown settings
kramdown:
  input: GFM
  syntax_highlighter: rouge
  syntax_highlighter_opts:
    css_class: 'highlight'
    span:
      line_numbers: false
    block:
      line_numbers: false

# Timezone
timezone: America/Sao_Paulo

# Configurações de desenvolvimento
livereload: true
incremental: true

# Future posts
future: false

# Pagination (se necessário)
paginate: 10
paginate_path: "/page:num/"

# Configurações do Feed
feed:
  posts_limit: 20
  excerpt_separator: "\n\n"

# Configurações de SEO
twitter:
  username: "seutwitter"
  card: "summary"

facebook:
  app_id: "seuappid"
  publisher: "suapagina"

# Google Analytics (opcional)
google_analytics: "UA-XXXXXXX-X"

# Configurações personalizadas do ATI
ati:
  version: "2.0.0"
  firebase:
    project_id: "site-ati-75d83"
  features:
    - "Chat Automatizado"
    - "Conversor de Aditivos"
    - "Temas Personalizáveis"
    - "Layout Responsivo"
  supported_browsers:
    - "Chrome 90+"
    - "Firefox 88+"
    - "Safari 14+"
    - "Edge 90+"

// --- docs\Brainstorm.txt ---

1. criar um sistema para automatizar o processo do sgp (em andamento. metade feito)
2. arrumar a parte da extensão que ao entrar e fazer o aditivo se clickar fora da pagina ele recarrega a pagina e perde os dados.
3. criar um sistema para justificativa de ponto e etc automatico baseado no nome.
4. criar melhorar o readme.md
5. criar um sistema de sugestão de texto baseado na leitura do chat.
6. melhorar o sistema de criador de o.s permitindo escolher datas e extrair melhor os dados do cliente. (requer vinculo com o sgp).


//futuro//
1. transformar o html em react para melhor dinamica.
2. transformar o banco de dados no firebase para dockerfile.
3. revisar o codigo para comentar melhor para melhor localização.

// --- docs\manual.md ---

📖 Manual do Usuário - ATI
Bem-vindo ao ATI! 👋
Este manual vai te ajudar a usar todas as funcionalidades do sistema de forma eficiente.

🚀 Primeiros Passos: Registro e Login
O ATI agora funciona com contas individuais. Cada atendente precisa ter a sua.

1. Criando uma Conta (Registro)
Na tela inicial, clique no link "Registre-se".

Preencha todos os campos:

Nome de Usuário (Login): Um nome curto, em minúsculas e sem espaços (ex: victor). Este será seu login principal.

Nome e Sobrenome: Seu nome completo, que será exibido em outros locais (ex: Victor Henrique).

Email e Senha: Suas credenciais para acesso e recuperação.

Clique em "Registrar". O sistema irá criar sua conta e fazer o login automaticamente.

Ao se registrar, sua conta já virá com um conjunto de respostas-padrão para você começar a usar e editar!

2. Acessando sua Conta (Login)
Na tela inicial, preencha os campos:

Usuário ou E-mail: Você pode usar tanto o seu nome de usuário (victor) quanto o seu e-mail para entrar.

Senha: Sua senha de acesso.

Clique em "Entrar".

👤 Gerenciando seu Perfil
Você pode alterar seus dados pessoais a qualquer momento.

Clique no botão com o ícone de perfil 👤 e seu nome de usuário na barra lateral.

Um menu irá aparecer. Nele, você pode:

Alterar Nome Completo: Digite seu novo nome e clique em "Salvar Nome".

Alterar Senha: Digite e confirme sua nova senha e clique em "Salvar Nova Senha".

Sair (Logout): Desconecta sua conta do sistema.

💬 Usando o Chat Automatizado
Após o login, suas respostas personalizadas são carregadas.

Enviando Mensagens Rápidas
Escolha a Mensagem na lista organizada por categoria.

Personalize se Necessário: Edite o texto na caixa de mensagem.

Use os Marcadores: [SAUDACAO] e [DESPEDIDA] para saudações que se ajustam ao horário.

Copie e Cole: Clique em 📋 Copiar e cole no seu sistema de atendimento.

Gerenciando Mensagens
➕ Adicionar: Cria uma nova resposta com um texto padrão para você editar.

✏️ Editar: Selecione uma mensagem, modifique o texto e clique em 💾 Salvar.

🗑️ Apagar: Exclui permanentemente a mensagem selecionada (após confirmação).

⇅ Arrastar e Soltar: Clique e segure no título de uma categoria ou de uma resposta para reordená-las.

👑 Painel de Administração (Para Admins)
Se sua conta tiver permissão de administrador, você terá acesso a uma área de gerenciamento.

Acessando o Painel
Abra o seu menu de perfil (clicando no botão 👤).

Clique no botão "Painel do Administrador".

Gerenciando Usuários
No painel, você verá uma lista de todos os usuários e poderá:

Alterar Permissão: Mudar um usuário de "Usuário" para "Admin" (e vice-versa).

Alterar Status: Desativar uma conta para bloquear o acesso do usuário sem apagar seus dados, ou Ativar uma conta previamente desativada.

Verificação de Usuários Órfãos
Esta ferramenta ajuda a manter o sistema limpo, encontrando contas que existem na Autenticação do Firebase mas não no banco de dados.

No painel, clique em "Passo 1: Carregar Usuários Válidos".

Abra o painel do Firebase Authentication, selecione (Ctrl+A) e copie (Ctrl+C) a lista de usuários.

Cole (Ctrl+V) na área de texto da ferramenta.

Clique em "Passo 3: Encontrar Contas Órfãs". O sistema mostrará uma lista de e-mails que podem ser removidos com segurança diretamente no Firebase.

📄 Usando o Conversor de Aditivos
O processo continua o mesmo:

Upload: Vá para a seção 📄 Conversor, escolha o arquivo PDF e clique em "Carregar e Extrair Dados".

Verificação e Configuração: Confira os dados extraídos e preencha o restante do formulário.

Geração: Clique em "Gerar O.S" e use os botões de cópia.

🎨 Personalizando a Interface
Clique no botão ⚙️ Personalizar na barra lateral.

Ajuste o Modo Escuro, Bordas Neon e as Cores.

Clique em 💾 Salvar para manter suas preferências.

🎯 Sucesso nos seus atendimentos com o ATI! 🚀

// --- docs\project.txt ---

projeto/
├── index.html
├── _config.yml
├── .gitignore
├── README.md
├── assets/
│   ├── css/
│   │   ├── main.css          # @imports e configurações base
│   │   ├── layout.css        # Sidebar, content, grid
│   │   ├── components.css    # Buttons, forms, cards, popups
│   │   └── themes.css        # Light/dark/neon themes
│   ├── js/
│   │   ├── app.js
│   │   ├── chat.js
│   │   ├── conversor.js
│   │   ├── firebase.js
│   │   ├── theme.js
│   │   └── ui.js
│   └── images/
│       └── favicon.ico
└── docs/
    └── manual.md

// --- Extensão ATI\background.js ---

// background.js

// Listener para o comando de atalho (Ctrl+Shift+C)
chrome.commands.onCommand.addListener((command) => {
  if (command === "copy-data") {
    chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
      if (tabs[0]) {
        // Adicionamos um callback vazio para tratar o erro
        chrome.tabs.sendMessage(tabs[0].id, { action: "executeCopy" }, () => {
          // A função chrome.runtime.lastError será definida se a mensagem falhar.
          // Ao ter este callback, o erro é "capturado" e não aparece no console.
          if (chrome.runtime.lastError) {
            console.log("O atalho foi pressionado em uma aba não compatível. Isso é normal.");
          }
        });
      }
    });
  }
});

// Listener para a mensagem da ponte (aviso de login/logout)
chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.action === "userChanged") {
    console.log('[Background] Aviso de mudança de usuário recebido. Notificando abas do Chatmix...');
    
    chrome.tabs.query({ url: "*://*.chatmix.com.br/*" }, (tabs) => {
      tabs.forEach(tab => {
        // Adicionamos o mesmo callback de tratamento de erro aqui
        chrome.tabs.sendMessage(tab.id, { action: "reloadTemplates" }, () => {
          if (chrome.runtime.lastError) {
            console.log(`A aba do Chatmix ${tab.id} não estava pronta para receber a mensagem. Isso é normal.`);
          }
        });
      });
    });
  }
  // Retornar true é importante para indicar que a resposta pode ser assíncrona
  return true; 
});

// --- Extensão ATI\bridge-injected.js ---

// bridge-injected.js
console.log("[Site] Ponte injetada INICIADA. Monitorando login...");

let lastKnownAttendant = null;

setInterval(() => {
    const currentAttendant = localStorage.getItem('atendenteAtual');

    if (currentAttendant !== lastKnownAttendant) {
        console.log(`[Site] Mudança detectada! Atendente agora é: ${currentAttendant}. Enviando mensagem para a extensão...`);
        lastKnownAttendant = currentAttendant;

        window.postMessage({
            type: 'ATI_ATTENDANT_UPDATE',
            attendant: currentAttendant
        }, '*');
    }
}, 1500);

// --- Extensão ATI\bridge-listener.js ---

// bridge-listener.js
console.log('[Extensão ATI] Listener da ponte INICIADO.');

const s = document.createElement('script');
s.src = chrome.runtime.getURL('bridge-injected.js');
(document.head || document.documentElement).appendChild(s);
s.onload = () => console.log('[Extensão ATI] Script injetado com sucesso no site.');

window.addEventListener('message', (event) => {
    if (event.source === window && event.data.type && event.data.type === 'ATI_ATTENDANT_UPDATE') {
        const attendantKey = event.data.attendant;
        
        console.log(`[Extensão ATI] MENSAGEM RECEBIDA: Atendente é '${attendantKey}'. Salvando...`);
        chrome.storage.local.set({ atendenteAtual: attendantKey }, () => {
            console.log('[Extensão ATI] Atendente salvo com sucesso no armazenamento da extensão.');
            
            // AVISO PARA O BACKGROUND SCRIPT QUE O USUÁRIO MUDOU
            chrome.runtime.sendMessage({ action: "userChanged" });
        });
    }
}, false);

// --- Extensão ATI\content.js ---

// content.js - VERSÃO FINAL (ESTRATÉGIA DE HIJACK DE MODAL)

chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.action === "executeCopy") {
    if (typeof copyContactInfo === "function") {
      copyContactInfo();
      sendResponse({ status: "Cópia executada." });
    } else {
      sendResponse({ status: "Erro: Função de cópia não encontrada." });
    }
  } else if (request.action === "reloadTemplates") {
    console.log("ATI Extensão: Aviso de recarregamento recebido. Buscando novos templates...");
    runExtension();
    sendResponse({ status: "Templates recarregados." });
  }
  return true;
});

async function runExtension() {
  injectCSS('injected.css');
  if (typeof initializeActions === "function" && typeof loadTemplatesFromStorage === "function") {
    
    if (!document.getElementById('actionsContainer')) {
        initializeActions();
    }

    console.log("ATI Extensão: runExtension iniciada.");
    try {
      const templates = await loadTemplatesFromStorage();
      console.log("ATI Extensão: Templates carregados.");
      window.osTemplates = templates;
      
      // Inicia o "sequestrador" de modal
      initializeModalHijacker();

      console.log("ATI Extensão: Funções de UI inicializadas com sucesso.");
    } catch (error) {
      console.error("ATI Extensão: Erro fatal durante a inicialização.", error);
    }
  }
}

const startupInterval = setInterval(() => {
    const targetElement = document.querySelector("section.attendances");
    if (targetElement) {
        clearInterval(startupInterval);
        runExtension();
    } 
}, 500);

// --- Extensão ATI\firebase-config.js ---

// firebase-config.js (na EXTENSÃO)

// Use o SDK compatível com Manifest V3, importando de um arquivo local
// (Você precisará baixar o SDK e incluí-lo no seu projeto)
// Por simplicidade, este exemplo usará a API REST, que não precisa do SDK.

const firebaseConfig = {
    apiKey: "AIzaSyB5wO0x-7NFmh6waMKzWzRew4ezfYOmYBI",
    authDomain: "site-ati-75d83.firebaseapp.com",
    databaseURL: "https://site-ati-75d83-default-rtdb.firebaseio.com/",
    projectId: "site-ati-75d83"
    // Outras chaves não são necessárias para esta operação
};

// Função para buscar os templates usando a API REST do Realtime Database
async function fetchTemplatesFromFirebase(username) {
  if (!username) {
    console.log("Nenhum atendente logado, não há respostas para buscar.");
    return []; // Retorna vazio se não houver usuário
  }

  const dbURL = firebaseConfig.databaseURL;
  // Constrói a URL para o nó específico do atendente
  const url = `${dbURL}respostas/${username}.json`;

  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Erro na rede: ${response.statusText}`);
    }
    const data = await response.json();
    
    // O Realtime Database retorna null se o nó não existir
    if (data === null) {
      return [];
    }
    
    // A API REST retorna os dados no formato correto (array de objetos)
    return data;

  } catch (error) {
    console.error(`[Extensão ATI] Falha ao buscar dados para '${username}'.`, error);
    throw error;
  }
}

// --- Extensão ATI\injected.css ---

/* =================================================================== */
/* ARQUIVO DE ESTILO FINAL - ATI EXTENSÃO */
/* =================================================================== */
#actionsContainer, #actionsContainerV2 {
    display: flex;
    gap: 8px;
    z-index: 9999;
}
#actionsContainer { position: fixed; bottom: 20px; left: 80px; }
#actionsContainerV2 { padding: 12px; margin: 0 16px 12px 16px; flex-wrap: wrap; }

.action-btn {
    padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer;
    font-weight: bold; font-size: 14px; transition: all 0.2s;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.action-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
#actionsContainer .action-btn--contact { background-color: #007bff; color: white; }
#actionsContainer .action-btn--contact:hover { background-color: #0056b3; }
#actionsContainer .action-btn--cpf { background-color: #28a745; color: white; }
#actionsContainer .action-btn--cpf:hover { background-color: #1e7e34; }
#actionsContainer .action-btn--os { background-color: #ffc107; color: #333; }
#actionsContainer .action-btn--os:hover { background-color: #e0a800; }
#actionsContainerV2 .action-btn {
    flex: 1 1 auto; min-width: 90px; padding: 8px 12px;
    border: 1px solid #555; background-color: transparent; color: #ccc;
    border-radius: 6px; font-size: 12px;
}
#actionsContainerV2 .action-btn:hover { background-color: #3a3a3a; border-color: #777; }
#actionsContainerV2 .action-btn--contact { color: #10B981; border-color: #10B981; }
#actionsContainerV2 .action-btn--cpf { color: #3B82F6; border-color: #3B82F6; }
#actionsContainerV2 .action-btn--os { color: #F59E0B; border-color: #F59E0B; 
}
.notification {
    position: fixed; top: 20px; right: 20px; padding: 12px 20px;
    border-radius: 8px; color: white; z-index: 10000; font-size: 14px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}
.notification.success { background-color: #22C55E; }
.notification.error { background-color: #EF4444; }
/* =================================================================== */
/* == MODAL DE RESPOSTAS RÁPIDAS (V1) == */
/* =================================================================== */
.modal[data-modal="msg_model"] .modal-box {
    background-color: #2d2d2d !important;
    border: 1px solid #444 !important;
    color: #e0e0e0 !important;
    min-height: auto !important;
    height: fit-content !important;
    max-height: 85vh !important;
    display: flex;
    flex-direction: column;
}

.modal[data-modal="msg_model"] .modal-header,
.modal[data-modal="msg_model"] .modal-content,
.modal[data-modal="msg_model"] .modal-footer {
    background-color: transparent !important;
}

.modal[data-modal="msg_model"] .modal-header {
    border-bottom: 1px solid #444 !important;
    flex-shrink: 0;
}
.modal[data-modal="msg_model"] .modal-header h1 {
    color: #ffffff !important;
}

.modal[data-modal="msg_model"] .modal-content {
    overflow-y: auto !important;
    padding: 20px;
}

.modal[data-modal="msg_model"] .modal-content ul {
    display: flex;
    flex-wrap: wrap;
    align-items: flex-start;
    gap: 12px;
    padding: 0;
    list-style: none;
}
.modal[data-modal="msg_model"] .modal-content ul li {
    margin: 0 !important;
    padding: 0 !important;
    background: none !important;
    width: auto;
    display: flex;
}

.modal[data-modal="msg_model"] ul li:has(b) {
    flex-basis: 100%;
    margin-bottom: 5px !important;
}
.modal[data-modal="msg_model"] ul li b {
    color: #a0a0a0 !important;
    font-size: 1rem !important;
    padding-left: 4px;
    border-left: 3px solid #007bff;
}

/* Botões de Resposta */
.modal[data-modal="msg_model"] ul li p.message_model {
    padding: 8px 16px !important;
    background-color: #3a3a3a !important;
    border-radius: 20px !important;
    border: 1px solid #555 !important;
    color: #e0e0e0 !important;
    transition: all 0.2s;
    margin: 0;
    line-height: 1.4;
}
.modal[data-modal="msg_model"] ul li p.message_model:hover {
    background-color: #007bff !important;
    border-color: #007bff !important;
    color: #ffffff !important;
    transform: translateY(-2px);
}
.modal[data-modal="msg_model"] ul li p.message_model::after {
    display: none !important;
}

/* Rodapé */
.modal[data-modal="msg_model"] .modal-footer {
    border-top: 1px solid #444 !important;
    margin-bottom: 0 !important;
    padding: 1rem !important;
    justify-content: center;
    flex-shrink: 0;
}
.modal[data-modal="msg_model"] .modal-footer .button {
    background-color: #4a4a4a;
    border-radius: 8px;
}
/* =================================================================== */
/* == MODAL DE O.S. CUSTOMIZADO (V1 e V2) == */
/* =================================================================== */
.ati-os-modal.modal-backdrop {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: flex; justify-content: center; align-items: center; z-index: 10000;
}
.ati-os-modal .modal-content {
    background-color: #2d2d2d; padding: 25px; border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5); width: 90%; max-width: 650px;
    max-height: 90vh; overflow-y: auto; color: #e0e0e0;
    display: flex; flex-direction: column;
}
.ati-os-modal .modal-header {
    display: flex; justify-content: space-between; align-items: center;
    border-bottom: 1px solid #444; padding-bottom: 15px; margin-bottom: 15px;
}
.ati-os-modal h3 { margin: 0; color: #0095ff; font-size: 1.25rem; }
.ati-os-modal .modal-close-btn { background: none; border: none; font-size: 1.8rem; color: #888; cursor: pointer; }
.ati-os-modal .modal-close-btn:hover { color: #fff; }
.ati-os-modal .modal-body label {
    display: block; margin-bottom: 8px; font-weight: bold;
    color: #aaa; font-size: 0.9rem;
}
.ati-os-modal .modal-textarea {
    width: 100%; min-height: 120px; padding: 10px; border: 1px solid #555;
    border-radius: 5px; margin-bottom: 20px; font-size: 14px; box-sizing: border-box;
    resize: vertical; background-color: #3a3a3a; color: #e0e0e0;
}
.ati-os-modal .modal-suggestion {
    background-color: #3a3a3a; border: 1px solid #007bff;
    border-radius: 5px; padding: 15px; margin-bottom: 20px;
}
.ati-os-modal .modal-category-title {
    flex-basis: 100%; margin-top: 15px; margin-bottom: 10px; color: #0095ff;
    font-size: 1rem; border-bottom: 1px dashed #555; padding-bottom: 5px;
}
.ati-os-modal .modal-btn-group { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
.ati-os-modal .template-btn {
    padding: 8px 16px; border: 1px solid #555; border-radius: 20px;
    background-color: #444; color: #ccc; cursor: pointer; font-size: 13px;
    transition: all 0.2s;
}
.ati-os-modal .template-btn:hover { background-color: #555; color: white; border-color: #777; }
.ati-os-modal .template-btn--suggestion { background-color: #007bff; color: white; border-color: #0056b3; }
.ati-os-modal .template-btn--suggestion:hover { background-color: #0056b3; }
.ati-os-modal .modal-footer {
    display: flex; justify-content: flex-end; gap: 10px;
    margin-top: 20px; border-top: 1px solid #444; padding-top: 20px;
    margin-bottom: 0 !important;
}
.ati-os-modal .main-btn {
    padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;
    font-weight: bold; font-size: 15px; transition: background-color 0.2s;
}
.ati-os-modal .main-btn--confirm { background-color: #28a745; color: white; }
.ati-os-modal .main-btn--confirm:hover { background-color: #218838; }
.ati-os-modal .main-btn--cancel { background-color: #6c757d; color: white; }
.ati-os-modal .main-btn--cancel:hover { background-color: #5a6268; }
/* =================================================================== */
/* == Respostas Rápidas (V2) - Com Estilos de Alta Prioridade       == */
/* =================================================================== */

#atiQuickRepliesContainerV2.quick-replies-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 0 8px 12px 8px;
    margin: 12px 8px 0 8px; /* Adicionado margem no topo para separar */
}
#atiQuickRepliesContainerV2 .qr-btn {
    padding: 6px 14px;
    border-radius: 16px;
    border: 1px solid #555;
    background-color: #3a3a3a;
    color: #ccc;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    transition: all 0.2s;
}
#atiQuickRepliesContainerV2 .qr-btn:hover {
    background-color: #4a4a4a;
    border-color: #777;
}
#atiQuickRepliesContainerV2 .qr-btn--back {
    color: white;
    border-color: #888;
}
#atiQuickRepliesContainerV2 .qr-btn--back:hover {
    background-color: #555;
}


// --- Extensão ATI\jquery.min.js ---

/*! jQuery v3.7.1 | (c) OpenJS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(ie,e){"use strict";var oe=[],r=Object.getPrototypeOf,ae=oe.slice,g=oe.flat?function(e){return oe.flat.call(e)}:function(e){return oe.concat.apply([],e)},s=oe.push,se=oe.indexOf,n={},i=n.toString,ue=n.hasOwnProperty,o=ue.toString,a=o.call(Object),le={},v=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},y=function(e){return null!=e&&e===e.window},C=ie.document,u={type:!0,src:!0,nonce:!0,noModule:!0};function m(e,t,n){var r,i,o=(n=n||C).createElement("script");if(o.text=e,t)for(r in u)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function x(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[i.call(e)]||"object":typeof e}var t="3.7.1",l=/HTML$/i,ce=function(e,t){return new ce.fn.init(e,t)};function c(e){var t=!!e&&"length"in e&&e.length,n=x(e);return!v(e)&&!y(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}function fe(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}ce.fn=ce.prototype={jquery:t,constructor:ce,length:0,toArray:function(){return ae.call(this)},get:function(e){return null==e?ae.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=ce.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return ce.each(this,e)},map:function(n){return this.pushStack(ce.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(ae.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(ce.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(ce.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:oe.sort,splice:oe.splice},ce.extend=ce.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||v(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(ce.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||ce.isPlainObject(n)?n:{},i=!1,a[t]=ce.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},ce.extend({expando:"jQuery"+(t+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==i.call(e))&&(!(t=r(e))||"function"==typeof(n=ue.call(t,"constructor")&&t.constructor)&&o.call(n)===a)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){m(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(c(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},text:function(e){var t,n="",r=0,i=e.nodeType;if(!i)while(t=e[r++])n+=ce.text(t);return 1===i||11===i?e.textContent:9===i?e.documentElement.textContent:3===i||4===i?e.nodeValue:n},makeArray:function(e,t){var n=t||[];return null!=e&&(c(Object(e))?ce.merge(n,"string"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:se.call(t,e,n)},isXMLDoc:function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!l.test(t||n&&n.nodeName||"HTML")},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(c(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:le}),"function"==typeof Symbol&&(ce.fn[Symbol.iterator]=oe[Symbol.iterator]),ce.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var pe=oe.pop,de=oe.sort,he=oe.splice,ge="[\\x20\\t\\r\\n\\f]",ve=new RegExp("^"+ge+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ge+"+$","g");ce.contains=function(e,t){var n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(e.contains?e.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))};var f=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function p(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}ce.escapeSelector=function(e){return(e+"").replace(f,p)};var ye=C,me=s;!function(){var e,b,w,o,a,T,r,C,d,i,k=me,S=ce.expando,E=0,n=0,s=W(),c=W(),u=W(),h=W(),l=function(e,t){return e===t&&(a=!0),0},f="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",t="(?:\\\\[\\da-fA-F]{1,6}"+ge+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",p="\\["+ge+"*("+t+")(?:"+ge+"*([*^$|!~]?=)"+ge+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+t+"))|)"+ge+"*\\]",g=":("+t+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+p+")*)|.*)\\)|)",v=new RegExp(ge+"+","g"),y=new RegExp("^"+ge+"*,"+ge+"*"),m=new RegExp("^"+ge+"*([>+~]|"+ge+")"+ge+"*"),x=new RegExp(ge+"|>"),j=new RegExp(g),A=new RegExp("^"+t+"$"),D={ID:new RegExp("^#("+t+")"),CLASS:new RegExp("^\\.("+t+")"),TAG:new RegExp("^("+t+"|[*])"),ATTR:new RegExp("^"+p),PSEUDO:new RegExp("^"+g),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ge+"*(even|odd|(([+-]|)(\\d*)n|)"+ge+"*(?:([+-]|)"+ge+"*(\\d+)|))"+ge+"*\\)|)","i"),bool:new RegExp("^(?:"+f+")$","i"),needsContext:new RegExp("^"+ge+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ge+"*((?:-\\d)?\\d*)"+ge+"*\\)|)(?=[^-]|$)","i")},N=/^(?:input|select|textarea|button)$/i,q=/^h\d$/i,L=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,H=/[+~]/,O=new RegExp("\\\\[\\da-fA-F]{1,6}"+ge+"?|\\\\([^\\r\\n\\f])","g"),P=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},M=function(){V()},R=J(function(e){return!0===e.disabled&&fe(e,"fieldset")},{dir:"parentNode",next:"legend"});try{k.apply(oe=ae.call(ye.childNodes),ye.childNodes),oe[ye.childNodes.length].nodeType}catch(e){k={apply:function(e,t){me.apply(e,ae.call(t))},call:function(e){me.apply(e,ae.call(arguments,1))}}}function I(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(V(e),e=e||T,C)){if(11!==p&&(u=L.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return k.call(n,a),n}else if(f&&(a=f.getElementById(i))&&I.contains(e,a)&&a.id===i)return k.call(n,a),n}else{if(u[2])return k.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&e.getElementsByClassName)return k.apply(n,e.getElementsByClassName(i)),n}if(!(h[t+" "]||d&&d.test(t))){if(c=t,f=e,1===p&&(x.test(t)||m.test(t))){(f=H.test(t)&&U(e.parentNode)||e)==e&&le.scope||((s=e.getAttribute("id"))?s=ce.escapeSelector(s):e.setAttribute("id",s=S)),o=(l=Y(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+Q(l[o]);c=l.join(",")}try{return k.apply(n,f.querySelectorAll(c)),n}catch(e){h(t,!0)}finally{s===S&&e.removeAttribute("id")}}}return re(t.replace(ve,"$1"),e,n,r)}function W(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function F(e){return e[S]=!0,e}function $(e){var t=T.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function B(t){return function(e){return fe(e,"input")&&e.type===t}}function _(t){return function(e){return(fe(e,"input")||fe(e,"button"))&&e.type===t}}function z(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&R(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function X(a){return F(function(o){return o=+o,F(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function U(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function V(e){var t,n=e?e.ownerDocument||e:ye;return n!=T&&9===n.nodeType&&n.documentElement&&(r=(T=n).documentElement,C=!ce.isXMLDoc(T),i=r.matches||r.webkitMatchesSelector||r.msMatchesSelector,r.msMatchesSelector&&ye!=T&&(t=T.defaultView)&&t.top!==t&&t.addEventListener("unload",M),le.getById=$(function(e){return r.appendChild(e).id=ce.expando,!T.getElementsByName||!T.getElementsByName(ce.expando).length}),le.disconnectedMatch=$(function(e){return i.call(e,"*")}),le.scope=$(function(){return T.querySelectorAll(":scope")}),le.cssHas=$(function(){try{return T.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}}),le.getById?(b.filter.ID=function(e){var t=e.replace(O,P);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&C){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(O,P);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&C){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},b.find.CLASS=function(e,t){if("undefined"!=typeof t.getElementsByClassName&&C)return t.getElementsByClassName(e)},d=[],$(function(e){var t;r.appendChild(e).innerHTML="<a id='"+S+"' href='' disabled='disabled'></a><select id='"+S+"-\r\\' disabled='disabled'><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+ge+"*(?:value|"+f+")"),e.querySelectorAll("[id~="+S+"-]").length||d.push("~="),e.querySelectorAll("a#"+S+"+*").length||d.push(".#.+[+~]"),e.querySelectorAll(":checked").length||d.push(":checked"),(t=T.createElement("input")).setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),r.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&d.push(":enabled",":disabled"),(t=T.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||d.push("\\["+ge+"*name"+ge+"*="+ge+"*(?:''|\"\")")}),le.cssHas||d.push(":has"),d=d.length&&new RegExp(d.join("|")),l=function(e,t){if(e===t)return a=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!le.sortDetached&&t.compareDocumentPosition(e)===n?e===T||e.ownerDocument==ye&&I.contains(ye,e)?-1:t===T||t.ownerDocument==ye&&I.contains(ye,t)?1:o?se.call(o,e)-se.call(o,t):0:4&n?-1:1)}),T}for(e in I.matches=function(e,t){return I(e,null,null,t)},I.matchesSelector=function(e,t){if(V(e),C&&!h[t+" "]&&(!d||!d.test(t)))try{var n=i.call(e,t);if(n||le.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){h(t,!0)}return 0<I(t,T,null,[e]).length},I.contains=function(e,t){return(e.ownerDocument||e)!=T&&V(e),ce.contains(e,t)},I.attr=function(e,t){(e.ownerDocument||e)!=T&&V(e);var n=b.attrHandle[t.toLowerCase()],r=n&&ue.call(b.attrHandle,t.toLowerCase())?n(e,t,!C):void 0;return void 0!==r?r:e.getAttribute(t)},I.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ce.uniqueSort=function(e){var t,n=[],r=0,i=0;if(a=!le.sortStable,o=!le.sortStable&&ae.call(e,0),de.call(e,l),a){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)he.call(e,n[r],1)}return o=null,e},ce.fn.uniqueSort=function(){return this.pushStack(ce.uniqueSort(ae.apply(this)))},(b=ce.expr={cacheLength:50,createPseudo:F,match:D,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(O,P),e[3]=(e[3]||e[4]||e[5]||"").replace(O,P),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||I.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&I.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return D.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&j.test(n)&&(t=Y(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(O,P).toLowerCase();return"*"===e?function(){return!0}:function(e){return fe(e,t)}},CLASS:function(e){var t=s[e+" "];return t||(t=new RegExp("(^|"+ge+")"+e+"("+ge+"|$)"))&&s(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=I.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(v," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(d,e,t,h,g){var v="nth"!==d.slice(0,3),y="last"!==d.slice(-4),m="of-type"===e;return 1===h&&0===g?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u=v!==y?"nextSibling":"previousSibling",l=e.parentNode,c=m&&e.nodeName.toLowerCase(),f=!n&&!m,p=!1;if(l){if(v){while(u){o=e;while(o=o[u])if(m?fe(o,c):1===o.nodeType)return!1;s=u="only"===d&&!s&&"nextSibling"}return!0}if(s=[y?l.firstChild:l.lastChild],y&&f){p=(a=(r=(i=l[S]||(l[S]={}))[d]||[])[0]===E&&r[1])&&r[2],o=a&&l.childNodes[a];while(o=++a&&o&&o[u]||(p=a=0)||s.pop())if(1===o.nodeType&&++p&&o===e){i[d]=[E,a,p];break}}else if(f&&(p=a=(r=(i=e[S]||(e[S]={}))[d]||[])[0]===E&&r[1]),!1===p)while(o=++a&&o&&o[u]||(p=a=0)||s.pop())if((m?fe(o,c):1===o.nodeType)&&++p&&(f&&((i=o[S]||(o[S]={}))[d]=[E,p]),o===e))break;return(p-=g)===h||p%h==0&&0<=p/h}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||I.error("unsupported pseudo: "+e);return a[S]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?F(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=se.call(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:F(function(e){var r=[],i=[],s=ne(e.replace(ve,"$1"));return s[S]?F(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:F(function(t){return function(e){return 0<I(t,e).length}}),contains:F(function(t){return t=t.replace(O,P),function(e){return-1<(e.textContent||ce.text(e)).indexOf(t)}}),lang:F(function(n){return A.test(n||"")||I.error("unsupported lang: "+n),n=n.replace(O,P).toLowerCase(),function(e){var t;do{if(t=C?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=ie.location&&ie.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===r},focus:function(e){return e===function(){try{return T.activeElement}catch(e){}}()&&T.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:z(!1),disabled:z(!0),checked:function(e){return fe(e,"input")&&!!e.checked||fe(e,"option")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return q.test(e.nodeName)},input:function(e){return N.test(e.nodeName)},button:function(e){return fe(e,"input")&&"button"===e.type||fe(e,"button")},text:function(e){var t;return fe(e,"input")&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:X(function(){return[0]}),last:X(function(e,t){return[t-1]}),eq:X(function(e,t,n){return[n<0?n+t:n]}),even:X(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:X(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:X(function(e,t,n){var r;for(r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:X(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=B(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=_(e);function G(){}function Y(e,t){var n,r,i,o,a,s,u,l=c[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=y.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=m.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace(ve," ")}),a=a.slice(n.length)),b.filter)!(r=D[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?I.error(e):c(e,s).slice(0)}function Q(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function J(a,e,t){var s=e.dir,u=e.next,l=u||s,c=t&&"parentNode"===l,f=n++;return e.first?function(e,t,n){while(e=e[s])if(1===e.nodeType||c)return a(e,t,n);return!1}:function(e,t,n){var r,i,o=[E,f];if(n){while(e=e[s])if((1===e.nodeType||c)&&a(e,t,n))return!0}else while(e=e[s])if(1===e.nodeType||c)if(i=e[S]||(e[S]={}),u&&fe(e,u))e=e[s]||e;else{if((r=i[l])&&r[0]===E&&r[1]===f)return o[2]=r[2];if((i[l]=o)[2]=a(e,t,n))return!0}return!1}}function K(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Z(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function ee(d,h,g,v,y,e){return v&&!v[S]&&(v=ee(v)),y&&!y[S]&&(y=ee(y,e)),F(function(e,t,n,r){var i,o,a,s,u=[],l=[],c=t.length,f=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)I(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),p=!d||!e&&h?f:Z(f,u,d,n,r);if(g?g(p,s=y||(e?d:c||v)?[]:t,n,r):s=p,v){i=Z(s,l),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(s[l[o]]=!(p[l[o]]=a))}if(e){if(y||d){if(y){i=[],o=s.length;while(o--)(a=s[o])&&i.push(p[o]=a);y(null,s=[],i,r)}o=s.length;while(o--)(a=s[o])&&-1<(i=y?se.call(e,a):u[o])&&(e[i]=!(t[i]=a))}}else s=Z(s===t?s.splice(c,s.length):s),y?y(null,t,s,r):k.apply(t,s)})}function te(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=J(function(e){return e===i},a,!0),l=J(function(e){return-1<se.call(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!=w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[J(K(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return ee(1<s&&K(c),1<s&&Q(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(ve,"$1"),t,s<n&&te(e.slice(s,n)),n<r&&te(e=e.slice(n)),n<r&&Q(e))}c.push(t)}return K(c)}function ne(e,t){var n,v,y,m,x,r,i=[],o=[],a=u[e+" "];if(!a){t||(t=Y(e)),n=t.length;while(n--)(a=te(t[n]))[S]?i.push(a):o.push(a);(a=u(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=E+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==T||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==T||(V(o),n=!C);while(s=v[a++])if(s(o,t||T,n)){k.call(r,o);break}i&&(E=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=pe.call(r));f=Z(f)}k.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&ce.uniqueSort(r)}return i&&(E=h,w=p),c},m?F(r):r))).selector=e}return a}function re(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&Y(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&C&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(O,P),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=D.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(O,P),H.test(o[0].type)&&U(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&Q(o)))return k.apply(n,r),n;break}}}return(l||ne(e,c))(r,t,!C,n,!t||H.test(e)&&U(t.parentNode)||t),n}G.prototype=b.filters=b.pseudos,b.setFilters=new G,le.sortStable=S.split("").sort(l).join("")===S,V(),le.sortDetached=$(function(e){return 1&e.compareDocumentPosition(T.createElement("fieldset"))}),ce.find=I,ce.expr[":"]=ce.expr.pseudos,ce.unique=ce.uniqueSort,I.compile=ne,I.select=re,I.setDocument=V,I.tokenize=Y,I.escape=ce.escapeSelector,I.getText=ce.text,I.isXML=ce.isXMLDoc,I.selectors=ce.expr,I.support=ce.support,I.uniqueSort=ce.uniqueSort}();var d=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&ce(e).is(n))break;r.push(e)}return r},h=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},b=ce.expr.match.needsContext,w=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function T(e,n,r){return v(n)?ce.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?ce.grep(e,function(e){return e===n!==r}):"string"!=typeof n?ce.grep(e,function(e){return-1<se.call(n,e)!==r}):ce.filter(n,e,r)}ce.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?ce.find.matchesSelector(r,e)?[r]:[]:ce.find.matches(e,ce.grep(t,function(e){return 1===e.nodeType}))},ce.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(ce(e).filter(function(){for(t=0;t<r;t++)if(ce.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)ce.find(e,i[t],n);return 1<r?ce.uniqueSort(n):n},filter:function(e){return this.pushStack(T(this,e||[],!1))},not:function(e){return this.pushStack(T(this,e||[],!0))},is:function(e){return!!T(this,"string"==typeof e&&b.test(e)?ce(e):e||[],!1).length}});var k,S=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(ce.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||k,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:S.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof ce?t[0]:t,ce.merge(this,ce.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:C,!0)),w.test(r[1])&&ce.isPlainObject(t))for(r in t)v(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=C.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):v(e)?void 0!==n.ready?n.ready(e):e(ce):ce.makeArray(e,this)}).prototype=ce.fn,k=ce(C);var E=/^(?:parents|prev(?:Until|All))/,j={children:!0,contents:!0,next:!0,prev:!0};function A(e,t){while((e=e[t])&&1!==e.nodeType);return e}ce.fn.extend({has:function(e){var t=ce(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(ce.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&ce(e);if(!b.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&ce.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?ce.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?se.call(ce(e),this[0]):se.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(ce.uniqueSort(ce.merge(this.get(),ce(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ce.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return d(e,"parentNode")},parentsUntil:function(e,t,n){return d(e,"parentNode",n)},next:function(e){return A(e,"nextSibling")},prev:function(e){return A(e,"previousSibling")},nextAll:function(e){return d(e,"nextSibling")},prevAll:function(e){return d(e,"previousSibling")},nextUntil:function(e,t,n){return d(e,"nextSibling",n)},prevUntil:function(e,t,n){return d(e,"previousSibling",n)},siblings:function(e){return h((e.parentNode||{}).firstChild,e)},children:function(e){return h(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(fe(e,"template")&&(e=e.content||e),ce.merge([],e.childNodes))}},function(r,i){ce.fn[r]=function(e,t){var n=ce.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=ce.filter(t,n)),1<this.length&&(j[r]||ce.uniqueSort(n),E.test(r)&&n.reverse()),this.pushStack(n)}});var D=/[^\x20\t\r\n\f]+/g;function N(e){return e}function q(e){throw e}function L(e,t,n,r){var i;try{e&&v(i=e.promise)?i.call(e).done(t).fail(n):e&&v(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}ce.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},ce.each(e.match(D)||[],function(e,t){n[t]=!0}),n):ce.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){ce.each(e,function(e,t){v(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==x(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return ce.each(arguments,function(e,t){var n;while(-1<(n=ce.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<ce.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},ce.extend({Deferred:function(e){var o=[["notify","progress",ce.Callbacks("memory"),ce.Callbacks("memory"),2],["resolve","done",ce.Callbacks("once memory"),ce.Callbacks("once memory"),0,"resolved"],["reject","fail",ce.Callbacks("once memory"),ce.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return ce.Deferred(function(r){ce.each(o,function(e,t){var n=v(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&v(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,v(t)?s?t.call(e,l(u,o,N,s),l(u,o,q,s)):(u++,t.call(e,l(u,o,N,s),l(u,o,q,s),l(u,o,N,o.notifyWith))):(a!==N&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){ce.Deferred.exceptionHook&&ce.Deferred.exceptionHook(e,t.error),u<=i+1&&(a!==q&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(ce.Deferred.getErrorHook?t.error=ce.Deferred.getErrorHook():ce.Deferred.getStackHook&&(t.error=ce.Deferred.getStackHook()),ie.setTimeout(t))}}return ce.Deferred(function(e){o[0][3].add(l(0,e,v(r)?r:N,e.notifyWith)),o[1][3].add(l(0,e,v(t)?t:N)),o[2][3].add(l(0,e,v(n)?n:q))}).promise()},promise:function(e){return null!=e?ce.extend(e,a):a}},s={};return ce.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=ae.call(arguments),o=ce.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?ae.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(L(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||v(i[t]&&i[t].then)))return o.then();while(t--)L(i[t],a(t),o.reject);return o.promise()}});var H=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;ce.Deferred.exceptionHook=function(e,t){ie.console&&ie.console.warn&&e&&H.test(e.name)&&ie.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},ce.readyException=function(e){ie.setTimeout(function(){throw e})};var O=ce.Deferred();function P(){C.removeEventListener("DOMContentLoaded",P),ie.removeEventListener("load",P),ce.ready()}ce.fn.ready=function(e){return O.then(e)["catch"](function(e){ce.readyException(e)}),this},ce.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--ce.readyWait:ce.isReady)||(ce.isReady=!0)!==e&&0<--ce.readyWait||O.resolveWith(C,[ce])}}),ce.ready.then=O.then,"complete"===C.readyState||"loading"!==C.readyState&&!C.documentElement.doScroll?ie.setTimeout(ce.ready):(C.addEventListener("DOMContentLoaded",P),ie.addEventListener("load",P));var M=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===x(n))for(s in i=!0,n)M(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,v(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(ce(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},R=/^-ms-/,I=/-([a-z])/g;function W(e,t){return t.toUpperCase()}function F(e){return e.replace(R,"ms-").replace(I,W)}var $=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function B(){this.expando=ce.expando+B.uid++}B.uid=1,B.prototype={cache:function(e){var t=e[this.expando];return t||(t={},$(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[F(t)]=n;else for(r in t)i[F(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][F(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(F):(t=F(t))in r?[t]:t.match(D)||[]).length;while(n--)delete r[t[n]]}(void 0===t||ce.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!ce.isEmptyObject(t)}};var _=new B,z=new B,X=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,U=/[A-Z]/g;function V(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(U,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:X.test(i)?JSON.parse(i):i)}catch(e){}z.set(e,t,n)}else n=void 0;return n}ce.extend({hasData:function(e){return z.hasData(e)||_.hasData(e)},data:function(e,t,n){return z.access(e,t,n)},removeData:function(e,t){z.remove(e,t)},_data:function(e,t,n){return _.access(e,t,n)},_removeData:function(e,t){_.remove(e,t)}}),ce.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=z.get(o),1===o.nodeType&&!_.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=F(r.slice(5)),V(o,r,i[r]));_.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){z.set(this,n)}):M(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=z.get(o,n))?t:void 0!==(t=V(o,n))?t:void 0;this.each(function(){z.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){z.remove(this,e)})}}),ce.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=_.get(e,t),n&&(!r||Array.isArray(n)?r=_.access(e,t,ce.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=ce.queue(e,t),r=n.length,i=n.shift(),o=ce._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){ce.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return _.get(e,n)||_.access(e,n,{empty:ce.Callbacks("once memory").add(function(){_.remove(e,[t+"queue",n])})})}}),ce.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?ce.queue(this[0],t):void 0===n?this:this.each(function(){var e=ce.queue(this,t,n);ce._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&ce.dequeue(this,t)})},dequeue:function(e){return this.each(function(){ce.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=ce.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=_.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var G=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Y=new RegExp("^(?:([+-])=|)("+G+")([a-z%]*)$","i"),Q=["Top","Right","Bottom","Left"],J=C.documentElement,K=function(e){return ce.contains(e.ownerDocument,e)},Z={composed:!0};J.getRootNode&&(K=function(e){return ce.contains(e.ownerDocument,e)||e.getRootNode(Z)===e.ownerDocument});var ee=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&K(e)&&"none"===ce.css(e,"display")};function te(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return ce.css(e,t,"")},u=s(),l=n&&n[3]||(ce.cssNumber[t]?"":"px"),c=e.nodeType&&(ce.cssNumber[t]||"px"!==l&&+u)&&Y.exec(ce.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)ce.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,ce.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ne={};function re(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=_.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ee(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ne[s])||(o=a.body.appendChild(a.createElement(s)),u=ce.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ne[s]=u)))):"none"!==n&&(l[c]="none",_.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}ce.fn.extend({show:function(){return re(this,!0)},hide:function(){return re(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ee(this)?ce(this).show():ce(this).hide()})}});var xe,be,we=/^(?:checkbox|radio)$/i,Te=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Ce=/^$|^module$|\/(?:java|ecma)script/i;xe=C.createDocumentFragment().appendChild(C.createElement("div")),(be=C.createElement("input")).setAttribute("type","radio"),be.setAttribute("checked","checked"),be.setAttribute("name","t"),xe.appendChild(be),le.checkClone=xe.cloneNode(!0).cloneNode(!0).lastChild.checked,xe.innerHTML="<textarea>x</textarea>",le.noCloneChecked=!!xe.cloneNode(!0).lastChild.defaultValue,xe.innerHTML="<option></option>",le.option=!!xe.lastChild;var ke={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Se(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&fe(e,t)?ce.merge([e],n):n}function Ee(e,t){for(var n=0,r=e.length;n<r;n++)_.set(e[n],"globalEval",!t||_.get(t[n],"globalEval"))}ke.tbody=ke.tfoot=ke.colgroup=ke.caption=ke.thead,ke.th=ke.td,le.option||(ke.optgroup=ke.option=[1,"<select multiple='multiple'>","</select>"]);var je=/<|&#?\w+;/;function Ae(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===x(o))ce.merge(p,o.nodeType?[o]:o);else if(je.test(o)){a=a||f.appendChild(t.createElement("div")),s=(Te.exec(o)||["",""])[1].toLowerCase(),u=ke[s]||ke._default,a.innerHTML=u[1]+ce.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;ce.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<ce.inArray(o,r))i&&i.push(o);else if(l=K(o),a=Se(f.appendChild(o),"script"),l&&Ee(a),n){c=0;while(o=a[c++])Ce.test(o.type||"")&&n.push(o)}return f}var De=/^([^.]*)(?:\.(.+)|)/;function Ne(){return!0}function qe(){return!1}function Le(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Le(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=qe;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return ce().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=ce.guid++)),e.each(function(){ce.event.add(this,t,i,r,n)})}function He(e,r,t){t?(_.set(e,r,!1),ce.event.add(e,r,{namespace:!1,handler:function(e){var t,n=_.get(this,r);if(1&e.isTrigger&&this[r]){if(n)(ce.event.special[r]||{}).delegateType&&e.stopPropagation();else if(n=ae.call(arguments),_.set(this,r,n),this[r](),t=_.get(this,r),_.set(this,r,!1),n!==t)return e.stopImmediatePropagation(),e.preventDefault(),t}else n&&(_.set(this,r,ce.event.trigger(n[0],n.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=Ne)}})):void 0===_.get(e,r)&&ce.event.add(e,r,Ne)}ce.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=_.get(t);if($(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&ce.find.matchesSelector(J,i),n.guid||(n.guid=ce.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof ce&&ce.event.triggered!==e.type?ce.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(D)||[""]).length;while(l--)d=g=(s=De.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=ce.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=ce.event.special[d]||{},c=ce.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&ce.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),ce.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=_.hasData(e)&&_.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(D)||[""]).length;while(l--)if(d=g=(s=De.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=ce.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||ce.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)ce.event.remove(e,d+t[l],n,r,!0);ce.isEmptyObject(u)&&_.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=ce.event.fix(e),l=(_.get(this,"events")||Object.create(null))[u.type]||[],c=ce.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=ce.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((ce.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<ce(i,this).index(l):ce.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(ce.Event.prototype,t,{enumerable:!0,configurable:!0,get:v(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[ce.expando]?e:new ce.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return we.test(t.type)&&t.click&&fe(t,"input")&&He(t,"click",!0),!1},trigger:function(e){var t=this||e;return we.test(t.type)&&t.click&&fe(t,"input")&&He(t,"click"),!0},_default:function(e){var t=e.target;return we.test(t.type)&&t.click&&fe(t,"input")&&_.get(t,"click")||fe(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},ce.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},ce.Event=function(e,t){if(!(this instanceof ce.Event))return new ce.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ne:qe,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&ce.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[ce.expando]=!0},ce.Event.prototype={constructor:ce.Event,isDefaultPrevented:qe,isPropagationStopped:qe,isImmediatePropagationStopped:qe,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ne,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ne,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ne,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},ce.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},ce.event.addProp),ce.each({focus:"focusin",blur:"focusout"},function(r,i){function o(e){if(C.documentMode){var t=_.get(this,"handle"),n=ce.event.fix(e);n.type="focusin"===e.type?"focus":"blur",n.isSimulated=!0,t(e),n.target===n.currentTarget&&t(n)}else ce.event.simulate(i,e.target,ce.event.fix(e))}ce.event.special[r]={setup:function(){var e;if(He(this,r,!0),!C.documentMode)return!1;(e=_.get(this,i))||this.addEventListener(i,o),_.set(this,i,(e||0)+1)},trigger:function(){return He(this,r),!0},teardown:function(){var e;if(!C.documentMode)return!1;(e=_.get(this,i)-1)?_.set(this,i,e):(this.removeEventListener(i,o),_.remove(this,i))},_default:function(e){return _.get(e.target,r)},delegateType:i},ce.event.special[i]={setup:function(){var e=this.ownerDocument||this.document||this,t=C.documentMode?this:e,n=_.get(t,i);n||(C.documentMode?this.addEventListener(i,o):e.addEventListener(r,o,!0)),_.set(t,i,(n||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=C.documentMode?this:e,n=_.get(t,i)-1;n?_.set(t,i,n):(C.documentMode?this.removeEventListener(i,o):e.removeEventListener(r,o,!0),_.remove(t,i))}}}),ce.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){ce.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||ce.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),ce.fn.extend({on:function(e,t,n,r){return Le(this,e,t,n,r)},one:function(e,t,n,r){return Le(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,ce(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=qe),this.each(function(){ce.event.remove(this,e,n,t)})}});var Oe=/<script|<style|<link/i,Pe=/checked\s*(?:[^=]|=\s*.checked.)/i,Me=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Re(e,t){return fe(e,"table")&&fe(11!==t.nodeType?t:t.firstChild,"tr")&&ce(e).children("tbody")[0]||e}function Ie(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function We(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Fe(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(_.hasData(e)&&(s=_.get(e).events))for(i in _.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)ce.event.add(t,i,s[i][n]);z.hasData(e)&&(o=z.access(e),a=ce.extend({},o),z.set(t,a))}}function $e(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=v(d);if(h||1<f&&"string"==typeof d&&!le.checkClone&&Pe.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),$e(t,r,i,o)});if(f&&(t=(e=Ae(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=ce.map(Se(e,"script"),Ie)).length;c<f;c++)u=e,c!==p&&(u=ce.clone(u,!0,!0),s&&ce.merge(a,Se(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,ce.map(a,We),c=0;c<s;c++)u=a[c],Ce.test(u.type||"")&&!_.access(u,"globalEval")&&ce.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?ce._evalUrl&&!u.noModule&&ce._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):m(u.textContent.replace(Me,""),u,l))}return n}function Be(e,t,n){for(var r,i=t?ce.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||ce.cleanData(Se(r)),r.parentNode&&(n&&K(r)&&Ee(Se(r,"script")),r.parentNode.removeChild(r));return e}ce.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=K(e);if(!(le.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ce.isXMLDoc(e)))for(a=Se(c),r=0,i=(o=Se(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&we.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||Se(e),a=a||Se(c),r=0,i=o.length;r<i;r++)Fe(o[r],a[r]);else Fe(e,c);return 0<(a=Se(c,"script")).length&&Ee(a,!f&&Se(e,"script")),c},cleanData:function(e){for(var t,n,r,i=ce.event.special,o=0;void 0!==(n=e[o]);o++)if($(n)){if(t=n[_.expando]){if(t.events)for(r in t.events)i[r]?ce.event.remove(n,r):ce.removeEvent(n,r,t.handle);n[_.expando]=void 0}n[z.expando]&&(n[z.expando]=void 0)}}}),ce.fn.extend({detach:function(e){return Be(this,e,!0)},remove:function(e){return Be(this,e)},text:function(e){return M(this,function(e){return void 0===e?ce.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return $e(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Re(this,e).appendChild(e)})},prepend:function(){return $e(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Re(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return $e(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return $e(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(ce.cleanData(Se(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return ce.clone(this,e,t)})},html:function(e){return M(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Oe.test(e)&&!ke[(Te.exec(e)||["",""])[1].toLowerCase()]){e=ce.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(ce.cleanData(Se(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return $e(this,arguments,function(e){var t=this.parentNode;ce.inArray(this,n)<0&&(ce.cleanData(Se(this)),t&&t.replaceChild(e,this))},n)}}),ce.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){ce.fn[e]=function(e){for(var t,n=[],r=ce(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),ce(r[o])[a](t),s.apply(n,t.get());return this.pushStack(n)}});var _e=new RegExp("^("+G+")(?!px)[a-z%]+$","i"),ze=/^--/,Xe=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=ie),t.getComputedStyle(e)},Ue=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Ve=new RegExp(Q.join("|"),"i");function Ge(e,t,n){var r,i,o,a,s=ze.test(t),u=e.style;return(n=n||Xe(e))&&(a=n.getPropertyValue(t)||n[t],s&&a&&(a=a.replace(ve,"$1")||void 0),""!==a||K(e)||(a=ce.style(e,t)),!le.pixelBoxStyles()&&_e.test(a)&&Ve.test(t)&&(r=u.width,i=u.minWidth,o=u.maxWidth,u.minWidth=u.maxWidth=u.width=a,a=n.width,u.width=r,u.minWidth=i,u.maxWidth=o)),void 0!==a?a+"":a}function Ye(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",J.appendChild(u).appendChild(l);var e=ie.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),J.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=C.createElement("div"),l=C.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",le.clearCloneStyle="content-box"===l.style.backgroundClip,ce.extend(le,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=C.createElement("table"),t=C.createElement("tr"),n=C.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="box-sizing:content-box;border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",J.appendChild(e).appendChild(t).appendChild(n),r=ie.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,J.removeChild(e)),a}}))}();var Qe=["Webkit","Moz","ms"],Je=C.createElement("div").style,Ke={};function Ze(e){var t=ce.cssProps[e]||Ke[e];return t||(e in Je?e:Ke[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Qe.length;while(n--)if((e=Qe[n]+t)in Je)return e}(e)||e)}var et=/^(none|table(?!-c[ea]).+)/,tt={position:"absolute",visibility:"hidden",display:"block"},nt={letterSpacing:"0",fontWeight:"400"};function rt(e,t,n){var r=Y.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function it(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0,l=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(l+=ce.css(e,n+Q[a],!0,i)),r?("content"===n&&(u-=ce.css(e,"padding"+Q[a],!0,i)),"margin"!==n&&(u-=ce.css(e,"border"+Q[a]+"Width",!0,i))):(u+=ce.css(e,"padding"+Q[a],!0,i),"padding"!==n?u+=ce.css(e,"border"+Q[a]+"Width",!0,i):s+=ce.css(e,"border"+Q[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u+l}function ot(e,t,n){var r=Xe(e),i=(!le.boxSizingReliable()||n)&&"border-box"===ce.css(e,"boxSizing",!1,r),o=i,a=Ge(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(_e.test(a)){if(!n)return a;a="auto"}return(!le.boxSizingReliable()&&i||!le.reliableTrDimensions()&&fe(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===ce.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===ce.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+it(e,t,n||(i?"border":"content"),o,r,a)+"px"}function at(e,t,n,r,i){return new at.prototype.init(e,t,n,r,i)}ce.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ge(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=F(t),u=ze.test(t),l=e.style;if(u||(t=Ze(s)),a=ce.cssHooks[t]||ce.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=Y.exec(n))&&i[1]&&(n=te(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(ce.cssNumber[s]?"":"px")),le.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=F(t);return ze.test(t)||(t=Ze(s)),(a=ce.cssHooks[t]||ce.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Ge(e,t,r)),"normal"===i&&t in nt&&(i=nt[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),ce.each(["height","width"],function(e,u){ce.cssHooks[u]={get:function(e,t,n){if(t)return!et.test(ce.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?ot(e,u,n):Ue(e,tt,function(){return ot(e,u,n)})},set:function(e,t,n){var r,i=Xe(e),o=!le.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===ce.css(e,"boxSizing",!1,i),s=n?it(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-it(e,u,"border",!1,i)-.5)),s&&(r=Y.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=ce.css(e,u)),rt(0,t,s)}}}),ce.cssHooks.marginLeft=Ye(le.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Ge(e,"marginLeft"))||e.getBoundingClientRect().left-Ue(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),ce.each({margin:"",padding:"",border:"Width"},function(i,o){ce.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+Q[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(ce.cssHooks[i+o].set=rt)}),ce.fn.extend({css:function(e,t){return M(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Xe(e),i=t.length;a<i;a++)o[t[a]]=ce.css(e,t[a],!1,r);return o}return void 0!==n?ce.style(e,t,n):ce.css(e,t)},e,t,1<arguments.length)}}),((ce.Tween=at).prototype={constructor:at,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||ce.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(ce.cssNumber[n]?"":"px")},cur:function(){var e=at.propHooks[this.prop];return e&&e.get?e.get(this):at.propHooks._default.get(this)},run:function(e){var t,n=at.propHooks[this.prop];return this.options.duration?this.pos=t=ce.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):at.propHooks._default.set(this),this}}).init.prototype=at.prototype,(at.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=ce.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){ce.fx.step[e.prop]?ce.fx.step[e.prop](e):1!==e.elem.nodeType||!ce.cssHooks[e.prop]&&null==e.elem.style[Ze(e.prop)]?e.elem[e.prop]=e.now:ce.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=at.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ce.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},ce.fx=at.prototype.init,ce.fx.step={};var st,ut,lt,ct,ft=/^(?:toggle|show|hide)$/,pt=/queueHooks$/;function dt(){ut&&(!1===C.hidden&&ie.requestAnimationFrame?ie.requestAnimationFrame(dt):ie.setTimeout(dt,ce.fx.interval),ce.fx.tick())}function ht(){return ie.setTimeout(function(){st=void 0}),st=Date.now()}function gt(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=Q[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function vt(e,t,n){for(var r,i=(yt.tweeners[t]||[]).concat(yt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function yt(o,e,t){var n,a,r=0,i=yt.prefilters.length,s=ce.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=st||ht(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:ce.extend({},e),opts:ce.extend(!0,{specialEasing:{},easing:ce.easing._default},t),originalProperties:e,originalOptions:t,startTime:st||ht(),duration:t.duration,tweens:[],createTween:function(e,t){var n=ce.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=F(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=ce.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=yt.prefilters[r].call(l,o,c,l.opts))return v(n.stop)&&(ce._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return ce.map(c,vt,l),v(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),ce.fx.timer(ce.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}ce.Animation=ce.extend(yt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return te(n.elem,e,Y.exec(t),n),n}]},tweener:function(e,t){v(e)?(t=e,e=["*"]):e=e.match(D);for(var n,r=0,i=e.length;r<i;r++)n=e[r],yt.tweeners[n]=yt.tweeners[n]||[],yt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ee(e),v=_.get(e,"fxshow");for(r in n.queue||(null==(a=ce._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,ce.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],ft.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||ce.style(e,r)}if((u=!ce.isEmptyObject(t))||!ce.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=_.get(e,"display")),"none"===(c=ce.css(e,"display"))&&(l?c=l:(re([e],!0),l=e.style.display||l,c=ce.css(e,"display"),re([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===ce.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=_.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&re([e],!0),p.done(function(){for(r in g||re([e]),_.remove(e,"fxshow"),d)ce.style(e,r,d[r])})),u=vt(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?yt.prefilters.unshift(e):yt.prefilters.push(e)}}),ce.speed=function(e,t,n){var r=e&&"object"==typeof e?ce.extend({},e):{complete:n||!n&&t||v(e)&&e,duration:e,easing:n&&t||t&&!v(t)&&t};return ce.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in ce.fx.speeds?r.duration=ce.fx.speeds[r.duration]:r.duration=ce.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){v(r.old)&&r.old.call(this),r.queue&&ce.dequeue(this,r.queue)},r},ce.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ee).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=ce.isEmptyObject(t),o=ce.speed(e,n,r),a=function(){var e=yt(this,ce.extend({},t),o);(i||_.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=ce.timers,r=_.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&pt.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||ce.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=_.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=ce.timers,o=n?n.length:0;for(t.finish=!0,ce.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),ce.each(["toggle","show","hide"],function(e,r){var i=ce.fn[r];ce.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(gt(r,!0),e,t,n)}}),ce.each({slideDown:gt("show"),slideUp:gt("hide"),slideToggle:gt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){ce.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),ce.timers=[],ce.fx.tick=function(){var e,t=0,n=ce.timers;for(st=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||ce.fx.stop(),st=void 0},ce.fx.timer=function(e){ce.timers.push(e),ce.fx.start()},ce.fx.interval=13,ce.fx.start=function(){ut||(ut=!0,dt())},ce.fx.stop=function(){ut=null},ce.fx.speeds={slow:600,fast:200,_default:400},ce.fn.delay=function(r,e){return r=ce.fx&&ce.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=ie.setTimeout(e,r);t.stop=function(){ie.clearTimeout(n)}})},lt=C.createElement("input"),ct=C.createElement("select").appendChild(C.createElement("option")),lt.type="checkbox",le.checkOn=""!==lt.value,le.optSelected=ct.selected,(lt=C.createElement("input")).value="t",lt.type="radio",le.radioValue="t"===lt.value;var mt,xt=ce.expr.attrHandle;ce.fn.extend({attr:function(e,t){return M(this,ce.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){ce.removeAttr(this,e)})}}),ce.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?ce.prop(e,t,n):(1===o&&ce.isXMLDoc(e)||(i=ce.attrHooks[t.toLowerCase()]||(ce.expr.match.bool.test(t)?mt:void 0)),void 0!==n?null===n?void ce.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=ce.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!le.radioValue&&"radio"===t&&fe(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(D);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),mt={set:function(e,t,n){return!1===t?ce.removeAttr(e,n):e.setAttribute(n,n),n}},ce.each(ce.expr.match.bool.source.match(/\w+/g),function(e,t){var a=xt[t]||ce.find.attr;xt[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=xt[o],xt[o]=r,r=null!=a(e,t,n)?o:null,xt[o]=i),r}});var bt=/^(?:input|select|textarea|button)$/i,wt=/^(?:a|area)$/i;function Tt(e){return(e.match(D)||[]).join(" ")}function Ct(e){return e.getAttribute&&e.getAttribute("class")||""}function kt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(D)||[]}ce.fn.extend({prop:function(e,t){return M(this,ce.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[ce.propFix[e]||e]})}}),ce.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&ce.isXMLDoc(e)||(t=ce.propFix[t]||t,i=ce.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=ce.find.attr(e,"tabindex");return t?parseInt(t,10):bt.test(e.nodeName)||wt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),le.optSelected||(ce.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),ce.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ce.propFix[this.toLowerCase()]=this}),ce.fn.extend({addClass:function(t){var e,n,r,i,o,a;return v(t)?this.each(function(e){ce(this).addClass(t.call(this,e,Ct(this)))}):(e=kt(t)).length?this.each(function(){if(r=Ct(this),n=1===this.nodeType&&" "+Tt(r)+" "){for(o=0;o<e.length;o++)i=e[o],n.indexOf(" "+i+" ")<0&&(n+=i+" ");a=Tt(n),r!==a&&this.setAttribute("class",a)}}):this},removeClass:function(t){var e,n,r,i,o,a;return v(t)?this.each(function(e){ce(this).removeClass(t.call(this,e,Ct(this)))}):arguments.length?(e=kt(t)).length?this.each(function(){if(r=Ct(this),n=1===this.nodeType&&" "+Tt(r)+" "){for(o=0;o<e.length;o++){i=e[o];while(-1<n.indexOf(" "+i+" "))n=n.replace(" "+i+" "," ")}a=Tt(n),r!==a&&this.setAttribute("class",a)}}):this:this.attr("class","")},toggleClass:function(t,n){var e,r,i,o,a=typeof t,s="string"===a||Array.isArray(t);return v(t)?this.each(function(e){ce(this).toggleClass(t.call(this,e,Ct(this),n),n)}):"boolean"==typeof n&&s?n?this.addClass(t):this.removeClass(t):(e=kt(t),this.each(function(){if(s)for(o=ce(this),i=0;i<e.length;i++)r=e[i],o.hasClass(r)?o.removeClass(r):o.addClass(r);else void 0!==t&&"boolean"!==a||((r=Ct(this))&&_.set(this,"__className__",r),this.setAttribute&&this.setAttribute("class",r||!1===t?"":_.get(this,"__className__")||""))}))},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+Tt(Ct(n))+" ").indexOf(t))return!0;return!1}});var St=/\r/g;ce.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=v(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,ce(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=ce.map(t,function(e){return null==e?"":e+""})),(r=ce.valHooks[this.type]||ce.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=ce.valHooks[t.type]||ce.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(St,""):null==e?"":e:void 0}}),ce.extend({valHooks:{option:{get:function(e){var t=ce.find.attr(e,"value");return null!=t?t:Tt(ce.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!fe(n.parentNode,"optgroup"))){if(t=ce(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=ce.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<ce.inArray(ce.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),ce.each(["radio","checkbox"],function(){ce.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<ce.inArray(ce(e).val(),t)}},le.checkOn||(ce.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Et=ie.location,jt={guid:Date.now()},At=/\?/;ce.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new ie.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||ce.error("Invalid XML: "+(n?ce.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var Dt=/^(?:focusinfocus|focusoutblur)$/,Nt=function(e){e.stopPropagation()};ce.extend(ce.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||C],d=ue.call(e,"type")?e.type:e,h=ue.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||C,3!==n.nodeType&&8!==n.nodeType&&!Dt.test(d+ce.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[ce.expando]?e:new ce.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:ce.makeArray(t,[e]),c=ce.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!y(n)){for(s=c.delegateType||d,Dt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||C)&&p.push(a.defaultView||a.parentWindow||ie)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(_.get(o,"events")||Object.create(null))[e.type]&&_.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&$(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!$(n)||u&&v(n[d])&&!y(n)&&((a=n[u])&&(n[u]=null),ce.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,Nt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,Nt),ce.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=ce.extend(new ce.Event,n,{type:e,isSimulated:!0});ce.event.trigger(r,null,t)}}),ce.fn.extend({trigger:function(e,t){return this.each(function(){ce.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return ce.event.trigger(e,t,n,!0)}});var qt=/\[\]$/,Lt=/\r?\n/g,Ht=/^(?:submit|button|image|reset|file)$/i,Ot=/^(?:input|select|textarea|keygen)/i;function Pt(n,e,r,i){var t;if(Array.isArray(e))ce.each(e,function(e,t){r||qt.test(n)?i(n,t):Pt(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==x(e))i(n,e);else for(t in e)Pt(n+"["+t+"]",e[t],r,i)}ce.param=function(e,t){var n,r=[],i=function(e,t){var n=v(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!ce.isPlainObject(e))ce.each(e,function(){i(this.name,this.value)});else for(n in e)Pt(n,e[n],t,i);return r.join("&")},ce.fn.extend({serialize:function(){return ce.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ce.prop(this,"elements");return e?ce.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ce(this).is(":disabled")&&Ot.test(this.nodeName)&&!Ht.test(e)&&(this.checked||!we.test(e))}).map(function(e,t){var n=ce(this).val();return null==n?null:Array.isArray(n)?ce.map(n,function(e){return{name:t.name,value:e.replace(Lt,"\r\n")}}):{name:t.name,value:n.replace(Lt,"\r\n")}}).get()}});var Mt=/%20/g,Rt=/#.*$/,It=/([?&])_=[^&]*/,Wt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ft=/^(?:GET|HEAD)$/,$t=/^\/\//,Bt={},_t={},zt="*/".concat("*"),Xt=C.createElement("a");function Ut(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(D)||[];if(v(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Vt(t,i,o,a){var s={},u=t===_t;function l(e){var r;return s[e]=!0,ce.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Gt(e,t){var n,r,i=ce.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&ce.extend(!0,e,r),e}Xt.href=Et.href,ce.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Et.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Et.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":zt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":ce.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Gt(Gt(e,ce.ajaxSettings),t):Gt(ce.ajaxSettings,e)},ajaxPrefilter:Ut(Bt),ajaxTransport:Ut(_t),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=ce.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?ce(y):ce.event,x=ce.Deferred(),b=ce.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=Wt.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||Et.href)+"").replace($t,Et.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(D)||[""],null==v.crossDomain){r=C.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Xt.protocol+"//"+Xt.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=ce.param(v.data,v.traditional)),Vt(Bt,v,t,T),h)return T;for(i in(g=ce.event&&v.global)&&0==ce.active++&&ce.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Ft.test(v.type),f=v.url.replace(Rt,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Mt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(At.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(It,"$1"),o=(At.test(f)?"&":"?")+"_="+jt.guid+++o),v.url=f+o),v.ifModified&&(ce.lastModified[f]&&T.setRequestHeader("If-Modified-Since",ce.lastModified[f]),ce.etag[f]&&T.setRequestHeader("If-None-Match",ce.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+zt+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Vt(_t,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=ie.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&ie.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<ce.inArray("script",v.dataTypes)&&ce.inArray("json",v.dataTypes)<0&&(v.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(ce.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(ce.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--ce.active||ce.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return ce.get(e,t,n,"json")},getScript:function(e,t){return ce.get(e,void 0,t,"script")}}),ce.each(["get","post"],function(e,i){ce[i]=function(e,t,n,r){return v(t)&&(r=r||n,n=t,t=void 0),ce.ajax(ce.extend({url:e,type:i,dataType:r,data:t,success:n},ce.isPlainObject(e)&&e))}}),ce.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),ce._evalUrl=function(e,t,n){return ce.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){ce.globalEval(e,t,n)}})},ce.fn.extend({wrapAll:function(e){var t;return this[0]&&(v(e)&&(e=e.call(this[0])),t=ce(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return v(n)?this.each(function(e){ce(this).wrapInner(n.call(this,e))}):this.each(function(){var e=ce(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=v(t);return this.each(function(e){ce(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){ce(this).replaceWith(this.childNodes)}),this}}),ce.expr.pseudos.hidden=function(e){return!ce.expr.pseudos.visible(e)},ce.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},ce.ajaxSettings.xhr=function(){try{return new ie.XMLHttpRequest}catch(e){}};var Yt={0:200,1223:204},Qt=ce.ajaxSettings.xhr();le.cors=!!Qt&&"withCredentials"in Qt,le.ajax=Qt=!!Qt,ce.ajaxTransport(function(i){var o,a;if(le.cors||Qt&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Yt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&ie.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),ce.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),ce.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return ce.globalEval(e),e}}}),ce.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),ce.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=ce("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),C.head.appendChild(r[0])},abort:function(){i&&i()}}});var Jt,Kt=[],Zt=/(=)\?(?=&|$)|\?\?/;ce.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Kt.pop()||ce.expando+"_"+jt.guid++;return this[e]=!0,e}}),ce.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Zt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Zt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=v(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Zt,"$1"+r):!1!==e.jsonp&&(e.url+=(At.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||ce.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=ie[r],ie[r]=function(){o=arguments},n.always(function(){void 0===i?ce(ie).removeProp(r):ie[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,Kt.push(r)),o&&v(i)&&i(o[0]),o=i=void 0}),"script"}),le.createHTMLDocument=((Jt=C.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Jt.childNodes.length),ce.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(le.createHTMLDocument?((r=(t=C.implementation.createHTMLDocument("")).createElement("base")).href=C.location.href,t.head.appendChild(r)):t=C),o=!n&&[],(i=w.exec(e))?[t.createElement(i[1])]:(i=Ae([e],t,o),o&&o.length&&ce(o).remove(),ce.merge([],i.childNodes)));var r,i,o},ce.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=Tt(e.slice(s)),e=e.slice(0,s)),v(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&ce.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?ce("<div>").append(ce.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},ce.expr.pseudos.animated=function(t){return ce.grep(ce.timers,function(e){return t===e.elem}).length},ce.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=ce.css(e,"position"),c=ce(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=ce.css(e,"top"),u=ce.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),v(t)&&(t=t.call(e,n,ce.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},ce.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){ce.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===ce.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===ce.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=ce(e).offset()).top+=ce.css(e,"borderTopWidth",!0),i.left+=ce.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-ce.css(r,"marginTop",!0),left:t.left-i.left-ce.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===ce.css(e,"position"))e=e.offsetParent;return e||J})}}),ce.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;ce.fn[t]=function(e){return M(this,function(e,t,n){var r;if(y(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),ce.each(["top","left"],function(e,n){ce.cssHooks[n]=Ye(le.pixelPosition,function(e,t){if(t)return t=Ge(e,n),_e.test(t)?ce(e).position()[n]+"px":t})}),ce.each({Height:"height",Width:"width"},function(a,s){ce.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){ce.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return M(this,function(e,t,n){var r;return y(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?ce.css(e,t,i):ce.style(e,t,n,i)},s,n?e:void 0,n)}})}),ce.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ce.fn[t]=function(e){return this.on(t,e)}}),ce.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.on("mouseenter",e).on("mouseleave",t||e)}}),ce.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){ce.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var en=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;ce.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),v(e))return r=ae.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(ae.call(arguments)))}).guid=e.guid=e.guid||ce.guid++,i},ce.holdReady=function(e){e?ce.readyWait++:ce.ready(!0)},ce.isArray=Array.isArray,ce.parseJSON=JSON.parse,ce.nodeName=fe,ce.isFunction=v,ce.isWindow=y,ce.camelCase=F,ce.type=x,ce.now=Date.now,ce.isNumeric=function(e){var t=ce.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},ce.trim=function(e){return null==e?"":(e+"").replace(en,"$1")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return ce});var tn=ie.jQuery,nn=ie.$;return ce.noConflict=function(e){return ie.$===ce&&(ie.$=nn),e&&ie.jQuery===ce&&(ie.jQuery=tn),ce},"undefined"==typeof e&&(ie.jQuery=ie.$=ce),ce});

// --- Extensão ATI\logic.js ---

// logic.js - VERSÃO COM COLETA DE TEXTO CORRIGIDA

async function loadTemplatesFromStorage() {
  return new Promise((resolve) => {
    chrome.storage.local.get('atendenteAtual', async ({
      atendenteAtual
    }) => {
      if (!atendenteAtual) {
        console.log("[Extensão ATI] Nenhum atendente definido. Use o site-painel para fazer login.");
        if (typeof showNotification === 'function') {
          showNotification("ATI: Faça o login no painel para carregar seus modelos.", true, 5000);
        }
        resolve([]);
        return;
      }

      console.log(`[Extensão ATI] Tentando carregar modelos para: ${atendenteAtual}`);
      try {
        const firebaseTemplates = await fetchTemplatesFromFirebase(atendenteAtual);
        await chrome.storage.local.set({
          cachedOsTemplates: firebaseTemplates
        });
        console.log(`[Extensão ATI] ${firebaseTemplates.length} modelos de '${atendenteAtual}' carregados do Firebase.`);
        resolve(firebaseTemplates);

      } catch (error) {
        console.error("[Extensão ATI] Falha ao carregar do Firebase. Tentando usar o cache local.", error);
        chrome.storage.local.get('cachedOsTemplates', (cache) => {
          if (cache.cachedOsTemplates) {
            console.log("[Extensão ATI] Modelos carregados do cache como fallback.");
            resolve(cache.cachedOsTemplates);
          } else {
            console.error("[Extensão ATI] Cache também está vazio. Nenhum modelo carregado.");
            resolve([]);
          }
        });
      }
    });
  });
}

function findActiveAttendanceElement() {
    // CORREÇÃO: O seletor agora busca por CADA painel de atendimento individual
    // que tenha o atributo 'data-message_to'.
    const allChatPanels = document.querySelectorAll('section.chat .attendance[data-message_to]');

    // Itera sobre cada painel encontrado para verificar qual está visível.
    for (const panel of allChatPanels) {
        const style = window.getComputedStyle(panel);
        
        // A condição para ser o "ativo" é simplesmente estar visível na tela.
        if (style.display !== 'none' && style.visibility !== 'hidden' && panel.offsetHeight > 0) {
            // Encontramos o painel ativo! Retornamos ele imediatamente.
            // No seu HTML, o painel da "Heglaia" vai passar aqui, e o da "Valeria" não.
            return panel; 
        }
    }

    // Se, por algum motivo, nenhum chat ativo for encontrado, retorna nulo.
    return null;
}

function findActiveChatHeader() {
    const activeAttendance = findActiveAttendanceElement();
    return activeAttendance ? activeAttendance.querySelector('header') : null;
}

function findActiveChatBody() {
    const activeAttendance = findActiveAttendanceElement();
    return activeAttendance ? activeAttendance.querySelector('.messages') : null;
}

function processDynamicPlaceholders(text) {
    if (typeof text !== 'string') return '';
    const now = new Date();
    const hour = now.getHours();
    let saudacao = '';
    let despedida = '';
    if (hour >= 5 && hour < 12) {
        saudacao = 'Bom dia';
        despedida = 'Tenha uma excelente manhã';
    } else if (hour >= 12 && hour < 18) {
        saudacao = 'Boa tarde';
        despedida = 'Tenha uma excelente tarde';
    } else {
        saudacao = 'Boa noite';
        despedida = 'Tenha uma excelente noite';
    }
    let processedText = text.replace(/\[SAUDACAO\]/gi, saudacao);
    processedText = processedText.replace(/\[DESPEDIDA\]/gi, despedida);
    return processedText;
}

// ===================================================================================
// ## INÍCIO DA CORREÇÃO ##
// ===================================================================================

/**
 * Coleta APENAS o texto principal das mensagens, ignorando lixo de UI e replies.
 * @param {HTMLElement} rootElement O contêiner de mensagens (div.messages).
 * @returns {string[]} Um array com os textos limpos de cada mensagem.
 */
function collectTextFromMessages(rootElement) {
    const texts = [];
    if (!rootElement) return texts;

    // Seleciona todos os blocos de mensagem visíveis
    const messageItems = rootElement.querySelectorAll('.item');
    messageItems.forEach(item => {
        const contentDiv = item.querySelector('.content.message_content');
        if (contentDiv) {
            // Pega todos os parágrafos (<p>) que são filhos DIRETOS do 'content'.
            // Isso inteligentemente ignora os parágrafos que estão dentro de uma citação (div.reply).
            const directMessageParagraphs = Array.from(contentDiv.children).filter(child => child.tagName === 'P');
            
            if (directMessageParagraphs.length > 0) {
                const messageText = directMessageParagraphs.map(p => p.textContent.trim()).join(' ');
                texts.push(messageText);
            }
        }
    });

    console.log("Textos coletados de forma limpa:", texts); // Log para depuração
    return texts;
}

function findCPF(allTexts) {
    const cpfCnpjRegex = /\b(\d{11}|\d{14})\b/g;
    const validMatches = [];
    const blacklist = ['código de barras', 'boleto', 'fatura', 'pix', 'linha digitável'];
    
    console.log("Textos recebidos para análise de CPF:", allTexts); // Log 1: Ver o que a função recebe

    for (const text of allTexts) {
        // Converte para minúsculas ANTES de verificar a blacklist
        const lowerCaseText = text.toLowerCase();
        
        if (blacklist.some(keyword => lowerCaseText.includes(keyword))) {
            console.log("Texto ignorado pela blacklist:", text); // Log 2: Ver o que está sendo pulado
            continue;
        }

        const cleanText = text.replace(/[.\-\/]/g, "");
        const potentialMatches = cleanText.match(cpfCnpjRegex);

        if (potentialMatches) {
            for (const match of potentialMatches) {
                if (match.length === 11 && isValidCPF(match)) {
                    validMatches.push(match);
                } else if (match.length === 14 && isValidCNPJ(match)) {
                    validMatches.push(match);
                }
            }
        }
    }

    // Retorna o último CPF/CNPJ válido encontrado no chat
    return validMatches.length > 0 ? validMatches[validMatches.length - 1] : null;
}

// ===================================================================================
// ## FIM DA CORREÇÃO ##
// ===================================================================================


function extractDataFromHeader(headerElement) {
    let firstName = "", phoneNumber = "";
    if (headerElement) {
        let nameElement = headerElement.querySelector('.client_name');
        let phoneElement = headerElement.querySelector('.client_user');
        if (nameElement) firstName = (nameElement.textContent || "").trim().split(' ')[0].toUpperCase();
        if (phoneElement) {
            const phoneDigits = (phoneElement.textContent || "").replace(/\D/g, '');
            if (phoneDigits.startsWith('55') && (phoneDigits.length === 12 || phoneDigits.length === 13)) {
                const ddd = phoneDigits.substring(2, 4);
                const number = phoneDigits.substring(4);
                const part1 = number.length === 9 ? number.slice(0, 5) : number.slice(0, 4);
                const part2 = number.length === 9 ? number.slice(5) : number.slice(4);
                phoneNumber = `${ddd} ${part1}-${part2}`;
            } else if (phoneDigits.length === 10 || phoneDigits.length === 11) {
                const ddd = phoneDigits.substring(0, 2);
                const number = phoneDigits.substring(2);
                const part1 = number.length === 9 ? number.slice(0, 5) : number.slice(0, 4);
                const part2 = number.length === 9 ? number.slice(5) : number.slice(4);
                phoneNumber = `${ddd} ${part1}-${part2}`;
            }
        }
    }
    return { firstName, phoneNumber };
}

function isValidCPF(cpf) {
    if (typeof cpf !== 'string') return false;
    cpf = cpf.replace(/[^\d]/g, '');
    if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
    let sum = 0, remainder;
    for (let i = 1; i <= 9; i++) sum += parseInt(cpf.substring(i - 1, i)) * (11 - i);
    remainder = (sum * 10) % 11;
    if ((remainder === 10) || (remainder === 11)) remainder = 0;
    if (remainder !== parseInt(cpf.substring(9, 10))) return false;
    sum = 0;
    for (let i = 1; i <= 10; i++) sum += parseInt(cpf.substring(i - 1, i)) * (12 - i);
    remainder = (sum * 10) % 11;
    if ((remainder === 10) || (remainder === 11)) remainder = 0;
    if (remainder !== parseInt(cpf.substring(10, 11))) return false;
    return true;
}

function isValidCNPJ(cnpj) {
    if (typeof cnpj !== 'string') return false;
    cnpj = cnpj.replace(/[^\d]/g, '');
    if (cnpj.length !== 14 || /^(\d)\1{13}$/.test(cnpj)) return false;
    let length = cnpj.length - 2;
    let numbers = cnpj.substring(0,length);
    let digits = cnpj.substring(length);
    let sum = 0;
    let pos = length - 7;
    for (let i = length; i >= 1; i--) {
        sum += numbers.charAt(length - i) * pos--;
        if (pos < 2) pos = 9;
    }
    let result = sum % 11 < 2 ? 0 : 11 - sum % 11;
    if (result != digits.charAt(0)) return false;
    length += 1;
    numbers = cnpj.substring(0,length);
    sum = 0;
    pos = length - 7;
    for (let i = length; i >= 1; i--) {
        sum += numbers.charAt(length - i) * pos--;
        if (pos < 2) pos = 9;
    }
    result = sum % 11 < 2 ? 0 : 11 - sum % 11;
    if (result != digits.charAt(1)) return false;
    return true;
}

function extractClientChatAfterAssignment(chatContainerElement) {
    const assignmentKeyword = "atendimento atribuído ao atendente";
    let assignmentMessageFound = false;
    const clientTexts = [];
    if (!chatContainerElement) return [];
    const allMessageItems = Array.from(chatContainerElement.querySelectorAll('.item'));
    for (const item of allMessageItems) {
        const itemText = item.textContent.toLowerCase();
        if (!assignmentMessageFound && itemText.includes(assignmentKeyword)) {
            assignmentMessageFound = true;
            continue;
        }
        if (assignmentMessageFound) {
            if (!item.classList.contains('sent')) {
                clientTexts.push(item.textContent.trim());
            }
        }
    }
    return clientTexts;
}

function injectCSS(filePath) {
    const cssFileId = 'extension-styles';
    if (document.getElementById(cssFileId)) return;
    const link = document.createElement('link');
    link.id = cssFileId;
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = chrome.runtime.getURL(filePath);
    (document.head || document.documentElement).appendChild(link);
    console.log("ATI Extensão: Arquivo de estilo injetado com sucesso.");
}

// --- Extensão ATI\manifest.json ---

{
  "manifest_version": 3,
  "name": "ATI - Auxiliar de Atendimentos",
  "version": "6.1",
  "description": "Copia dados, sugere e cria Ordens de Serviço a partir do chat.",
  "permissions": [
    "storage",
    "activeTab",
    "clipboardWrite",
    "clipboardRead",
    "tabs",
    "commands"
  ],
  "host_permissions": [
    "https://*.firebaseio.com/*",
    "https://*.firebaseapp.com/",
    "https://*.googleapis.com/*"
  ],
  "action": {
    "default_popup": "popup.html"
  },
  "background": {
    "service_worker": "background.js"
  },
  "commands": {
    "copy-data": {
      "suggested_key": {
        "default": "Ctrl+Shift+C",
        "mac": "Command+Shift+C"
      },
      "description": "Copia os dados do cliente ativo."
    }
  },
  "content_scripts": [
    {
      "comment": "Scripts para a V1 do Chatmix.",
      "matches": ["https://www.chatmix.com.br/app/atendimento"],
      "js": [
        "firebase-config.js",
        "logic.js",
        "ui.js",
        "content.js"
      ]
    },
    {
      "comment": "Scripts para a V2 do Chatmix.",
      "matches": ["https://www.chatmix.com.br/v2/chat*"],
      "js": [
        "firebase-config.js",
        "logic.js",
        "v2.js"
      ]
    },
    {
      "comment": "Ponte de comunicação com o site-painel.",
      "matches": ["https://vituali.github.io/ATI/"],
      "js": ["bridge-listener.js"],
       "all_frames": true
    },
    {
      "comment": "NOVO: Script para automatizar o SGP.",
      "matches": ["https://sgp.atiinternet.com.br/admin/atendimento/cliente/*/ocorrencia/add/"],
      "js": [
        "jquery.min.js",
        "sgp.js"
      ]
    }
  ],
  "web_accessible_resources": [
    {
      "resources": ["bridge-injected.js", "injected.css"],
      "matches": ["https://*.chatmix.com.br/*", "https://vituali.github.io/*"]
    }
  ]
}

// --- Extensão ATI\popup.css ---

:root {
    --bg-color: #2c2f33;
    --primary-color: #007bff;
    --secondary-color: #3a3f44;
    --text-color: #ffffff;
    --text-muted-color: #99aab5;
    --border-color: #4f545c;
    --success-color: #28a745;
    --danger-color: #dc3545;
    --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    font-family: var(--font-family);
    margin: 0;
    background-color: var(--bg-color);
    color: var(--text-color);
    width: 520px;
}

.container {
    padding: 20px;
}

header h1 {
    margin: 0 0 5px 0;
    color: var(--primary-color);
}

header p {
    margin: 0 0 20px 0;
    color: var(--text-muted-color);
}

/* --- Estilos das Abas --- */
.tab-nav {
    display: flex;
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 20px;
}

.tab-button {
    padding: 10px 20px;
    cursor: pointer;
    background: none;
    border: none;
    color: var(--text-muted-color);
    font-size: 16px;
    font-family: var(--font-family);
    border-bottom: 2px solid transparent;
    transition: all 0.2s ease-in-out;
}

.tab-button.active {
    color: var(--primary-color);
    border-bottom-color: var(--primary-color);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

/* --- Lista de Modelos --- */
.template-list {
    max-height: 250px;
    overflow-y: auto;
    background-color: var(--secondary-color);
    border-radius: 6px;
    margin-bottom: 20px;
}

.template-item {
    padding: 12px 15px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
}
.template-item:last-child { border-bottom: none; }

.template-details strong { display: block; }
.template-details small { color: var(--text-muted-color); }

.template-actions button {
    margin-left: 8px;
    padding: 5px 10px;
    border: 1px solid var(--border-color);
    background-color: var(--bg-color);
    color: var(--text-color);
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s;
}
.template-actions button:hover { background-color: #4f545c; }
.template-actions button.delete { color: var(--danger-color); }
.template-actions button.delete:hover { background-color: var(--danger-color); color: white; }

/* --- Formulário --- */
.form-area {
    background-color: var(--secondary-color);
    padding: 20px;
    border-radius: 6px;
}

#form-title { margin-top: 0; color: var(--primary-color); }

.form-group { margin-bottom: 15px; }
.form-group label { display: block; margin-bottom: 5px; }

/* ===== CORREÇÃO: Ajustado para ocupar 100% da largura do contêiner ===== */
.form-group input, .form-group textarea, .form-group select {
    box-sizing: border-box; /* Garante que o padding não afete a largura total */
    width: 100%;
    padding: 10px;
    border-radius: 4px;
    border: 1px solid var(--border-color);
    background-color: var(--bg-color);
    color: var(--text-color);
    font-family: var(--font-family);
}

/* ===== CORREÇÃO: Nova regra para o textarea crescer automaticamente ===== */
.form-group textarea {
    min-height: 60px; /* Altura inicial para ~2 linhas */
    resize: vertical; /* Permite que o usuário redimensione manualmente se quiser */
    field-sizing: content; /* Propriedade que faz a mágica de auto-ajuste de altura */
}

.form-buttons {
    display: flex;
    gap: 10px;
}

.form-buttons button {
    padding: 10px 15px;
    border: none;
    color: white;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: opacity 0.2s;
}
.form-buttons button:hover { opacity: 0.9; }

#save-button { background-color: var(--success-color); }
#cancel-button { background-color: var(--text-muted-color); display: none; }

.io-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    border-top: 1px solid var(--border-color);
    padding-top: 20px;
}

/* ===== CORREÇÃO: Ajustado para garantir que os botões fiquem lado a lado ===== */
.io-buttons button, .io-buttons .import-label {
    flex: 1; /* Faz com que os itens dividam o espaço igualmente */
    padding: 10px;
    text-align: center;
    border: 1px solid var(--border-color);
    background-color: var(--secondary-color);
    color: var(--text-color);
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.2s;
    font-size: 14px;
}

.io-buttons button:hover, .io-buttons .import-label:hover {
    background-color: var(--border-color);
}

// --- Extensão ATI\popup.html ---

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>ATI - Painel do Atendente</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 400px;
            height: 550px;
            overflow: hidden;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <iframe src="https://vituali.github.io/ATI/" allow="clipboard-write"></iframe>
</body>
</html>

// --- Extensão ATI\popup.js ---

document.addEventListener('DOMContentLoaded', () => {
    // Elementos da UI
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    const osListContainer = document.getElementById('os-list-container');
    const replyListContainer = document.getElementById('reply-list-container');
    const saveButton = document.getElementById('save-button');
    const cancelButton = document.getElementById('cancel-button');
    const formTitle = document.getElementById('form-title');
    const titleInput = document.getElementById('title');
    const textInput = document.getElementById('text');
    const categoryInput = document.getElementById('category');
    const keywordsInput = document.getElementById('keywords');
    const keywordsGroup = document.getElementById('keywords-group');
    const editIndexInput = document.getElementById('edit-index');
    const exportBtn = document.getElementById('export-btn');
    const importFile = document.getElementById('import-file');
    const subCategoryInput = document.getElementById('subcategory');
    const subCategoryGroup = document.getElementById('subcategory-group');

    let templates = [];

    // Função para mostrar/esconder campos do formulário
    const toggleFormFields = (category) => {
        if (category === 'quick_reply') {
            keywordsGroup.style.display = 'none';
            subCategoryGroup.style.display = 'block';
        } else {
            keywordsGroup.style.display = 'block';
            subCategoryGroup.style.display = 'none';
        }
    };
    
    // Adiciona o listener para o dropdown de categoria
    categoryInput.addEventListener('change', () => toggleFormFields(categoryInput.value));

    // --- Lógica das Abas ---
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));

            button.classList.add('active');
            const tabId = button.getAttribute('data-tab');
            document.getElementById(`${tabId}-content`).classList.add('active');
            
            // Adapta o formulário para a aba ativa
            const categoryValue = tabId === 'replies' ? 'quick_reply' : 'Técnico';
            categoryInput.value = categoryValue;
            toggleFormFields(categoryValue);
        });
    });

    // --- Lógica de Renderização e CRUD ---
    const renderTemplates = () => {
        chrome.storage.local.get('osTemplates', (data) => {
            templates = data.osTemplates || [];
            osListContainer.innerHTML = '';
            replyListContainer.innerHTML = '';

            const osTemplates = templates.filter(t => t.category !== 'quick_reply');
            const quickReplies = templates.filter(t => t.category === 'quick_reply');

            const createItemHTML = (template, index) => `
                <div class="template-item">
                    <div class="template-details">
                        <strong>${template.title}</strong>
                        <small>${template.subCategory ? `Subcategoria: ${template.subCategory}` : `Categoria: ${template.category}`}</small>
                    </div>
                    <div class="template-actions">
                        <button class="edit" data-index="${index}">Editar</button>
                        <button class="delete" data-index="${index}">Excluir</button>
                    </div>
                </div>`;

            osTemplates.forEach((template) => {
                const originalIndex = templates.findIndex(t => t === template);
                osListContainer.innerHTML += createItemHTML(template, originalIndex);
            });
            quickReplies.forEach((template) => {
                const originalIndex = templates.findIndex(t => t === template);
                replyListContainer.innerHTML += createItemHTML(template, originalIndex);
            });
        });
    };

    const saveTemplates = () => {
        chrome.storage.local.set({ osTemplates: templates }, () => {
            console.log('Modelos salvos com sucesso.');
            renderTemplates();
        });
    };

    const resetForm = () => {
        formTitle.textContent = 'Adicionar Novo Modelo';
        saveButton.textContent = 'Salvar Novo Modelo';
        titleInput.value = '';
        textInput.value = '';
        keywordsInput.value = '';
        subCategoryInput.value = '';
        editIndexInput.value = '';
        cancelButton.style.display = 'none';
        
        const activeTab = document.querySelector('.tab-button.active').getAttribute('data-tab');
        const categoryValue = activeTab === 'replies' ? 'quick_reply' : 'Técnico';
        categoryInput.value = categoryValue;
        toggleFormFields(categoryValue);
    };

    // CORREÇÃO: A lógica de salvar estava fora do listener de clique
    saveButton.addEventListener('click', () => {
        const newTemplate = {
            title: titleInput.value.trim(),
            text: textInput.value.trim(),
            category: categoryInput.value,
            keywords: keywordsInput.value.split(',').map(k => k.trim()).filter(Boolean),
            subCategory: subCategoryInput.value.trim()
        };

        if (newTemplate.category !== 'quick_reply') {
            delete newTemplate.subCategory;
        } else {
            delete newTemplate.keywords;
        }

        if (!newTemplate.title || !newTemplate.text) {
            alert('Título e Texto são obrigatórios.');
            return;
        }

        const editIndex = editIndexInput.value;
        if (editIndex !== '') {
            templates[parseInt(editIndex)] = newTemplate;
        } else {
            templates.push(newTemplate);
        }
        saveTemplates();
        resetForm();
    });

    cancelButton.addEventListener('click', resetForm);

    document.body.addEventListener('click', (e) => {
        const target = e.target;
        if (!target.matches('.edit, .delete')) return;
        const index = parseInt(target.getAttribute('data-index'));

        if (target.classList.contains('delete')) {
            if (confirm(`Tem certeza que deseja excluir o modelo "${templates[index].title}"?`)) {
                templates.splice(index, 1);
                saveTemplates();
            }
        }
        if (target.classList.contains('edit')) {
            const template = templates[index];
            formTitle.textContent = 'Editando Modelo';
            saveButton.textContent = 'Salvar Alterações';
            titleInput.value = template.title;
            textInput.value = template.text;
            categoryInput.value = template.category;
            keywordsInput.value = (template.keywords || []).join(', ');
            subCategoryInput.value = template.subCategory || '';
            editIndexInput.value = index;
            cancelButton.style.display = 'inline-block';
            toggleFormFields(template.category);
            titleInput.focus();
        }
    });

    // --- Lógica de Importar e Exportar ---
    exportBtn.addEventListener('click', () => {
        chrome.storage.local.get('osTemplates', (data) => {
            if (!data.osTemplates || data.osTemplates.length === 0) {
                alert('Não há modelos para exportar.');
                return;
            }
            const jsonData = JSON.stringify(data.osTemplates, null, 4);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'modelos_backup.json';
            a.click();
            URL.revokeObjectURL(url);
        });
    });

    importFile.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const importedTemplates = JSON.parse(e.target.result);
                if (!Array.isArray(importedTemplates)) throw new Error("O arquivo não é uma lista válida.");
                if (confirm('Isso irá substituir todos os seus modelos atuais. Deseja continuar?')) {
                    templates = importedTemplates;
                    saveTemplates();
                }
            } catch (error) {
                alert('Erro ao ler o arquivo. Certifique-se de que é um JSON válido.');
            }
        };
        reader.readAsText(file);
        event.target.value = '';
    });

    // Inicia a renderização e ajusta o formulário
    renderTemplates();
    toggleFormFields(categoryInput.value);
});

// --- Extensão ATI\sgp.js ---

// sgp.js - Versão com 3 fluxos: Padrão, Comprovante e Promessa (v8)

// --- CONFIGURAÇÃO DOS ATENDENTES ---

const ATTENDANTS = {
    'VICTORH': '99',
    'LUCASJ': '100',
    
};
// ------------------------------------

/**
 * Função auxiliar para criar uma pausa.
 * @param {number} ms - Tempo em milissegundos para esperar.
 */
const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

/**
 * Função auxiliar para formatar a data e hora atuais no padrão DD/MM/AAAA HH:mm:ss.
 */
function getCurrentFormattedDateTime() {
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const year = now.getFullYear();
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const seconds = String(now.getSeconds()).padStart(2, '0');
    return `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
}

/**
 * Função de preenchimento que usa dispatchEvent nativo.
 */
const setValueWithDelay = (selector, value, delay) => {
    return new Promise(resolve => {
        setTimeout(() => {
            try {
                const element = $(selector);
                if (element.length > 0) {
                    element.val(value);
                    const event = new Event('change', { bubbles: true });
                    element[0].dispatchEvent(event);
                    console.log(`[Extensão ATI] Campo ${selector} preenchido com valor ${value}.`);
                }
                resolve();
            } catch (error) {
                console.error(`[Extensão ATI] Erro ao preencher o campo ${selector}:`, error);
                resolve();
            }
        }, delay);
    });
};

/**
 * Função principal que lê os dados e preenche o formulário.
 */
async function fillSgpForm() {
    try {

        const clipboardText = await navigator.clipboard.readText();
        const upperCaseText = clipboardText.toUpperCase();

        // --- 1. PREENCHIMENTO DE CAMPOS COMUNS A TODOS OS FLUXOS ---

        // Define o responsável (usuário logado)
        const selectedAttendant = localStorage.getItem('sgp_selected_attendant');
        if (selectedAttendant) {
            await setValueWithDelay('#id_responsavel', selectedAttendant, 100);
        }

        // Filtra as opções para encontrar contratos que não estão "Cancelados"
        const validContracts = $('#id_clientecontrato option').filter(function() {
            // A opção deve ter um valor e o texto não pode incluir 'Cancelado'
            return $(this).val() !== '' && !$(this).text().toUpperCase().includes('CANCELADO');
        });

        // Decide o que fazer com base no número de contratos válidos encontrados
        if (validContracts.length > 1) {
            // Se houver mais de um contrato válido, avisa o usuário para selecionar
            alert('[Extensão ATI] Existem múltiplos contratos ativos. Por favor, selecione o contrato correto manualmente.');
        
        } else if (validContracts.length === 1) {
            // Se houver exatamente um contrato válido, seleciona-o
            const contractId = validContracts.val();
            await setValueWithDelay('#id_clientecontrato', contractId, 100);
        }
        // Se validContracts.length for 0, nenhum contrato será selecionado.

        // Define os valores fixos para todos os atendimentos
        await setValueWithDelay('#id_setor', '2', 100);     // Suporte
        await setValueWithDelay('#id_metodo', '3', 100);    // Suporte Online
        await setValueWithDelay('#id_status', '1', 100);    // Encerrada

        // Preenche conteúdo e data
        $('#id_conteudo').val(clipboardText); // Pode usar o texto original ou upperCaseText
        $('#id_data_agendamento').val(getCurrentFormattedDateTime());
        
        // Garante que a O.S. esteja sempre desmarcada
        $('#id_os').prop('checked', false);

        // --- 2. TRATAMENTO DOS CASOS ESPECIAIS ---

        // Pausa estratégica APÓS definir o setor, caso o campo "tipo" dependa dele
        await wait(200); 

        const isComprovante = upperCaseText.includes('ENVIO DE COMPROVANTE');
        const isPromessa = upperCaseText.includes('PROMESSA DE PAGAMENTO');
        const isLentidao = upperCaseText.includes('CLIENTE RELATA LENTIDÃO');

        let tipoOcorrencia = ''; // Por padrão, o tipo fica vazio

        if (isComprovante) {
            tipoOcorrencia = '42'; // Financeiro- Comunicação de pagamento
        }

        else if (isPromessa) {
            tipoOcorrencia = '41'; // Financeiro - Promessa de pagamento
        }
        
        else if (isLentidao) {
            tipoOcorrencia = '3'; // Suporte - Acesso lento
        }
        // Se um tipo foi definido, preenche o campo
        if (tipoOcorrencia) {
            await setValueWithDelay('#id_tipo', tipoOcorrencia, 100);
        }

        console.log('[Extensão ATI] Preenchimento concluído!');

    } catch (error) {
        console.error('[Extensão ATI] Erro ao preencher formulário SGP:', error);
        alert('Ocorreu um erro ao tentar preencher o formulário.');
    }
}

/**
 * Cria e injeta o seletor de atendente na página.
 */
function injectAttendantSelector() {
    if (document.getElementById('attendant-selector-container')) return;

    const container = document.createElement('div');
    container.id = 'attendant-selector-container';
    container.style.cssText = 'position: absolute; top: 10px; right: 450px; z-index: 9999; display: flex; align-items: center; color: white;';

    const label = document.createElement('label');
    label.innerText = 'Atendente da Extensão:';
    label.style.marginRight = '10px';
    label.style.fontWeight = 'bold';

    const select = document.createElement('select');
    select.id = 'sgp-attendant-selector';
    select.style.padding = '5px';
    select.style.borderRadius = '4px';
    
    Object.keys(ATTENDANTS).forEach(name => {
        const option = document.createElement('option');
        option.value = ATTENDANTS[name];
        option.innerText = name;
        select.appendChild(option);
    });

    const savedAttendant = localStorage.getItem('sgp_selected_attendant');
    if (savedAttendant) {
        select.value = savedAttendant;
    } else {

        localStorage.setItem('sgp_selected_attendant', select.value);
    }

    select.addEventListener('change', () => {
        localStorage.setItem('sgp_selected_attendant', select.value);
    });

    container.appendChild(label);
    container.appendChild(select);

    document.getElementById('header-right').prepend(container);
}

/**
 * Adiciona o botão de preenchimento automático na página.
 */
function injectSgpButton() {
    if (document.getElementById('fill-from-chatmix-btn')) return;
    
    const submitButton = document.getElementById('btacao');
    if (submitButton) {
        const customButton = document.createElement('input');
        customButton.id = 'fill-from-chatmix-btn';
        customButton.type = 'button';
        customButton.value = 'Preencher com Dados do Chatmix';
        customButton.className = 'button blue';
        customButton.style.marginLeft = '10px';
        customButton.addEventListener('click', fillSgpForm);
        submitButton.parentNode.insertBefore(customButton, submitButton.nextSibling);
    }
}

// Inicia o script
const readyCheckInterval = setInterval(() => {
    if (document.getElementById('btacao') && document.getElementById('header-right')) {
        clearInterval(readyCheckInterval);
        injectSgpButton();
        injectAttendantSelector();
    }
}, 500);

// --- Extensão ATI\ui.js ---

// ui.js - VERSÃO FINAL CORRIGIDA

const V1_TEXTAREA_SELECTOR = 'textarea[placeholder="Digite aqui sua mensagem..."]';
var osTemplates = [];

// ===================================================================================
// LÓGICA DE "SEQUESTRO" DO MODAL NATIVO
// ===================================================================================

function selectReplyAndClose(text) {
    const activeChat = findActiveAttendanceElement();
    if (!activeChat) return;
    const textarea = activeChat.querySelector(V1_TEXTAREA_SELECTOR);
    if (textarea) {
        textarea.value = processDynamicPlaceholders(text);
        textarea.dispatchEvent(new Event('input', { bubbles: true }));
        textarea.focus();
    }
    const closeButton = document.querySelector('.modal_msg_model .modal-footer a.button');
    if (closeButton) {
        closeButton.click();
    }
}

function rebuildNativeModal(modal) {
    const quickReplies = osTemplates.filter(t => t.category === 'quick_reply');
    if (quickReplies.length === 0) return;
    const titleElement = modal.querySelector('.modal-header h1');
    const listElement = modal.querySelector('.modal-content ul');
    const taglineElement = modal.querySelector('.modal-header p.tagline');
    const markElement = modal.querySelector('.modal-content mark');
    if (!titleElement || !listElement) return;
    titleElement.textContent = 'Respostas Rápidas (Extensão)';
    if (taglineElement) taglineElement.style.display = 'none';
    if (markElement) markElement.style.display = 'none';
    listElement.innerHTML = '';
    const repliesByCategory = quickReplies.reduce((acc, reply) => {
        const subCategory = reply.subCategory || 'Geral';
        if (!acc[subCategory]) acc[subCategory] = [];
        acc[subCategory].push(reply);
        return acc;
    }, {});
    for (const subCategory in repliesByCategory) {
        const categoryTitle = document.createElement('li');
        categoryTitle.innerHTML = `<b>${subCategory}</b>`;
        listElement.appendChild(categoryTitle);
        repliesByCategory[subCategory].forEach(reply => {
            const listItem = document.createElement('li');
            const paragraph = document.createElement('p');
            paragraph.className = 'message_model';
            paragraph.textContent = reply.title;
            paragraph.title = reply.text;
            paragraph.onclick = (event) => {
                event.stopPropagation();
                event.preventDefault();
                selectReplyAndClose(reply.text);
            };
            listItem.appendChild(paragraph);
            listElement.appendChild(listItem);
        });
    }
}

function initializeModalHijacker() {
    const nativeModalSelector = 'section[data-modal="msg_model"]';
    let isHijacked = false;
    const observer = new MutationObserver((mutationsList) => {
        for (const mutation of mutationsList) {
            if (mutation.attributeName === 'style') {
                const modal = document.querySelector(nativeModalSelector);
                if (modal && modal.style.display !== 'none' && !isHijacked) {
                    isHijacked = true;
                    rebuildNativeModal(modal);
                } else if (modal && modal.style.display === 'none') {
                    isHijacked = false;
                }
            }
        }
    });
    const modalNode = document.querySelector(nativeModalSelector);
    if (modalNode) {
        observer.observe(modalNode, { attributes: true, attributeFilter: ['style'] });
        console.log("ATI Extensão: 'Sequestrador de Modal' inicializado.");
    }
}

// ===================================================================================
// FUNÇÕES PRINCIPAIS DA EXTENSÃO (O.S., Copiar, etc.)
// ===================================================================================

function showNotification(message, isError = false, duration = 3000) {
    const notification = document.createElement("div");
    notification.textContent = message;
    notification.style.cssText = `position: fixed; top: 20px; right: 20px; padding: 10px 20px; background-color: ${isError ? "#dc3545" : "#007bff"}; color: #fff; border-radius: 5px; z-index: 999999;`;
    document.body.appendChild(notification);
    setTimeout(() => { notification.remove(); }, duration);
}

function findSuggestedTemplate(allTexts) {
    const osOnlyTemplates = osTemplates.filter(t => t.category !== 'quick_reply');
    const chatContent = allTexts.join(' ').toLowerCase();
    for (const template of osOnlyTemplates) {
        if (!template.keywords || template.keywords.length === 0) continue;
        for (const keyword of template.keywords) {
            if (chatContent.includes(keyword.toLowerCase())) return template;
        }
    }
    return null;
}

function showOSModal() {
    if (document.getElementById('osModal')) return;
    const chatHeader = findActiveChatHeader();
    const chatBody = findActiveChatBody();
    if (!chatHeader || !chatBody) { showNotification("Nenhum chat ativo encontrado.", true); return; }
    const clientChatTexts = extractClientChatAfterAssignment(chatBody);
    const suggestedTemplate = findSuggestedTemplate(clientChatTexts);
    const { firstName, phoneNumber } = extractDataFromHeader(chatHeader);
    const osBaseText = `${phoneNumber || ''} ${firstName || ''} | `;
    const osOnlyTemplates = osTemplates.filter(t => t.category !== 'quick_reply');
    const templatesByCategory = osOnlyTemplates.reduce((acc, t) => { (acc[t.category || 'Outros'] = acc[t.category || 'Outros'] || []).push(t); return acc; }, {});
    let modelsHTML = '';
    for (const category in templatesByCategory) {
        modelsHTML += `<h4 class="modal-category-title">${category}</h4>`;
        const buttonsHTML = templatesByCategory[category].map(t => `<button class="template-btn" data-template-text="${t.text.replace(/"/g, '&quot;')}">${t.title}</button>`).join('');
        modelsHTML += `<div class="modal-btn-group">${buttonsHTML}</div>`;
    }
    const modalBackdrop = document.createElement('div');
    modalBackdrop.id = 'osModal';
    modalBackdrop.className = 'modal-backdrop ati-os-modal';
    const modalContent = document.createElement('div');
    modalContent.className = 'modal-content';
    const suggestionHTML = suggestedTemplate ? `<div class="modal-suggestion"><strong>Sugestão:</strong><button class="template-btn template-btn--suggestion" data-template-text="${suggestedTemplate.text.replace(/"/g, '&quot;')}">${suggestedTemplate.title}</button></div>` : '';
    
    // CORREÇÃO 1: O botão de cancelar do rodapé agora tem um ID único: "cancelOsBtnFooter"
    modalContent.innerHTML = `
        <div class="modal-header">
            <h3>CRIAR ORDEM DE SERVIÇO</h3>
            <button id="cancelOsBtn" class="modal-close-btn">&times;</button>
        </div>
        <div class="modal-body">
            ${suggestionHTML}
            <label for="osTextArea">DESCRIÇÃO:</label>
            <textarea id="osTextArea" class="modal-textarea"></textarea>
            <div class="modal-templates-container"><strong>TODOS OS MODELOS:</strong>${modelsHTML}</div>
        </div>
        <div class="modal-footer">
            <button id="copyOsBtn" class="main-btn main-btn--confirm">COPIAR O.S. E FECHAR</button>
            <button id="cancelOsBtnFooter" class="main-btn main-btn--cancel">CANCELAR</button>
        </div>`;
    
    modalBackdrop.appendChild(modalContent);
    document.body.appendChild(modalBackdrop);
    const osTextArea = document.getElementById('osTextArea');
    osTextArea.value = processDynamicPlaceholders(osBaseText).toUpperCase();
    osTextArea.addEventListener('input', function() { this.value = this.value.toUpperCase(); });
    modalContent.querySelectorAll('.template-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const templateText = btn.getAttribute('data-template-text');
            const fullText = osBaseText + templateText;
            osTextArea.value = processDynamicPlaceholders(fullText).toUpperCase();
            osTextArea.focus();
        });
    });

    const closeModal = () => modalBackdrop.remove();

    document.getElementById('copyOsBtn').onclick = () => {
        navigator.clipboard.writeText(osTextArea.value).then(() => {
            showNotification("O.S. copiada!");
            closeModal();
        });
    };

    // CORREÇÃO 2: Adicionada a lógica de clique para AMBOS os botões de cancelar
    document.getElementById('cancelOsBtn').onclick = closeModal;
    document.getElementById('cancelOsBtnFooter').onclick = closeModal;
}

function createActionsContainer() {
    // Se o container de ações já existir na página, não faz nada.
    if (document.getElementById("actionsContainer")) return;

    const container = document.createElement("div");
    container.id = "actionsContainer";

    // A CORREÇÃO: Anexar o container SEMPRE ao <body> da página.
    // Desta forma, ele "flutua" sobre o site e não interfere com
    // a estrutura e os scripts do Chatmix. O CSS já cuida do posicionamento.
    document.body.appendChild(container);
}

function initializeActions() {
    if (!document.getElementById("actionsContainer")) {
        createActionsContainer();
    }
    const container = document.getElementById("actionsContainer");
    if (!container || container.childElementCount > 0) return;
    container.innerHTML = `
        <button class="action-btn action-btn--contact">Copiar Contato</button>
        <button class="action-btn action-btn--cpf">Copiar CPF</button>
        <button class="action-btn action-btn--os">Criar O.S.</button>
    `;
    container.querySelector('.action-btn--contact').onclick = copyContactInfo;
    container.querySelector('.action-btn--cpf').onclick = copyCPFFromChat;
    container.querySelector('.action-btn--os').onclick = showOSModal;
}

function copyContactInfo() {
  const header = findActiveChatHeader();
  if (!header) { showNotification("Nenhum chat ativo encontrado!", true); return; }
  const { firstName, phoneNumber } = extractDataFromHeader(header);
  if (phoneNumber || firstName) {
    const contactString = `${phoneNumber || ''} ${firstName || ''} |`.trim();
    navigator.clipboard.writeText(contactString).then(() => showNotification(`Contato copiado: ${contactString}`)).catch(err => showNotification("Erro ao copiar dados!", true));
  } else {
    showNotification("Nenhum nome ou telefone encontrado no cabeçalho!", true);
  }
}

function copyCPFFromChat() {
    const chatBody = findActiveChatBody();
    if (!chatBody) { showNotification("Nenhum chat ativo encontrado!", true); return; }
    const allMessageTexts = collectTextFromMessages(chatBody);
    const foundCPF = findCPF(allMessageTexts);
    if (foundCPF) {
        navigator.clipboard.writeText(foundCPF).then(() => showNotification(`CPF/CNPJ copiado: ${foundCPF}`)).catch(err => showNotification("Erro ao copiar CPF!", true));
    } else {
        showNotification("Nenhum CPF/CNPJ encontrado nas mensagens do chat!", true);
    }
}

// --- Extensão ATI\v2.js ---

// v2.js - VERSÃO FINAL CORRIGIDA PARA INJEÇÃO DE BOTÕES

console.log("ATI Extensão: Script V2 (Final v5) carregado!");

var osTemplates = [];

// --- Funções Auxiliares e de Lógica ---
function showNotification(message, isError = false, duration = 3000) {
    const notificationId = 'v2-notification';
    document.getElementById(notificationId)?.remove();
    const notification = document.createElement("div");
    notification.id = notificationId;
    notification.textContent = message;
    notification.className = `notification ${isError ? 'error' : 'success'}`;
    document.body.appendChild(notification);
    setTimeout(() => { notification.remove(); }, duration);
}

async function loadTemplatesV2() {
    osTemplates = await loadTemplatesFromStorage();
}

function findActiveChatHeaderV2() { return document.querySelector('div.z-10 header'); }
function findActiveChatBodyV2() { return document.querySelector('div#attendanceMessages'); }

function extractDataFromHeaderV2(headerElement) {
    if (!headerElement) return { firstName: "", phoneNumber: "" };
    const nameElement = headerElement.querySelector('h2.text-base');
    const phoneElement = headerElement.querySelector('span.text-sm');
    const firstName = nameElement ? (nameElement.textContent || "").trim().split(' ')[0].toUpperCase() : "";
    let phoneNumber = "";
    if (phoneElement) {
        const phoneDigits = (phoneElement.textContent || "").replace(/\D/g, '');
        if (phoneDigits.startsWith('55') && (phoneDigits.length === 12 || phoneDigits.length === 13)) {
            const ddd = phoneDigits.substring(2, 4);
            const number = phoneDigits.substring(4);
            phoneNumber = `${ddd} ${number.slice(0, number.length - 4)}-${number.slice(number.length - 4)}`;
        } else if (phoneDigits.length === 10 || phoneDigits.length === 11) {
            const ddd = phoneDigits.substring(0, 2);
            const number = phoneDigits.substring(2);
            phoneNumber = `${ddd} ${number.slice(0, number.length - 4)}-${number.slice(number.length - 4)}`;
        } else {
            phoneNumber = phoneDigits;
        }
    }
    return { firstName, phoneNumber };
}

function collectTextFromMessagesV2(chatBody) {
    const texts = [];
    if (!chatBody) return texts;
    // Seleciona todas as mensagens e pega o texto de cada uma
    chatBody.querySelectorAll('p.mensagem').forEach(p => {
        texts.push(p.textContent.trim());
    });
    return texts;
}

function extractAndFormatConversationV2(chatBody) {
    if (!chatBody) return "";

    const allMessages = Array.from(chatBody.querySelectorAll('p.mensagem'));
    const assignmentKeyword = "atendimento atribuído ao atendente";
    let conversationStarted = false;
    const relevantTexts = [];

    for (const message of allMessages) {
        const text = message.textContent.trim();
        const lowerCaseText = text.toLowerCase();

        // Procura pelo marco zero da conversa
        if (lowerCaseText.includes(assignmentKeyword)) {
            conversationStarted = true;
            continue; // Pula para a próxima mensagem
        }

        // Se a conversa humana já começou, captura a mensagem
        if (conversationStarted) {
            // Verifica se a mensagem é do próprio atendente
            if (lowerCaseText.startsWith("victor disse:")) {
                 // Remove o "VICTOR disse:" e adiciona um marcador claro
                relevantTexts.push(`VICTOR: ${text.substring(13).trim()}`);
            } else {
                // Se não for do atendente, assume que é do cliente
                relevantTexts.push(`CLIENTE: ${text}`);
            }
        }
    }
    
    // Se, por algum motivo, não encontrar a atribuição, retorna as últimas 10 mensagens como fallback
    if (!conversationStarted) {
        return allMessages.slice(-10).map(m => m.textContent.trim()).join('\n');
    }

    return relevantTexts.join('\n');
}

function findSuggestedTemplate(allTexts) {
    const osOnlyTemplates = osTemplates.filter(t => t.category !== 'quick_reply');
    const chatContent = allTexts.join(' ').toLowerCase();
    for (const template of osOnlyTemplates) {
        if (!template.keywords || template.keywords.length === 0) continue;
        for (const keyword of template.keywords) {
            if (chatContent.includes(keyword.toLowerCase())) return template;
        }
    }
    return null;
}

function insertReplyText(text) {
    const textarea = document.querySelector('textarea.chat_textarea');
    if (textarea) {
        textarea.value = processDynamicPlaceholders(text);
        textarea.dispatchEvent(new Event('input', { bubbles: true }));
        textarea.focus();
    }
}

function renderReplyUI(container, groupedReplies, activeCategory = null) {
    container.innerHTML = '';
    if (activeCategory && groupedReplies[activeCategory]) {
        const backButton = document.createElement('button');
        backButton.className = 'qr-btn qr-btn--back';
        backButton.textContent = '↩️ Voltar';
        backButton.onclick = () => renderReplyUI(container, groupedReplies, null);
        container.appendChild(backButton);
        groupedReplies[activeCategory].forEach(reply => {
            const button = document.createElement('button');
            button.className = 'qr-btn';
            button.textContent = reply.title;
            button.title = reply.text;
            button.onclick = () => insertReplyText(reply.text);
            container.appendChild(button);
        });
    } else {
        Object.keys(groupedReplies).forEach(subCategory => {
            const button = document.createElement('button');
            button.className = 'qr-btn qr-btn--category';
            button.textContent = subCategory;
            button.onclick = () => renderReplyUI(container, groupedReplies, subCategory);
            container.appendChild(button);
        });
    }
}

function copyContactInfoV2() {
    const header = findActiveChatHeaderV2();
    if (!header) return showNotification("Nenhum chat ativo para copiar contato.", true);
    const { firstName, phoneNumber } = extractDataFromHeaderV2(header);
    const contactString = `${phoneNumber || ''} ${firstName || ''} |`.trim();
    if (contactString.length > 2) {
        navigator.clipboard.writeText(contactString).then(() => showNotification(`Contato copiado: ${contactString}`));
    } else {
        showNotification("Nome ou telefone não encontrado no cabeçalho.", true);
    }
}

function copyCPFFromChatV2() {
    const chatBody = findActiveChatBodyV2();
    if (!chatBody) return showNotification("Nenhum chat ativo para procurar CPF.", true);
    const allMessageTexts = collectTextFromMessagesV2(chatBody);
    const foundCPF = findCPF(allMessageTexts);
    if (foundCPF) {
        navigator.clipboard.writeText(foundCPF).then(() => showNotification(`CPF/CNPJ copiado: ${foundCPF}`));
    } else {
        showNotification("Nenhum CPF/CNPJ encontrado nas mensagens do chat!", true);
    }
}

function showOSModalV2() {
    if (document.getElementById('osModalV2')) return;
    const chatHeader = findActiveChatHeaderV2();
    const chatBody = findActiveChatBodyV2();
    if (!chatHeader || !chatBody) { showNotification("Nenhum chat ativo para criar O.S.", true); return; }
    const allMessageTexts = collectTextFromMessagesV2(chatBody);
    const { firstName, phoneNumber } = extractDataFromHeaderV2(chatHeader);
    const suggestedTemplate = findSuggestedTemplate(allMessageTexts);
    const osOnlyTemplates = osTemplates.filter(t => t.category !== 'quick_reply');
    const templatesByCategory = osOnlyTemplates.reduce((acc, t) => {
        (acc[t.category || 'Outros'] = acc[t.category || 'Outros'] || []).push(t); return acc;
    }, {});
    let modelsHTML = '';
    for (const category in templatesByCategory) {
        modelsHTML += `<h4 class="modal-category-title">${category}</h4>`;
        const buttonsHTML = templatesByCategory[category].map(t => `<button class="template-btn" data-template-text="${t.text.replace(/"/g, '&quot;')}">${t.title}</button>`).join('');
        modelsHTML += `<div class="modal-btn-group">${buttonsHTML}</div>`;
    }
    const modalBackdrop = document.createElement('div');
    modalBackdrop.id = 'osModalV2';
    modalBackdrop.className = 'modal-backdrop ati-os-modal';
    const modalContent = document.createElement('div');
    modalContent.className = 'modal-content';
    const suggestionHTML = suggestedTemplate ? `<div class="modal-suggestion"><strong>Sugestão:</strong><button class="template-btn template-btn--suggestion" data-template-text="${suggestedTemplate.text.replace(/"/g, '&quot;')}">${suggestedTemplate.title}</button></div>` : '';
    const baseTextForOS = `${phoneNumber || ''} ${firstName || ''} | `;
    modalContent.innerHTML = `<div class="modal-header"><h3>Criar Ordem de Serviço</h3><button id="closeOsBtnV2" class="modal-close-btn">&times;</button></div><div class="modal-body">${suggestionHTML}<label for="osTextAreaV2">Descrição da O.S.:</label><textarea id="osTextAreaV2" class="modal-textarea"></textarea><div class="modal-templates-container"><strong>Todos os Modelos:</strong>${modelsHTML}</div></div><div class="modal-footer"><button id="copyOsBtnV2" class="main-btn main-btn--confirm">Copiar O.S. e Fechar</button></div>`;
    modalBackdrop.appendChild(modalContent);
    document.body.appendChild(modalBackdrop);
    const osTextArea = document.getElementById('osTextAreaV2');
    osTextArea.value = processDynamicPlaceholders(baseTextForOS).toUpperCase();
    osTextArea.addEventListener('input', function() { this.value = this.value.toUpperCase(); });
    modalContent.querySelectorAll('.template-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const templateText = btn.getAttribute('data-template-text');
            const fullText = baseTextForOS + templateText;
            osTextArea.value = processDynamicPlaceholders(fullText).toUpperCase();
            osTextArea.focus();
        });
    });
    const closeModal = () => modalBackdrop.remove();
    document.getElementById('copyOsBtnV2').onclick = () => { navigator.clipboard.writeText(osTextArea.value).then(() => { showNotification("O.S. copiada com sucesso!"); closeModal(); }).catch(err => showNotification("Falha ao copiar O.S.", true)); };
    document.getElementById('closeOsBtnV2').onclick = closeModal;
    modalBackdrop.addEventListener('click', (e) => { if (e.target === modalBackdrop) { closeModal(); } });
}

// --- Funções de Injeção de UI ---
function injectUIElements() {
    // Injeção dos botões de ação (Copiar Contato, CPF, etc.)
    const sidebar = document.querySelector('.chat_sidebar');
    if (sidebar && !document.getElementById('actionsContainerV2')) {
        const container = document.createElement("div");
        container.id = "actionsContainerV2";
        sidebar.appendChild(container); // Injeta na sidebar
        container.innerHTML = `
            <button class="action-btn action-btn--contact">Copiar Contato</button>
            <button class="action-btn action-btn--cpf">Copiar CPF</button>
            <button class="action-btn action-btn--os">Criar O.S.</button>
            <button class="action-btn action-btn--ai">🤖 Copiar Prompt IA</button>
        `;
        container.querySelector('.action-btn--contact').onclick = copyContactInfoV2;
        container.querySelector('.action-btn--cpf').onclick = copyCPFFromChatV2;
        container.querySelector('.action-btn--os').onclick = showOSModalV2;
        container.querySelector('.action-btn--ai').onclick = handleCopyPromptClick;
    }

    // Lógica de injeção das Respostas Rápidas
    const injectionParent = document.querySelector('.flex-none.p-4.pb-6');
    if (injectionParent && !document.getElementById('atiQuickRepliesContainerV2')) {
        const quickReplies = osTemplates.filter(t => t.category === 'quick_reply');
        if (quickReplies.length > 0) {
            const repliesByCategory = quickReplies.reduce((acc, reply) => {
                (acc[reply.subCategory || 'Geral'] = acc[reply.subCategory || 'Geral'] || []).push(reply);
                return acc;
            }, {});

            const buttonContainer = document.createElement('div');
            buttonContainer.id = 'atiQuickRepliesContainerV2';
            buttonContainer.className = 'quick-replies-container';

            // Usamos prepend() para garantir que os botões apareçam no início da seção do rodapé
            injectionParent.prepend(buttonContainer);
            renderReplyUI(buttonContainer, repliesByCategory, null);
        }
    }
}

async function handleCopyPromptClick() {
    showNotification("🤖 Copiando prompt filtrado...");

    const chatBody = findActiveChatBodyV2();
    if (!chatBody) return showNotification("Nenhum chat ativo para copiar.", true);
    
    // --- MUDANÇA PRINCIPAL AQUI ---
    // Chamamos a nova função que filtra a automação
    const customerText = extractAndFormatConversationV2(chatBody);
    // --- FIM DA MUDANÇA ---

    if (!customerText) return showNotification("Não há mensagens de cliente para analisar.", true);
    
    const companyProceduresContext = `
- Para problemas de conexão, primeiro entenda a situação e depois siga as etapas de diagnóstico. Somente como último caso, acione uma equipe técnica.
- O horário do suporte é de Seg a Sab de 08:00 as 21:00 e Dom/Feriados de 09:00 as 21:00.
- Os planos de internet são: 600 MEGA, 800 MEGA e 920 MEGA.

- Etapas de Diagnóstico Obrigatórias (siga na ordem):
1. Verificar se o cliente já reiniciou o modem/roteador. **Se não, peça para fazer.**
2. Testar a conexão via cabo. **Pergunte ao cliente se é possível testar com um cabo de rede.**
3. Realizar o teste de velocidade. **Peça ao cliente para acessar speedtest.net e informar os resultados de download e upload.**
4. Confirmar o número de dispositivos conectados. **Pergunte quantos aparelhos estão usando a internet no momento.**

- Somente se todos os passos acima não resolverem, ofereça o acionamento da equipe técnica com prazo de até 48h.
`;

    const prompt = `
Você é um atendente de suporte da empresa 'ATI Internet'. Seu nome é Victor.
Sua resposta deve ser profissional, amigável e resolver o problema do cliente.

---
REGRAS IMPORTANTES:
1. Gere respostas CURTAS e DIRETAS, ideais para um chat.
2. Se uma explicação for longa, divida-a em 2 mensagens curtas e sequenciais.
3. Siga estritamente os procedimentos e informações da empresa listados abaixo.
---
PROCEDIMENTOS E INFORMAÇÕES DA EMPRESA:
${companyProceduresContext}
---
CONVERSA COM O CLIENTE:
${customerText}
---

Sugira a resposta ideal seguindo TODAS as regras:
    `;

    try {
        await navigator.clipboard.writeText(prompt.trim());
        showNotification("✅ Prompt para IA copiado!", false);
    } catch (error) {
        console.error("Erro ao copiar o prompt:", error);
        showNotification("Falha ao copiar o prompt.", true);
    }
}
// --- LÓGICA DE INICIALIZAÇÃO E O "VIGIA" ---
const observer = new MutationObserver(() => injectUIElements());
(async function main() {
    await loadTemplatesV2();
    injectCSS('injected.css');
    injectUIElements();
    observer.observe(document.body, { childList: true, subtree: true });
})();

// --- gitignore ---

# ==========================================
# .gitignore para ATI - Auxiliar de Atendimentos
# ==========================================

# ==========================================
# Jekyll
# ==========================================
_site/
.sass-cache/
.jekyll-cache/
.jekyll-metadata
.bundle/
vendor/

# ==========================================
# Node.js
# ==========================================
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*
package-lock.json
yarn.lock
.npm/
.yarn/

# ==========================================
# Dependências Ruby
# ==========================================
Gemfile.lock

# ==========================================
# IDEs e Editores
# ==========================================
.vscode/
.idea/
*.swp
*.swo
*~
.sublime-project
.sublime-workspace

# ==========================================
# Sistemas Operacionais
# ==========================================
# macOS
.DS_Store
._*
.Spotlight-V100
.Trashes

# Windows
Thumbs.db
ehthumbs.db
Desktop.ini
$RECYCLE.BIN/
*.cab
*.msi
*.msm
*.msp
*.lnk

# Linux
*~
.directory
.Trash-*

# ==========================================
# Logs
# ==========================================
*.log
logs/
*.log.*
lerna-debug.log*

# ==========================================
# Arquivos Temporários
# ==========================================
*.tmp
*.temp
*.bak
*.backup
*.old
*.orig
*.rej

# ==========================================
# Configurações Locais
# ==========================================
.env
.env.local
.env.development.local
.env.test.local
.env.production.local
config.local.js
firebase-config.local.js

# ==========================================
# Build e Distribuição
# ==========================================
dist/
build/
out/
.next/
.nuxt/
.cache/

# ==========================================
# Testes
# ==========================================
coverage/
*.cover
.nyc_output/
.coverage
.pytest_cache/
htmlcov/

# ==========================================
# Arquivos de desenvolvimento
# ==========================================
TODO.md
NOTES.md
development/
dev/
test-files/
debug/

# ==========================================
# Arquivos específicos do ATI
# ==========================================
# Backups de configuração Firebase
firebase-config-backup.js
credenciais-*.json

# Arquivos de teste de PDF
test-pdfs/
sample-pdfs/

# Dados de desenvolvimento
dev-data/
mock-data/

# Screenshots e assets temporários
screenshots/
temp-assets/

# ==========================================
# Compressão
# ==========================================
*.zip
*.tar.gz
*.rar
*.7z

# ==========================================
# Certificados e Chaves
# ==========================================
*.pem
*.key
*.crt
*.p12
*.pfx

# ==========================================
# Documentação gerada
# ==========================================
docs/build/
documentation/generated/

# ==========================================
# Cache de ferramentas
# ==========================================
.parcel-cache/
.eslintcache
.stylelintcache

# ==========================================
# Arquivos de sistema
# ==========================================
.fuse_hidden*
.nfs*

# ==========================================
# Específico do projeto ATI
# ==========================================
# Não versionar arquivos de configuração local
assets/js/firebase-config.local.js

# Arquivos de dados sensíveis
user-data/
client-data/

# Arquivos de log específicos
atendimento-logs/
conversor-logs/

// --- index.html ---

<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATI - Auxiliar de Atendimentos</title>

    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
    <link rel="stylesheet" href="assets/css/main.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
</head>

<body class="dark-mode">

    <div id="popup" class="popup"></div>
    
    <div id="auth-overlay" class="modal-overlay" style="display: none;">
        <div class="modal-content card" style="max-width: 450px;">
                    <form id="login-form">
                <h3>Login - ATI</h3>
                <div class="modal-form-group">
                    <label for="loginIdentifier">Usuário ou E-mail:</label>
                    <input type="text" id="loginIdentifier" required autocomplete="username">
                </div>
                <div class="modal-form-group">
                    <label for="loginPassword">Senha:</label>
                    <input type="password" id="loginPassword" required autocomplete="current-password">
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="button">Entrar</button>
                </div>
                <p class="auth-toggle-link">Ainda não tem conta? <a href="#" id="show-register">Registre-se</a></p>
            </form>
                    <form id="register-form" style="display: none;">
                <h3>Registro - Novo Atendente</h3>
                <div class="modal-form-group">
                    <label for="registerUsername">Nome de Usuário (Login):</label>
                    <input type="text" id="registerUsername" required placeholder="tudo minúsculo, sem espaços">
                </div>
                <div class="modal-form-group">
                    <label for="registerFullName">Nome e Sobrenome:</label>
                    <input type="text" id="registerFullName" required placeholder="Será exibido no seletor">
                </div>
                <div class="modal-form-group">
                    <label for="registerEmail">Email:</label>
                    <input type="email" id="registerEmail" required autocomplete="email">
                </div>
                <div class="modal-form-group">
                    <label for="registerPassword">Senha (mínimo 6 caracteres):</label>
                    <input type="password" id="registerPassword" required autocomplete="new-password">
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="button">Registrar</button>
                </div>
                <p class="auth-toggle-link">Já tem uma conta? <a href="#" id="show-login">Faça Login</a></p>
            </form>
        </div>
    </div>
                    <div class="chatbox" style="display: none;">
    <div id="sidebar" class="sidebar">
        <button id="toggleSidebarBtn" class="toggle-sidebar" aria-label="Abrir ou fechar menu lateral">☰</button>
        <button class="sidebar-button active" data-section="chat"><span class="icon">🗨️</span><span class="text">Chat</span></button>
        <button class="sidebar-button" data-section="os"><span class="icon">📝</span><span class="text">Modelos O.S.</span></button>
        <button class="sidebar-button" data-section="conversor"><span class="icon">📄</span><span class="text">Conversor</span></button>
        <button class="sidebar-button" data-section="senhas"><span class="icon">🔑</span><span class="text">Senhas</span></button>
        <a href="extensao-ati.zip" class="sidebar-button" download>
            <span class="icon">📥</span>
            <span class="text">Baixar Extensão</span>
        </a>
                    <div class="sidebar-footer">
                <button id="atendenteToggleBtn" class="bottom-toggle" data-tooltip="Abrir perfil do usuário">
                    <span class="icon">👤</span>
                    <span class="text">Perfil</span>
                </button>
                    <button id="darkModeToggleBtn" class="bottom-toggle" data-tooltip="Personalizar interface">
                    <span class="icon">⚙️</span><span class="text">Personalizar</span>
                </button>
            </div>
        </div>
                    <div class="content">

            <div id="chatSection">
                <h1 id="saudacaoChat"></h1>
                <h2>🤖 Automatizador de Chat Humanizado 🤖</h2>
                <div class="card">
                    <div class="card-loader" id="chatLoader" style="display: none;">
                        <div class="loader"></div>
                    </div>

                    <div class="grupo">
                        <div id="custom-select" class="custom-select">
                            <div class="select-selected" id="select-display">Selecione uma resposta</div>
                            <div class="select-items select-hide" id="select-items">
                                </div>
                        </div>
                    </div>                 
                    
                    <div id="titleContainer" class="title-container" style="display: none;">
                        <input type="text" id="titulo" placeholder="Título da resposta">
                        <button id="saveTitleBtn" class="button">Salvar Título</button>
                    </div>
                    
                    <div class="grupo">
                        <label for="resposta">Mensagem:</label>
                        <textarea id="resposta" rows="4"></textarea>
                    </div>
                    <div class="controls">
                        <button id="copyBtn" class="button copy-btn" data-tooltip="Copiar mensagem">📋 Copiar</button>
                        <button id="editTitleBtn" class="button" data-tooltip="Editar título">✏️ Editar Título</button>
                        <button id="saveEditBtn" class="button" data-tooltip="Salvar mensagem">💾 Salvar</button>
                        <button id="deleteBtn" class="button" data-tooltip="Apagar resposta">🗑️ Apagar</button>
                        <button id="addBtn" class="button" data-tooltip="Adicionar nova resposta">➕ Adicionar</button>
                    </div>
                    
                    <p id="saudacaoDespedidaText">Use [SAUDACAO] e [DESPEDIDA] para textos dinâmicos.</p>
                </div>
            </div>
            <div id="osSection" style="display: none;">
                    <h1>Editor de Modelos de O.S.</h1>
                    <h2>Crie e gerencie os templates para a criação de Ordens de Serviço.</h2>

    <div class="os-editor-layout">
        <div class="os-list-container card">
            <h3>Seus Modelos</h3>
            <div id="os-list" class="os-list">
                </div>

             <button id="os-reset-btn" class="button back" style="width: 100%; margin-top: 15px;">Resetar para Padrão</button>
        </div>

        <div class="os-form-container card">
            <form id="os-form">
                <input type="hidden" id="os-edit-index">
                <h3 id="os-form-title">Selecione ou crie um modelo</h3>

                <div class="grupo">
                    <label for="os-title">Título do Modelo:</label>
                    <input type="text" id="os-title" placeholder="Ex: Sem Conexão" required>
                </div>

                <div class="grupo">
                    <label for="os-text">Texto da O.S.:</label>
                    <textarea id="os-text" rows="5" placeholder="Ex: CLIENTE SEM ACESSO. REALIZADO OS PROCEDIMENTOS..."></textarea>
                </div>

                <div class="grupo">
                    <label for="os-category">Categoria:</label>
                    <select id="os-category">
                        <option value="Suporte">Suporte</option>
                        <option value="Financeiro">Financeiro</option>
                        <option value="Comercial">Comercial</option>
                        <option value="Geral">Geral</option>
                        </select>
                </div>

                <div class="grupo">
                    <label for="os-keywords">Palavras-chave (separadas por vírgula):</label>
                    <input type="text" id="os-keywords" placeholder="sem conexao, nao funciona, caiu">
                </div>

                <div class="controls">
                    <button type="submit" id="os-save-btn" class="button">Salvar</button>
                    <button type="button" id="os-new-btn" class="button">Novo Modelo</button>
                    <button type="button" id="os-delete-btn" class="button back" style="display: none;">Apagar</button>
                </div>
            </form>
        </div>
    </div>
</div>
                    <div id="conversorSection" style="display: none;">
                <h1 id="saudacaoConversor"></h1>
                <h2>Conversor de Aditivo</h2>
                
                <div id="uploadSection" class="upload-card">
                    <div class="upload-content">
                        <h3>Carregar Aditivo PDF</h3>
                        <div class="file-upload-wrapper">
                            <label for="pdfUpload" class="file-label">Escolher Arquivo</label>
                            <input type="file" id="pdfUpload" class="file-input" accept="application/pdf">
                            <span id="fileName" class="file-name">Nenhum arquivo selecionado</span>
                        </div>
                        <button class="button" id="loadPdfBtn">Carregar e Extrair Dados</button>
                    </div>
                </div>
                
                <div id="dataSection" style="display: none;">
                    <button class="button back" id="backToUploadBtn">Voltar</button>
                    <h3>Agendamento para Contrato - <span id="contratoSpan"></span></h3>
                
                    <div class="dual-grid">
                        <div class="card">
                            <h4>Dados Gerais</h4>
                            <div class="grupo">
                                <p><strong>Contrato:</strong> <span id="contrato"></span></p>
                                <p><strong>Nome:</strong> <span id="nome"></span></p>
                                <p><strong>Endereço Antigo:</strong> <span id="oldAddress"></span></p>
                                <p><strong>Endereço Novo:</strong> <span id="newAddress"></span></p>
                                <div class="inline-group">
                                    <div>
                                        <label for="phone">Número de Telefone:</label>
                                        <input type="text" id="phone" placeholder="21 99999-9999" autocomplete="tel">
                                        <span id="phoneError" class="error"></span>
                                    </div>
                                    <div>
                                        <label for="equipmentType">Tipo de Comodato:</label>
                                        <select id="equipmentType">
                                            <option value="alcl">ALCL</option>
                                            <option value="proprio">PROPRIO</option>
                                            <option value="huawei">HUAWEI</option>
                                            <option value="tp link">TP LINK</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <h4>Detalhes do Contrato</h4>
                            <div class="grupo checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="renewal">
                                    <span class="checkbox-custom"></span> É Renovação? (Isento de taxa)
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="migration">
                                    <span class="checkbox-custom"></span> É Migração? (Isento de taxa)
                                </label>
                            <div id="carrierSection" class="grupo" style="display: none; margin-top: 15px;">
                                <label for="oldCarrier">Antigo Portador:</label>
                                <select id="oldCarrier">
                                <option value="none">Sem alteração ou digitais</option>
                                <option value="ITAU AGT">BANCO ITAÚ - AGANTANGELO</option>
                                <option value="GERENCIANET AGT">GERENCIANET - AGATANGELO</option>
                                <option value="ITAU ATI">BANCO ITAU - ATI</option>
                                <option value="GERENCIANET - BANDA LARGA">GERENCIANET - ATI INTERNET BANDA LARGA</option>
                                </select>
                            </div>
                                <p id="renewalMessage" style="display: none;">Taxa isenta devido à renovação.</p>
                                <p id="migrationMessage" style="display: none;">Taxa isenta devido à migração.</p>
                            </div>
                            <div class="inline-group">
                                <div>
                                    <label for="taxValue">Valor da Taxa:</label>
                                    <select id="taxValue">
                                        <option value="100">R$ 100</option>
                                        <option value="65">R$ 65</option>
                                        <option value="50">R$ 50</option>
                                        <option value="isento">Isento</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="signature">Tipo de Assinatura:</label>
                                    <select id="signature">
                                        <option value="digital">Assinatura Digital</option>
                                        <option value="local">Assinatura no Local</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dual-grid">
                        <div class="card">
                            <h4>Retirada</h4>
                            <div class="grupo checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="selfWithdrawal">
                                    <span class="checkbox-custom"></span> Cliente faz a retirada
                                </label>
                            </div>
                            <div id="withdrawalSection" class="grupo">
                                <label for="withdrawalDate">Data de Retirada:</label>
                                <input type="date" id="withdrawalDate">
                                <label for="withdrawalPeriod">Período de Retirada:</label>
                                <select id="withdrawalPeriod">
                                    <option value="Manhã">Manhã</option>
                                    <option value="Tarde">Tarde</option>
                                </select>
                            </div>
                        </div>
                        <div class="card">
                            <h4>Instalação</h4>
                            <div class="grupo">
                                <label for="installationDate">Data de Instalação:</label>
                                <input type="date" id="installationDate">
                                <label for="installationPeriod">Período de Instalação:</label>
                                <select id="installationPeriod">
                                    <option value="Manhã">Manhã</option>
                                    <option value="Tarde">Tarde</option>
                                </select>
                            </div>
                        </div>
                    </div>
                  
                    <div class="card">
                        <button class="button" id="generateOsBtn">Gerar O.S</button>
                        <textarea id="output" class="output" readonly></textarea>
                        <div id="copyButtons" class="copy-buttons" style="display: none;">
                            <button class="button copy-btn" id="copyWithdrawalBtn">Copiar Retirada</button>
                            <button class="button copy-btn" id="copyInstallationBtn">Copiar Instalação</button>
                            <button class="button copy-btn" id="copyOsBtn">Copiar O.S</button>
                        </div>
                    </div>
                </div>
            </div>
            
        <div id="senhasSection" style="display: none;">
            <h1>Senhas de Equipamentos</h1>
            <h2>Acesso rápido aos logins e senhas dos roteadores. Clique para copiar.</h2>
            <div class="password-grid">
                <div class="card">
                    <h4>ALCL OLT NOKIA</h4>
                    <p><strong>LOGIN:</strong> <span class="copiable">ATI-GPON</span></p>
                    <p><strong>SENHA:</strong> <span class="copiable">@adminATI26422001</span></p>
                </div>
                <div class="card">
                    <h4>ALCL OLT FIBER</h4>
                    <p><strong>LOGIN:</strong> <span class="copiable">AdminGPON</span></p>
                    <p><strong>SENHA:</strong> <span class="copiable">adminati2001</span></p>
                    <hr>
                    <h4>Padrão de fabrica</h4>
                    <p><strong>LOGIN:</strong> <span class="copiable">AdminGPON</span></p>
                    <p><strong>SENHA:</strong> <span class="copiable">ALC#FGU</span></p>
                </div>
                <div class="card">
                    <h4>NBEL</h4>
                    <p><strong>Endereço:</strong> <span class="copiable">IP/login.cgi</span></p>
                    <hr>
                    <p><strong>LOGIN:</strong> <span class="copiable">atiinternet</span></p>
                    <p><strong>SENHA:</strong> <span class="copiable">@dminati2001</span></p>
                    <hr>
                    <h4>Alternativa</h4>
                    <p><strong>LOGIN:</strong> <span class="copiable">telecomadmin</span></p>
                    <p><strong>SENHA:</strong> <span class="copiable">admintelecom</span></p>
                </div>
                <div class="card">
                    <h4>HUAWEI E TP LINK</h4>
                    <p><strong>IP HUAWEI:</strong> <span class="copiable">192.168.3.1</span></p><br>
                    <p><strong>IP TP LINK:</strong> <span class="copiable">192.168.0.1</span></p>
                    <hr>
                    <p><strong>SENHA:</strong> <span class="copiable">atiadmin258963</span></p>
                    <hr>
                    <h4>Alternativa</h4>
                    <p><strong>SENHA:</strong> <span class="copiable">ATIADMIN258963</span></p>
                </div>
                <div class="card">
                    <h4>Ura</h4>
                    <p>
                    <h4><a href="http://201.158.20.39:8022/login" style="color: var(--heading-color);" target="_blank" rel="noopener noreferrer">Acessar o Sistema</a></h4>
                    </p>
                    <hr>
                    <p><strong>Login:</strong> <span class="copiable">christian</span></p>
                    <p><strong>senha:</strong> <span class="copiable">@Ati26422001!10547580770</span></p>
                </div>
                <div class="card">
                    <h4>Sites importantes</h4>
                    <h4><a href="https://painel.autentique.com.br/documentos/todos" style="color: var(--heading-color);" target="_blank" rel="noopener noreferrer">Autentique</a></h4>
                    <h4><a href="http://201.158.20.46:3000/" style="color: var(--heading-color);" target="_blank" rel="noopener noreferrer">ACS</a></h4>
                    <h4><a href="https://atiinternet.cademi.com.br/area/vitrine" style="color: var(--heading-color);" target="_blank" rel="noopener noreferrer">Curso</a></h4>
                    <h4><a href="http://201.158.20.35:8000/" style="color: var(--heading-color);" target="_blank" rel="noopener noreferrer">SGP interno</a></h4>
                    <h4><a href="https://sgp.atiinternet.com.br/admin/" style="color: var(--heading-color);" target="_blank" rel="noopener noreferrer">SGP externo</a></h4>
                </div>
            </div>
        </div>
                    <div id="customizationPopup" class="customization-popup" style="display: none;">
        <h2>Personalizar Cores</h2>
        <div class="customization-grid">
            <div class="popup-column">
                <label class="popup-label">
                    <span>Modo Escuro</span>
                    <label class="switch"><input type="checkbox" id="themeToggle"><span class="slider"></span></label>
                </label>
                <label class="popup-label">
                    <span>Ativar Bordas Neon</span>
                    <label class="switch"><input type="checkbox" id="neonBorders"><span class="slider"></span></label>
                </label>
            </div>
            <div class="popup-column">
                <label class="popup-label">
                    <span>Cor dos Ícones</span>
                    <input type="color" id="iconColor">
                </label>
                <label class="popup-label">
                    <span>Cor das Bordas e Botões</span>
                    <input type="color" id="borderColor">
                </label>
                <label class="popup-label">
                    <span>Cor dos Títulos</span>
                    <input type="color" id="textColor">
                </label>
            </div>
        </div>
        <div class="customization-buttons">
            <button class="button" id="saveCustomizationBtn">Salvar</button>
            <button class="button back" id="closeCustomizationBtn">Cancelar</button>
        </div>
    </div>
                    <div id="profileModal" class="modal-overlay" style="display: none;">
        <div class="modal-content card">
            <h3>Perfil do Usuário</h3>
          
            <form id="update-fullname-form">
                <div class="modal-form-group">
                    <label for="newFullName">Alterar Nome Completo:</label>
                    <input type="text" id="newFullName" placeholder="Seu nome e sobrenome">
                </div>
                <button type="submit" class="button">Salvar Nome</button>
            </form>
            <hr style="margin: 20px 0;">
          
            <form id="update-password-form">
                <div class="modal-form-group">
                    <label for="newPassword">Alterar Senha:</label>
                    <input type="password" id="newPassword" placeholder="Nova senha (mín. 6 caracteres)" autocomplete="new-password">
                </div>
                <button type="submit" class="button">Salvar Nova Senha</button>
            </form>
            <hr style="margin: 20px 0;">
                    <div id="admin-link-container" style="display: none;">
                <a href="admin.html" class="button">Painel do Administrador</a>
            </div>
            <div class="modal-buttons" style="margin-top: 20px;">
                <button id="modalLogoutBtn" class="button back">Sair (Logout)</button>
                <button id="modalCloseProfileBtn" class="button back">Fechar</button>
            </div>
        </div>
    </div>
                    <div id="confirmationModal" class="modal-overlay" style="display: none;">
        <div class="modal-content card">
            <h3 id="modalTitle">Confirmar Ação</h3>
            <p id="modalMessage">Você tem certeza que deseja continuar?</p>
            <div class="modal-buttons">
                <button id="modalConfirmBtn" class="button">Confirmar</button>
                <button id="modalCancelBtn" class="button back">Cancelar</button>
            </div>
        </div>
    </div>
                    <div id="addResponseModal" class="modal-overlay" style="display: none;">
        <div class="modal-content card">
            <h3>Adicionar Nova Resposta</h3>
            <div class="modal-form-group">
                <label for="newResponseTitle">Título da Resposta:</label>
                <input type="text" id="newResponseTitle" placeholder="Ex: Problema de conexão">
            </div>
            <div class="modal-form-group">
                <label for="newResponseCategory">Categoria:</label>
                <input type="text" id="newResponseCategory" placeholder="Ex: suporte (ou deixe em branco para 'geral')">
            </div>
            <div class="modal-buttons">
                <button id="modalSaveNewBtn" class="button">Salvar</button>
                <button id="modalCancelNewBtn" class="button back">Cancelar</button>
            </div>
        </div>
    </div>
   
    <script type="module" src="assets/js/app.js"></script>

</body>

</html>

// --- merge.js ---

const fs = require('fs');
const path = require('path');

// Configuração dos merges
const merges = [
  {
    nome: 'merge_site.txt',
    pastas: [
      '.',         // raiz: index.html, README.md, etc
      'docs',
      'assets/css',
      'assets/js'
    ],
    ignorar: ['merge_site.txt', 'merge_extensao.txt', '.git']
  },
  {
    nome: 'merge_extensao.txt',
    pastas: [
      'Extensão ATI'   // substitua pelo caminho da pasta da extensão
    ],
    ignorar: []
  }
];

// Função para ler arquivos recursivamente
function lerArquivosRecursivo(pasta, ignorar) {
  let arquivosTodos = [];
  const itens = fs.readdirSync(pasta);

  itens.forEach(item => {
    if (ignorar.includes(item)) return;

    const itemPath = path.join(pasta, item);
    const stats = fs.statSync(itemPath);

    if (stats.isDirectory()) {
      arquivosTodos = arquivosTodos.concat(lerArquivosRecursivo(itemPath, ignorar));
    } else {
      arquivosTodos.push(itemPath);
    }
  });

  return arquivosTodos;
}

// Gerar merges
merges.forEach(merge => {
  let conteudoFinal = '';

  merge.pastas.forEach(pasta => {
    if (!fs.existsSync(pasta)) return;

    const arquivos = lerArquivosRecursivo(pasta, merge.ignorar);

    arquivos.forEach(filePath => {
      const fileConteudo = fs.readFileSync(filePath, 'utf-8');
      const relativePath = path.relative('.', filePath);

      conteudoFinal += `\n\n// --- ${relativePath} ---\n\n`;
      conteudoFinal += fileConteudo;
    });
  });

  fs.writeFileSync(merge.nome, conteudoFinal);
  console.log(`Merge concluído: ${merge.nome}`);
});


// --- README.md ---

# ATI - Auxiliar de Atendimentos 🤖

[![Deploy static content to Pages](https://github.com/Vituali/ATI/actions/workflows/pages/pages-build-deployment/badge.svg)](https://github.com/Vituali/ATI/actions/workflows/pages/pages-build-deployment)
![Licença](https://img.shields.io/badge/licen%C3%A7a-MIT-blue.svg)
![Versão](https://img.shields.io/badge/vers%C3%A3o-3.0.0-brightgreen)

Um sistema de produtividade multiusuário para equipas de atendimento, focado em agilizar a comunicação e automatizar tarefas repetitivas. O ATI combina um gerenciador de respostas rápidas com um conversor inteligente de aditivos contratuais em PDF, tudo com contas de usuário individuais e um painel de administração.

### ✨ [Acesse a versão ao vivo aqui!](https://vituali.github.io/ATI/)

---

## 🚀 Funcionalidades Principais

O ATI é dividido em duas ferramentas principais, com uma interface totalmente personalizável e um sistema de autenticação completo.

* **🔐 Sistema de Autenticação e Gerenciamento:**
    * **Contas Individuais:** Sistema completo de Registro e Login para cada atendente.
    * **Login Flexível:** Permite o login tanto com **nome de usuário** quanto com **e-mail**.
    * **Gerenciamento de Perfil:** Usuários podem alterar o próprio nome completo e senha.
    * **Painel de Administração:** Uma área restrita para administradores gerenciarem outros usuários, alterando suas permissões (role) e status (ativo/inativo).
    * **Segurança Robusta:** Regras de segurança no Firebase impedem o acesso não autorizado e a sobrescrita de nomes de usuário.

* **💬 Chat Automatizado:**
    * Crie, edite e apague respostas padrão salvas na sua conta.
    * **Modelo para Novos Usuários:** Novos registros começam com um conjunto de respostas-padrão para facilitar a integração.
    * Organize as respostas em categorias customizáveis.
    * Reordene tanto as categorias quanto as respostas com um sistema de **Arrastar e Soltar (Drag and Drop)**.
    * Use marcadores dinâmicos como `[SAUDACAO]` e `[DESPEDIDA]` que se ajustam ao horário.

* **📄 Conversor de Aditivos:**
    * Faça o upload de um aditivo contratual em PDF.
    * O sistema extrai automaticamente: Número do Contrato, Nome do Cliente e Endereços.
    * Preencha informações adicionais num formulário inteligente.
    * Gere uma Ordem de Serviço (O.S.) completa e formatada com um clique.

* **🎨 Interface Personalizável:**
    * Alterne entre **Modo Claro** e **Modo Escuro**.
    * Ative/desative o efeito de **Bordas Neon**.
    * Escolha cores personalizadas para ícones, bordas e títulos.
    * As preferências são salvas no navegador e persistem entre as sessões.

## 🛠️ Tecnologias Utilizadas

Este projeto foi construído com tecnologias web puras para garantir leveza e performance.

* **Frontend:** HTML5, CSS3 (com Variáveis CSS), JavaScript (ES6 Modules)
* **Autenticação e Banco de Dados:** Firebase Authentication e Firebase Realtime Database
* **Bibliotecas:**
    * [SortableJS](https://github.com/SortableJS/Sortable): Para a funcionalidade de Arrastar e Soltar.
    * [PDF.js](https://mozilla.github.io/pdf.js/): Para a leitura e extração de texto de arquivos PDF.
* **Hospedagem e CI/CD:** GitHub Pages com GitHub Actions para deploy automático.

## ⚙️ Como Rodar o Projeto Localmente

1.  **Clone o repositório:**
    ```bash
    git clone [https://github.com/vituali/ATI.git](https://github.com/vituali/ATI.git)
    ```
2.  **Navegue até a pasta do projeto:**
    ```bash
    cd ATI
    ```
3.  **Inicie um servidor local:**
    Como o projeto usa Módulos JavaScript (ESM), ele precisa ser servido por um servidor web. A forma mais fácil é usando `http-server`.
    * Se não tiver o `http-server`, instale globalmente com o Node.js:
        ```bash
        npm install -g http-server
        ```
    * Inicie o servidor na pasta do projeto:
        ```bash
        http-server
        ```
    * Abra o endereço fornecido (geralmente `http://localhost:8080`) no seu navegador.

## 🗂️ Estrutura de Ramificação (Branching Strategy)

* **`main`**: Branch de produção. Contém apenas o código estável que está no ar.
* **`develop`**: Branch principal de desenvolvimento. Todas as novas funcionalidades são mescladas aqui.
* **`feature/*`**: Branches para novas funcionalidades ou correções.

## 📄 Licença

Este projeto está sob a licença MIT. Veja o arquivo `LICENSE` para mais detalhes.

---

*Desenvolvido por [Vituali](https://github.com/vituali).*


// --- docs\Brainstorm.txt ---

1. criar um sistema para automatizar o processo do sgp (em andamento. metade feito)
2. arrumar a parte da extensão que ao entrar e fazer o aditivo se clickar fora da pagina ele recarrega a pagina e perde os dados.
3. criar um sistema para justificativa de ponto e etc automatico baseado no nome.
4. criar melhorar o readme.md
5. criar um sistema de sugestão de texto baseado na leitura do chat.
6. melhorar o sistema de criador de o.s permitindo escolher datas e extrair melhor os dados do cliente. (requer vinculo com o sgp).


//futuro//
1. transformar o html em react para melhor dinamica.
2. transformar o banco de dados no firebase para dockerfile.
3. revisar o codigo para comentar melhor para melhor localização.

// --- docs\manual.md ---

📖 Manual do Usuário - ATI
Bem-vindo ao ATI! 👋
Este manual vai te ajudar a usar todas as funcionalidades do sistema de forma eficiente.

🚀 Primeiros Passos: Registro e Login
O ATI agora funciona com contas individuais. Cada atendente precisa ter a sua.

1. Criando uma Conta (Registro)
Na tela inicial, clique no link "Registre-se".

Preencha todos os campos:

Nome de Usuário (Login): Um nome curto, em minúsculas e sem espaços (ex: victor). Este será seu login principal.

Nome e Sobrenome: Seu nome completo, que será exibido em outros locais (ex: Victor Henrique).

Email e Senha: Suas credenciais para acesso e recuperação.

Clique em "Registrar". O sistema irá criar sua conta e fazer o login automaticamente.

Ao se registrar, sua conta já virá com um conjunto de respostas-padrão para você começar a usar e editar!

2. Acessando sua Conta (Login)
Na tela inicial, preencha os campos:

Usuário ou E-mail: Você pode usar tanto o seu nome de usuário (victor) quanto o seu e-mail para entrar.

Senha: Sua senha de acesso.

Clique em "Entrar".

👤 Gerenciando seu Perfil
Você pode alterar seus dados pessoais a qualquer momento.

Clique no botão com o ícone de perfil 👤 e seu nome de usuário na barra lateral.

Um menu irá aparecer. Nele, você pode:

Alterar Nome Completo: Digite seu novo nome e clique em "Salvar Nome".

Alterar Senha: Digite e confirme sua nova senha e clique em "Salvar Nova Senha".

Sair (Logout): Desconecta sua conta do sistema.

💬 Usando o Chat Automatizado
Após o login, suas respostas personalizadas são carregadas.

Enviando Mensagens Rápidas
Escolha a Mensagem na lista organizada por categoria.

Personalize se Necessário: Edite o texto na caixa de mensagem.

Use os Marcadores: [SAUDACAO] e [DESPEDIDA] para saudações que se ajustam ao horário.

Copie e Cole: Clique em 📋 Copiar e cole no seu sistema de atendimento.

Gerenciando Mensagens
➕ Adicionar: Cria uma nova resposta com um texto padrão para você editar.

✏️ Editar: Selecione uma mensagem, modifique o texto e clique em 💾 Salvar.

🗑️ Apagar: Exclui permanentemente a mensagem selecionada (após confirmação).

⇅ Arrastar e Soltar: Clique e segure no título de uma categoria ou de uma resposta para reordená-las.

👑 Painel de Administração (Para Admins)
Se sua conta tiver permissão de administrador, você terá acesso a uma área de gerenciamento.

Acessando o Painel
Abra o seu menu de perfil (clicando no botão 👤).

Clique no botão "Painel do Administrador".

Gerenciando Usuários
No painel, você verá uma lista de todos os usuários e poderá:

Alterar Permissão: Mudar um usuário de "Usuário" para "Admin" (e vice-versa).

Alterar Status: Desativar uma conta para bloquear o acesso do usuário sem apagar seus dados, ou Ativar uma conta previamente desativada.

Verificação de Usuários Órfãos
Esta ferramenta ajuda a manter o sistema limpo, encontrando contas que existem na Autenticação do Firebase mas não no banco de dados.

No painel, clique em "Passo 1: Carregar Usuários Válidos".

Abra o painel do Firebase Authentication, selecione (Ctrl+A) e copie (Ctrl+C) a lista de usuários.

Cole (Ctrl+V) na área de texto da ferramenta.

Clique em "Passo 3: Encontrar Contas Órfãs". O sistema mostrará uma lista de e-mails que podem ser removidos com segurança diretamente no Firebase.

📄 Usando o Conversor de Aditivos
O processo continua o mesmo:

Upload: Vá para a seção 📄 Conversor, escolha o arquivo PDF e clique em "Carregar e Extrair Dados".

Verificação e Configuração: Confira os dados extraídos e preencha o restante do formulário.

Geração: Clique em "Gerar O.S" e use os botões de cópia.

🎨 Personalizando a Interface
Clique no botão ⚙️ Personalizar na barra lateral.

Ajuste o Modo Escuro, Bordas Neon e as Cores.

Clique em 💾 Salvar para manter suas preferências.

🎯 Sucesso nos seus atendimentos com o ATI! 🚀

// --- docs\project.txt ---

projeto/
├── index.html
├── _config.yml
├── .gitignore
├── README.md
├── assets/
│   ├── css/
│   │   ├── main.css          # @imports e configurações base
│   │   ├── layout.css        # Sidebar, content, grid
│   │   ├── components.css    # Buttons, forms, cards, popups
│   │   └── themes.css        # Light/dark/neon themes
│   ├── js/
│   │   ├── app.js
│   │   ├── chat.js
│   │   ├── conversor.js
│   │   ├── firebase.js
│   │   ├── theme.js
│   │   └── ui.js
│   └── images/
│       └── favicon.ico
└── docs/
    └── manual.md

// --- assets\css\admin.css ---

/* ==========================================================================
   ADMIN.CSS - Estilos para o Painel de Administração
   ========================================================================== */

/* --- Layout Geral da Página de Admin --- */
/* Ajusta o contêiner principal para empilhar os cards verticalmente */
.content {
    flex-direction: column; /* Empilha os cards */
    align-items: center;    /* Centraliza os cards horizontalmente */
    gap: 20px; /* Espaço entre os cards */
}

/* Garante que o conteúdo principal não fique muito largo em telas grandes */
#mainContent {
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 100%;
    max-width: 900px; /* Limita a largura máxima */
}

/* --- Estilização dos Cards --- */
.card h2 {
    font-family: var(--font-primary);
    color: var(--heading-color);
    margin-bottom: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border-color);
}

.card p {
    margin-bottom: 20px;
    font-size: 14px;
    color: var(--text-primary);
    opacity: 0.8;
}

/* --- Tabela de Gerenciamento --- */
.admin-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

.admin-table th,
.admin-table td {
    border: 1px solid var(--border-color);
    padding: 12px;
    text-align: left;
    vertical-align: middle;
}

.admin-table th {
    background-color: rgba(0, 0, 0, 0.1);
    font-family: var(--font-primary);
    font-size: 14px;
}

.admin-table select {
    background-color: var(--input-bg);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    border-radius: 5px;
    padding: 8px;
    width: 100%;
    font-size: 14px;
}

.admin-table select:focus {
    outline: none;
    border-color: var(--icon-color);
}

.admin-table button {
    margin: 0;
    width: 100%;
    padding: 8px 12px;
}

/* --- Ferramenta de Verificação de Órfãos --- */
.checker-section textarea {
    background-color: var(--input-bg);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    border-radius: 5px;
    width: 100%;
    min-height: 150px;
    margin-top: 10px;
    padding: 10px;
    font-family: monospace;
}

.checker-section .instructions {
    margin-bottom: 15px;
}

.checker-section .instructions ol {
    line-height: 1.8;
    padding-left: 20px;
    font-size: 14px;
}

.checker-section .user-list {
    list-style: none;
    padding: 10px;
    margin-top: 10px;
    background-color: rgba(0,0,0,0.1);
    border-radius: 5px;
    max-height: 200px;
    overflow-y: auto;
}

.checker-section .orphan {
    color: var(--error-color, #F43F5E);
    font-weight: bold;
}

.checker-section .valid {
    color: var(--success-color, #22C55E);
}

/* --- Botão de Voltar --- */
#backToAppBtn {
    display: block;
    width: 100%;
    max-width: 900px;
    text-align: center;
    margin: 10px auto 0;
    padding: 12px 20px;
    background: var(--button-bg);
    color: var(--button-text);
    border-radius: 5px;
    text-decoration: none;
    font-family: var(--font-primary);
    transition: background 0.3s, transform 0.2s;
}

#backToAppBtn:hover {
    background: var(--button-hover-bg);
    transform: scale(1.02);
}

.hidden {
    display: none;
}


// --- assets\css\components.css ---

/* ==========================================================================
   COMPONENTS.CSS - Estilos para todos os elementos de UI reutilizáveis
   ========================================================================== */

/* --- Cards e Contêineres de Conteúdo --- */
.card,
.upload-card {
    position: relative;
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 20px;
    margin: 15px 0;
    max-width: 1200px;
    width: 100%;
    min-height: 200px;
    box-sizing: border-box;
}

.upload-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    width: 100%;
}

/* --- Botões da Barra Lateral --- */
.sidebar-button,
.toggle-sidebar,
.dark-mode-toggle {
    background: transparent;
    color: var(--icon-color);
    border: none;
    padding: 10px;
    cursor: pointer;
    font-size: 24px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    transition: color 0.3s, background 0.2s, transform 0.2s;
}

.sidebar-footer {
    margin-top: auto;
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.bottom-toggle {
    background: transparent;
    color: var(--icon-color);
    border: none;
    padding: 10px;
    cursor: pointer;
    font-size: 24px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    transition: color 0.3s, background 0.2s, transform 0.2s;
    width: 100%;
    border-radius: 5px;
}

.bottom-toggle .text {
    display: none;
    font-family: var(--font-primary);
    font-size: 16px;
    white-space: nowrap;
}

.bottom-toggle .text {
    display: none; /* Esconde o texto por padrão */
    white-space: nowrap;
}

.sidebar.expanded .bottom-toggle .text {
    display: inline-block;
}

.bottom-toggle:hover {
    background: rgba(0, 0, 0, 0.1);
    transform: scale(1.05);
}

.sidebar-button {
    font-family: var(--font-primary);
    font-size: 16px;
    border-radius: 5px;
}

.dark-mode-toggle {
    width: 100%;
}

.sidebar-button .icon {
    font-size: 20px;
}

.sidebar-button .text {
    display: none;
    white-space: nowrap;
}

.sidebar.expanded .sidebar-button .text {
    display: inline-block;
}

.sidebar-button:hover,
.toggle-sidebar:hover,
.dark-mode-toggle:hover {
    background: rgba(0, 0, 0, 0.1);
    transform: scale(1.05);
}

.sidebar-button.active {
    background: var(--icon-color); /* Cor customizável via JS */
    color: var(--button-text);
}

.sidebar-button.active .text {
    text-shadow: 0 0 5px rgba(0, 0, 0, 0.7);
}

/* --- Botões Principais --- */
.button,
.copy-btn,
.file-label {
    background: var(--button-bg);
    color: var(--button-text);
    border: none;
    padding: 8px 16px;
    border-radius: 5px;
    cursor: pointer;
    font-family: var(--font-primary);
    font-size: 14px;
    margin: 5px;
    text-align: center;
    flex: 1 1 10px;
    max-width: 150px;
    transition: background 0.3s, transform 0.2s;
}

.button:hover,
.copy-btn:hover,
.file-label:hover {
    background: var(--button-hover-bg);
    transform: scale(1.05);
}

/* Botão especial de voltar */
.button.back {
    background: #6B7280;
}
.button.back:hover {
    background: #4B5563;
}
.dark-mode .button.back {
    background: #4B5563;
}
.dark-mode .button.back:hover {
    background: #374151;
}

/* --- Elementos de Formulário --- */
input,
select,
textarea {
    width: 100%;
    padding: 8px;
    margin: 5px 0;
    border: 1px solid var(--border-color);
    background: var(--input-bg);
    color: var(--text-primary);
    border-radius: 5px;
    font-size: 14px;
    box-sizing: border-box;
    font-family: var(--font-secondary);
}

textarea {
    resize: vertical;
    min-height: 80px;
}

input:focus,
select:focus,
textarea:focus {
    outline: none;
    border-color: var(--icon-color); /* Destaca com a cor do ícone ao focar */
}

input[type="color"] {
    width: 40px;
    height: 40px;
    padding: 2px;
    vertical-align: middle;
    cursor: pointer;
}

.error {
    color: var(--error-color);
    font-size: 12px;
    margin-top: 5px;
    display: block;
}

.grupo {
    margin-bottom: 15px;
}

.grupo label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

.grupo p {
    margin: 5px 0;
}

/* --- Upload de Arquivo --- */
.file-upload-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}
.file-input {
    display: none;
}
.file-name {
    text-align: center;
}

/* --- Popups --- */
.popup {
    position: fixed;
    top: 20px;
    right: 20px;
    background: var(--button-bg);
    color: var(--button-text);
    padding: 10px 20px;
    border-radius: 5px;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 3000;
}
.popup.show {
    opacity: 1;
}

.customization-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--card-bg);
    padding: 20px;
    border-radius: 10px;
    z-index: 1000;
    max-width: 400px;
    width: 90%;
    border: 1px solid var(--border-color);
}
.customization-group {
    margin-bottom: 15px;
}
.customization-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}
.theme-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.customization-buttons {
    display: flex;
    gap: 10px;
    justify-content: space-between;
}

/* --- Switch Toggle --- */
.switch {
    position: relative;
    display: inline-block;
    width: 50px; /* Tamanho explícito para garantir consistência */
    height: 24px;
    margin-left: 10px;
    flex-shrink: 0; /* Impede que o switch encolha */
}
.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}
.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--switch-bg);
    transition: background 0.3s;
    border-radius: 24px;
}
.slider:before {
    position: absolute;
    content: "";
    height: 18px; /* Tamanho explícito da bolinha */
    width: 18px;
    left: 3px;   /* Posição inicial da bolinha */
    bottom: 3px;
    background: white;
    transition: transform 0.3s;
    border-radius: 50%;
}
input:checked + .slider {
    background: var(--switch-bg-checked);
}
input:checked + .slider:before {
    transform: translateX(26px); /* Distância que a bolinha se move */
}

/* --- Checkbox Customizado --- */
.checkbox-group {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    margin: 10px 0;
}
.checkbox-label {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
}
.checkbox-custom {
    width: 18px;
    height: 18px;
    border: 2px solid var(--border-color);
    border-radius: 4px;
    display: inline-block;
    position: relative;
    transition: background 0.3s, border-color 0.3s;
}
.checkbox-label input {
    display: none;
}
.checkbox-label input:checked + .checkbox-custom {
    background: var(--button-bg);
    border: var(--button-bg);
}
.checkbox-custom::after {
    content: '✔';
    color: var(--button-text);
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    font-size: 12px;
    transition: transform 0.2s;
}
.checkbox-label input:checked + .checkbox-custom::after {
    transform: translate(-50%, -50%) scale(1);
}

/* --- Contêineres de Elementos --- */
.controls,
.copy-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    margin-top: 10px;
}
.inline-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: space-between;
}
.inline-group > div {
    flex: 1;
    min-width: 150px;
}
.title-container {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-bottom: 10px;
}
.title-container input {
    flex: 1;
}

/* --- Output e Mensagens --- */
.output {
    margin-top: 20px;
    padding: 10px;
    border: 1px solid var(--border-color);
    background: var(--input-bg);
    border-radius: 5px;
    white-space: pre-wrap;
    width: 100%;
}
#renewalMessage,
#migrationMessage {
    margin-top: 10px;
    font-weight: bold;
}
#saudacaoDespedidaText {
    text-align: center;
    margin-top: 10px;
    font-size: 0.9em;
}

.customization-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.popup-column {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.popup-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: normal;
}

.customization-buttons {
    margin-top: 10px;
}

.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    backdrop-filter: blur(5px);
}

.modal-content {
    max-width: 400px;
    text-align: center;
}

.modal-buttons {
    display: flex;
    justify-content: space-around;
    margin-top: 20px;
}

/* --- Estilo dos Tooltips --- */
[data-tooltip] {
    position: relative;
}

/* Regra geral para tooltips (acima do elemento) */
[data-tooltip]::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: calc(100% + 5px);
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--icon-color);
    color: #ffffff;
    padding: 6px 12px;
    border-radius: 5px;
    font-size: 12px;
    font-family: var(--font-secondary);
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
    z-index: 101;
}

#atendenteToggleBtn[data-tooltip]::after,
#darkModeToggleBtn[data-tooltip]::after {
    bottom: auto;
    top: 50%;
    left: calc(100% + 10px);
    transform: translateY(-50%);
}

[data-tooltip]:hover::after {
    opacity: 1;
}

/* --- Estilo do Indicador de Carregamento --- */
.card-loader {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(42, 42, 42, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10;
    border-radius: 10px;
}

.light-mode .card-loader {
    background: rgba(255, 255, 255, 0.7);
}

.loader {
    width: 40px;
    height: 40px;
    border: 4px solid #555;
    border-top-color: var(--icon-color, #FFF);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* --- Estilos para o Seletor Customizado (Drag and Drop) --- */
.custom-select {
    position: relative;
    width: 100%;
}

.select-selected {
    background-color: var(--input-bg);
    color: var(--text-primary);
    padding: 12px 16px;
    font-size: 16px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    cursor: pointer;
    user-select: none;
    transition: all 0.2s;
}

.select-selected:hover {
    border-color: var(--icon-color);
}

.select-items {
    position: absolute;
    background-color: var(--input-bg);
    top: 100%;
    left: 0;
    right: 0;
    z-index: 99;
    border: 1px solid var(--border-color);
    border-top: none;
    border-radius: 0 0 5px 5px;
    max-height: 500px;
    overflow-y: auto;
}

.select-hide {
    display: none;
}

.select-items div, .select-items .optgroup-label {
    padding: 4px 16px;
    font-size: 13px;
    cursor: pointer;
    border-bottom: 1px solid var(--border-color);
    transition: background-color 0.2s;
}

.select-items .optgroup-label {
    font-weight: bold;
    color: var(--icon-color);
    cursor: default;
    background-color: rgba(0,0,0,0.1);
}

.select-items div:not(.optgroup-label) {
    padding-left: 25px;
    cursor: grab;
}

.select-items div:hover:not(.optgroup-label) {
    background-color: rgba(0,0,0,0.2);
}

.sortable-ghost {
    opacity: 0.4;
    background-color: var(--icon-color) !important;
}

/* --- Estilos para o Formulário do Modal --- */
.modal-form-group {
    text-align: left;
    margin-bottom: 15px;
}

.modal-form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    font-size: 14px;
}

.modal-form-group input {
    width: 100%;
}

.category-group {
    border-bottom: 2px solid var(--border-color);
}

.optgroup-label {
    cursor: move !important;
}

.option-item {
    padding-left: 25px;
    cursor: grab;
}

.option-item:hover {
    background-color: rgba(0,0,0,0.2);
}

/* --- Estilos para Autenticação --- */
.auth-toggle-link {
    margin-top: 20px;
    font-size: 14px;
}
.auth-toggle-link a {
    color: var(--icon-color);
    text-decoration: underline;
    cursor: pointer;
}

.user-menu {
    position: absolute;
    bottom: 110px;
    left: 15px;
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    z-index: 101;
    width: 180px;
    padding: 5px;
    transition: opacity 0.2s, transform 0.2s;
}

.user-menu a {
    display: block;
    padding: 10px 15px;
    color: var(--text-primary);
    text-decoration: none;
    font-family: var(--font-secondary);
    font-size: 14px;
    border-radius: 5px;
}

.user-menu a:hover {
    background-color: var(--button-bg);
    color: var(--button-text, #FFF);
}

.popup.success {
    background: var(--success-color);
    color: #FFFFFF;
    box-shadow: 0 0 15px 1px var(--success-color);
}

.popup.error {
    background: var(--error-color);
    color: #FFFFFF;
    box-shadow: 0 0 15px 1px var(--error-color);
}
/* ======================================= */
/* ESTILOS PARA O EDITOR DE MODELOS DE O.S. */
/* ======================================= */

.os-editor-layout {
    display: grid;
    grid-template-columns: 1fr 2fr; /* Coluna da lista com 1/3 e formulário com 2/3 */
    gap: 20px;
}

.os-list {
    max-height: 400px;
    overflow-y: auto;
}

.os-category-header {
    font-weight: bold;
    color: var(--heading-color);
    margin-top: 15px;
    margin-bottom: 8px;
    padding-bottom: 5px;
    border-bottom: 1px solid var(--border-color);
    font-size: 1.1em;
}
.os-category-header:first-child {
    margin-top: 0;
}

.os-list-item {
    padding: 10px;
    cursor: pointer;
    border-radius: 4px;
    transition: background-color 0.2s;
}

.os-list-item:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

.os-list-item.active {
    background-color: var(--button-bg);
    color: var(--button-text);
    font-weight: bold;
}
/*=============================================================================*/
/* == TEXTO COPIADOS = */
@font-face {
    font-family: Orbitron;
    font-style: normal;
    font-weight: 400;
    src: url(https://fonts.gstatic.com/s/orbitron/v31/yMJRMIlzdpvBhQQL_Qq7dy0.woff2) format('woff2')            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
.password-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
}
.password-grid .card hr {
    margin: 10px 0;
    border-color: rgba(128, 128, 128, 0.2);
}
.copiable {
    cursor: pointer;
    background-color: rgba(255, 255, 255, 0.08);
    padding: 2px 6px;
    border-radius: 4px;
    transition: background-color 0.2s;
    display: inline-block; /* Garante que o fundo se aplique corretamente */
}

.copiable:hover {
    background-color: rgba(255, 255, 255, 0.2);
}

.copiable:active {
    transform: translateY(1px); /* Efeito de clique */
}

// --- assets\css\layout.css ---

/* ==========================================================================
   LAYOUT.CSS - Estrutura principal, sidebar, grid
   ========================================================================== */

/* Contêiner principal */
.chatbox {
    display: flex;
    min-height: 100vh;
}

/* Barra lateral */
.sidebar {
    width: 60px;
    background: var(--sidebar-bg);
    border-right: 1px solid var(--border-color);
    padding: 20px 10px;
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    gap: 10px;
    transition: width 0.3s ease, background 0.3s;
    overflow: visible;
    z-index: 100;
}

.sidebar.expanded {
    width: 200px;
}

/* Conteúdo principal */
.content {
    margin-left: 80px;
    padding: 20px;
    flex: 1;
    transition: margin-left 0.3s ease;
    display: flex;
    justify-content: center;
}

.sidebar.expanded ~ .content {
    margin-left: 220px;
}

/* Grid de duas colunas */
.dual-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    width: 100%;
    align-items: start;
}

@media (max-width: 800px) {
    .dual-grid {
        grid-template-columns: 1fr;
    }
    .content {
        margin-left: 80px;
        padding: 10px;
    }
    .sidebar.expanded ~ .content {
        margin-left: 220px;
    }
}

// --- assets\css\main.css ---

/* ==========================================================================
   MAIN.CSS - Ponto de entrada principal
   ========================================================================== */

/* 1. Importa os módulos de estilo */
@import url('themes.css');
@import url('layout.css');
@import url('components.css');

/* 2. Regras Globais e Resets */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: var(--font-secondary);
    background: var(--bg-gradient);
    color: var(--text-primary);
    transition: background-color 0.3s, color 0.3s;
    min-height: 100vh;
}

h1, h2, h3, h4 {
    font-family: var(--font-primary);
    color: var(--heading-color);
    text-align: center;
    margin-bottom: 1rem;
}

// --- assets\css\themes.css ---

/* ==========================================================================
   THEMES.CSS - Variáveis de cores, fontes e temas
   ========================================================================== */

:root {
    /* Fontes */
    --font-primary: 'Orbitron', sans-serif;
    --text-primary: #1A3C5A;
    --font-secondary: Arial, sans-serif;
    --bg-gradient: linear-gradient(135deg, #E5F0F8 0%, #D1E0F0 100%);
    --card-bg: linear-gradient(135deg, #FFFFFF 0%, #F5F7FA 100%);
    --sidebar-bg: linear-gradient(180deg, #E5F0F8 0%, #D1E0F0 100%);
    --input-bg: #FFFFFF;
    --switch-bg: linear-gradient(180deg, #CCCCCC 0%, #AAAAAA 100%);
    --switch-bg-checked: linear-gradient(180deg, #FF416C 0%, #FF4B2B 100%);
}

.dark-mode {
    /* Cores do Tema Escuro */
    --bg-gradient: linear-gradient(135deg, #2A2A2A 0%, #1A1A1A 100%);
    --card-bg: linear-gradient(135deg, #2A2A2A 0%, #1A1A1A 100%);
    --sidebar-bg: linear-gradient(180deg, #2A2A2A 0%, #1A1A1A 100%);
    --text-primary: #D1D5DB;
    --input-bg: #2A2A2A;
    --switch-bg: linear-gradient(180deg, #555555 0%, #333333 100%); /* Gradiente cinza-escuro para 'desligado' */
    --switch-bg-checked: linear-gradient(180deg, #FF0000 0%, #B30000 100%); /* Gradiente vermelho-escuro para 'ligado' */
}

/* Efeito Neon (controlado pela classe .no-neon no body) */
.card, .upload-card, .customization-popup, .popup {
    box-shadow: 0 0 15px 1px var(--shadow-color), 0 4px 8px rgba(0,0,0,0.2);
}
.button, .copy-btn, .file-label {
    box-shadow: 0 0 10px 0px var(--shadow-color), 0 2px 4px rgba(0,0,0,0.2);
}
input:focus, select:focus, textarea:focus {
    box-shadow: 0 0 10px 2px var(--shadow-color);
}
.sidebar-button.active {
    box-shadow: 0 0 15px 2px var(--shadow-color);
}

/* Desativa o neon */
.no-neon .card,
.no-neon .upload-card,
.no-neon .customization-popup,
.no-neon .popup,
.no-neon .button,
.no-neon .copy-btn,
.no-neon .file-label,
.no-neon input:focus,
.no-neon select:focus,
.no-neon textarea:focus,
.no-neon .sidebar-button.active {
    box-shadow: none;
}

// --- assets\js\admin.js ---

import { initializeFirebase, checkAuthState, loadAtendentes, updateUserRole, updateUserStatus } from './firebase.js';
import { showPopup } from './ui.js';

document.addEventListener('DOMContentLoaded', () => {
    
    // --- SELETORES GERAIS ---
    const userListBody = document.getElementById('userListBody');
    const loader = document.getElementById('adminLoader');
    const mainContent = document.getElementById('mainContent');
    let loadedAtendentes = {}; // Armazena os atendentes carregados para reutilização

    initializeFirebase();

    // --- LÓGICA DE GERENCIAMENTO DE USUÁRIOS ---
    const populateUserTable = (allAtendentes, currentAdminUid) => {
        userListBody.innerHTML = '';
        Object.entries(allAtendentes).forEach(([username, data]) => {
            const row = document.createElement('tr');
            
            row.innerHTML = `
                <td>${username}</td>
                <td>${data.nomeCompleto || 'N/A'}</td>
                <td>
                    <select data-username="${username}" ${data.uid === currentAdminUid ? 'disabled' : ''}>
                        <option value="usuario" ${data.role === 'usuario' ? 'selected' : ''}>Usuário</option>
                        <option value="admin" ${data.role === 'admin' ? 'selected' : ''}>Admin</option>
                    </select>
                </td>
                <td>
                    <button class="${data.status === 'inativo' ? 'button' : 'button back'}" data-username="${username}" data-current-status="${data.status || 'ativo'}" ${data.uid === currentAdminUid ? 'disabled' : ''}>
                        ${data.status === 'inativo' ? 'Ativar' : 'Desativar'}
                    </button>
                </td>
            `;
            
            if (data.status === 'inativo') {
                row.style.opacity = '0.5';
            }
            userListBody.appendChild(row);
        });
    };

    // --- FLUXO PRINCIPAL E EVENTOS DE GERENCIAMENTO ---
    loader.style.display = 'flex';
    mainContent.style.display = 'none';

    checkAuthState(async (user) => {
        if (user) {
            loadedAtendentes = await loadAtendentes(); // Carrega e armazena os atendentes
            const adminKey = Object.keys(loadedAtendentes).find(key => loadedAtendentes[key].uid === user.uid);
            
            if (adminKey && loadedAtendentes[adminKey].role === 'admin') {
                populateUserTable(loadedAtendentes, user.uid);
                loader.style.display = 'none';
                mainContent.style.display = 'block';
            } else {
                alert("Acesso negado. Você não tem permissão para ver esta página.");
                window.location.href = 'index.html';
            }
        } else {
            alert("Você precisa estar logado para acessar esta página.");
            window.location.href = 'index.html';
        }
    });

    userListBody.addEventListener('click', async (e) => {
        if (e.target.tagName === 'BUTTON' && e.target.dataset.username) {
            const button = e.target;
            const username = button.dataset.username;
            const newStatus = button.dataset.currentStatus === 'ativo' ? 'inativo' : 'ativo';
            try {
                await updateUserStatus(username, newStatus);
                showPopup(`Usuário ${username} foi ${newStatus === 'ativo' ? 'ativado' : 'desativado'}.`, 'success');
                // Recarrega os dados para atualizar a UI de forma consistente
                loadedAtendentes = await loadAtendentes();
                const currentUser = auth.currentUser;
                populateUserTable(loadedAtendentes, currentUser.uid);
            } catch (error) {
                showPopup(`Erro ao atualizar status: ${error.message}`, 'error');
            }
        }
    });

    userListBody.addEventListener('change', async (e) => {
        if (e.target.tagName === 'SELECT') {
            const username = e.target.dataset.username;
            const newRole = e.target.value;
            try {
                await updateUserRole(username, newRole);
                showPopup(`Permissão de ${username} atualizada para ${newRole}.`, 'success');
            } catch (error) {
                showPopup(`Erro ao atualizar permissão: ${error.message}`, 'error');
            }
        }
    });


    // --- LÓGICA PARA O VERIFICADOR DE USUÁRIOS ÓRFÃOS ---
    const checkerStep1 = document.getElementById('checkerStep1');
    const checkerStep2 = document.getElementById('checkerStep2');
    const checkerResults = document.getElementById('checkerResults');
    const loadValidUsersBtn = document.getElementById('loadValidUsersBtn');
    const compareBtn = document.getElementById('compareBtn');
    const pasteArea = document.getElementById('authPasteArea');
    const orphanList = document.getElementById('orphanList');
    let validUIDs = new Set();

    loadValidUsersBtn.addEventListener('click', () => {
        // Reutiliza a lista de atendentes já carregada
        Object.values(loadedAtendentes).forEach(data => {
            if (data.uid) validUIDs.add(data.uid);
        });
        
        alert(`${validUIDs.size} usuários válidos encontrados no banco de dados.`);
        checkerStep1.classList.add('hidden');
        checkerStep2.classList.remove('hidden');
    });

    compareBtn.addEventListener('click', () => {
        const pastedText = pasteArea.value;
        if (!pastedText.trim()) return alert("Por favor, cole os dados do painel de autenticação.");

        const lineRegex = /([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})\s+([a-zA-Z0-9]{28})/g;
        let match;
        const orphans = [];

        while ((match = lineRegex.exec(pastedText)) !== null) {
            const email = match[1];
            const uid = match[2];
            if (!validUIDs.has(uid)) {
                orphans.push({ email, uid });
            }
        }

        orphanList.innerHTML = '';
        if (orphans.length > 0) {
            orphans.forEach(orphan => {
                const li = document.createElement('li');
                li.innerHTML = `<span class="orphan">[ÓRFÃ]</span> Email: ${orphan.email} | UID: ${orphan.uid}`;
                orphanList.appendChild(li);
});
        } else {
            orphanList.innerHTML = '<li><span class="valid">[OK] Nenhuma conta órfã encontrada!</span></li>';
        }
        checkerResults.classList.remove('hidden');
    });
});

// --- assets\js\app.js ---

import { initializeUI, showSection, updateGreeting, showPopup } from './ui.js';
import {
    initializeFirebase,
    loadDataForAttendant,
    loadAtendentes,
    loginUser,
    loginWithUsername,
    logoutUser,
    checkAuthState,
    createUserAccount,
    updateUserPassword,
    updateUserFullName
} from './firebase.js';
import { initializeTheme } from './theme.js';
import { initializeChat } from './chat.js';
import { osEditorModule, initializeOsEditor } from './os-editor.js';
import { initializeConversor } from './conversor.js';

document.addEventListener('DOMContentLoaded', async () => {
    // --- 1. INICIALIZAÇÃO E SELETORES ---
    initializeUI();
    initializeTheme();
    initializeOsEditor();
    initializeConversor();
    initializeFirebase();
    const chatModule = initializeChat();

    let currentUsername = null;

    // Seletores da interface
    const authOverlay = document.getElementById('auth-overlay');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const mainContent = document.querySelector('.chatbox');
    const sidebar = document.querySelector('.sidebar');
    const atendenteToggleBtn = document.getElementById('atendenteToggleBtn');
    const chatLoader = document.getElementById('chatLoader');
    const profileModal = document.getElementById('profileModal');
    const updateFullNameForm = document.getElementById('update-fullname-form');
    const updatePasswordForm = document.getElementById('update-password-form');
    const modalLogoutBtn = document.getElementById('modalLogoutBtn');
    const modalCloseProfileBtn = document.getElementById('modalCloseProfileBtn');
    const adminLinkContainer = document.getElementById('admin-link-container');
    const newFullNameInput = document.getElementById('newFullName');
    const profileUsernameSpan = document.getElementById('profileUsername');

    // --- 2. DEFINIÇÃO DAS FUNÇÕES PRINCIPAIS ---

    const startApp = async (user, allAtendentes) => {
        const attendantKey = Object.keys(allAtendentes).find(key => allAtendentes[key].uid === user.uid);
        
        if (!attendantKey) {
            showPopup("Não foi possível carregar os dados do seu perfil. Por favor, faça o login novamente.", 'error');
            await logoutUser();
            return;
        }

        currentUsername = attendantKey;
        authOverlay.style.display = 'none';
        mainContent.style.display = 'flex';
        sidebar.style.display = 'flex';
        
        const attendantData = allAtendentes[attendantKey];
        if (attendantData.status === 'inativo') {
            showPopup("Sua conta foi desativada.", 'error');
            await logoutUser();
            return;
        }

        if (atendenteToggleBtn) {
            const atendenteTextSpan = atendenteToggleBtn.querySelector('.text');
            if (atendenteTextSpan) atendenteTextSpan.textContent = attendantKey.charAt(0).toUpperCase() + attendantKey.slice(1);
        }
        localStorage.setItem("atendenteAtual", attendantKey);
        
        if (newFullNameInput) newFullNameInput.value = attendantData.nomeCompleto;
        if (profileUsernameSpan) profileUsernameSpan.textContent = attendantKey;
        if (adminLinkContainer) adminLinkContainer.style.display = attendantData.role === 'admin' ? 'block' : 'none';

        chatLoader.style.display = 'flex';
        try {
            // 1. Carrega TODOS os dados (respostas e O.S.)
            const data = await loadDataForAttendant(attendantKey);

            // 2. REMOVA A LINHA QUE CRIA a constante 'chatResponses'
            // const chatResponses = data.filter(item => item.category === 'quick_reply'); // <-- APAGUE ESTA LINHA

            // 3. Passe a lista COMPLETA 'data' para ambos os módulos
            chatModule.setResponses(data); // <-- ALTERE DE VOLTA PARA 'data'
            osEditorModule.setTemplates(data, attendantKey);

        } catch (error) {
            console.error("Erro ao carregar dados do chat:", error);
            showPopup("Não foi possível carregar suas respostas.", "error");
        } finally {
            chatLoader.style.display = 'none';
        }

        updateGreeting(attendantKey);
        setInterval(() => updateGreeting(currentUsername), 60000);
    };

    const showLoginScreen = () => {
        mainContent.style.display = 'none';
        sidebar.style.display = 'none';
        authOverlay.style.display = 'flex';
        currentUsername = null;
    };

    // --- 3. FLUXO DE EXECUÇÃO PRINCIPAL ---
    try {
        checkAuthState(async (user) => {
            if (user) {
                const allAtendentes = await loadAtendentes();
                await startApp(user, allAtendentes);
            } else {
                showLoginScreen();
            }
        });
    } catch (error) {
        console.error("Erro fatal na inicialização:", error);
        showPopup("Não foi possível iniciar a aplicação.", "error");
        showLoginScreen();
    }

    // --- 4. EVENT LISTENERS DA INTERFACE ---
    if (atendenteToggleBtn) atendenteToggleBtn.addEventListener('click', () => { profileModal.style.display = 'flex'; });
    if (modalCloseProfileBtn) modalCloseProfileBtn.addEventListener('click', () => { profileModal.style.display = 'none'; });
    if (modalLogoutBtn) modalLogoutBtn.addEventListener('click', async () => { try { await logoutUser(); profileModal.style.display = 'none'; } catch (error) { showPopup("Erro ao fazer logout: " + error.message, 'error'); } });

    if (updateFullNameForm) {
        updateFullNameForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const newFullName = newFullNameInput.value;
            if (!newFullName.trim()) return showPopup("O nome não pode estar em branco.", 'error');
            if (!currentUsername) return showPopup("Erro: Usuário não identificado.", 'error');
            try {
                await updateUserFullName(currentUsername, newFullName);
                showPopup("Nome alterado com sucesso!", 'success');
                profileModal.style.display = 'none';
            } catch (error) {
                showPopup("Erro ao alterar o nome: " + error.message, 'error');
            }
        });
    }

    if (updatePasswordForm) {
        updatePasswordForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const newPassword = document.getElementById('newPassword').value;
            if (newPassword.length < 6) return showPopup("A nova senha deve ter pelo menos 6 caracteres.", 'error');
            try {
                await updateUserPassword(newPassword);
                showPopup("Senha alterada com sucesso!", 'success');
                document.getElementById('newPassword').value = '';
                profileModal.style.display = 'none';
            } catch (error) {
                showPopup("Erro ao alterar senha: " + error.message, 'error');
            }
        });
    }

    if(loginForm) {
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const identifier = document.getElementById('loginIdentifier').value;
            const password = document.getElementById('loginPassword').value;
            try {
                if (identifier.includes('@')) {
                    await loginUser(identifier, password);
                } else {
                    await loginWithUsername(identifier, password);
                }
            } catch (error) {
                let friendlyMessage = "Ocorreu um erro.";
                if (error.code === 'auth/invalid-login-credentials') {
                    friendlyMessage = "Usuário, e-mail ou senha incorretos.";
                }
                showPopup(friendlyMessage, 'error');
            }
        });
    }
    if (registerForm) {
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const userDetails = {
                username: document.getElementById('registerUsername').value,
                fullName: document.getElementById('registerFullName').value,
                email: document.getElementById('registerEmail').value,
                password: document.getElementById('registerPassword').value,
            };
            if (!userDetails.username || !userDetails.fullName) return showPopup("Todos os campos são obrigatórios.", 'error');
            
            try {
                // CORREÇÃO DO FLUXO PÓS-REGISTRO
                const { userCredential, sanitizedUsername, newAtendenteData } = await createUserAccount(userDetails);
                
                // Em vez de esperar o listener, iniciamos o app manualmente com os dados que acabamos de criar.
                // Isso evita a "tela presa" e a "condição de corrida".
                const allAtendentes = await loadAtendentes();
                allAtendentes[sanitizedUsername] = newAtendenteData;
                await startApp(userCredential.user, allAtendentes);
                
            } catch (error) {
                let friendlyMessage = "Ocorreu um erro desconhecido.";
                if (error.code === 'auth/email-already-in-use') friendlyMessage = "Este e-mail já está cadastrado.";
                else if (error.code === 'auth/weak-password') friendlyMessage = "A senha é muito fraca.";
                else if (error.message.includes('Este nome de usuário já pode estar em uso')) friendlyMessage = "Este nome de usuário já está em uso.";
                
                showPopup("Erro no registro: " + friendlyMessage, 'error');
            }
        });
    }

    document.querySelectorAll('.sidebar-button[data-section]').forEach(button => {
        button.addEventListener('click', () => {
            showSection(button.dataset.section, currentUsername); 
        });
    });
    const showRegisterBtn = document.getElementById('show-register');
    if (showRegisterBtn) showRegisterBtn.addEventListener('click', (e) => { e.preventDefault(); loginForm.style.display = 'none'; registerForm.style.display = 'block'; });
    const showLoginBtn = document.getElementById('show-login');
    if (showLoginBtn) showLoginBtn.addEventListener('click', (e) => { e.preventDefault(); registerForm.style.display = 'none'; loginForm.style.display = 'block'; });

    document.addEventListener('click', (e) => {
        if (profileModal && atendenteToggleBtn && !atendenteToggleBtn.contains(e.target) && !profileModal.contains(e.target)) {
            profileModal.style.display = 'none';
        }
    });
        document.addEventListener('click', (e) => {
        // Verifica se o elemento clicado (ou um parente próximo) tem a classe 'copiable'
        const copiableElement = e.target.closest('.copiable');
        if (copiableElement) {
            navigator.clipboard.writeText(copiableElement.textContent).then(() => {
                showPopup(`'${copiableElement.textContent}' copiado!`, 'success');
            }).catch(err => {
                console.error('Erro ao copiar:', err);
                showPopup('Não foi possível copiar.', 'error');
            });
        }
    });
});


// --- assets\js\bridge.js ---

// bridge.js

console.log("ATI Extensão [Ponte]: Script da ponte carregado no site-painel.");

// A cada 2 segundos, esta função verifica se o usuário fez login no site
setInterval(() => {
    // Lê o 'atendenteAtual' que o app.js do site salvou no localStorage
    const attendantKey = localStorage.getItem('atendenteAtual');

    if (attendantKey) {
        // Verifica no armazenamento da extensão se o valor já é o mesmo
        chrome.storage.local.get('atendenteAtual', (data) => {
            if (data.atendenteAtual !== attendantKey) {
                // Se for diferente (ou não existir), salva o novo valor
                chrome.storage.local.set({ atendenteAtual: attendantKey }, () => {
                    console.log(`[Ponte] Atendente '${attendantKey}' foi salvo para a extensão.`);
                });
            }
        });
    }
}, 2000);

// --- assets\js\chat.js ---

import { showPopup, adjustTextareaHeight, replacePlaceholders } from './ui.js';
import { saveDataForAttendant } from './firebase.js';

export function initializeChat() {
    // 'respostas' agora guardará a lista COMPLETA (quick replies + modelos de o.s.)
    let respostas = [];
    let currentSelection = { value: "", text: "Selecione uma resposta" };
    let sortableInstances = [];

    const elements = {
        selectDisplay: document.getElementById('select-display'),
        selectItems: document.getElementById('select-items'),
        response: document.getElementById('resposta'),
        title: document.getElementById('titulo'),
        titleContainer: document.getElementById('titleContainer'),
        copyBtn: document.getElementById('copyBtn'),
        editTitleBtn: document.getElementById('editTitleBtn'),
        saveEditBtn: document.getElementById('saveEditBtn'),
        deleteBtn: document.getElementById('deleteBtn'),
        addBtn: document.getElementById('addBtn'),
        saveTitleBtn: document.getElementById('saveTitleBtn'),
    };

    const getCurrentAttendant = () => localStorage.getItem('atendenteAtual');

    const updateResponseSelector = () => {
        elements.selectItems.innerHTML = '';

        // ## CORREÇÃO DE EXIBIÇÃO ##
        // Filtra a lista completa para pegar apenas os quick_replies para mostrar no chat
        const quickReplies = respostas.filter(r => r.category === 'quick_reply');

        if (quickReplies.length === 0) {
            elements.selectDisplay.textContent = 'Nenhuma resposta encontrada';
            return;
        }

        // Agrupa por categoria apenas os quick_replies
        const groupedByCategory = quickReplies.reduce((acc, template) => {
            const category = template.subCategory || 'Geral';
            if (!acc[category]) {
                acc[category] = [];
            }
            acc[category].push(template);
            return acc;
        }, {});

        sortableInstances.forEach(sortable => sortable.destroy());
        sortableInstances = [];

        for (const categoryName in groupedByCategory) {
            const categoryGroup = document.createElement("div");
            categoryGroup.className = 'category-group';
            const optgroup = document.createElement("div");
            optgroup.className = 'optgroup-label';
            optgroup.textContent = categoryName.charAt(0).toUpperCase() + categoryName.slice(1);
            categoryGroup.appendChild(optgroup);
            const optionsContainer = document.createElement("div");
            optionsContainer.className = 'options-container';
            optionsContainer.dataset.categoryName = categoryName;

            groupedByCategory[categoryName].forEach(template => {
                const opt = document.createElement("div");
                opt.className = 'option-item';
                opt.textContent = template.title;
                // IMPORTANTE: o data-value continua sendo o índice do item na lista COMPLETA ('respostas')
                opt.dataset.value = respostas.indexOf(template);
                opt.addEventListener('click', () => {
                    currentSelection = { value: opt.dataset.value, text: opt.textContent };
                    elements.selectDisplay.textContent = opt.textContent;
                    elements.selectItems.classList.add('select-hide');
                    displaySelectedResponse();
                });
                optionsContainer.appendChild(opt);
            });
            categoryGroup.appendChild(optionsContainer);
            elements.selectItems.appendChild(categoryGroup);
        }

        // Inicializa o Sortable para os itens dentro de cada categoria
        elements.selectItems.querySelectorAll('.options-container').forEach(container => {
            const sortable = Sortable.create(container, {
                group: 'shared-options',
                animation: 150,
                ghostClass: 'sortable-ghost',
                onEnd: (evt) => {
                    const itemEl = evt.item;
                    const originalIndex = parseInt(itemEl.dataset.value, 10);
                    const newCategoryName = evt.to.dataset.categoryName;
                    if (respostas[originalIndex] && newCategoryName) {
                        respostas[originalIndex].subCategory = newCategoryName;
                    }
                    saveOrderAndCategories();
                },
            });
            sortableInstances.push(sortable);
        });

        // Inicializa o Sortable para reordenar as categorias inteiras
        Sortable.create(elements.selectItems, {
            handle: '.optgroup-label',
            animation: 150,
            ghostClass: 'sortable-ghost',
            onEnd: () => saveOrderAndCategories(),
        });
    };

    // ## CORREÇÃO DE SALVAMENTO ##
    const saveOrderAndCategories = () => {
        const attendant = getCurrentAttendant();
        if (!attendant) return;

        // 1. Pega a nova ordem dos quick_replies a partir dos elementos visíveis no DOM
        const newOrderedQuickReplies = [];
        elements.selectItems.querySelectorAll('.option-item').forEach(item => {
            const originalIndex = parseInt(item.dataset.value, 10);
            if (respostas[originalIndex]) {
                newOrderedQuickReplies.push(respostas[originalIndex]);
            }
        });

        // 2. Pega todos os modelos de O.S. que não estão visíveis, para não perdê-los
        const osTemplates = respostas.filter(r => r.category !== 'quick_reply');

        // 3. Junta as duas listas: os quick_replies reordenados + os modelos de O.S. intactos
        const fullDataToSave = [...newOrderedQuickReplies, ...osTemplates];

        // 4. Atualiza o estado local e salva a lista COMPLETA no Firebase
        respostas = fullDataToSave;
        saveDataForAttendant(attendant, respostas).then(() => {
            updateResponseSelector();
            showPopup("Ordem e categoria salvas!", 'success');
        }).catch(error => {
            showPopup("Erro ao salvar as alterações.", 'error');
            console.error("Erro no Firebase:", error);
        });
    };

    const displaySelectedResponse = () => {
        const selectedIndex = currentSelection.value;
        if (selectedIndex === "") {
            elements.response.value = "Selecione uma opção para ver a mensagem.";
        } else {
            const template = respostas[parseInt(selectedIndex)];
            elements.response.value = template ? template.text : "Resposta não encontrada.";
        }
        adjustTextareaHeight(elements.response);
        elements.titleContainer.style.display = 'none';
    };

    const saveChanges = () => {
        const attendant = getCurrentAttendant();
        const selectedIndex = currentSelection.value;
        if (!attendant || selectedIndex === "") return showPopup("Selecione uma resposta para salvar.");
        respostas[parseInt(selectedIndex)].text = elements.response.value.trim();
        saveDataForAttendant(attendant, respostas);
        showPopup("Resposta salva com sucesso!", 'success');
    };

    const deleteResponse = () => {
        const attendant = getCurrentAttendant();
        const selectedIndex = currentSelection.value;
        if (!attendant || selectedIndex === "") return showPopup("Selecione uma resposta para apagar.");
        const modal = document.getElementById('confirmationModal');
        document.getElementById('modalTitle').textContent = 'Apagar Resposta';
        document.getElementById('modalMessage').textContent = 'Tem certeza que deseja apagar esta resposta permanentemente?';
        const confirmBtn = document.getElementById('modalConfirmBtn');
        const cancelBtn = document.getElementById('modalCancelBtn');
        modal.style.display = 'flex';
        const onConfirm = () => {
            respostas.splice(parseInt(selectedIndex), 1);
            saveDataForAttendant(attendant, respostas).then(() => {
                currentSelection = { value: "", text: "Selecione uma resposta" };
                updateResponseSelector();
                displaySelectedResponse();
                showPopup("Resposta apagada com sucesso!");
            });
            modal.style.display = 'none';
        };
        const onCancel = () => {
            confirmBtn.removeEventListener('click', onConfirm);
            cancelBtn.removeEventListener('click', onCancel);
            modal.style.display = 'none';
        };
        confirmBtn.addEventListener('click', onConfirm, { once: true });
        cancelBtn.addEventListener('click', onCancel, { once: true });
    };

    const addNewResponse = () => {
        const attendant = getCurrentAttendant();
        if (!attendant) return showPopup("Selecione um atendente primeiro.");
        const modal = document.getElementById('addResponseModal');
        const titleInput = document.getElementById('newResponseTitle');
        const categoryInput = document.getElementById('newResponseCategory');
        const saveBtn = document.getElementById('modalSaveNewBtn');
        const cancelBtn = document.getElementById('modalCancelNewBtn');
        titleInput.value = '';
        categoryInput.value = '';
        modal.style.display = 'flex';
        titleInput.focus();
        const onSave = () => {
            const title = titleInput.value.trim();
            if (!title) return showPopup("O título não pode estar em branco.");
            let categoryName = categoryInput.value.trim() || 'Geral';
            const newTemplate = {
                title: title,
                text: "Nova resposta. Edite aqui e clique em Salvar.",
                category: "quick_reply",
                subCategory: categoryName,
                keywords: []
            };
            respostas.push(newTemplate);
            saveDataForAttendant(attendant, respostas).then(() => {
                currentSelection = { value: (respostas.length - 1).toString(), text: title };
                updateResponseSelector();
                displaySelectedResponse();
                showPopup("Nova resposta adicionada!");
                modal.style.display = 'none';
            });
        };
        const onCancel = () => {
            saveBtn.removeEventListener('click', onSave);
            cancelBtn.removeEventListener('click', onCancel);
            modal.style.display = 'none';
        };
        saveBtn.addEventListener('click', onSave, { once: true });
        cancelBtn.addEventListener('click', onCancel, { once: true });
    };

    const editTitle = () => {
        const selectedIndex = currentSelection.value;
        if (selectedIndex === "") return showPopup("Selecione uma resposta para editar o título.");
        const template = respostas[parseInt(selectedIndex)];
        if (template) {
            elements.title.value = template.title;
            elements.titleContainer.style.display = 'flex';
            elements.title.focus();
        }
    };

    const saveNewTitle = () => {
        const attendant = getCurrentAttendant();
        const selectedIndex = currentSelection.value;
        if (selectedIndex === "" || !attendant) return;
        const newTitle = elements.title.value.trim();
        if (!newTitle) return showPopup("O título não pode estar em branco.");
        respostas[parseInt(selectedIndex)].title = newTitle;
        saveDataForAttendant(attendant, respostas).then(() => {
            currentSelection.text = newTitle;
            updateResponseSelector();
            displaySelectedResponse();
            showPopup("Título alterado com sucesso!");
        });
    };

    // --- Event Listeners ---
    elements.selectDisplay.addEventListener('click', () => elements.selectItems.classList.toggle('select-hide'));
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.custom-select')) elements.selectItems.classList.add('select-hide');
    });
    elements.response.addEventListener('input', () => adjustTextareaHeight(elements.response));
    elements.copyBtn.addEventListener('click', () => {
        const rawText = elements.response.value;
        const processedText = replacePlaceholders(rawText);
        navigator.clipboard.writeText(processedText).then(() => showPopup('Texto copiado!'));
    });
    elements.saveEditBtn.addEventListener('click', saveChanges);
    elements.addBtn.addEventListener('click', addNewResponse);
    elements.deleteBtn.addEventListener('click', deleteResponse);
    elements.editTitleBtn.addEventListener('click', editTitle);
    elements.saveTitleBtn.addEventListener('click', saveNewTitle);

    // --- API PÚBLICA DO MÓDULO ---
    return {
        setResponses: (data) => {
            respostas = Array.isArray(data) ? data : [];
            currentSelection = { value: "", text: "Selecione uma resposta" };
            updateResponseSelector();
            displaySelectedResponse();
        }
    };
}

// --- assets\js\conversor.js ---

import { showPopup, replacePlaceholders } from './ui.js';

// Define o worker do PDF.js para o módulo
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

// --- Funções Auxiliares do Módulo ---

function formatAddress(fullAddress) {
    if (!fullAddress || typeof fullAddress !== 'string') return 'N/A';
    // Exemplo de entrada: "RUA YEDA,781, TIJUCA, 25975-560, TERESOPOLIS/RJ."
    const parts = fullAddress.split(','); // ["RUA YEDA", "781", " TIJUCA", ...]
    if (parts.length < 3) return fullAddress; // Retorna o original se o formato for inesperado

    // 1. Pega as 3 primeiras partes: "RUA YEDA,781, TIJUCA"
    let address = parts.slice(0, 3).join(',');
    // 2. Substitui a primeira vírgula por um espaço: "RUA YEDA 781, TIJUCA"
    address = address.replace(',', ' ');
    return address.trim();
}

function formatPhone(phone) {
    const cleaned = phone.replace(/\D/g, '');
    const isValid = /^[1-9]{2}(9?\d{8})$/.test(cleaned);
    let formatted = cleaned;
    if (isValid) {
        if (cleaned.length === 10) { // Fixo
            formatted = `${cleaned.slice(0, 2)} ${cleaned.slice(2, 6)}-${cleaned.slice(6)}`;
        } else if (cleaned.length === 11) { // Celular
            formatted = `${cleaned.slice(0, 2)} ${cleaned.slice(2, 7)}-${cleaned.slice(7)}`;
        }
    }
    return { formatted, isValid };
}

function formatDate(dateStr) {
    if (!dateStr) return '';
    const [year, month, day] = dateStr.split('-');
    return `${day}/${month}`;
}

// --- Função Principal de Inicialização ---

export function initializeConversor() {
    let pdfData = {};
    let osTextData = { withdrawal: '', installation: '', os: '' };

    const elements = {
        uploadSection: document.getElementById('uploadSection'),
        dataSection: document.getElementById('dataSection'),
        withdrawalSection: document.getElementById('withdrawalSection'),
        copyButtons: document.getElementById('copyButtons'),
        contratoSpan: document.getElementById('contratoSpan'),
        contrato: document.getElementById('contrato'),
        nome: document.getElementById('nome'),
        oldAddress: document.getElementById('oldAddress'),
        newAddress: document.getElementById('newAddress'),
        fileName: document.getElementById('fileName'),
        phoneError: document.getElementById('phoneError'),
        renewalMessage: document.getElementById('renewalMessage'),
        migrationMessage: document.getElementById('migrationMessage'),
        output: document.getElementById('output'),
        pdfUpload: document.getElementById('pdfUpload'),
        phone: document.getElementById('phone'),
        equipmentType: document.getElementById('equipmentType'),
        withdrawalDate: document.getElementById('withdrawalDate'),
        withdrawalPeriod: document.getElementById('withdrawalPeriod'),
        installationDate: document.getElementById('installationDate'),
        installationPeriod: document.getElementById('installationPeriod'),
        taxValue: document.getElementById('taxValue'),
        signature: document.getElementById('signature'),
        selfWithdrawal: document.getElementById('selfWithdrawal'),
        renewal: document.getElementById('renewal'),
        migration: document.getElementById('migration'),
        carrierSection: document.getElementById('carrierSection'), // ADICIONAR
        oldCarrier: document.getElementById('oldCarrier'), 
        loadPdfBtn: document.getElementById('loadPdfBtn'),
        generateOsBtn: document.getElementById('generateOsBtn'),
        backToUploadBtn: document.getElementById('backToUploadBtn'),
        copyWithdrawalBtn: document.getElementById('copyWithdrawalBtn'),
        copyInstallationBtn: document.getElementById('copyInstallationBtn'),
        copyOsBtn: document.getElementById('copyOsBtn'),
    };

    const setMinDates = () => {
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        const minDate = tomorrow.toISOString().split('T')[0];
        elements.withdrawalDate.min = minDate;
        elements.installationDate.min = minDate;
    };

    const updateInstallationMinDate = () => {
        if (!elements.selfWithdrawal.checked && elements.withdrawalDate.value) {
            elements.installationDate.min = elements.withdrawalDate.value;
        } else {
            setMinDates();
        }
    };

    const updateTaxLogic = () => {
        const isExempt = elements.renewal.checked || elements.migration.checked;
        elements.taxValue.disabled = isExempt;
        elements.renewalMessage.style.display = elements.renewal.checked ? 'block' : 'none';
        elements.migrationMessage.style.display = elements.migration.checked ? 'block' : 'none';
        elements.carrierSection.style.display = elements.migration.checked ? 'block' : 'none';
        elements.taxValue.value = isExempt ? 'isento' : '100';
    };
    
    const handleCheckboxExclusion = (event) => {
        const { id, checked } = event.target;
        if (id === 'renewal') {
            elements.migration.disabled = checked;
        } else if (id === 'migration') {
            elements.renewal.disabled = checked;
        }
    };

    const resetForm = () => {
        pdfData = {};
        osTextData = { withdrawal: '', installation: '', os: '' };
        elements.dataSection.style.display = 'none';
        elements.uploadSection.style.display = 'block';
        elements.pdfUpload.value = '';
        elements.fileName.textContent = 'Nenhum arquivo selecionado';
        elements.output.textContent = '';
        elements.phone.value = '';
        elements.phoneError.textContent = '';
        elements.copyButtons.style.display = 'none';
        elements.renewal.checked = false;
        elements.carrierSection.style.display = 'none';
        elements.oldCarrier.value = 'none';
        elements.migration.checked = false;
        elements.selfWithdrawal.checked = false;
        elements.migration.disabled = false;
        elements.renewal.disabled = false;
        updateTaxLogic();
    };

    async function handlePdfLoad() {
        const file = elements.pdfUpload.files[0];
        if (!file) return showPopup('Por favor, selecione um arquivo PDF.');
        
        try {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            const text = (await (await pdf.getPage(1)).getTextContent()).items.map(item => item.str).join(' ');

            // --- LÓGICA DE EXTRAÇÃO CORRIGIDA USANDO SUA REGEX ORIGINAL E FUNCIONAL ---

            // Esta é a expressão regular correta do seu código original, que busca duas linhas de endereço.
            const oldAddressRegex = /2 - Sobre o\(s\) antigo\(s\) endereco\(s\) de cobrança e instalação\s+([\s\S]*? \/ RJ\.)\s+([\s\S]*? \/ RJ\.)/;
            const newAddressRegex = /3 - Sobre o\(s\) novo\(s\) endereco\(s\) de cobrança e instalação\s+([\s\S]*? \/ RJ\.)\s+([\s\S]*? \/ RJ\.)/;

            pdfData.contrato = text.match(/Aditivo do Contrato (\d+)/)?.[1] || 'N/A';
            pdfData.nomeCompleto = text.match(/CONTRATADA e ([\s\S]*?),/)?.[1].trim() || 'N/A';
            pdfData.primeiroNome = pdfData.nomeCompleto.split(' ')[0].toUpperCase();
            
            // Acessamos o grupo [2], que é o segundo endereço capturado, exatamente como no seu código.
            const rawOldAddress = oldAddressRegex.exec(text)?.[2].trim().toUpperCase();
            const rawNewAddress = newAddressRegex.exec(text)?.[2].trim().toUpperCase();

            pdfData.oldAddress = formatAddress(rawOldAddress) || 'Endereço antigo não encontrado';
            pdfData.newAddress = formatAddress(rawNewAddress) || 'Endereço novo não encontrado';

            // Preenche a UI com os dados
            elements.contratoSpan.textContent = pdfData.contrato;
            elements.contrato.textContent = pdfData.contrato;
            elements.nome.textContent = pdfData.nomeCompleto;
            elements.oldAddress.textContent = pdfData.oldAddress;
            elements.newAddress.textContent = pdfData.newAddress;

            elements.uploadSection.style.display = 'none';
            elements.dataSection.style.display = 'block';

        } catch (error) {
            console.error('Erro ao processar PDF:', error);
            showPopup('Erro ao ler o arquivo PDF.');
            resetForm();
        }
    }

    function handleGenerateOS() {
        const technician = localStorage.getItem('atendenteAtual')?.toUpperCase();
        if (!technician) return showPopup('Selecione um atendente antes de gerar a OS.');

        const { formatted: phone, isValid } = formatPhone(elements.phone.value);
        if (!isValid) {
            elements.phoneError.textContent = 'Telefone inválido. Ex: (21) 98765-4321';
            return;
        }
        elements.phoneError.textContent = '';
        
        const isSelfWithdrawal = elements.selfWithdrawal.checked;
        const withdrawalDay = formatDate(elements.withdrawalDate.value);
        const installationDay = formatDate(elements.installationDate.value);
        
        if (!isSelfWithdrawal && !withdrawalDay) return showPopup('Data de Retirada é obrigatória.');
        if (!installationDay) return showPopup('Data de Instalação é obrigatória.');
        if (!isSelfWithdrawal && elements.installationDate.value && elements.withdrawalDate.value && new Date(elements.installationDate.value) < new Date(elements.withdrawalDate.value)) {
            return showPopup('Instalação não pode ser antes da Retirada.');
        }

        const withdrawalPeriod = elements.withdrawalPeriod.value.toUpperCase();
        const installationPeriod = elements.installationPeriod.value.toUpperCase();
        
        const signature = elements.signature.value === 'digital' ? 'ASSINATURA DIGITAL PENDENTE' : 'TITULAR NO LOCAL PARA ASSINATURA';
        
        let scheduleLines = '';
        if (!isSelfWithdrawal) {
            osTextData.withdrawal = `${withdrawalDay} - ${pdfData.contrato} - ${pdfData.primeiroNome} - ${pdfData.oldAddress} - MUD ENDEREÇO - ${withdrawalPeriod} - ${technician}`;
            scheduleLines += osTextData.withdrawal + '\n';
        } else {
            osTextData.withdrawal = '';
        }
        
        osTextData.installation = `${installationDay} - ${pdfData.contrato} - ${pdfData.primeiroNome} - ${pdfData.newAddress} - MUD ENDEREÇO - ${installationPeriod} - ${technician}`;
        scheduleLines += osTextData.installation;
        
        // ✅ LINHA CORRIGIDA / READICIONADA ABAIXO
        const withdrawalText = isSelfWithdrawal ? 'CLIENTE FAZ A RETIRADA POR CONTA PRÓPRIA' : `RETIRAR EM ${pdfData.oldAddress} DIA ${withdrawalDay} ${withdrawalPeriod}`;
        
        const taxValue = elements.taxValue.value;
        let taxText;
        if (elements.renewal.checked) {
            taxText = 'ISENTO DA TAXA POR RENOVAÇÃO.';
        } else if (elements.migration.checked) {
            taxText = 'ISENTO DA TAXA POR MIGRAÇÃO.';
        } else if (taxValue === 'isento') {
            taxText = 'ISENTO DA TAXA.';
        } else {
            taxText = `TAXA DE R$${taxValue}.`;
        }

        // --- INÍCIO DA NOVA LÓGICA DO PORTADOR ---
        let carrierText = '';
        if (elements.migration.checked) {
            const selectedCarrier = elements.oldCarrier.value;
            if (selectedCarrier !== 'none') {
                carrierText = `** ANTIGO PORTADOR ${selectedCarrier.toUpperCase()} **\n`;
            }
        }
        // --- FIM DA NOVA LÓGICA ---

        // Adiciona a variável 'carrierText' no início da O.S.
        osTextData.os = `${carrierText}${phone} ${pdfData.primeiroNome} | ** ${elements.equipmentType.value.toUpperCase()} **\n${withdrawalText}.\nINSTALAR EM ${pdfData.newAddress} DIA ${installationDay} ${installationPeriod}.\n${taxText}\n${signature}.`;
        
        const fullOutput = `${scheduleLines}\n\n${osTextData.os}`;
        elements.output.textContent = replacePlaceholders(fullOutput);
        elements.output.style.height = 'auto';
        elements.output.style.height = (elements.output.scrollHeight) + 'px';
        elements.copyButtons.style.display = 'flex';
    }

    // --- Configuração Inicial e Event Listeners ---
    setMinDates();

    elements.loadPdfBtn.addEventListener('click', handlePdfLoad);
    elements.generateOsBtn.addEventListener('click', handleGenerateOS);
    elements.backToUploadBtn.addEventListener('click', resetForm);
    elements.copyWithdrawalBtn.addEventListener('click', () => {
        if(osTextData.withdrawal) navigator.clipboard.writeText(osTextData.withdrawal).then(() => showPopup('Agendamento de Retirada copiado!'));
        else showPopup('Não há agendamento de retirada para copiar.');
    });
    elements.copyInstallationBtn.addEventListener('click', () => {
        navigator.clipboard.writeText(osTextData.installation).then(() => showPopup('Agendamento de Instalação copiado!'));
    });
    elements.copyOsBtn.addEventListener('click', () => {
        navigator.clipboard.writeText(replacePlaceholders(osTextData.os)).then(() => showPopup('Texto da O.S. copiado!'));
    });
    elements.pdfUpload.addEventListener('change', () => {
        elements.fileName.textContent = elements.pdfUpload.files[0]?.name || 'Nenhum arquivo selecionado';
    });
    elements.phone.addEventListener('blur', () => {
        const { formatted, isValid } = formatPhone(elements.phone.value);
        elements.phone.value = formatted;
        elements.phoneError.textContent = isValid ? '' : 'Telefone inválido.';
    });
    elements.selfWithdrawal.addEventListener('change', () => {
        elements.withdrawalSection.style.display = elements.selfWithdrawal.checked ? 'none' : 'block';
        updateInstallationMinDate();
    });
    elements.withdrawalDate.addEventListener('change', updateInstallationMinDate);
    elements.renewal.addEventListener('change', updateTaxLogic);
    elements.migration.addEventListener('change', updateTaxLogic);
    elements.renewal.addEventListener('change', handleCheckboxExclusion);
    elements.migration.addEventListener('change', handleCheckboxExclusion);
}

// --- assets\js\firebase.js ---

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getDatabase, ref, set, get, remove } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
import { 
    getAuth, 
    createUserWithEmailAndPassword, 
    signInWithEmailAndPassword, 
    signOut, 
    onAuthStateChanged,
    updateProfile,
    updatePassword 
} from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyB5wO0x-7NFmh6waMKzWzRew4ezfYOmYBI",
    authDomain: "site-ati-75d83.firebaseapp.com",
    databaseURL: "https://site-ati-75d83-default-rtdb.firebaseio.com/",
    projectId: "site-ati-75d83",
    storageBucket: "site-ati-75d83.appspot.com",
    messagingSenderId: "467986581951",
    appId: "1:467986581951:web:046a778a0c9b6967d5790a",
    measurementId: "G-22D5RNGGK6"
};

export let db;
let auth;

export function initializeFirebase() {
    try {
        const app = initializeApp(firebaseConfig);
        db = getDatabase(app);
        auth = getAuth(app);
    } catch (error) {
        console.error("❌ Erro ao inicializar Firebase:", error);
    }
}

function capitalizeFullName(name) {
    if (!name || typeof name !== 'string') return '';
    return name.split(' ').map(word => 
        word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
    ).join(' ');
}

export const loginUser = (email, password) => signInWithEmailAndPassword(auth, email, password);
export const logoutUser = () => signOut(auth);
export const checkAuthState = (callback) => onAuthStateChanged(auth, callback);
export const updateUserPassword = (newPassword) => {
    if (!auth.currentUser) throw new Error("Usuário não autenticado.");
    return updatePassword(auth.currentUser, newPassword);
};

export async function loginWithUsername(username, password) {
    const sanitizedUsername = username.trim().toLowerCase();
    const userRef = ref(db, `atendentes/${sanitizedUsername}`);
    const snapshot = await get(userRef);

    if (!snapshot.exists() || !snapshot.val().email) {
        const error = new Error("Credenciais inválidas.");
        error.code = 'auth/invalid-login-credentials';
        throw error;
    }

    const email = snapshot.val().email;
    return signInWithEmailAndPassword(auth, email, password);
}

export async function createUserAccount(details) {
    const { email, password, username, fullName } = details;
    const sanitizedUsername = username.trim().toLowerCase().replace(/\s+/g, "_");
    if (/[.$#[\]/]/.test(sanitizedUsername)) {
        throw new Error('Nome de usuário inválido.');
    }

    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;
    const formattedFullName = capitalizeFullName(fullName);

    await updateProfile(user, { displayName: formattedFullName });

    const newAtendenteData = {
        nomeCompleto: formattedFullName,
        role: "usuario",
        status: "ativo",
        uid: user.uid,
        email: email
    };

    try {
        const atendenteRef = ref(db, `atendentes/${sanitizedUsername}`);
        await set(atendenteRef, newAtendenteData);
        // Retorna tudo que o app.js precisa para iniciar o app imediatamente
        return { userCredential, sanitizedUsername, newAtendenteData };
    } catch (error) {
        await user.delete();
        console.error("Erro ao gravar no banco de dados, usuário de autenticação foi revertido:", error);
        throw new Error('Este nome de usuário já pode estar em uso ou ocorreu um erro de permissão.');
    }
}

export async function loadAtendentes() {
    const dbRef = ref(db, 'atendentes');
    const snapshot = await get(dbRef);
    return snapshot.exists() ? snapshot.val() : {};
}

export async function loadDataForAttendant(attendant) {
    if (!attendant || !auth.currentUser) return [];
    const dbRef = ref(db, `respostas/${attendant}`);
    const snapshot = await get(dbRef);
    // Lógica simplificada: Apenas lê. Se não existir, retorna vazio.
    return snapshot.exists() ? snapshot.val() : [];
}

export async function saveDataForAttendant(attendant, data) {
    if (!attendant || !auth.currentUser) {
        console.error("Tentativa de salvar dados sem um atendente definido.");
        return;
    }
    const dbRef = ref(db, `respostas/${attendant}`);
    await set(dbRef, data);
}

export async function updateUserFullName(username, newFullName) {
    if (!auth.currentUser) throw new Error("Usuário não autenticado.");
    const formattedName = capitalizeFullName(newFullName);
    const dbRef = ref(db, `atendentes/${username}/nomeCompleto`);
    await set(dbRef, formattedName);
    await updateProfile(auth.currentUser, { displayName: formattedName });
}

async function updateUserData(username, field, value) {
    if (!auth.currentUser) throw new Error("Ação não permitida.");
    const userFieldRef = ref(db, `atendentes/${username}/${field}`);
    return set(userFieldRef, value);
}

export const updateUserRole = (username, newRole) => updateUserData(username, 'role', newRole);
export const updateUserStatus = (username, newStatus) => updateUserData(username, 'status', newStatus);


// --- assets\js\os-editor.js ---

// assets/js/os-editor.js

import { showPopup } from './ui.js';
import { saveDataForAttendant, db } from './firebase.js'; // Precisaremos do 'db' para buscar o modelo mestre
import { ref, get } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

// Variável para guardar todos os templates do usuário (O.S. e Quick Replies)
let allUserTemplates = []; 
let currentUsername = '';

const elements = {
    list: document.getElementById('os-list'),
    form: document.getElementById('os-form'),
    formTitle: document.getElementById('os-form-title'),
    editIndex: document.getElementById('os-edit-index'),
    title: document.getElementById('os-title'),
    text: document.getElementById('os-text'),
    category: document.getElementById('os-category'),
    keywords: document.getElementById('os-keywords'),
    saveBtn: document.getElementById('os-save-btn'),
    newBtn: document.getElementById('os-new-btn'),
    deleteBtn: document.getElementById('os-delete-btn'),
    resetBtn: document.getElementById('os-reset-btn'),
};

function getOsTemplates() {
    return allUserTemplates.filter(t => t.category !== 'quick_reply');
}

function renderList() {
    const osTemplates = getOsTemplates();
    elements.list.innerHTML = '';
    if (osTemplates.length === 0) {
        elements.list.innerHTML = '<p>Nenhum modelo de O.S. encontrado.</p>';
        return;
    }

    // 1. Agrupa os templates por categoria usando reduce
    const groupedByCategory = osTemplates.reduce((acc, template) => {
        const category = template.category || 'Geral'; // Usa 'Geral' se não houver categoria
        if (!acc[category]) {
            acc[category] = [];
        }
        acc[category].push(template);
        return acc;
    }, {});

    // 2. Itera sobre as categorias agrupadas para criar a lista
    for (const category in groupedByCategory) {
        // Cria o título da categoria (ex: <h3>Financeiro</h3>)
        const categoryHeader = document.createElement('div');
        categoryHeader.className = 'os-category-header';
        categoryHeader.textContent = category;
        elements.list.appendChild(categoryHeader);

        // Itera sobre os templates dentro de cada categoria
        groupedByCategory[category].forEach(template => {
            const originalIndex = allUserTemplates.indexOf(template);
            const item = document.createElement('div');
            item.className = 'os-list-item';
            item.textContent = template.title;
            item.dataset.index = originalIndex;
            
            item.addEventListener('click', () => {
                document.querySelectorAll('.os-list-item.active').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                fillFormForEdit(originalIndex);
            });

            elements.list.appendChild(item);
        });
    }
}

function fillFormForEdit(index) {
    const template = allUserTemplates[index];
    if (!template) return;

    elements.formTitle.textContent = `Editando: ${template.title}`;
    elements.editIndex.value = index;
    elements.title.value = template.title;
    elements.text.value = template.text;
    elements.category.value = template.category;
    elements.keywords.value = (template.keywords || []).join(', ');
    elements.deleteBtn.style.display = 'inline-block';
}

function resetForm() {
    elements.form.reset();
    elements.formTitle.textContent = 'Crie um Novo Modelo';
    elements.editIndex.value = '';
    elements.deleteBtn.style.display = 'none';
    document.querySelectorAll('.os-list-item.active').forEach(i => i.classList.remove('active'));
}

async function saveAllTemplates() {
    if (!currentUsername) return;
    await saveDataForAttendant(currentUsername, allUserTemplates);
    renderList(); // Re-renderiza a lista para refletir as mudanças
}

async function handleFormSubmit(e) {
    e.preventDefault();
    const data = {
        title: elements.title.value.trim(),
        text: elements.text.value.trim(),
        category: elements.category.value,
        keywords: elements.keywords.value.split(',').map(k => k.trim()).filter(Boolean),
    };

    if (!data.title) {
        showPopup('O título é obrigatório.', 'error');
        return;
    }

    const editIndex = elements.editIndex.value;

    if (editIndex !== '') { // Editando um existente
        const template = allUserTemplates[parseInt(editIndex)];
        Object.assign(template, data);
    } else { // Criando um novo
        // Garante que não é confundido com uma resposta rápida
        if (data.category === 'quick_reply') data.category = 'Geral'; 
        allUserTemplates.push(data);
    }

    await saveAllTemplates();
    showPopup('Modelo salvo com sucesso!', 'success');
    resetForm();
}

async function handleDelete() {
    const editIndex = elements.editIndex.value;
    if (editIndex === '') return;

    if (confirm('Tem certeza que deseja apagar este modelo?')) {
        allUserTemplates.splice(parseInt(editIndex), 1);
        await saveAllTemplates();
        showPopup('Modelo apagado.', 'info');
        resetForm();
    }
}

async function resetToDefaults() {
    if (!confirm('Isso substituirá TODOS os seus modelos de O.S. pelos modelos padrão. Deseja continuar?')) {
        return;
    }

    try {
        const masterRef = ref(db, 'os_templates_master');
        const snapshot = await get(masterRef);
        if (snapshot.exists()) {
            const masterTemplates = snapshot.val();
            // Remove todos os modelos de O.S. antigos
            const quickReplies = allUserTemplates.filter(t => t.category === 'quick_reply');
            // Cria a nova lista com as respostas rápidas + os modelos mestre
            allUserTemplates = [...quickReplies, ...masterTemplates];
            await saveAllTemplates();
            showPopup('Modelos de O.S. resetados para o padrão!', 'success');
        } else {
            showPopup('Nenhum modelo padrão encontrado no banco de dados.', 'error');
        }
    } catch (error) {
        showPopup('Erro ao buscar modelos padrão.', 'error');
        console.error("Erro ao resetar:", error);
    }
}


export function initializeOsEditor() {
    elements.form.addEventListener('submit', handleFormSubmit);
    elements.newBtn.addEventListener('click', resetForm);
    elements.deleteBtn.addEventListener('click', handleDelete);
    elements.resetBtn.addEventListener('click', resetToDefaults);
}

// API pública para o app.js
export const osEditorModule = {
    setTemplates: (templates, username) => {
        allUserTemplates = templates;
        currentUsername = username;
        renderList();
        resetForm();
    }
};

// --- assets\js\theme.js ---

import { showPopup } from './ui.js';

// Funções auxiliares de cor
function lightenColor(hex, percent) {
    hex = hex.replace("#", "");
    const r = parseInt(hex.substring(0, 2), 16);
    const g = parseInt(hex.substring(2, 4), 16);
    const b = parseInt(hex.substring(4, 6), 16);
    const increase = percent / 100;
    return `#${Math.min(255, Math.round(r + (255 - r) * increase)).toString(16).padStart(2, "0")}${Math.min(255, Math.round(g + (255 - g) * increase)).toString(16).padStart(2, "0")}${Math.min(255, Math.round(b + (255 - b) * increase)).toString(16).padStart(2, "0")}`;
}
function hexToRgba(hex, alpha) {
    hex = hex.replace("#", "");
    const r = parseInt(hex.substring(0, 2), 16);
    const g = parseInt(hex.substring(2, 4), 16);
    const b = parseInt(hex.substring(4, 6), 16);
    return `rgba(${r}, ${g}, ${b}, ${alpha})`;
}
function getLuminance(hex) {
    if (!hex || hex.length < 4) return 0; // Proteção contra cores inválidas
    hex = hex.replace("#", "");
    const r = parseInt(hex.substring(0, 2), 16) / 255;
    const g = parseInt(hex.substring(2, 4), 16) / 255;
    const b = parseInt(hex.substring(4, 6), 16) / 255;
    const a = [r, g, b].map(v => v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4));
    return 0.2126 * a[0] + 0.7152 * a[1] + 0.0722 * a[2];
}

// --- Função Principal de Inicialização do Tema ---
export function initializeTheme() {
    const elements = {
        popup: document.getElementById('customizationPopup'),
        openBtn: document.getElementById('darkModeToggleBtn'),
        saveBtn: document.getElementById('saveCustomizationBtn'),
        closeBtn: document.getElementById('closeCustomizationBtn'),
        themeToggle: document.getElementById('themeToggle'),
        neonBorders: document.getElementById('neonBorders'),
        iconColor: document.getElementById('iconColor'),
        borderColor: document.getElementById('borderColor'),
        textColor: document.getElementById('textColor'),
        styleTag: document.getElementById('custom-styles') || document.createElement('style')
    };
    if (!document.getElementById('custom-styles')) {
        elements.styleTag.id = 'custom-styles';
        document.head.appendChild(elements.styleTag);
    }

    let originalSettings = {};

    const applyCustomizations = (settings) => {
        document.body.classList.toggle('dark-mode', settings.isDarkMode);
        document.body.classList.toggle('no-neon', !settings.neonBorders);

        const contrastColorForIcons = getLuminance(settings.iconColor) > 0.5 ? '#000000' : '#FFFFFF';
        const contrastColorForButtons = getLuminance(settings.borderColor) > 0.5 ? '#111111' : '#FFFFFF';
        
        elements.styleTag.textContent = `
            :root {
                --icon-color: ${settings.iconColor};
                --border-color: ${settings.borderColor};
                --button-bg: ${settings.borderColor};
                --heading-color: ${settings.textColor};
                --button-text: ${contrastColorForButtons};
                --button-hover-bg: ${lightenColor(settings.borderColor, 20)};
                --shadow-color: ${hexToRgba(settings.borderColor, 0.5)};
            }
            .sidebar-button.active {
                background-color: ${settings.iconColor} !important;
                color: ${contrastColorForIcons} !important;
            }
        `;
    };

    const loadSettings = () => {
        const isDarkMode = localStorage.getItem('darkMode') === 'true';
        const defaultColors = {
            iconColor: isDarkMode ? '#0AEEF5' : '#D12E66',
            borderColor: isDarkMode ? '#0AEEF5' : '#D12E66',
            textColor: isDarkMode ? '#E5E5E5' : '#1A3C5A',
        };
        return {
            isDarkMode: isDarkMode,
            neonBorders: localStorage.getItem('neonBorders') !== 'false',
            iconColor: localStorage.getItem('iconColor') || defaultColors.iconColor,
            borderColor: localStorage.getItem('borderColor') || defaultColors.borderColor,
            textColor: localStorage.getItem('textColor') || defaultColors.textColor,
        };
    };

    const saveSettings = (settings) => {
        localStorage.setItem('darkMode', settings.isDarkMode);
        localStorage.setItem('neonBorders', settings.neonBorders);
        localStorage.setItem('iconColor', settings.iconColor);
        localStorage.setItem('borderColor', settings.borderColor);
        localStorage.setItem('textColor', settings.textColor);
    };

    const updatePopupUI = (settings) => {
        elements.themeToggle.checked = settings.isDarkMode;
        elements.neonBorders.checked = settings.neonBorders;
        elements.iconColor.value = settings.iconColor;
        elements.borderColor.value = settings.borderColor;
        elements.textColor.value = settings.textColor;
    };

    elements.openBtn.addEventListener('click', () => {
        originalSettings = loadSettings();
        updatePopupUI(originalSettings);
        elements.popup.style.display = 'block';
    });

    elements.closeBtn.addEventListener('click', () => {
        elements.popup.style.display = 'none';
        applyCustomizations(originalSettings);
    });

    elements.saveBtn.addEventListener('click', () => {
        const newSettings = {
            isDarkMode: elements.themeToggle.checked,
            neonBorders: elements.neonBorders.checked,
            iconColor: elements.iconColor.value,
            borderColor: elements.borderColor.value,
            textColor: elements.textColor.value,
        };
        saveSettings(newSettings);
        applyCustomizations(newSettings);
        elements.popup.style.display = 'none';
        showPopup('Personalização salva!');
    });
    
    ['input', 'change'].forEach(eventType => {
        elements.popup.addEventListener(eventType, () => {
            const previewSettings = {
                isDarkMode: elements.themeToggle.checked,
                neonBorders: elements.neonBorders.checked,
                iconColor: elements.iconColor.value,
                borderColor: elements.borderColor.value,
                textColor: elements.textColor.value,
            };
            applyCustomizations(previewSettings);
        });
    });

    const initialSettings = loadSettings();
    applyCustomizations(initialSettings);
}

// --- assets\js\ui.js ---

// --- Funções de UI reutilizáveis ---

export function showPopup(message, type = 'info', duration = 3000) {
    const popup = document.getElementById('popup');
    if (!popup) return;

    popup.classList.remove('success', 'error', 'info');
    popup.classList.add(type);
    popup.textContent = message;
    popup.classList.add('show');
    
    setTimeout(() => {
        popup.classList.remove('show');
    }, duration);
}
export function showSection(sectionId, username) {
    // Esconde todas as seções de conteúdo
    document.querySelectorAll('.content > div[id$="Section"]').forEach(section => {
        section.style.display = 'none';
    });

    // Mostra apenas a seção desejada
    const activeSection = document.getElementById(`${sectionId}Section`);
    if (activeSection) {
        activeSection.style.display = 'block';
    }

    // Gerencia a classe 'active' nos botões da sidebar
    document.querySelectorAll('.sidebar-button[data-section]').forEach(button => {
        // Remove a classe 'active' de todos os botões
        button.classList.remove('active');
        // Adiciona a classe 'active' apenas ao botão correspondente
        if (button.dataset.section === sectionId) {
            button.classList.add('active');
        }
    });

    updateGreeting(username);
}

export function initializeUI() {
    const sidebar = document.getElementById('sidebar');
    const toggleSidebarBtn = document.getElementById('toggleSidebarBtn');
    if (sidebar && toggleSidebarBtn) {
        toggleSidebarBtn.addEventListener('click', () => {
            sidebar.classList.toggle('expanded');
        });
    }
}

export function updateGreeting(username) {
    const hora = new Date().getHours();
    let saudacaoText = hora >= 5 && hora < 12 ? "Bom dia" :
                         hora >= 12 && hora < 18 ? "Boa tarde" : "Boa noite";
    if (username) {
        const capitalizedUsername = username.charAt(0).toUpperCase() + username.slice(1);
        saudacaoText += `, ${capitalizedUsername}`;
    }                         
    document.getElementById('saudacaoChat').textContent = saudacaoText;
}

export function replacePlaceholders(text) {
    const hora = new Date().getHours();
    const saudacao = hora >= 5 && hora < 12 ? "Bom dia" :
                     hora >= 12 && hora < 18 ? "Boa tarde" : "Boa noite";
    const despedida = hora >= 5 && hora < 12 ? "Tenha uma excelente manhã" :
                      hora >= 12 && hora < 18 ? "Tenha uma excelente tarde" : "Tenha uma excelente noite";
    
    // Verifica se o texto é uma string antes de substituir
    if (typeof text !== 'string') return '';

    return text.replace(/\[SAUDACAO\]/gi, saudacao).replace(/\[DESPEDIDA\]/gi, despedida);
}

export function adjustTextareaHeight(textarea) {
    if (textarea) {
        textarea.style.height = 'auto';
        textarea.style.height = `${textarea.scrollHeight}px`;
    }
}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Conversor de Dados Firebase</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        textarea { width: 100%; height: 200px; margin-bottom: 10px; }
        button { padding: 10px 20px; font-size: 16px; }
    </style>
</head>
<body>
    <h1>Conversor de Estrutura Firebase</h1>
    <p>1. Cole o conteúdo do seu JSON de backup do Firebase na área abaixo.</p>
    <textarea id="inputJson" placeholder="Cole o JSON do Firebase aqui..."></textarea>
    <button onclick="convertData()">Converter</button>
    <p>2. O resultado convertido aparecerá aqui. Copie e importe para o Firebase.</p>
    <textarea id="outputJson" readonly></textarea>

    <script>
        function convertData() {
            const inputArea = document.getElementById('inputJson');
            const outputArea = document.getElementById('outputJson');

            try {
                const data = JSON.parse(inputArea.value);
                const newRespostas = {};

                // Itera sobre cada atendente (victor, igor, etc.)
                for (const attendantName in data.respostas) {
                    const attendantData = data.respostas[attendantName];
                    if (!Array.isArray(attendantData)) continue;

                    const newTemplateList = [];

                    // Itera sobre as categorias de cada atendente
                    attendantData.forEach(categoryObj => {
                        const categoryName = categoryObj.categoryName || 'Geral';
                        const items = categoryObj.items || {};

                        // Itera sobre os itens dentro de cada categoria
                        for (const itemKey in items) {
                            // Tenta adivinhar a categoria (Financeiro, Suporte, etc.)
                            let mainCategory = 'quick_reply'; // Padrão
                            if (categoryName.toLowerCase().includes('suporte')) mainCategory = 'Suporte';
                            if (categoryName.toLowerCase().includes('financeiro')) mainCategory = 'Financeiro';

                            const newTemplate = {
                                category: mainCategory,
                                subCategory: categoryName, // Guarda a categoria original na subcategoria
                                title: itemKey.replace(/_/g, ' ').toUpperCase(), // Converte a chave para um título legível
                                text: items[itemKey],
                                keywords: [] // Keywords precisam ser adicionadas manualmente depois
                            };
                            newTemplateList.push(newTemplate);
                        }
                    });
                    newRespostas[attendantName] = newTemplateList;
                }

                // Monta o objeto final para importação
                const finalObject = { "respostas": newRespostas };
                outputArea.value = JSON.stringify(finalObject, null, 2);
                alert('Conversão concluída!');

            } catch (e) {
                alert('Erro ao processar o JSON. Verifique se o texto foi copiado corretamente. Erro: ' + e.message);
            }
        }
    </script>
</body>
</html>